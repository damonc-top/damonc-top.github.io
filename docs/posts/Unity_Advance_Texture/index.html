<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Unity 纹理高级用法(翻译六)" /><meta name="author" content="catlikecoding" /><meta property="og:locale" content="en" /><meta name="description" content="本篇摘要: 扰动法线以模拟凹凸视觉 从高度场计算法线 采样和混合法线贴图 从切线空间转换到世界空间" /><meta property="og:description" content="本篇摘要: 扰动法线以模拟凹凸视觉 从高度场计算法线 采样和混合法线贴图 从切线空间转换到世界空间" /><link rel="canonical" href="www.damonc.top/posts/Unity_Advance_Texture/" /><meta property="og:url" content="www.damonc.top/posts/Unity_Advance_Texture/" /><meta property="og:site_name" content="仗剑天涯" /><meta property="og:image" content="https://img.damonc.top/posts/2018/month1/catRender6/tutorial-image.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-01-04T20:00:00+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://img.damonc.top/posts/2018/month1/catRender6/tutorial-image.png" /><meta property="twitter:title" content="Unity 纹理高级用法(翻译六)" /><meta name="twitter:site" content="@elonmusk" /><meta name="twitter:creator" content="@catlikecoding" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"catlikecoding","url":"https://catlikecoding.com/unity/tutorials"},"dateModified":"2026-02-15T22:53:15+08:00","datePublished":"2018-01-04T20:00:00+08:00","description":"本篇摘要: 扰动法线以模拟凹凸视觉 从高度场计算法线 采样和混合法线贴图 从切线空间转换到世界空间","headline":"Unity 纹理高级用法(翻译六)","image":{"lqip":"data:image/webp;base64,UklGRlYAAABXRUJQVlA4IEoAAABQAwCdASoUAAoAP3Ggxli0q6ejsAgCkC4JbAAAKnt1Wn2rKAD+cZIkcq0ELIuSp7awtSBy9n5rcv07jR53autWntpVe0d8fxYAAA==","url":"https://img.damonc.top/posts/2018/month1/catRender6/tutorial-image.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"www.damonc.top/posts/Unity_Advance_Texture/"},"url":"www.damonc.top/posts/Unity_Advance_Texture/"}</script><meta name="fediverse:creator" content="@damonc@mastodon.social"><title>Unity 纹理高级用法(翻译六) | 仗剑天涯</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.loli.net" ><link rel="dns-prefetch" href="https://fonts.loli.net" ><link rel="preconnect" href="https://gstatic.loli.net" crossorigin><link rel="dns-prefetch" href="https://gstatic.loli.net" ><link rel="preconnect" href="https://fastly.jsdelivr.net" ><link rel="dns-prefetch" href="https://fastly.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script type="module" src="/assets/js/dist/theme.min.js"></script> <script> /* Apply sidebar collapsed state as early as possible to prevent flickering */ if (localStorage.getItem('sidebar-collapsed') === 'true') { document.documentElement.setAttribute('data-sidebar-collapsed', 'true'); } </script> <script defer src="https://fastly.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js,npm/mermaid@11.12.0/dist/mermaid.min.js"></script> <script type="module" defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/js/data/mathjax.js"></script> <script async src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://fastly.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script> <script type="module"> window.WalinePrefix = "/pro"; import { pageviewCount } from '/assets/js/dist/waline.min.js'; pageviewCount({ serverURL: 'https://comments.damonc.top', update: true }); </script> <script type="module" defer src="/app.min.js?baseurl=&register=true" ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"> <button type="button" id="sidebar-collapse-btn" class="btn" aria-label="Toggle Sidebar"> <i class="fas fa-bars-staggered"></i> </button><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://img.damonc.top/commons/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">仗剑天涯</a><p class="site-subtitle fst-italic mb-0">听说读写看做忘摊手</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/damonc-top" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/elonmusk" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['damoncbl','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Unity 纹理高级用法(翻译六)</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Unity 纹理高级用法(翻译六)</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1515067200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 4, 2018 </time> </span> <span> Updated <time data-ts="1771167195" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 15, 2026 </time> </span><div class="mt-3 mb-3"> <a href="https://img.damonc.top/posts/2018/month1/catRender6/tutorial-image.png" class="popup img-link preview-img blur"><img data-src="https://img.damonc.top/posts/2018/month1/catRender6/tutorial-image.png" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/webp;base64,UklGRlYAAABXRUJQVlA4IEoAAABQAwCdASoUAAoAP3Ggxli0q6ejsAgCkC4JbAAAKnt1Wn2rKAD+cZIkcq0ELIuSp7awtSBy9n5rcv07jR53autWntpVe0d8fxYAAA=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://catlikecoding.com/unity/tutorials">catlikecoding</a> </em> </span><div> <span> <em class="waline-pageview-count" data-path="/posts/Unity_Advance_Texture/"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2937 words" > <em>16 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Unity 纹理高级用法(翻译六)</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Unity 纹理高级用法(翻译六)</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>本篇摘要:</p><ul><li>扰动法线以模拟凹凸视觉<li>从高度场计算法线<li>采样和混合法线贴图<li>从切线空间转换到世界空间</ul><hr /><h2 id="bump-map凹凸贴图"><span class="me-2">Bump Map(凹凸贴图):</span><a href="#bump-map凹凸贴图" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="table-wrapper"><table><thead><tr><th>Bump Map Type<th>Describe<tbody><tr><td>NormalMap<td>法线图，映射公式：normal=pixel*2-1,反映射：pixel=(normal+1)/2. 法线存储既可以在<br />模型空间，也可以在切线空间。//unity顶点输入结构带切线变量，一般存在切线空间更佳<tr><td>HeightMap<td>灰度图(黑白纹理-强度值)，颜色越浅该表面越向外凸起，颜色深越凹。视差映射技术，与<br />Occlusion Map搭配使用体验更佳，计算昂贵<tr><td>Occlusion Map<td>灰度图，表面细节更丰富。颜色值白色表示应该接收完全间接照明的区域，黑色表示没有<br />间接照明。如裂缝或褶皱，实际上不会接收到太多的间接光，可与高度图一起使用<tr><td>Detail Maps<td>参考StandardShader:第二细节纹理，应用第二反照率图和第二法线图，在近距离观察时<br />有清晰的细节，比如毛孔、细小的裂缝等。计算昂贵</table></div><blockquote class="prompt-tip"><p>常用纹理<br /> NormalMap 法线纹理：比较常用<br /> HeightMap 高度纹理(视差映射)：手机平台不常用，使用法线纹理替代<br /> Occlusion Map：细节纹理<br /> Secondary Maps (Detail Maps) &amp; Detail Mask：细节纹理<br /></p></blockquote><h3 id="高度图-heightmap"><span class="me-2">高度图-HeightMap</span><a href="#高度图-heightmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>高度图为了模拟平面的凹凸程度，将高度(黑白色)数据存储在纹理中，由于纹理数据是二维的，即u轴和v轴，那为了得到这些数据为每个片段生成法向量，可分别在u轴和v轴上采样。先从U轴计算$ f(u)=h $ ,如果知道了斜率就能求得u轴上所有点的法向量，但斜率由h的变化程度高低决定。为了近似得到从一个点到下一个点的高度差：</p><figure style="margin:1rem 0;"><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender6/1692664-20191105100150635-879071241.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender6/1692664-20191105100150635-879071241.png" alt="斜率采样示意图，从$f(0) \rightarrow f(1)$" width="100%" height="auto" loading="lazy"></a></div></div><figcaption class="text-center pt-2 pb-2">斜率采样示意图，从$f(0) \rightarrow f(1)$</figcaption></figure><p>这是对切向量的一个粗略的估算，它把整张纹理作为线性的斜率。那为了避免这种粗略计算，可以采样两个靠的更近点的。例如，从$ 0 \rightarrow {1\over2} $，那这两点的斜率$ f=f({1 \over 2})-f(0) $，同时f因子被缩小，需要乘以相应的倍数。$ 2f({1 \over 2})-f(0) $。扩展开来，可以得到如下的函数：δ值越小越精确，必须大于0小于1.</p><p>差分函数:</p>\[f^`(u) = {f(u+δ) - f(u) \over δ}\]<p>有限差分函数:</p>\[f^`(u)= lim_{(δ\rightarrow 0)} {f(u+δ) - f(u) \over δ}\]<p>那么切向量就是 \(\begin{bmatrix} 1\\ f`(u)\\ 0 \end{bmatrix}^\mathrm{T}\) ，从切向量计算法向量 \(\begin{bmatrix} f’(u)\\ 1\\ 0 \end{bmatrix}^\mathrm{T}\)</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">sampler2D</span> <span class="n">_HeightMap</span><span class="p">;</span>
<span class="n">float4</span> <span class="n">_HeightMap_TexelSize</span><span class="p">;</span><span class="c1">//xy是纹素坐标(uv)，zw是整张纹理宽高</span>
<span class="n">float2</span> <span class="n">delta</span> <span class="p">=</span> <span class="nf">float2</span><span class="p">(</span><span class="n">_HeightMap_TexelSize</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span><span class="c1">//u轴</span>
<span class="kt">float</span> <span class="n">h1</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_HeightMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span><span class="c1">//模型uv在高度图采样</span>
<span class="kt">float</span> <span class="n">h2</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_HeightMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="p">+</span> <span class="n">delta</span><span class="p">);</span><span class="c1">//二次采样</span>

<span class="c1">//第一步套用公式</span>
<span class="c1">//i.normal = float3(1, (h2 - h1) / delta.x, 0); </span>

<span class="c1">//第二步优化，缩放向量并不改变方向，消除了除法操作</span>
<span class="c1">//i.normal = float3( delta.x, (h2 - h1), 0);</span>

<span class="c1">//第三步改变垂直方向，需要得到法向量正向垂直于表面，那么逆时针旋转90度以翻转x分量符号.//Y是扰动法向量的高低变化因子</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">float3</span><span class="p">(</span> <span class="n">h1</span> <span class="p">-</span> <span class="n">h2</span><span class="p">,</span> <span class="m">1</span> <span class="p">,</span> <span class="m">0</span><span class="p">);</span>

<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
</pre></table></code></div></div><p>有限差分只在一个方向近似求值，为了更好近似可以在两个方向线性逼近.</p><p>中心差分:</p>\[f^`(u)= lim_{(δ\rightarrow 0)} {f(u+{δ\over 2}) - f(u - {δ\over 2}) \over δ}\]<div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">float2</span> <span class="n">delta</span> <span class="p">=</span> <span class="nf">float2</span><span class="p">(</span><span class="n">_HeightMap_TexelSize</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="m">0.5</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">h1</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_HeightMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="p">-</span> <span class="n">delta</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">h2</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_HeightMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="p">+</span> <span class="n">delta</span><span class="p">);</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">float3</span><span class="p">(</span><span class="n">h1</span> <span class="p">-</span> <span class="n">h2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</pre></table></code></div></div><p>那么$f’(u, v)$计算$f’(v)$同理,切向量 \(\begin{bmatrix} 0\\ f’(v)\\ 1 \end{bmatrix}^\mathrm{T}\) 法向量是 \(\begin{bmatrix} 0\\ 1\\ f’(v) \end{bmatrix}^\mathrm{T}\)</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">float2</span> <span class="n">du</span> <span class="p">=</span> <span class="nf">float2</span><span class="p">(</span><span class="n">_HeightMap_TexelSize</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="m">0.5</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">u1</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_HeightMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="p">-</span> <span class="n">du</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">u2</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_HeightMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="p">+</span> <span class="n">du</span><span class="p">);</span>
<span class="c1">//float3 tu = float3(1, u2 - u1, 0);</span>
<span class="n">float2</span> <span class="n">dv</span> <span class="p">=</span> <span class="nf">float2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">_HeightMap_TexelSize</span><span class="p">.</span><span class="n">y</span> <span class="p">*</span> <span class="m">0.5</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">v1</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_HeightMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="p">-</span> <span class="n">dv</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">v2</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_HeightMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="p">+</span> <span class="n">dv</span><span class="p">);</span>
<span class="c1">//float3 tv = float3(0, v2 - v1, 1);</span>
<span class="c1">//i.normal = cross(tv, tu);//直接使用叉积求出垂直于u和v轴的法向量=&gt;(0*(v2-v1)-(u2-u1)*1, 1*1-0*0, (u2-u1)*0-1*(v2-v1))=(u1-u2, 1, v1-v2)</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">float3</span><span class="p">(</span><span class="n">u1</span> <span class="p">-</span> <span class="n">u2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">v1</span> <span class="p">-</span> <span class="n">v2</span><span class="p">);</span>

<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
</pre></table></code></div></div><p>\(\begin{bmatrix} 0\\ f’(v)\\ 1 \end{bmatrix}\) x \(\begin{bmatrix} 1\\ f’(u)\\ 0 \end{bmatrix}\) = \(\begin{bmatrix} -f’(u)\\ 1\\ -f’(v) \end{bmatrix}\)</p><h3 id="法线-normal-map"><span class="me-2">法线-Normal Map</span><a href="#法线-normal-map" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>高度图是每帧采样实时计算法线，为了避免高额计算量，采用预制法线纹理代替。</p><figure style="margin:1rem 0;"><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender6/1692664-20191105100152927-1516726103.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender6/1692664-20191105100152927-1516726103.png" alt="Unity中使用高度图" width="100%" height="auto" loading="lazy"></a></div></div><figcaption class="text-center pt-2 pb-2">Unity中使用高度图</figcaption></figure><p>导入高度图作为法线贴图预先计算法线纹理必须勾选Create from Grayscale，白色表示相对更高，黑色表示相对更低。</p><p>像素分量范围是[0,1]，而法线分量范围[-1,1]。相互映射转换公式为：</p><p>$ pixel = {(normal+1)\over 2} $</p><p>$ normal = pixel \cdot 2 – 1 $</p><p>法线纹理呈现淡蓝色，这是因为法向映射最常见的约定是将向上的方向存储在Z分量中(垂直于表面外侧)，又由于DXT5nm纹理压缩格式的原因，只存储了X与Y分量舍弃了Z分量(Y分量存储在G通道，X分量存储在A通道，RB通道被舍弃)。通过推导法向量的单位向量可得Z分量：</p>\[|N| = |N|^2 = N_x{^2} + N_y{^2} + N_z{^2} = 1\] \[Nz = \sqrt{1 - N_x{^2} - N_y{^2}}\]<div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">//第一种方法</span>
<span class="c1">// Unpack normal as DXT5nm (1, y, 1, x) or BC5 (x, y, 0, 1)</span>
<span class="c1">//dxt5压缩对应的位置取wy</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xy</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_NormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">).</span><span class="n">wy</span> <span class="p">*</span> <span class="m">2</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xy</span> <span class="p">*=</span> <span class="n">_BumpScale</span><span class="p">;</span><span class="c1">//计算Z之前缩放才有效，平坦凹凸程度</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="nf">sqrt</span><span class="p">(</span><span class="m">1</span> <span class="p">-</span> <span class="nf">saturate</span><span class="p">(</span><span class="nf">dot</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xy</span><span class="p">)));</span><span class="c1">//dot模拟平方计算-((x,y)*(x,y))=-x方-y方</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xzy</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>

<span class="c1">//第二种方法</span>
<span class="c1">//UnityStandardUtils.cginc包含了解码法线函数，替代上面的方法</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_NormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">),</span> <span class="n">_BumpScale</span><span class="p">);</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xzy</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="细节纹理与细节法线-detail-mapssecond-texture-与-detail-normals"><span class="me-2">细节纹理与细节法线-Detail Maps(Second Texture) 与 Detail Normals</span><a href="#细节纹理与细节法线-detail-mapssecond-texture-与-detail-normals" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>第二细节纹理与MainTexture合并，简要代码如下：</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">//顶点uv坐标映射到纹理uv</span>
<span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span>  <span class="p">=</span> <span class="nf">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_MainTex</span><span class="p">);</span>
<span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">zw</span> <span class="p">=</span> <span class="nf">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_DetailTex</span><span class="p">);</span>
<span class="c1">//计算第二纹理的影响</span>
<span class="n">float3</span> <span class="n">albedo</span> <span class="p">=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span><span class="p">).</span><span class="n">rgb</span> <span class="p">*</span> <span class="n">_Tint</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<span class="n">albedo</span> <span class="p">*=</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_DetailTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">zw</span><span class="p">)</span> <span class="p">*</span> <span class="n">unity_ColorSpaceDouble</span><span class="p">;</span><span class="c1">//颜色空间转换</span>
</pre></table></code></div></div><p>第二细节纹理的法线映射</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_NormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span><span class="p">),</span> <span class="n">_BumpScale</span><span class="p">);</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_DetailNormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">zw</span><span class="p">),</span> <span class="n">_DetailBumpScale</span><span class="p">);</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xzy</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="法线融合-blending-normals"><span class="me-2">法线融合-Blending Normals</span><a href="#法线融合-blending-normals" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>方式一：(main.normal + details.normal) * 0.5; 简单容易，但结果不是很好。主纹理和细节纹理都变得平坦。理想情况下，当其中一个是平的，期望它不会影响到另一个。</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">float3</span> <span class="n">mainNormal</span> <span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_NormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span><span class="p">),</span> <span class="n">_BumpScale</span><span class="p">);</span>
<span class="n">float3</span> <span class="n">detailNormal</span> <span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_DetailNormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">zw</span><span class="p">),</span> <span class="n">_DetailBumpScale</span><span class="p">);</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="p">(</span><span class="n">mainNormal</span> <span class="p">+</span> <span class="n">detailNormal</span><span class="p">)</span> <span class="p">*</span> <span class="m">0.5</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xzy</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
</pre></table></code></div></div><p>方式二：用z分量做缩放因子求偏导函数，然后相加。[Mx, My, Mz]T = [Mx/Mz, My/Mz, 1]T 同理求得detail偏导函数，然后相加：[Mx/Mz + Dx/Dz, My/Mz + Dy/Dz, 1]T .效果很好，但是在合并陡峭时仍将失去细节。</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">float3</span> <span class="n">mainNormal</span> <span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_NormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span><span class="p">),</span> <span class="n">_BumpScale</span><span class="p">);</span>
<span class="n">float3</span> <span class="n">detailNormal</span> <span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_DetailNormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">zw</span><span class="p">),</span> <span class="n">_DetailBumpScale</span><span class="p">);</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">float3</span><span class="p">(</span><span class="n">mainNormal</span><span class="p">.</span><span class="n">xy</span> <span class="p">/</span> <span class="n">mainNormal</span><span class="p">.</span><span class="n">z</span> <span class="p">+</span> <span class="n">detailNormal</span><span class="p">.</span><span class="n">xy</span> <span class="p">/</span> <span class="n">detailNormal</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xzy</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
</pre></table></code></div></div><p>方式三：白色调和，对上一步合并法线分别乘以MzDz,然后再去掉x和y的缩放因子夸大缩放，使陡峭更加明显，同时平坦的法线，它不会影响到另一个了。</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">float3</span> <span class="n">mainNormal</span> <span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_NormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span><span class="p">),</span> <span class="n">_BumpScale</span><span class="p">);</span>
<span class="n">float3</span> <span class="n">detailNormal</span> <span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_DetailNormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">zw</span><span class="p">),</span> <span class="n">_DetailBumpScale</span><span class="p">);</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">float3</span><span class="p">(</span><span class="n">mainNormal</span><span class="p">.</span><span class="n">xy</span> <span class="p">+</span> <span class="n">detailNormal</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">mainNormal</span><span class="p">.</span><span class="n">z</span> <span class="p">*</span> <span class="n">detailNormal</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
<span class="c1">//UnityStandardUtils包含了混合函数</span>
<span class="c1">//i.normal = BlendNormals(mainNormal, detailNormal);</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">xzy</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span><span class="n">View</span> <span class="n">Code</span>
</pre></table></code></div></div><h3 id="切线空间-tangent-space"><span class="me-2">切线空间-Tangent Space</span><a href="#切线空间-tangent-space" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>切线空间的法线纹理：顶点为原点，z轴为法线方向，x轴为切线方向，y轴为垂直于xz的副切线方向。Unity导入模型计算切线默认使用了mikktspace(在顶点着色器计算)，也可以在片元着色器计算cross得到副切线向量。</p><p>顶点下计算：</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">VertexData</span> <span class="p">{</span>
	<span class="n">float4</span> <span class="n">tangent</span> <span class="p">:</span> <span class="n">TANGENT</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">Interpolators</span> <span class="p">{</span>
	<span class="n">float4</span> <span class="n">tangent</span> <span class="p">:</span> <span class="n">TEXCOORD2</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>使用UnityCG中的UnityObjectToWorldDir在顶点程序中将切线转换为世界空间。 当然，这仅适用于切线的XYZ部分。 它的W分量需要不加修改地传递。</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">Interpolators</span> <span class="nf">MyVertexProgram</span> <span class="p">(</span><span class="n">VertexData</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">Interpolators</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">i</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">UNITY_MATRIX_MVP</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
	<span class="n">i</span><span class="p">.</span><span class="n">worldPos</span> <span class="p">=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">unity_ObjectToWorld</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
	<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">UnityObjectToWorldNormal</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
	<span class="n">i</span><span class="p">.</span><span class="n">tangent</span> <span class="p">=</span> <span class="nf">float4</span><span class="p">(</span><span class="nf">UnityObjectToWorldDir</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">),</span> <span class="n">v</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">w</span><span class="p">);</span>
	<span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span> <span class="p">=</span> <span class="nf">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_MainTex</span><span class="p">);</span>
	<span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">zw</span> <span class="p">=</span> <span class="nf">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_DetailTex</span><span class="p">);</span>
	<span class="nf">ComputeVertexLightColor</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>现在我们可以将法线从切线空间转换为世界空间。</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">float3</span> <span class="n">binormal</span> <span class="p">=</span> <span class="nf">cross</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">)</span> <span class="p">*</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span>
	<span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span> <span class="p">+</span>
	<span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">y</span> <span class="p">*</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">+</span>
	<span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">z</span> <span class="p">*</span> <span class="n">binormal</span>
<span class="p">);</span>
</pre></table></code></div></div><p>去掉显式YZ交换，将其与空间转换结合在一起。</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">//tangentSpaceNormal = tangentSpaceNormal.xzy;	</span>
<span class="n">float3</span> <span class="n">binormal</span> <span class="p">=</span> <span class="nf">cross</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">)</span> <span class="p">*</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span>
	<span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span> <span class="p">+</span>
	<span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">y</span> <span class="p">*</span> <span class="n">binormal</span> <span class="p">+</span>
	<span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">z</span> <span class="p">*</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span>
<span class="err">）</span><span class="p">;</span>

</pre></table></code></div></div><p>在构造副法线时，还有一个额外的细节。假设一个对象的scale设置为(- 1,1,1)，这意味着它是镜像的。在这种情况下，我们必须翻转副法线，来正确地镜像切线空间。事实上，当奇数维数为负时，我们必须这样做。_UnityShaderVariables_通过定义float4 unity_WorldTransformParams变量来帮助我们完成这个任务。当需要翻转副法线时，它的第四个分量为- 1，否则为1。</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">float3</span> <span class="n">binormal</span> <span class="p">=</span> <span class="nf">cross</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">)</span> <span class="p">*(</span><span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">w</span> <span class="p">*</span> <span class="n">unity_WorldTransformParams</span><span class="p">.</span><span class="n">w</span><span class="p">);</span>
</pre></table></code></div></div><h2 id="转换空间"><span class="me-2">转换空间</span><a href="#转换空间" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>在世界空间下计算</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="n">fixed4</span> <span class="nf">MyFrag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">v</span><span class="p">)</span> <span class="p">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
	<span class="c1">//...</span>
	<span class="n">float3</span> <span class="n">tangentSpaceNormal</span><span class="p">=</span> <span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_NormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span><span class="p">),</span> <span class="n">_BumpScale</span><span class="p">);</span>
	<span class="err">#</span><span class="k">if</span> <span class="nf">defined</span><span class="p">(</span><span class="n">BINORMAL_PER_FRAGMENT</span><span class="p">)</span>
	    <span class="n">float3</span> <span class="n">binormal</span> <span class="p">=</span> <span class="nf">cross</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">)</span> <span class="p">*</span> <span class="n">v</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
	<span class="err">#</span><span class="k">else</span>
	    <span class="n">float3</span> <span class="n">binormal</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">binormal</span><span class="p">;</span>
	<span class="err">#</span><span class="n">endif</span>
	<span class="c1">//把切线空间转到世界空间</span>
	<span class="c1">//tangentSpaceNormal * [v.tangent,binromal, v.normal]T</span>
	<span class="n">v</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span>
	    <span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">v</span><span class="p">.</span><span class="n">tangent</span> <span class="p">+</span>
	    <span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">y</span> <span class="p">*</span> <span class="n">binormal</span> <span class="p">+</span>
	    <span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">z</span> <span class="p">*</span> <span class="n">v</span><span class="p">.</span><span class="n">normal</span>
	<span class="p">);</span>
	<span class="c1">//...</span>
<span class="p">}</span>
</pre></table></code></div></div><p>在切线空间计算</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">//计算副切线</span>
<span class="n">float3</span> <span class="n">binormal</span> <span class="p">=</span> <span class="nf">cross</span><span class="p">(</span><span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">),</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">))</span> <span class="p">*</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<span class="c1">//切线空间矩阵//行优先的填充</span>
<span class="n">float3x3</span> <span class="n">t_matrix</span> <span class="p">=</span> <span class="nf">float3x3</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">binormal</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>
<span class="c1">//把各种信息转到切线空间下参与计算</span>
</pre></table></code></div></div><h3 id="副切线在哪算合适"><span class="me-2">副切线在哪算合适</span><a href="#副切线在哪算合适" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在顶点计算不必计算叉乘函数，通过宏定义开启。</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">Interpolators</span> <span class="p">{</span>
	<span class="n">float4</span> <span class="n">position</span> <span class="p">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
	<span class="n">float4</span> <span class="n">uv</span> <span class="p">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
	<span class="n">float3</span> <span class="n">normal</span> <span class="p">:</span> <span class="n">TEXCOORD1</span><span class="p">;</span>

	<span class="err">#</span><span class="k">if</span> <span class="nf">defined</span><span class="p">(</span><span class="n">BINORMAL_PER_FRAGMENT</span><span class="p">)</span>
		<span class="n">float4</span> <span class="n">tangent</span> <span class="p">:</span> <span class="n">TEXCOORD2</span><span class="p">;</span>
	<span class="err">#</span><span class="k">else</span>
		<span class="n">float3</span> <span class="n">tangent</span> <span class="p">:</span> <span class="n">TEXCOORD2</span><span class="p">;</span>
		<span class="n">float3</span> <span class="n">binormal</span> <span class="p">:</span> <span class="n">TEXCOORD3</span><span class="p">;</span>
	<span class="err">#</span><span class="n">endif</span>

	<span class="n">float3</span> <span class="n">worldPos</span> <span class="p">:</span> <span class="n">TEXCOORD4</span><span class="p">;</span>

	<span class="err">#</span><span class="k">if</span> <span class="nf">defined</span><span class="p">(</span><span class="n">VERTEXLIGHT_ON</span><span class="p">)</span>
		<span class="n">float3</span> <span class="n">vertexLightColor</span> <span class="p">:</span> <span class="n">TEXCOORD5</span><span class="p">;</span>
	<span class="err">#</span><span class="n">endif</span>
<span class="p">};</span>
</pre></table></code></div></div><p>如果不确定在哪里计算比较好，可以同时支持这两种方法。假设定义了BINORMAL_PER_FRAGMENT，我们逐像素计算每个片段的副法线。否则，逐顶点计算。在前一种情况下，我们保持我们的float4 tangent变量 。在后者中，我们需要两个float3变量。</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="n">float3</span> <span class="nf">CreateBinormal</span> <span class="p">(</span><span class="n">float3</span> <span class="n">normal</span><span class="p">,</span> <span class="n">float3</span> <span class="n">tangent</span><span class="p">,</span> <span class="kt">float</span> <span class="n">binormalSign</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nf">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">)</span> <span class="p">*</span>
		<span class="p">(</span><span class="n">binormalSign</span> <span class="p">*</span> <span class="n">unity_WorldTransformParams</span><span class="p">.</span><span class="n">w</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Interpolators</span> <span class="nf">MyVertexProgram</span> <span class="p">(</span><span class="n">VertexData</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">Interpolators</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">i</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">UNITY_MATRIX_MVP</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
	<span class="n">i</span><span class="p">.</span><span class="n">worldPos</span> <span class="p">=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">unity_ObjectToWorld</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
	<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">UnityObjectToWorldNormal</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">normal</span><span class="p">);</span>

	<span class="err">#</span><span class="k">if</span> <span class="nf">defined</span><span class="p">(</span><span class="n">BINORMAL_PER_FRAGMENT</span><span class="p">)</span>
		<span class="n">i</span><span class="p">.</span><span class="n">tangent</span> <span class="p">=</span> <span class="nf">float4</span><span class="p">(</span><span class="nf">UnityObjectToWorldDir</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">),</span> <span class="n">v</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">w</span><span class="p">);</span>
	<span class="err">#</span><span class="k">else</span>
		<span class="n">i</span><span class="p">.</span><span class="n">tangent</span> <span class="p">=</span> <span class="nf">UnityObjectToWorldDir</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
		<span class="n">i</span><span class="p">.</span><span class="n">binormal</span> <span class="p">=</span> <span class="nf">CreateBinormal</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">w</span><span class="p">);</span>
	<span class="err">#</span><span class="n">endif</span>

	<span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span> <span class="p">=</span> <span class="nf">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_MainTex</span><span class="p">);</span>
	<span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">zw</span> <span class="p">=</span> <span class="nf">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_DetailTex</span><span class="p">);</span>
	<span class="nf">ComputeVertexLightColor</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">InitializeFragmentNormal</span><span class="p">(</span><span class="n">inout</span> <span class="n">Interpolators</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">float3</span> <span class="n">mainNormal</span> <span class="p">=</span>
		<span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_NormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">xy</span><span class="p">),</span> <span class="n">_BumpScale</span><span class="p">);</span>
	<span class="n">float3</span> <span class="n">detailNormal</span> <span class="p">=</span>
		<span class="nf">UnpackScaleNormal</span><span class="p">(</span><span class="nf">tex2D</span><span class="p">(</span><span class="n">_DetailNormalMap</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">.</span><span class="n">zw</span><span class="p">),</span> <span class="n">_DetailBumpScale</span><span class="p">);</span>
	<span class="n">float3</span> <span class="n">tangentSpaceNormal</span> <span class="p">=</span> <span class="nf">BlendNormals</span><span class="p">(</span><span class="n">mainNormal</span><span class="p">,</span> <span class="n">detailNormal</span><span class="p">);</span>

	<span class="err">#</span><span class="k">if</span> <span class="nf">defined</span><span class="p">(</span><span class="n">BINORMAL_PER_FRAGMENT</span><span class="p">)</span>
		<span class="n">float3</span> <span class="n">binormal</span> <span class="p">=</span> <span class="nf">CreateBinormal</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span><span class="p">.</span><span class="n">w</span><span class="p">);</span>
	<span class="err">#</span><span class="k">else</span>
		<span class="n">float3</span> <span class="n">binormal</span> <span class="p">=</span> <span class="n">i</span><span class="p">.</span><span class="n">binormal</span><span class="p">;</span>
	<span class="err">#</span><span class="n">endif</span>

	<span class="n">i</span><span class="p">.</span><span class="n">normal</span> <span class="p">=</span> <span class="nf">normalize</span><span class="p">(</span>
		<span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">i</span><span class="p">.</span><span class="n">tangent</span> <span class="p">+</span>
		<span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">y</span> <span class="p">*</span> <span class="n">binormal</span> <span class="p">+</span>
		<span class="n">tangentSpaceNormal</span><span class="p">.</span><span class="n">z</span> <span class="p">*</span> <span class="n">i</span><span class="p">.</span><span class="n">normal</span>
	<span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>要对所有Pass块生效，需要使用CGINCLUDE … ENDCG包含</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/unity3d/">Unity3D</a>, <a href="/categories/shader/">Shader</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/shader/" class="post-tag no-text-decoration" >Shader</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Unity%20%E7%BA%B9%E7%90%86%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95(%E7%BF%BB%E8%AF%91%E5%85%AD)%20-%20%E4%BB%97%E5%89%91%E5%A4%A9%E6%B6%AF&url=www.damonc.top%2Fposts%2FUnity_Advance_Texture%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Unity%20%E7%BA%B9%E7%90%86%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95(%E7%BF%BB%E8%AF%91%E5%85%AD)%20-%20%E4%BB%97%E5%89%91%E5%A4%A9%E6%B6%AF&u=www.damonc.top%2Fposts%2FUnity_Advance_Texture%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=www.damonc.top%2Fposts%2FUnity_Advance_Texture%2F&text=Unity%20%E7%BA%B9%E7%90%86%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95(%E7%BF%BB%E8%AF%91%E5%85%AD)%20-%20%E4%BB%97%E5%89%91%E5%A4%A9%E6%B6%AF" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/flat-and-wireframe-shading/">平面着色与线框着色(翻译二十一)</a><li class="text-truncate lh-lg"> <a href="/posts/unity-tessellation/">曲面细分(翻译二十二)</a><li class="text-truncate lh-lg"> <a href="/posts/unity-surface-displacement/">曲面细分表面置换(翻译二十三)</a><li class="text-truncate lh-lg"> <a href="/posts/unity-bloom/">Bloom模糊光照(翻译二十四)</a><li class="text-truncate lh-lg"> <a href="/posts/claude-code-guide/">Claude Code学习总结：目录导航</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/shader/">Shader</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai/">AI</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli-agent/">CLI Agent</a> <a class="post-tag btn btn-outline-primary" href="/tags/best-practices/">Best Practices</a> <a class="post-tag btn btn-outline-primary" href="/tags/post-processing/">Post Processing</a> <a class="post-tag btn btn-outline-primary" href="/tags/srp/">SRP</a> <a class="post-tag btn btn-outline-primary" href="/tags/anti-aliasing/">Anti-aliasing</a> <a class="post-tag btn btn-outline-primary" href="/tags/architecture/">Architecture</a> <a class="post-tag btn btn-outline-primary" href="/tags/bloom/">Bloom</a> <a class="post-tag btn btn-outline-primary" href="/tags/configuration/">Configuration</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/Unity_ShaderGUI_Extension_2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1515333600" data-df="ll" > Jan 7, 2018 </time><h4 class="pt-0 my-2">Unity Shader GUI 扩展二(翻译十)</h4><div class="text-muted"><p>本篇摘要: 把自身阴影烘焙进材质 增加细节纹理部分 支持更丰富的shader变体 一次编辑多个材质球 遮挡区域的Self-Shading 美术能够创作非常复杂丰富的表面纹理，它只是一个视错觉。为了增强表面纹理视觉真实感，引入Self-Shading。 如何增强呢？通常我们使用了法线来增强模型表面的凹凸层次感，法线带来的视觉增强是第一步，但是法线只适用于采样直接光...</p></div></div></a></article><article class="col"> <a href="/posts/Unity_ShaderGUI_Extension_1/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1515326400" data-df="ll" > Jan 7, 2018 </time><h4 class="pt-0 my-2">Unity Shader GUI 扩展一(翻译九)</h4><div class="text-muted"><p>选中当前材质后，若材质使用的Shader调用了GUI拓展，则会自动读取该Shader的所有属性。通过重实现OnGUI函数后，获取其参数地址就能读取。</p></div></div></a></article><article class="col"> <a href="/posts/Unity_Reflection/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1515240000" data-df="ll" > Jan 6, 2018 </time><h4 class="pt-0 my-2">Unity Reflection 反射(翻译八)</h4><div class="text-muted"><p>一块完美的镜子是不会发生漫反射，但现在我们自己的Shader包含的光照：环境光、漫反射、高光反射、纹理、阴影，结果看起来蛮好。但是当把Metallic设为1，Smoothness设位0.95，看起来很亮就很不自然了。从下图看尽管颜色是白色但整个表面都是黑色，只有一个很小的高亮点。这个亮点形成1是光源的入射，2朝向观察者的反射。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/Unity_Multi_Light/" class="btn btn-outline-primary" aria-label="Older" ><p>Unity 基础光照多光源采样(翻译五)</p></a> <a href="/posts/Unity_Shadows/" class="btn btn-outline-primary" aria-label="Newer" ><p>Unity Shadow 阴影(翻译七)</p></a></nav><div id="waline-container" class="mt-5 pt-4" style="border-top: 1px dashed #ccc; padding-top: 20px;"><div id="waline"></div></div><link rel="stylesheet" href="/assets/css/waline.css"> <script type="module"> window.WalinePrefix = "/pro"; const observer = new IntersectionObserver((entries) => { if (entries[0].isIntersecting) { observer.disconnect(); import('/assets/js/dist/waline.min.js').then(({ init }) => { init({ el: '#waline', serverURL: 'https://comments.damonc.top', dark: 'html[data-mode="dark"]', emoji: [ 'https://fastly.jsdelivr.net/npm/@waline/emojis@1.4.0/qq' ], reaction: true, pageview: false }); }); } }); observer.observe(document.getElementById('waline-container')); </script><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2026</time> <a href="https://github.com/damonc-top">仗剑天涯</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>The blog is powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/shader/">Shader</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai/">AI</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli-agent/">CLI Agent</a> <a class="post-tag btn btn-outline-primary" href="/tags/best-practices/">Best Practices</a> <a class="post-tag btn btn-outline-primary" href="/tags/post-processing/">Post Processing</a> <a class="post-tag btn btn-outline-primary" href="/tags/srp/">SRP</a> <a class="post-tag btn btn-outline-primary" href="/tags/anti-aliasing/">Anti-aliasing</a> <a class="post-tag btn btn-outline-primary" href="/tags/architecture/">Architecture</a> <a class="post-tag btn btn-outline-primary" href="/tags/bloom/">Bloom</a> <a class="post-tag btn btn-outline-primary" href="/tags/configuration/">Configuration</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
