<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Unity 多纹理融合(翻译三)" /><meta name="author" content="catlikecoding" /><meta property="og:locale" content="en" /><meta name="description" content="本篇摘要： 采样多个纹理 应用细节纹理 处理线性空间中的颜色 使用 splat 地图" /><meta property="og:description" content="本篇摘要： 采样多个纹理 应用细节纹理 处理线性空间中的颜色 使用 splat 地图" /><link rel="canonical" href="www.damonc.top/posts/Unity_Combine_Texture/" /><meta property="og:url" content="www.damonc.top/posts/Unity_Combine_Texture/" /><meta property="og:site_name" content="仗剑天涯" /><meta property="og:image" content="https://img.damonc.top/posts/2018/month1/catRender3/tutorial-image.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-01-02T20:00:00+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://img.damonc.top/posts/2018/month1/catRender3/tutorial-image.png" /><meta property="twitter:title" content="Unity 多纹理融合(翻译三)" /><meta name="twitter:site" content="@elonmusk" /><meta name="twitter:creator" content="@catlikecoding" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"catlikecoding","url":"https://catlikecoding.com/unity/tutorials"},"dateModified":"2018-01-02T20:00:00+08:00","datePublished":"2018-01-02T20:00:00+08:00","description":"本篇摘要： 采样多个纹理 应用细节纹理 处理线性空间中的颜色 使用 splat 地图","headline":"Unity 多纹理融合(翻译三)","image":{"lqip":"data:image/webp;base64,UklGRkQAAABXRUJQVlA4IDgAAABQAwCdASoUAAoAP3Gixlk0rCejsAgCkC4JYwAARRmTpjRwAAD+Ejdyec5rm2EWtFZH9b+P4QAAAA==","url":"https://img.damonc.top/posts/2018/month1/catRender3/tutorial-image.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"www.damonc.top/posts/Unity_Combine_Texture/"},"url":"www.damonc.top/posts/Unity_Combine_Texture/"}</script><meta name="fediverse:creator" content="@damonc@mastodon.social"><title>Unity 多纹理融合(翻译三) | 仗剑天涯</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script type="module" src="/assets/js/dist/theme.min.js"></script> <script> /* Apply sidebar collapsed state as early as possible to prevent flickering */ if (localStorage.getItem('sidebar-collapsed') === 'true') { document.documentElement.setAttribute('data-sidebar-collapsed', 'true'); } </script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js,npm/mermaid@11.12.0/dist/mermaid.min.js"></script> <script type="module" defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/js/data/mathjax.js"></script> <script async src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script> <script type="module"> window.WalinePrefix = "/pro"; import { pageviewCount } from '/assets/js/dist/waline.min.js'; pageviewCount({ serverURL: 'https://comments.damonc.top', update: true }); </script> <script type="module" defer src="/app.min.js?baseurl=&register=true" ></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7166721253489246" crossorigin="anonymous"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"> <button type="button" id="sidebar-collapse-btn" class="btn" aria-label="Toggle Sidebar"> <i class="fas fa-bars-staggered"></i> </button><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://img.damonc.top/commons/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">仗剑天涯</a><p class="site-subtitle fst-italic mb-0">听说读写看做忘摊手</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/damonc-top" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/elonmusk" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['damoncbl','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Unity 多纹理融合(翻译三)</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Unity 多纹理融合(翻译三)</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1514894400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 2, 2018 </time> </span><div class="mt-3 mb-3"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/tutorial-image.png" class="popup img-link preview-img blur"><img data-src="https://img.damonc.top/posts/2018/month1/catRender3/tutorial-image.png" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/webp;base64,UklGRkQAAABXRUJQVlA4IDgAAABQAwCdASoUAAoAP3Gixlk0rCejsAgCkC4JYwAARRmTpjRwAAD+Ejdyec5rm2EWtFZH9b+P4QAAAA=="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://catlikecoding.com/unity/tutorials">catlikecoding</a> </em> </span><div> <span> <em class="waline-pageview-count" data-path="/posts/Unity_Combine_Texture/"> <i class="fas fa-spinner fa-spin small"></i> </em> views </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="6587 words" > <em>36 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Unity 多纹理融合(翻译三)</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Unity 多纹理融合(翻译三)</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>本篇摘要：</p><ul><li>采样多个纹理<li>应用细节纹理<li>处理线性空间中的颜色<li>使用 splat 地图</ul><h2 id="纹理合并"><span class="me-2">纹理合并</span><a href="#纹理合并" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>贴图在游戏应用广泛，但它们有局限性。无论以何种尺寸显示，它们都有固定数量的像素。如果需要被渲染到很小网格，可以使用mipmap来保持它们的部分细节。但是当渲染到很大的网格上，会变得模糊。我们也不能无中生有地渲染更多额外的细节。本文讨论了一些解决办法。</p><h3 id="细节纹理"><span class="me-2">细节纹理</span><a href="#细节纹理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>通常可以使用更大的纹理，意味着更多的像素和更多的细节。但是纹理的大小也是有限制的，取决于游戏包体大小和目标平台的内存，以及gpu采样能力。</p><p>另一种增加像素密度的方法是平铺纹理。出一张尽可能小的贴图，设置为重复模式。近距离观察下重复感可能不会很明显。毕竟当你站着用鼻子接触墙壁时，你只会看到整面墙壁的一小部分。</p><p>因此，我们能够通过拉伸与平铺纹理相结合的方式来尽可能地添加细节。为了尝试这一点，我们使用一张棱角明显的纹理。这是一个方格图，放入的工程内使用默认导入设置。</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/grid.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/grid.png" alt="略微扭曲的网格纹理" width="100%" height="auto" loading="lazy"></a></div></div><p>新建一个纹理融合shader</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">Shader</span> <span class="s">"Custom/Textured With Detail"</span> <span class="p">{</span>
    <span class="n">Properties</span> <span class="p">{</span>
        <span class="n">_Tint</span> <span class="p">(</span><span class="s">"Tint"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="n">SubShader</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>使用此着色器创建一个新材质，然后为其指定该shader和网格纹理。</p><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/detailed-inspector.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/detailed-inspector.png" alt="网格纹理" width="100%" height="auto" loading="lazy"></a></div><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/detailed-scene.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/detailed-scene.png" alt="网格纹理" width="100%" height="auto" loading="lazy"></a></div></div><p>将材质分配给quad并查看它。从远处看效果还行。但是靠得太近看会变得模糊不清。缺失一些细节，同时纹理压缩造成的伪影也会变得很明显。 网格特写，显示低纹素密度和 DXT1 伪影。 多个纹理样本</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/grid-close-up.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/grid-close-up.png" alt="带有低像素密度和DXT1伪影" width="100%" height="auto" loading="lazy"></a></div></div><h3 id="多张纹理贴图采样"><span class="me-2">多张纹理贴图采样</span><a href="#多张纹理贴图采样" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>现在我们只采样了单个纹理样本并将其用作片段着色器的结果，将采样的颜色存储在一个临时变量中。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kt">float4</span> <span class="nf">MyFragmentProgram</span> <span class="p">(</span><span class="n">Interpolators</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span> <span class="p">{</span>
    <span class="kt">float4</span> <span class="n">color</span> <span class="o">=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Tint</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">color</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>先假设可以通过引入平铺纹理的方式来增加像素密度。执行一次纹理采样函数，给它一个十倍采样面积，用这个结果替换临时存储的颜色原来的颜色输出到屏幕。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kt">float4</span> <span class="n">color</span> <span class="o">=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Tint</span><span class="p">;</span>
<span class="n">color</span> <span class="o">=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">*</span> <span class="mi">10</span><span class="p">);</span>
<span class="k">return</span> <span class="n">color</span><span class="p">;</span>
</pre></table></code></div></div><p>屏幕上会产生很多小网格。靠的很近再观察，结果不那么糟糕了。因为采样纹理用了平铺10次，所以很明显是一个重复的图案。 硬编码平铺。</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/tiling.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/tiling.png" alt="平铺纹理" width="100%" height="auto" loading="lazy"></a></div></div><p>请注意，此时我们正在执行两个纹理采样，但最终却只使用其中一个。这似乎很浪费。是吗？看看编译的顶点程序。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">uniform</span>  <span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
<span class="k">in</span>  <span class="n">vec2</span> <span class="n">vs_TEXCOORD0</span><span class="p">;</span>
<span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">out</span> <span class="n">vec4</span> <span class="n">SV_TARGET0</span><span class="p">;</span>
<span class="n">vec2</span> <span class="n">t0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">t0</span><span class="p">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">vs_TEXCOORD0</span><span class="p">.</span><span class="n">xy</span> <span class="o">*</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">SV_TARGET0</span> <span class="o">=</span> <span class="k">texture</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">SetTexture</span> <span class="mi">0</span> <span class="p">[</span><span class="n">_MainTex</span><span class="p">]</span> <span class="mi">2</span><span class="n">D</span> <span class="mi">0</span>
      <span class="n">ps_4_0</span>
      <span class="n">dcl_sampler</span> <span class="n">s0</span><span class="p">,</span> <span class="n">mode_default</span>
      <span class="n">dcl_resource_texture2d</span> <span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">)</span> <span class="n">t0</span>
      <span class="n">dcl_input_ps</span> <span class="k">linear</span> <span class="n">v0</span><span class="p">.</span><span class="n">xy</span>
      <span class="n">dcl_output</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span>
      <span class="n">dcl_temps</span> <span class="mi">1</span>
   <span class="mi">0</span><span class="o">:</span> <span class="nb">mul</span> <span class="n">r0</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">xyxx</span><span class="p">,</span> <span class="n">l</span><span class="p">(</span><span class="mi">10</span><span class="p">.</span><span class="mo">000000</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mo">000000</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">000000</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">000000</span><span class="p">)</span>
   <span class="mi">1</span><span class="o">:</span> <span class="k">sample</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyxx</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">s0</span>
   <span class="mi">2</span><span class="o">:</span> <span class="n">ret</span>
</pre></table></code></div></div><p>是否注意到编译后的代码中只有一个纹理采样？没错，编译器为我们去掉了不必要的代码！编译器基本上会丢弃任何最终未使用的内容。</p><p>我们不想丢弃原始采样到颜色，就要合并两次采样结果。让我们通过将它们相乘来做到这一点。再添加一个_Tint属性，叠加一层自定义颜色。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kt">float4</span> <span class="n">color</span> <span class="o">=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Tint</span><span class="p">;</span>
<span class="n">color</span> <span class="o">*=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
<span class="k">return</span> <span class="n">color</span><span class="p">;</span>
</pre></table></code></div></div><p>着色编译器会生成什么样的代码呢，对此有何影响？</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">uniform</span>  <span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
<span class="k">in</span>  <span class="n">vec2</span> <span class="n">vs_TEXCOORD0</span><span class="p">;</span>
<span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">out</span> <span class="n">vec4</span> <span class="n">SV_TARGET0</span><span class="p">;</span>
<span class="n">mediump</span> <span class="n">vec4</span> <span class="n">t16_0</span><span class="p">;</span>
<span class="n">lowp</span> <span class="n">vec4</span> <span class="n">t10_0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">t10_0</span> <span class="o">=</span> <span class="k">texture</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">vs_TEXCOORD0</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">t16_0</span> <span class="o">=</span> <span class="n">t10_0</span> <span class="o">*</span> <span class="n">t10_0</span><span class="p">;</span>
    <span class="n">SV_TARGET0</span> <span class="o">=</span> <span class="n">t16_0</span> <span class="o">*</span> <span class="n">_Tint</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="n">SetTexture</span> <span class="mi">0</span> <span class="p">[</span><span class="n">_MainTex</span><span class="p">]</span> <span class="mi">2</span><span class="n">D</span> <span class="mi">0</span>
<span class="n">ConstBuffer</span> <span class="s">"Globals"</span> <span class="mi">144</span>
<span class="n">Vector</span> <span class="mi">96</span> <span class="p">[</span><span class="n">_Tint</span><span class="p">]</span>
<span class="n">BindCB</span>  <span class="s">"Globals"</span> <span class="mi">0</span>
      <span class="n">ps_4_0</span>
      <span class="n">dcl_constantbuffer</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">immediateIndexed</span>
      <span class="n">dcl_sampler</span> <span class="n">s0</span><span class="p">,</span> <span class="n">mode_default</span>
      <span class="n">dcl_resource_texture2d</span> <span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">)</span> <span class="n">t0</span>
      <span class="n">dcl_input_ps</span> <span class="k">linear</span> <span class="n">v0</span><span class="p">.</span><span class="n">xy</span>
      <span class="n">dcl_output</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span>
      <span class="n">dcl_temps</span> <span class="mi">1</span>
   <span class="mi">0</span><span class="o">:</span> <span class="k">sample</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">xyxx</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">s0</span>
   <span class="mi">1</span><span class="o">:</span> <span class="nb">mul</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span>
   <span class="mi">2</span><span class="o">:</span> <span class="nb">mul</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">xyzw</span>
   <span class="mi">3</span><span class="o">:</span> <span class="n">ret</span>
</pre></table></code></div></div><p>这次的纹理采样，编译器检测到重复对_MainTex采样代码。对其进行优化后纹理只采样一次，结果存储在寄存器中并重复使用。即使使用_Tint中间变量等，编译器也足够聪明，可以检测到此类代码重复。最终将所有结果汇总后输出。</p><p>现在再对UV坐标平铺×10次，最终看到大网格和小网格的融合在一起</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">color</span> <span class="o">*=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">*</span> <span class="mi">10</span><span class="p">);</span>
</pre></table></code></div></div><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/multiplied.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/multiplied.png" alt="平铺纹理" width="100%" height="auto" loading="lazy"></a></div></div><p>由于纹理采样时参数不再相同，编译器也必须保留两次采样。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">uniform</span>  <span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
<span class="k">in</span>  <span class="n">vec2</span> <span class="n">vs_TEXCOORD0</span><span class="p">;</span>
<span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">out</span> <span class="n">vec4</span> <span class="n">SV_TARGET0</span><span class="p">;</span>
<span class="n">vec4</span> <span class="n">t0</span><span class="p">;</span>
<span class="n">lowp</span> <span class="n">vec4</span> <span class="n">t10_0</span><span class="p">;</span>
<span class="n">vec2</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">lowp</span> <span class="n">vec4</span> <span class="n">t10_1</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">t10_0</span> <span class="o">=</span> <span class="k">texture</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">vs_TEXCOORD0</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">t10_0</span> <span class="o">*</span> <span class="n">_Tint</span><span class="p">;</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">vs_TEXCOORD0</span><span class="p">.</span><span class="n">xy</span> <span class="o">*</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">t10_1</span> <span class="o">=</span> <span class="k">texture</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">SV_TARGET0</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">*</span> <span class="n">t10_1</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="n">SetTexture</span> <span class="mi">0</span> <span class="p">[</span><span class="n">_MainTex</span><span class="p">]</span> <span class="mi">2</span><span class="n">D</span> <span class="mi">0</span>
<span class="n">ConstBuffer</span> <span class="s">"Globals"</span> <span class="mi">144</span>
<span class="n">Vector</span> <span class="mi">96</span> <span class="p">[</span><span class="n">_Tint</span><span class="p">]</span>
<span class="n">BindCB</span>  <span class="s">"Globals"</span> <span class="mi">0</span>
      <span class="n">ps_4_0</span>
      <span class="n">dcl_constantbuffer</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">immediateIndexed</span>
      <span class="n">dcl_sampler</span> <span class="n">s0</span><span class="p">,</span> <span class="n">mode_default</span>
      <span class="n">dcl_resource_texture2d</span> <span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">)</span> <span class="n">t0</span>
      <span class="n">dcl_input_ps</span> <span class="k">linear</span> <span class="n">v0</span><span class="p">.</span><span class="n">xy</span>
      <span class="n">dcl_output</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span>
      <span class="n">dcl_temps</span> <span class="mi">2</span>
   <span class="mi">0</span><span class="o">:</span> <span class="k">sample</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">xyxx</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">s0</span>
   <span class="mi">1</span><span class="o">:</span> <span class="nb">mul</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">xyzw</span>
   <span class="mi">2</span><span class="o">:</span> <span class="nb">mul</span> <span class="n">r1</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">xyxx</span><span class="p">,</span> <span class="n">l</span><span class="p">(</span><span class="mi">10</span><span class="p">.</span><span class="mo">000000</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mo">000000</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">000000</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">000000</span><span class="p">)</span>
   <span class="mi">3</span><span class="o">:</span> <span class="k">sample</span> <span class="n">r1</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r1</span><span class="p">.</span><span class="n">xyxx</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">s0</span>
   <span class="mi">4</span><span class="o">:</span> <span class="nb">mul</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r1</span><span class="p">.</span><span class="n">xyzw</span>
   <span class="mi">5</span><span class="o">:</span> <span class="n">ret</span>
</pre></table></code></div></div><h3 id="单独的细节纹理"><span class="me-2">单独的细节纹理</span><a href="#单独的细节纹理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>将两个纹理相乘时，结果会更暗。除非至少其中一种纹理是白色的。这是因为像素的每个颜色通道都有一个介于 0 和 1 之间的值。当向纹理添加细节时，可以通过该通道值来实现变暗或变亮。</p><p>要使原始纹理变亮，给原始颜色乘2，使得每个颜色值都增大。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">color</span> <span class="o">*=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
</pre></table></code></div></div><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/doubled.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/doubled.png" alt="增亮颜色" width="100%" height="auto" loading="lazy"></a></div></div><p>这种直接扩大倍数的做法很粗暴。我们知道任何数乘以1不变，但是对细节纹理色加倍时，但对于1/2这个分界值就有用了。颜色区间是0-1，低于1/2的值将是结果变暗，高于1/2的值将变亮。这里引入一张特殊的灰度细节纹理来处理。</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/grid-detail.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/grid-detail.png" alt="细节灰度图" width="100%" height="auto" loading="lazy"></a></div></div><blockquote class="prompt-tip"><p>灰度细节纹理？</p><p>一般都是用灰度细节纹理来增白或加深原始颜色做二次细节调整，不是灰度图跳出 的颜色不是那么直观的结果。</p></blockquote><p>要使用这个单独的细节纹理，我们必须在着色器中添加第二个纹理属性。使用灰色作为默认值，因为这不会改变主纹理的外观。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">Properties</span> <span class="p">{</span>
    <span class="n">_Tint</span> <span class="p">(</span><span class="s">"Tint"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="n">_DetailTex</span> <span class="p">(</span><span class="s">"Detail Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"gray"</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>将细节纹理分配给我们的材质并将其平铺设置为10。</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/detail-texture-inspector.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/detail-texture-inspector.png" alt="两种纹理" width="100%" height="auto" loading="lazy"></a></div></div><p>我们必须添加变量来访问细节纹理及其平铺和偏移数据</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">,</span> <span class="n">_DetailTex</span><span class="p">;</span>
<span class="kt">float4</span> <span class="n">_MainTex_ST</span><span class="p">,</span> <span class="n">_DetailTex_ST</span><span class="p">;</span>
</pre></table></code></div></div><h3 id="使用两个uv"><span class="me-2">使用两个UV</span><a href="#使用两个uv" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>我们应该使用细节纹理的平铺和偏移数据，而不是使用硬编码乘10。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Interpolators</span> <span class="p">{</span>
  <span class="kt">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="nb">SV_POSITION</span><span class="p">;</span>
  <span class="kt">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="nb">TEXCOORD0</span><span class="p">;</span>
  <span class="kt">float2</span> <span class="n">uvDetail</span> <span class="o">:</span> <span class="nb">TEXCOORD1</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>通过使用主纹理uv对细节纹理进行采样，得到一个新的细节纹理uv。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">Interpolators</span> <span class="nf">MyVertexProgram</span> <span class="p">(</span><span class="n">VertexData</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Interpolators</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">i</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="nb">mul</span><span class="p">(</span><span class="n">UNITY_MATRIX_MVP</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
  <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_MainTex</span><span class="p">);</span>
  <span class="n">i</span><span class="p">.</span><span class="n">uvDetail</span> <span class="o">=</span> <span class="n">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_DetailTex</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>再一次看看汇编代码</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">uniform</span>         <span class="n">vec4</span> <span class="n">_Tint</span><span class="p">;</span>
<span class="k">uniform</span>         <span class="n">vec4</span> <span class="n">_MainTex_ST</span><span class="p">;</span>
<span class="k">uniform</span>         <span class="n">vec4</span> <span class="n">_DetailTex_ST</span><span class="p">;</span>
<span class="k">in</span>  <span class="n">vec4</span> <span class="n">in_POSITION0</span><span class="p">;</span>
<span class="k">in</span>  <span class="n">vec2</span> <span class="n">in_TEXCOORD0</span><span class="p">;</span>
<span class="k">out</span> <span class="n">vec2</span> <span class="n">vs_TEXCOORD0</span><span class="p">;</span>
<span class="k">out</span> <span class="n">vec2</span> <span class="n">vs_TEXCOORD1</span><span class="p">;</span>
<span class="n">vec4</span> <span class="n">t0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">in_POSITION0</span><span class="p">.</span><span class="n">yyyy</span> <span class="o">*</span> <span class="n">glstate_matrix_mvp</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">glstate_matrix_mvp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">in_POSITION0</span><span class="p">.</span><span class="n">xxxx</span> <span class="o">+</span> <span class="n">t0</span><span class="p">;</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">glstate_matrix_mvp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">in_POSITION0</span><span class="p">.</span><span class="n">zzzz</span> <span class="o">+</span> <span class="n">t0</span><span class="p">;</span>
    <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">glstate_matrix_mvp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">in_POSITION0</span><span class="p">.</span><span class="n">wwww</span> <span class="o">+</span> <span class="n">t0</span><span class="p">;</span>
    <span class="n">vs_TEXCOORD0</span><span class="p">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">in_TEXCOORD0</span><span class="p">.</span><span class="n">xy</span> <span class="o">*</span> <span class="n">_MainTex_ST</span><span class="p">.</span><span class="n">xy</span> <span class="o">+</span> <span class="n">_MainTex_ST</span><span class="p">.</span><span class="n">zw</span><span class="p">;</span>
    <span class="n">vs_TEXCOORD1</span><span class="p">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">in_TEXCOORD0</span><span class="p">.</span><span class="n">xy</span> <span class="o">*</span> <span class="n">_DetailTex_ST</span><span class="p">.</span><span class="n">xy</span> <span class="o">+</span> <span class="n">_DetailTex_ST</span><span class="p">.</span><span class="n">zw</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="n">Vector</span> <span class="mi">112</span> <span class="p">[</span><span class="n">_MainTex_ST</span><span class="p">]</span>
<span class="n">Vector</span> <span class="mi">128</span> <span class="p">[</span><span class="n">_DetailTex_ST</span><span class="p">]</span>
<span class="n">ConstBuffer</span> <span class="s">"UnityPerDraw"</span> <span class="mi">352</span>
<span class="n">Matrix</span> <span class="mi">0</span> <span class="p">[</span><span class="n">glstate_matrix_mvp</span><span class="p">]</span>
<span class="n">BindCB</span>  <span class="s">"Globals"</span> <span class="mi">0</span>
<span class="n">BindCB</span>  <span class="s">"UnityPerDraw"</span> <span class="mi">1</span>
      <span class="n">vs_4_0</span>
      <span class="n">dcl_constantbuffer</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">immediateIndexed</span>
      <span class="n">dcl_constantbuffer</span> <span class="n">cb1</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">immediateIndexed</span>
      <span class="n">dcl_input</span> <span class="n">v0</span><span class="p">.</span><span class="n">xyzw</span>
      <span class="n">dcl_input</span> <span class="n">v1</span><span class="p">.</span><span class="n">xy</span>
      <span class="n">dcl_output_siv</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">position</span>
      <span class="n">dcl_output</span> <span class="n">o1</span><span class="p">.</span><span class="n">xy</span>
      <span class="n">dcl_output</span> <span class="n">o1</span><span class="p">.</span><span class="n">zw</span>
      <span class="n">dcl_temps</span> <span class="mi">1</span>
   <span class="mi">0</span><span class="o">:</span> <span class="nb">mul</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">yyyy</span><span class="p">,</span> <span class="n">cb1</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">xyzw</span>
   <span class="mi">1</span><span class="o">:</span> <span class="nb">mad</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">cb1</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">xxxx</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span>
   <span class="mi">2</span><span class="o">:</span> <span class="nb">mad</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">cb1</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">zzzz</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span>
   <span class="mi">3</span><span class="o">:</span> <span class="nb">mad</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">cb1</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">wwww</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span>
   <span class="mi">4</span><span class="o">:</span> <span class="nb">mad</span> <span class="n">o1</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">v1</span><span class="p">.</span><span class="n">xyxx</span><span class="p">,</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">xyxx</span><span class="p">,</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">zwzz</span>
   <span class="mi">5</span><span class="o">:</span> <span class="nb">mad</span> <span class="n">o1</span><span class="p">.</span><span class="n">zw</span><span class="p">,</span> <span class="n">v1</span><span class="p">.</span><span class="n">xxxy</span><span class="p">,</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">xxxy</span><span class="p">,</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">zzzw</span>
   <span class="mi">6</span><span class="o">:</span> <span class="n">ret</span>
</pre></table></code></div></div><p>注意两个 UV 输出是如何在两个编译器顶点程序中定义的。OpenGLCore使用vs_TEXCOORD0和vs_TEXCOORD1输出，相反Direct3D11只使用一个输出o1.</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// Output signature:</span>
<span class="c1">//</span>
<span class="c1">// Name                 Index   Mask Register SysValue  Format   Used</span>
<span class="c1">// -- --  -- -- - </span>
<span class="c1">// SV_POSITION              0   xyzw        0      POS   float   xyzw</span>
<span class="c1">// TEXCOORD                 0   xy          1     NONE   float   xy  </span>
<span class="c1">// TEXCOORD                 1     zw        1     NONE   float     zw</span>
</pre></table></code></div></div><p>上面代码意味着两个 UV 对都被打包到一个输出寄存器中。第一个在 X 和 Y 通道，第二个在 Z 和 W 通道。因为寄存器总是由四个数字组成的组。Direct3D 11 编译器利用了这一点。</p><blockquote class="prompt-tip"><p>试着手动打包输出? 手动打包输出的常见原因是只有少数几个插值器可用。Shader Model 2硬件支持8个通用插补 器，而Shader Model 3硬件支持10个。复杂着色器可能会遇到这个限制。</p></blockquote><p>现在我们可以在片段程序中使用额外的UV对。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kt">float4</span> <span class="nf">MyFragmentProgram</span> <span class="p">(</span><span class="n">Interpolators</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span> <span class="p">{</span>
        <span class="kt">float4</span> <span class="n">color</span> <span class="o">=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Tint</span><span class="p">;</span>
        <span class="n">color</span> <span class="o">*=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_DetailTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uvDetail</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">color</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">uniform</span>         <span class="n">vec4</span> <span class="n">_Tint</span><span class="p">;</span>
<span class="k">uniform</span>         <span class="n">vec4</span> <span class="n">_MainTex_ST</span><span class="p">;</span>
<span class="k">uniform</span>         <span class="n">vec4</span> <span class="n">_DetailTex_ST</span><span class="p">;</span>
<span class="k">uniform</span>  <span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
<span class="k">uniform</span>  <span class="n">sampler2D</span> <span class="n">_DetailTex</span><span class="p">;</span>
<span class="k">in</span>  <span class="n">vec2</span> <span class="n">vs_TEXCOORD0</span><span class="p">;</span>
<span class="k">in</span>  <span class="n">vec2</span> <span class="n">vs_TEXCOORD1</span><span class="p">;</span>
<span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">out</span> <span class="n">vec4</span> <span class="n">SV_TARGET0</span><span class="p">;</span>
<span class="n">vec4</span> <span class="n">t0</span><span class="p">;</span>
<span class="n">lowp</span> <span class="n">vec4</span> <span class="n">t10_0</span><span class="p">;</span>
<span class="n">lowp</span> <span class="n">vec4</span> <span class="n">t10_1</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">t10_0</span> <span class="o">=</span> <span class="k">texture</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">vs_TEXCOORD0</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">t10_0</span> <span class="o">*</span> <span class="n">_Tint</span><span class="p">;</span>
    <span class="n">t10_1</span> <span class="o">=</span> <span class="k">texture</span><span class="p">(</span><span class="n">_DetailTex</span><span class="p">,</span> <span class="n">vs_TEXCOORD1</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">*</span> <span class="n">t10_1</span><span class="p">;</span>
    <span class="n">SV_TARGET0</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">t0</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="n">SetTexture</span> <span class="mi">0</span> <span class="p">[</span><span class="n">_MainTex</span><span class="p">]</span> <span class="mi">2</span><span class="n">D</span> <span class="mi">0</span>
<span class="n">SetTexture</span> <span class="mi">1</span> <span class="p">[</span><span class="n">_DetailTex</span><span class="p">]</span> <span class="mi">2</span><span class="n">D</span> <span class="mi">1</span>
<span class="n">ConstBuffer</span> <span class="s">"Globals"</span> <span class="mi">144</span>
<span class="n">Vector</span> <span class="mi">96</span> <span class="p">[</span><span class="n">_Tint</span><span class="p">]</span>
<span class="n">BindCB</span>  <span class="s">"Globals"</span> <span class="mi">0</span>
      <span class="n">ps_4_0</span>
      <span class="n">dcl_constantbuffer</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">immediateIndexed</span>
      <span class="n">dcl_sampler</span> <span class="n">s0</span><span class="p">,</span> <span class="n">mode_default</span>
      <span class="n">dcl_sampler</span> <span class="n">s1</span><span class="p">,</span> <span class="n">mode_default</span>
      <span class="n">dcl_resource_texture2d</span> <span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">)</span> <span class="n">t0</span>
      <span class="n">dcl_resource_texture2d</span> <span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">,</span><span class="n">float</span><span class="p">)</span> <span class="n">t1</span>
      <span class="n">dcl_input_ps</span> <span class="k">linear</span> <span class="n">v0</span><span class="p">.</span><span class="n">xy</span>
      <span class="n">dcl_input_ps</span> <span class="k">linear</span> <span class="n">v0</span><span class="p">.</span><span class="n">zw</span>
      <span class="n">dcl_output</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span>
      <span class="n">dcl_temps</span> <span class="mi">2</span>
   <span class="mi">0</span><span class="o">:</span> <span class="k">sample</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">xyxx</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">s0</span>
   <span class="mi">1</span><span class="o">:</span> <span class="nb">mul</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">cb0</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">xyzw</span>
   <span class="mi">2</span><span class="o">:</span> <span class="k">sample</span> <span class="n">r1</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">v0</span><span class="p">.</span><span class="n">zwzz</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">s1</span>
   <span class="mi">3</span><span class="o">:</span> <span class="nb">mul</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r1</span><span class="p">.</span><span class="n">xyzw</span>
   <span class="mi">4</span><span class="o">:</span> <span class="n">add</span> <span class="n">o0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">r0</span><span class="p">.</span><span class="n">xyzw</span>
   <span class="mi">5</span><span class="o">:</span> <span class="n">ret</span>
</pre></table></code></div></div><p>基于细节纹理，主纹理变得更亮和更暗。</p><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/grid-with-detail.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/grid-with-detail.png" alt="明暗两张纹理" width="100%" height="auto" loading="lazy"></a></div><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/grid-close-up-detail.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/grid-close-up-detail.png" alt="明暗两张纹理" width="100%" height="auto" loading="lazy"></a></div></div><h3 id="细节纹理渐变融合"><span class="me-2">细节纹理渐变融合</span><a href="#细节纹理渐变融合" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>添加细节的想法是它们可以在近距离或放大时改善材质的外观。它们不应该在远处可见或缩小，因为这会使平铺变得明显。所以我们需要一种方法来随着纹理显示尺寸的减小而淡化细节。我们可以通过将细节纹理淡化为灰色来做到这一点，因为这不会导致颜色变化。</p><p>需要做的就是在细节纹理的导入设置中启用Fadeout Mip Maps属性。这也会自动将过滤器模式切换为三线性，以便渐变为灰色是渐进的。</p><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/fading-inspector.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/fading-inspector.png" alt="纹理过渡" width="100%" height="auto" loading="lazy"></a></div><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/grid-fading-detail.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/grid-fading-detail.png" alt="纹理过渡" width="100%" height="auto" loading="lazy"></a></div></div><p>网格从详细到不详细的过渡非常明显，但通常不会注意到它。例如，这里是大理石材质的主纹理和细节纹理。</p><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/marble.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/marble.png" alt="大理石纹理" width="100%" height="auto" loading="lazy"></a></div><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/marble-detail.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/marble-detail.png" alt="大理石纹理" width="100%" height="auto" loading="lazy"></a></div></div><p>一旦我们的材质使用了这些纹理，细节纹理的过渡痕迹就不再明显了。</p><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/marble-inspector.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/marble-inspector.png" alt="大理石材质" width="100%" height="auto" loading="lazy"></a></div><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/marble-scene.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/marble-scene.png" alt="大理石材质" width="100%" height="auto" loading="lazy"></a></div></div><p>然而，由于细节纹理的过渡加持，大理石材质在近距离看起来要好得多。</p><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/marble-close.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/marble-close.png" alt="没有细节和有细节特写" width="100%" height="auto" loading="lazy"></a></div><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/marble-close-detail.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/marble-close-detail.png" alt="没有细节和有细节特写" width="100%" height="auto" loading="lazy"></a></div></div><h3 id="线性色彩空间"><span class="me-2">线性色彩空间</span><a href="#线性色彩空间" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>当我们在 gamma 颜色空间中渲染场景时，我们的着色器工作正常，但如果我们切换到线性颜色空间，它就会出错。色彩空间在项目中设置。它配置在Other Settings播放器设置面板，可以通过Edit / Project Settings / Player.</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/color-space-inspector.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/color-space-inspector.png" alt="选择颜色空间" width="100%" height="auto" loading="lazy"></a></div></div><h3 id="什么是-gamma-和-linear-色彩空间"><span class="me-2">什么是 Gamma 和 Linear 色彩空间？</span><a href="#什么是-gamma-和-linear-色彩空间" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在计算机图形学中，Gamma 和 Linear 是两种处理光照和颜色的不同方式，理解它们的区别对于渲染真实感画面至关重要。</p><h4 id="1-为什么会有-gamma-校正"><span class="me-2">1. 为什么会有 Gamma 校正？</span><a href="#1-为什么会有-gamma-校正" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>这源于早期的 CRT（阴极射线管）显示器。CRT 显示器的物理特性决定了它的输入电压和输出亮度不是线性的。如果你给它 50% 的电压，它并不会产生 50% 的亮度，而是大约 21.8% 的亮度（$0.5^{2.2}$）。这种关系呈现出一条向下弯曲的曲线，称为 Gamma 2.2 曲线。</p><p>为了让显示器输出正确的亮度，我们需要在把图像存入文件时，预先进行一次反向的增亮处理（$0.5^{1/2.2} \approx 0.73$），这个过程叫 <strong>Gamma Encoding</strong>。这样，当显示器再次以 2.2 的幂次压暗图像时，原本的增亮和显示器的压暗相互抵消，最终人眼就能看到正确的、线性的光照结果。</p><p>此外，<strong>人眼对暗部细节比对亮部细节更敏感</strong>。sRGB 标准利用了这一点，通过 Gamma Encoding 这种非线性存储方式，在有限的 8 位（0-255）数据中，把更多的数据位分配给了暗部。这是一种极其高效的数据压缩方式。</p><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/linear-to-gamma.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/linear-to-gamma.png" alt="gamma $1\over 2.2$ encoding vs. $2.2$ deconding" width="100%" height="auto" loading="lazy"></a></div><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/gamma-to-linear.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/gamma-to-linear.png" alt="gamma $1\over 2.2$ encoding vs. $2.2$ deconding" width="100%" height="auto" loading="lazy"></a></div></div><h4 id="2-gamma-space-vs-linear-space"><span class="me-2">2. Gamma Space vs Linear Space</span><a href="#2-gamma-space-vs-linear-space" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><strong>Gamma Space（伽马空间）</strong>：<ul><li><strong>工作流</strong>：这是旧时代的流程。贴图是 sRGB 的（经过 Gamma 编码），渲染计算（光照、混合）直接使用这些 sRGB 数值，最后直接输出到显示器。<li><strong>问题</strong>：数学上是错误的。光照计算（如 <code class="language-plaintext highlighter-rouge">Light * Albedo</code>）假设数值是线性的（1+1=2），但在 Gamma 空间中，0.5 并不代表一半的物理亮度。这会导致光照衰减不自然、混合颜色发黑、高光过曝等问题。</ul><li><strong>Linear Space（线性空间）</strong>：<ul><li><strong>工作流</strong>：这是现代标准流程。<ol><li><strong>输入</strong>：读取 sRGB 贴图时，GPU 自动去除 Gamma 编码，将其还原为线性数值（Linear）。<li><strong>计算</strong>：Shader 中的所有光照、混合计算都在线性空间进行，符合物理规律。<li><strong>输出</strong>：最终输出到屏幕前，再次进行 Gamma 校正（Encoding），以适应显示器的特性。</ol><li><strong>优势</strong>：光照计算符合物理规律，光影过渡自然，是 PBR（基于物理的渲染）的基础。</ul></ul><h4 id="3-游戏开发中的选择与统一"><span class="me-2">3. 游戏开发中的选择与统一</span><a href="#3-游戏开发中的选择与统一" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><strong>选择哪种空间？</strong></p><ul><li><strong>Linear Space</strong> 是目前游戏开发的<strong>绝对主流</strong>。PC、主机和中高端移动设备都首选线性空间，因为它能提供更真实的光照效果。<li><strong>Gamma Space</strong> 仅在针对极低端老旧设备或某些特定的非写实 2D 游戏中保留。</ul><p><strong>如何保持统一性？</strong> 在 Unity 中，通过 <code class="language-plaintext highlighter-rouge">Project Settings -&gt; Player -&gt; Other Settings -&gt; Color Space</code> 选择 Linear。</p><ul><li><strong>颜色贴图（Albedo/Diffuse）</strong>：Unity 默认会将纹理标记为 sRGB。在 Linear 模式下，Unity 会在采样时自动移除 Gamma，将其转为线性值供 Shader 使用。<li><strong>数值贴图（Normal/Metallic/Roughness）</strong>：这些纹理存储的是数学数据而非颜色，不需要 Gamma 校正。必须在纹理导入设置中<strong>取消勾选 “sRGB (Color Texture)”</strong>，确保 Shader 读取到的是未经修改的原始数值。</ul><p>回到我们的例子，当切换到 Linear 空间后，细节纹理变暗了。这是因为我们原本的算法（<code class="language-plaintext highlighter-rouge">* 2</code>）是基于 Gamma 空间的经验公式。在线性空间中，原本的中性灰（Gamma 0.5）被还原为线性值（约为 0.217），乘以 2 后仅为 0.434，远小于 1，所以变暗了。</p><p>为了修复这个问题，我们需要在线性空间中使用正确的数学转换，或者使用 Unity 提供的 <code class="language-plaintext highlighter-rouge">unity_ColorSpaceDouble</code> 变量，它会自动根据当前色彩空间提供正确的倍增系数（Linear 空间下约为 4.59，Gamma 空间下为 2），从而保证渲染结果的一致性。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">color</span> <span class="o">*=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_DetailTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uvDetail</span><span class="p">)</span> <span class="o">*</span> <span class="n">unity_ColorSpaceDouble</span><span class="p">;</span>
</pre></table></code></div></div><p>通过这种更改，无论我们在哪个颜色空间中渲染，我们的细节材质看起来都一样。</p><h2 id="纹理splat过渡遮罩"><span class="me-2">纹理splat过渡遮罩</span><a href="#纹理splat过渡遮罩" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>细节纹理的一个限制是对整个表面使用相同的细节。 这适用于均匀的表面，如大理石板。但是，如果材质没有统一的外观，不希望在任何地方都使用相同的细节。</p><p>考虑一个大地形。它可以有草、沙、岩石、雪等。希望这些地形类型有一定的细节。但是覆盖整个地形的纹理永远不会有足够的细节。可以通过为每种表面类型使用单独的纹理并平铺这些纹理来解决该问题。但是怎么知道在哪里使用哪种纹理呢？</p><p>假设我们有一个具有两种不同表面类型的地形，什么时候决定使用哪种表面纹理呢。不是一就是二。我们可以用一个布尔值来表示这个逻辑。如果设置为true，我们使用第一个纹理，否则使用第二个。我们可以使用灰度纹理来存储这个选择。值1表示第一个纹理，而值0表示第二个纹理。事实上，我们可以使用这些值在两个纹理之间进行线性插值。然后介于 0 和 1 之间的值表示两种纹理之间的混合，这使得平滑过渡成为可能。</p><p>这样的纹理被称为splat贴图。就像将多个地形特征喷溅到画布上一样。由于插值，这张地图甚至不需要高分辨率。</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/binary-splat-map.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/binary-splat-map.png" alt="splat遮罩贴图" width="100%" height="auto" loading="lazy"></a></div></div><p>将其添加到项目后，将其导入类型切换为高级。启用Bypass sRGB Sampling并指示其mipmap应在Linear Space中生成。因为该纹理不需要sRGB颜色。所以在线性空间中渲染时不应该进行转换。另外，将其 Wrap Mode 设置为clamp，因为我们不会平铺这张地图。</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/splat-map-binary-import.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/splat-map-binary-import.png" alt="splat导入设置" width="100%" height="auto" loading="lazy"></a></div></div><p>创建一个新的 Texture Splatting 着色器。</p><div file="cg" class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="cg"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="n">Shader</span> <span class="s">"Custom/Texture Splatting"</span> <span class="p">{</span>
    <span class="n">Properties</span> <span class="p">{</span>
        <span class="n">MainTex</span> <span class="p">(</span><span class="s">"Splat Map"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="n">SubShader</span> <span class="p">{</span>
        <span class="n">Pass</span> <span class="p">{</span>
        <span class="n">CGPROGRAM</span>

        <span class="cp">#pragma vertex MyVertexProgram
</span>        <span class="cp">#pragma fragment MyFragmentProgram
</span>
        <span class="cp">#include</span> <span class="cpf">"UnityCG.cginc"</span><span class="cp">
</span>
        <span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
        <span class="kt">float4</span> <span class="n">_MainTex_ST</span><span class="p">;</span>

        <span class="k">struct</span> <span class="n">VertexData</span> <span class="p">{</span>
            <span class="kt">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="nb">POSITION</span><span class="p">;</span>
            <span class="kt">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="nb">TEXCOORD0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">struct</span> <span class="n">Interpolators</span> <span class="p">{</span>
            <span class="kt">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="nb">SV_POSITION</span><span class="p">;</span>
            <span class="kt">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="nb">TEXCOORD0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Interpolators</span> <span class="n">MyVertexProgram</span> <span class="p">(</span><span class="n">VertexData</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Interpolators</span> <span class="n">i</span><span class="p">;</span>
            <span class="n">i</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="nb">mul</span><span class="p">(</span><span class="n">UNITY_MATRIX_MVP</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
            <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_MainTex</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">float4</span> <span class="n">MyFragmentProgram</span> <span class="p">(</span><span class="n">Interpolators</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">ENDCG</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>创建一个新材质并引用该shader，并将splat贴图指定为其主要纹理。</p><div style="display:flex;justify-content:center;align-items:center;gap:10px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/splat-map-binary-inspector.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/splat-map-binary-inspector.png" alt="splat图渲染" width="100%" height="auto" loading="lazy"></a></div><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/splat-map-binary-scene.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/splat-map-binary-scene.png" alt="splat图渲染" width="100%" height="auto" loading="lazy"></a></div></div><h3 id="增加融合纹理"><span class="me-2">增加融合纹理</span><a href="#增加融合纹理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>为了能够在两个纹理之间进行选择，作为属性添加命名为Texture1和Texture2到我们的着色器中。</p><div file="cg" class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="cg"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">Properties</span> <span class="p">{</span>
    <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Splat Map"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="n">_Texture1</span> <span class="p">(</span><span class="s">"Texture 1"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="n">_Texture2</span> <span class="p">(</span><span class="s">"Texture 2"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>可以为他们使用任何你想要的纹理,这里使用网格纹理和大理石纹理。</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/two-textures-inspector.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/two-textures-inspector.png" alt="增加的额外纹理" width="100%" height="auto" loading="lazy"></a></div></div><p>为添加到着色器的每个纹理修改平铺和偏移控制值。这需要我们将更多数据从顶点传递到片段着色器，或者在片元着色器中计算UV调整。 这很好，但通常地形的所有纹理都平铺相同。并且 splat 地图根本没有平铺。所以我们只需要一个平铺和偏移控件的实例。</p><p>可以将属性控制添加到着色器属性之前，就像在C#代码中一样。<code class="language-plaintext highlighter-rouge">NoScaleOffset</code>将禁用纹理平铺和偏移。</p><div file="shader" class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="shader"><i class="far fa-file-code fa-fw"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">Properties</span> <span class="p">{</span>
    <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Splat Map"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="p">[</span><span class="n">NoScaleOffset</span><span class="p">]</span> <span class="n">_Texture1</span> <span class="p">(</span><span class="s">"Texture 1"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="p">[</span><span class="n">NoScaleOffset</span><span class="p">]</span> <span class="n">_Texture2</span> <span class="p">(</span><span class="s">"Texture 2"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>同时修改splat贴图tiling为4。</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/no-tiling-offset.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/no-tiling-offset.png" alt="不需要额外的贴图纹理" width="100%" height="auto" loading="lazy"></a></div></div><p>将采样器变量添加到我们的着色器代码中，但是不必添加它们对应的 _ST 变量。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
<span class="kt">float4</span> <span class="n">_MainTex_ST</span><span class="p">;</span>

<span class="n">sampler2D</span> <span class="n">_Texture1</span><span class="p">,</span> <span class="n">_Texture2</span><span class="p">;</span>
</pre></table></code></div></div><p>对两张纹理采样后叠加，颜色会得到加深，然后输出</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kt">float4</span> <span class="nf">MyFragmentProgram</span> <span class="p">(</span><span class="n">Interpolators</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_Texture1</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_Texture2</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/textures-added.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/textures-added.png" alt="纹理叠加" width="100%" height="auto" loading="lazy"></a></div></div><h3 id="使用splat贴图"><span class="me-2">使用splat贴图</span><a href="#使用splat贴图" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>采样splat纹理需要顶点程序提供的UV坐标</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Interpolators</span> <span class="p">{</span>
    <span class="kt">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="nb">SV_POSITION</span><span class="p">;</span>
    <span class="kt">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="nb">TEXCOORD0</span><span class="p">;</span>
    <span class="kt">float2</span> <span class="n">uvSplat</span> <span class="o">:</span> <span class="nb">TEXCOORD1</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Interpolators</span> <span class="nf">MyVertexProgram</span> <span class="p">(</span><span class="n">VertexData</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Interpolators</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">i</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="nb">mul</span><span class="p">(</span><span class="n">UNITY_MATRIX_MVP</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
    <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_MainTex</span><span class="p">);</span>
    <span class="n">i</span><span class="p">.</span><span class="n">uvSplat</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>然后，以在对其他纹理进行采样之前对splat贴图进行采样。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kt">float4</span> <span class="nf">MyFragmentProgram</span> <span class="p">(</span><span class="n">Interpolators</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span> <span class="p">{</span>
    <span class="kt">float4</span> <span class="n">splat</span> <span class="o">=</span> <span class="nb">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uvSplat</span><span class="p">);</span>
    <span class="k">return</span>
    <span class="nb">tex2D</span><span class="p">(</span><span class="n">_Texture1</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">+</span>
    <span class="nb">tex2D</span><span class="p">(</span><span class="n">_Texture2</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>因为splat本身是单通道，可以任选一个RGB通道来来存储值，这里先决定使用第一个纹理与splat贴图R通道相乘。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">return</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_Texture1</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">splat</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span>
       <span class="nb">tex2D</span><span class="p">(</span><span class="n">_Texture2</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
</pre></table></code></div></div><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/modulating-first-texture.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/modulating-first-texture.png" alt="调制第一个纹理" width="100%" height="auto" loading="lazy"></a></div></div><p>第一个纹理现在由splat贴图R通道调制。为了完成插值，我们必须将另一个纹理<code class="language-plaintext highlighter-rouge">1-R</code>相乘。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">return</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_Texture1</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">splat</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span>
       <span class="nb">tex2D</span><span class="p">(</span><span class="n">_Texture2</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">splat</span><span class="p">.</span><span class="n">r</span><span class="p">);</span>
</pre></table></code></div></div><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/modulating-both-textures.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/modulating-both-textures.png" alt="调制两个纹理" width="100%" height="auto" loading="lazy"></a></div></div><h3 id="rgb-splat贴图"><span class="me-2">RGB Splat贴图</span><a href="#rgb-splat贴图" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>我们有一个功能性的splat材质，但它只支持两种纹理。我们可以支持更多吗？我们现在只使用了R通道，那么我们添加G和B通道怎么样？那么(1,0,0)代表第一个纹理，(0,1,0)代表第二个纹理，(0,0,1)代表第三个纹理。 为了在这三个之间获得正确的插值，我们只需要确保RGB通道的总和为1即可。</p><p>但是等等，当我们只使用一个通道时，我们可以支持两个纹理。这是因为第二个纹理的权重是通过<code class="language-plaintext highlighter-rouge">1-R</code>得出的。同样的技巧适用于任意数量的通道。因此可以通过<code class="language-plaintext highlighter-rouge">1-R-G-B</code>支持另一种纹理。</p><p>这导致了一个具有三种颜色和黑色的splat贴图。只要三个通道加起来不超过1，它就是一个有效的贴图。这里给出一张这样的贴图，导入Unity。</p><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/rgb-splat-map.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/rgb-splat-map.png" alt="RGB splat 贴图" width="100%" height="auto" loading="lazy"></a></div></div><blockquote class="prompt-warning"><p>当 R + G + B 超过1时会发生什么？</p><p>那么前三个纹理的组合会太强。 同时，第四个纹理将被减去而不是被添加。 如果错误很小，那么不会注 意到并且结果足够好。 示例 RGB 映射实际上并不完美，但不会注意到。 纹理压缩引入了更多错误，但 同样难以察觉。</p></blockquote><blockquote class="prompt-tip"><p>可以使用alpha通道吗？</p><p>确实可以！ 这意味着单个 RGBA splat 贴图最多可以支持五种不同的地形类型。 但是对于本教程，四个 就足够了。</p><p>如果要使用超过五个纹理，则必须使用多个splat贴图。虽然这是可能的，但最终会得到很多纹理采样 此时可以使用更好的技术，例如纹理数组。</p></blockquote><p>为了支持 RGB splat贴图，我们必须在着色器中添加两个额外的纹理。为它们分配了大理石细节和测试纹理。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">Properties</span> <span class="p">{</span>
    <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Splat Map"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="p">[</span><span class="n">NoScaleOffset</span><span class="p">]</span> <span class="n">_Texture1</span> <span class="p">(</span><span class="s">"Texture 1"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="p">[</span><span class="n">NoScaleOffset</span><span class="p">]</span> <span class="n">_Texture2</span> <span class="p">(</span><span class="s">"Texture 2"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="p">[</span><span class="n">NoScaleOffset</span><span class="p">]</span> <span class="n">_Texture3</span> <span class="p">(</span><span class="s">"Texture 3"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="p">[</span><span class="n">NoScaleOffset</span><span class="p">]</span> <span class="n">_Texture4</span> <span class="p">(</span><span class="s">"Texture 4"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></table></code></div></div><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/splat-map-rgb-inspector.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/splat-map-rgb-inspector.png" alt="Four textures" width="100%" height="auto" loading="lazy"></a></div></div><p>将所需的变量添加到着色器。 再一次，没有额外的 _ST需要的变量。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">sampler2D</span> <span class="n">_Texture1</span><span class="p">,</span> <span class="n">_Texture2</span><span class="p">,</span> <span class="n">_Texture3</span><span class="p">,</span> <span class="n">_Texture4</span><span class="p">;</span>
</pre></table></code></div></div><p>在片段程序中，添加额外的纹理样本。第二个样本现在使用G通道，第三个使用B通道。最终样本用 (1 - R - G - B) 调制。</p><div class="language-hlsl highlighter-rouge"><div class="code-header"> <span data-label-text="Hlsl"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">return</span> <span class="nf">tex2D</span><span class="p">(</span><span class="n">_Texture1</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">splat</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span>
        <span class="nb">tex2D</span><span class="p">(</span><span class="n">_Texture2</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">splat</span><span class="p">.</span><span class="n">g</span> <span class="o">+</span>
        <span class="nb">tex2D</span><span class="p">(</span><span class="n">_Texture3</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">splat</span><span class="p">.</span><span class="n">b</span> <span class="o">+</span>
        <span class="nb">tex2D</span><span class="p">(</span><span class="n">_Texture4</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">splat</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">splat</span><span class="p">.</span><span class="n">g</span> <span class="o">-</span> <span class="n">splat</span><span class="p">.</span><span class="n">b</span><span class="p">);</span>
</pre></table></code></div></div><div style="display:flex;justify-content:center;align-items:center;gap:2px;flex-wrap:wrap;margin:1rem 0;"><div style="flex:0 1 auto;min-width:150px;max-width:300px;"> <a href="https://img.damonc.top/posts/2018/month1/catRender3/four-textures-splatted.png" class="popup img-link shimmer" class="img-link shimmer" ><img src="https://img.damonc.top/posts/2018/month1/catRender3/four-textures-splatted.png" alt="四个纹理飞溅" width="100%" height="auto" loading="lazy"></a></div></div><blockquote class="prompt-tip"><p>为什么混合区域在线性色彩空间中看起来不同？</p><p>我们的 splat 贴图绕过了 sRGB 采样，所以混合不应该取决于我们使用的颜色空间，对吧？ splat 地图 确实不受影响。 但是发生混合的色彩空间确实发生了变化。</p><p>在伽马空间渲染的情况下，样本在伽马空间中混合，仅此而已。 但是在线性空间中渲染时，它们首先转换为 线性空间，然后混合，然后再转换回伽马空间。 结果略有不同。 在线性空间中，混合也是线性的。 但在伽 马空间中，混合偏向较深的颜色。</p></blockquote><p>现在知道如何应用细节纹理以及如何将多个纹理与splat贴图混合。也可以组合这些方法。</p><p>可以将四个细节纹理添加到splat着色器并使用贴图在它们之间进行混合。当然，这需要四个额外的纹理采样，性能有限。</p><p>还可以使用贴图来控制应用细节纹理的位置以及省略的位置。在这种情况下，需要一张单色贴图，它可以用作遮罩。当单个纹理同时包含表示多个不同材质的区域但没有地形那么大的面积时，这很有用。例如，如果我们的大理石纹理还包含金属片，则不希望在此处应用大理石细节。</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/unity3d/">Unity3D</a>, <a href="/categories/shader/">Shader</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/shader/" class="post-tag no-text-decoration" >Shader</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Unity%20%E5%A4%9A%E7%BA%B9%E7%90%86%E8%9E%8D%E5%90%88(%E7%BF%BB%E8%AF%91%E4%B8%89)%20-%20%E4%BB%97%E5%89%91%E5%A4%A9%E6%B6%AF&url=www.damonc.top%2Fposts%2FUnity_Combine_Texture%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Unity%20%E5%A4%9A%E7%BA%B9%E7%90%86%E8%9E%8D%E5%90%88(%E7%BF%BB%E8%AF%91%E4%B8%89)%20-%20%E4%BB%97%E5%89%91%E5%A4%A9%E6%B6%AF&u=www.damonc.top%2Fposts%2FUnity_Combine_Texture%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=www.damonc.top%2Fposts%2FUnity_Combine_Texture%2F&text=Unity%20%E5%A4%9A%E7%BA%B9%E7%90%86%E8%9E%8D%E5%90%88(%E7%BF%BB%E8%AF%91%E4%B8%89)%20-%20%E4%BB%97%E5%89%91%E5%A4%A9%E6%B6%AF" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/Unity_Multi_Light/">Unity 基础光照多光源采样(翻译五)</a><li class="text-truncate lh-lg"> <a href="/posts/Unity_Advance_Texture/">Unity 纹理高级用法(翻译六)</a><li class="text-truncate lh-lg"> <a href="/posts/Unity_Shadows/">Unity Shadow 阴影(翻译七)</a><li class="text-truncate lh-lg"> <a href="/posts/Unity_Reflection/">Unity Reflection 反射(翻译八)</a><li class="text-truncate lh-lg"> <a href="/posts/Unity_ShaderGUI_Extension_1/">Unity Shader GUI 扩展一(翻译九)</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/shader/">Shader</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai/">AI</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli-agent/">CLI Agent</a> <a class="post-tag btn btn-outline-primary" href="/tags/best-practices/">Best Practices</a> <a class="post-tag btn btn-outline-primary" href="/tags/architecture/">Architecture</a> <a class="post-tag btn btn-outline-primary" href="/tags/configuration/">Configuration</a> <a class="post-tag btn btn-outline-primary" href="/tags/context-engine/">Context Engine</a> <a class="post-tag btn btn-outline-primary" href="/tags/git-worktree/">git-worktree</a> <a class="post-tag btn btn-outline-primary" href="/tags/mcp/">MCP</a> <a class="post-tag btn btn-outline-primary" href="/tags/multi-agent/">Multi-agent</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/Unity_ShaderGUI_Extension_2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1515333600" data-df="ll" > Jan 7, 2018 </time><h4 class="pt-0 my-2">Unity Shader GUI 扩展二(翻译十)</h4><div class="text-muted"><p>本篇摘要: 把自身阴影烘焙进材质 增加细节纹理部分 支持更丰富的shader变体 一次编辑多个材质球 遮挡区域的Self-Shading 美术能够创作非常复杂丰富的表面纹理，它只是一个视错觉。为了增强表面纹理视觉真实感，引入Self-Shading。 如何增强呢？通常我们使用了法线来增强模型表面的凹凸层次感，法线带来的视觉增强是第一步，但是法线只适用于采样直接光照下...</p></div></div></a></article><article class="col"> <a href="/posts/Unity_ShaderGUI_Extension_1/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1515326400" data-df="ll" > Jan 7, 2018 </time><h4 class="pt-0 my-2">Unity Shader GUI 扩展一(翻译九)</h4><div class="text-muted"><p>选中当前材质后，若材质使用的Shader调用了GUI拓展，则会自动读取该Shader的所有属性。通过重实现OnGUI函数后，获取其参数地址就能读取。</p></div></div></a></article><article class="col"> <a href="/posts/Unity_Reflection/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1515240000" data-df="ll" > Jan 6, 2018 </time><h4 class="pt-0 my-2">Unity Reflection 反射(翻译八)</h4><div class="text-muted"><p>一块完美的镜子是不会发生漫反射，但现在我们自己的Shader包含的光照：环境光、漫反射、高光反射、纹理、阴影，结果看起来蛮好。但是当把Metallic设为1，Smoothness设位0.95，看起来很亮就很不自然了。从下图看尽管颜色是白色但整个表面都是黑色，只有一个很小的高亮点。这个亮点形成1是光源的入射，2朝向观察者的反射。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/Unity_Shader_Fundamentals/" class="btn btn-outline-primary" aria-label="Older" ><p>Unity Shader 基本语法(翻译二)</p></a> <a href="/posts/Unity_First_light/" class="btn btn-outline-primary" aria-label="Newer" ><p>Unity 基础光照(翻译四)</p></a></nav><section id="google-ads-bottom" class="mt-5 mb-4"><div class="container-fluid px-0"><div class="row g-3 justify-content-center"><div class="col-lg-6 d-none d-lg-block"><div class="google-ads-container-bottom"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7166721253489246" data-ad-slot="7646545514" data-ad-format="rectangle" data-full-width-responsive="false"> </ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></div></div><div class="col-lg-6 d-none d-lg-block"><div class="google-ads-container-bottom"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7166721253489246" data-ad-slot="7646545514" data-ad-format="rectangle" data-full-width-responsive="false"> </ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></div></div><div class="col-md-8 col-lg-12 d-none d-md-block d-lg-none"><div class="google-ads-container-bottom"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7166721253489246" data-ad-slot="7646545514" data-ad-format="horizontal" data-full-width-responsive="true"> </ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></div></div><div class="col-12 d-md-none"><div class="google-ads-container-bottom"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7166721253489246" data-ad-slot="7646545514" data-ad-format="auto" data-full-width-responsive="true"> </ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></div></div></div></div></section><style> #google-ads-bottom .google-ads-container-bottom { min-height: 250px; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } #google-ads-bottom .google-ads-container-bottom:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.15); } @media (max-width: 767.98px) { #google-ads-bottom .google-ads-container-bottom { min-height: 200px; margin: 0 1rem; } } @media (min-width: 768px) and (max-width: 991.98px) { #google-ads-bottom .google-ads-container-bottom { min-height: 280px; margin: 0 2rem; } } @media (min-width: 992px) { #google-ads-bottom .google-ads-container-bottom { min-height: 280px; max-width: 336px; margin: 0 auto; } }</style><div id="waline-container" class="mt-5 pt-4" style="border-top: 1px dashed #ccc; padding-top: 20px;"><div id="waline"></div></div><link rel="stylesheet" href="/assets/css/waline.css"> <script type="module"> window.WalinePrefix = "/pro"; import { init } from '/assets/js/dist/waline.min.js'; init({ el: '#waline', serverURL: 'https://comments.damonc.top', dark: 'html[data-mode="dark"]', emoji: [ '//unpkg.com/@waline/emojis@1.4.0/qq', '//unpkg.com/@waline/emojis@1.4.0/tw-emoji', '//unpkg.com/@waline/emojis@1.4.0/soul-emoji' ], reaction: true, pageview: false }); </script><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2026</time> <a href="https://github.com/damonc-top">仗剑天涯</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>The blog is powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/shader/">Shader</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai/">AI</a> <a class="post-tag btn btn-outline-primary" href="/tags/cli-agent/">CLI Agent</a> <a class="post-tag btn btn-outline-primary" href="/tags/best-practices/">Best Practices</a> <a class="post-tag btn btn-outline-primary" href="/tags/architecture/">Architecture</a> <a class="post-tag btn btn-outline-primary" href="/tags/configuration/">Configuration</a> <a class="post-tag btn btn-outline-primary" href="/tags/context-engine/">Context Engine</a> <a class="post-tag btn btn-outline-primary" href="/tags/git-worktree/">git-worktree</a> <a class="post-tag btn btn-outline-primary" href="/tags/mcp/">MCP</a> <a class="post-tag btn btn-outline-primary" href="/tags/multi-agent/">Multi-agent</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
