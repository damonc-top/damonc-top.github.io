<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ç¼–ç¨‹æ•£è®°</title>
    <description>ä¸ªäººçš„ä¸€ä¸ªæŠ€æœ¯åšå®¢ç«™ç‚¹ï¼Œè®°å½•ç”Ÿæ´»ã€å·¥ä½œã€å­¦ä¹ ä¸­çš„ä¸€äº›å°äº‹ï¼Œä»¥åŠä¸€äº›æ¯”è¾ƒæœ‰è¶£çš„äº‹æƒ…ï¼Œç•™ç‚¹ä»€ä¹ˆä¸œè¥¿ä¹ŸæŒºä¸é”™çš„ï¼Œå¶å°”ä¼šåœ¨è¿™é‡Œåœç•™ã€‚</description>
    <link>https://www.damonc.top//</link>
    <atom:link href="https://www.damonc.top/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Thu, 25 Sep 2025 04:06:16 +0000</pubDate>
    <lastBuildDate>Thu, 25 Sep 2025 04:06:16 +0000</lastBuildDate>
    <generator>Jekyll v4.3.4</generator>
    
      <item>
        <title>æ”¹è¿›æˆ‘çš„æ€è€ƒæ¨¡å¼</title>
        <description>&lt;p&gt;â€ƒâ€ƒæœ€è¿‘æˆ‘åœ¨unity3dç¯å¢ƒå®ç°ä¸€å¥—å¤šçº¿ç¨‹ä¸‹è½½ä»£ç ã€‚æˆ‘æƒ³æˆ‘ä¸ºä»€ä¹ˆä¸€å¼€å§‹å°±æ²¡æœ‰è€ƒè™‘åˆ°åºåˆ—åŒ–æ–¹æ¡ˆçš„æ½œåœ¨é—®é¢˜å‘¢ï¼Œæˆ‘åªæ˜¯ä¸€å‘³çš„æå‡ºä¸€ä¸ªæ–¹æ¡ˆç„¶åæµ…æµ…çš„æ€è€ƒï¼Œå½“æˆ‘å†™åˆ°ä¸€åŠæ—¶å°±å‘ç°äº†å¼‚å¸¸é€€å‡ºå¯¼è‡´åºåˆ—åŒ–ä¿¡æ¯ä¸¢å¤±ï¼Œå½“å†æ¬¡æ–­ç‚¹ä¸‹è½½æ—¶åºåˆ—åŒ–ä¿¡æ¯æ˜¯æ—§çš„é”™è¯¯çš„é—®é¢˜ï¼Œè¿™ç§æ€è€ƒæ¨¡å¼æœ‰å¾ˆå¤§çš„å¼Šç«¯ã€‚&lt;/p&gt;

&lt;h2 id=&quot;é—®é¢˜å¤ç›˜&quot;&gt;é—®é¢˜å¤ç›˜&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒğŸ¯è¯¦ç»†é—®é¢˜å¤ç›˜ï¼Œæˆ‘æœ€è¿‘åœ¨å®ç°ä¸€å¥—å¤šçº¿ç¨‹ä¸‹è½½ä»£ç ï¼Œéœ€è¦æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œå¯¹äºè¶…è¿‡ä¸€å®šsizeçš„å¤§æ–‡ä»¶è¿˜è¦æ”¯æŒåˆ†æ®µä¸‹è½½ã€‚OKï¼Œæˆ‘å°±æƒ³åˆ°äº†ä¸€ä¸ªæ–¹æ¡ˆï¼šä½¿ç”¨ç‰ˆæœ¬éš”ç¦»â•åˆ†æ®µä¸‹è½½â•åŠ åˆ†æ®µæ–­ç‚¹ç»­ä¼ ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç‰ˆæœ¬éš”ç¦»ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å®ƒå¯¹åº”çš„å½“å‰ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´è¯¥æ¬¡ä¸‹è½½æ–­ç‚¹æ–‡ä»¶æ˜¯è¿‡æ—¶çš„ã€‚&lt;/li&gt;
  &lt;li&gt;åˆ†æ®µä¸‹è½½ï¼Œç¬¦å·å½“å‰ç‰ˆæœ¬å·åï¼Œæ¯ä¸ªæ–‡ä»¶åˆ†æ®µä¸‹è½½ï¼Œå¦‚æœæ²¡æœ‰ä¸‹è½½å®Œæˆè¦æŠŠæ–­ç‚¹ä¿¡æ¯Infoåºåˆ—åŒ–åˆ°ç¡¬ç›˜ã€‚&lt;/li&gt;
  &lt;li&gt;åˆ†æ®µæ–­ç‚¹ç»­ä¼ ï¼Œç¬¦åˆå½“å‰ç‰ˆæœ¬å·ï¼Œä»ç¡¬ç›˜ååºåˆ—åŒ–æ–­ç‚¹ä¿¡æ¯æ‹¿åˆ°startRangeï¼ŒendRangeï¼Œç»§ç»­æ–­ç‚¹ä¸‹è½½ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;â€ƒâ€ƒæˆ‘å¼€å§‹æƒ³åˆ°â€åºåˆ—åŒ–infoæ–‡ä»¶â€è¿™ä¸ªæ–¹æ¡ˆåï¼Œè§‰å¾—å¯è¡Œç„¶åå°±å¼€å§‹å®ç°ä»£ç ï¼Œä½†æ˜¯ç°åœ¨é‡åˆ°äº†éå¸¸ä¸¥é‡çš„é—®é¢˜ã€‚ç°åœ¨æ¥çœ‹è¿™æ˜¯å…¸å‹çš„â€è§£å†³æ–¹æ¡ˆä¼˜å…ˆâ€æ€ç»´,å¦‚ä¸‹å›¾ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-mermaid2&quot;&gt;flowchart LR
    A[é—®é¢˜] --&amp;gt; B[ç«‹å³æƒ³æ–¹æ¡ˆ]
    B --&amp;gt; C[å¼€å§‹å®ç°]
    C --&amp;gt; D[å‘ç°é—®é¢˜]
    D --&amp;gt; E[ä¿®è¡¥]

    style A fill:#ffcccc
    style B fill:#ffe5cc
    style C fill:#ffffcc
    style D fill:#e5ffcc
    style E fill:#ccffe5
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;â€ƒâ€ƒä¸Šé¢è¿™ç§â€è§£å†³æ–¹æ¡ˆä¼˜å…ˆâ€æ€ç»´æœ€å¤§çš„å¼Šç«¯ï¼Œå°±æ˜¯ç¼ºå°‘â€è¾¹ç•Œæ¡ä»¶â€æ€è€ƒã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æ­£å¸¸æƒ…å†µï¼šä¸‹è½½æœªå®Œæˆï¼Œé€€å‡ºåº”ç”¨ä¹‹å‰åºåˆ—åŒ–&lt;/li&gt;
  &lt;li&gt;å¼‚å¸¸æƒ…å†µï¼šç¨‹åºå´©æºƒã€æ–­ç”µã€å¼ºåˆ¶å…³é—­&lt;/li&gt;
  &lt;li&gt;æç«¯æƒ…å†µï¼šç£ç›˜æ»¡ã€æƒé™ä¸è¶³ã€å¹¶å‘å†²çª&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;â€ƒâ€ƒæ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-mermaid2&quot;&gt;flowchart LR
    A[é—®é¢˜] --&amp;gt; B[æ·±åº¦åˆ†æ]
    B --&amp;gt; C[å¤šæ–¹æ¡ˆå¯¹æ¯”]
    C --&amp;gt; D[é€‰æ‹©å®ç°]
    D --&amp;gt; E[éªŒè¯]

    style A fill:#cce5ff
    style B fill:#ccd9ff
    style C fill:#e5ccff
    style D fill:#ffccf2
    style E fill:#ffd9cc
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;æ”¹è¿›æ€è€ƒæ¨¡å¼&quot;&gt;æ”¹è¿›æ€è€ƒæ¨¡å¼&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒğŸ§  ä»”ç»†å›æƒ³è¿‡å»ï¼Œå…¶å®å·²ç»é‡åˆ°äº†ä¸¤ä¸‰æ¬¡è¿™ç§æƒ…å†µäº†ï¼Œç°åœ¨å·¥ç¨‹é‡è¶Šå¤§è¶Šéš¾æ‰å¤´ï¼Œè¿™å¿…é¡»å¾—åº”è¯¥ä»æºå¤´å¼€å§‹åˆ¶å®šã€‚é“ç†éƒ½æ‡‚ï¼Œä½†æ˜¯åˆæ‡’å¾—æƒ³ï¼Œå¾€å¾€ä¼šè¢«åå™¬ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ•…éšœä¼˜å…ˆæ€ç»´&quot;&gt;â€œæ•…éšœä¼˜å…ˆâ€æ€ç»´&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ•…éšœä¼˜å…ˆï¼Œæƒ³å‡ºå„ç§å„æ ·çš„å¤±è´¥åœºæ™¯ã€‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;è¿™ä¸ªæ–¹æ¡ˆåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±è´¥&lt;/code&gt;ï¼Ÿ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;å¤±è´¥åä¼šé€ æˆä»€ä¹ˆåæœ&lt;/code&gt;ï¼Ÿ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;å¦‚ä½•ä»å¤±è´¥ä¸­æ¢å¤&lt;/code&gt;ï¼Ÿ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;æœ€åçš„æƒ…å†µæ˜¯ä»€ä¹ˆ&lt;/code&gt;ï¼Ÿç­‰ç­‰ç–‘é—®ï½&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;æ–¹æ¡ˆï¼šåºåˆ—åŒ–infoæ–‡ä»¶
â†“
æ•…éšœåˆ†æï¼šç¨‹åºå¼‚å¸¸é€€å‡º â†’ infoæ–‡ä»¶æœªæ›´æ–° â†’ æ–­ç‚¹ä¿¡æ¯é”™è¯¯
â†“
åæœè¯„ä¼°ï¼šç”¨æˆ·é‡æ–°ä¸‹è½½ï¼Œæµªè´¹æ—¶é—´å’Œæµé‡
â†“
æ¢å¤ç­–ç•¥ï¼šæ–‡ä»¶åè‡ªæè¿°ï¼Œä»åˆ†æ®µæ–‡ä»¶æ¢å¤
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;mvpè¿­ä»£æ€ç»´&quot;&gt;â€œMVP+è¿­ä»£â€æ€ç»´&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¿«é€Ÿè¿­ä»£å¼€å‘ï¼Œä»æœ€æœ€åŸºç¡€çš„å¼€å§‹ï¼Œé¿å…ä¸€å¼€å§‹å°±è¿½æ±‚â€å®Œç¾æ–¹æ¡ˆâ€ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªæ¯”è¾ƒå¤§çš„åŸºç¡€åŠŸèƒ½å¦‚æœå‰æœŸè®¾è®¡ä¸åˆ°ä½è¿˜æ˜¯ä¼šæœ‰ä¸€å®šçš„å±€é™æ€§ï¼ŒAPIæ¥å£ä½¿ç”¨é‡å¤§äº†åæœŸå†æ¬¡è¿­ä»£ä¹Ÿä¼šéå¸¸æ¼ç«ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;V1: æœ€ç®€å¯è¡Œæ–¹æ¡ˆï¼ˆæ— æ–­ç‚¹ç»­ä¼ ï¼‰&lt;/li&gt;
  &lt;li&gt;V2: åŸºç¡€æ–­ç‚¹ç»­ä¼ ï¼ˆæ–‡ä»¶ååŒ…å«ä¿¡æ¯ï¼‰&lt;/li&gt;
  &lt;li&gt;V3: ä¼˜åŒ–æ€§èƒ½ï¼ˆæ‰¹é‡å¤„ç†ã€ç¼“å­˜ï¼‰&lt;/li&gt;
  &lt;li&gt;V4: é«˜çº§ç‰¹æ€§ï¼ˆMD5æ ¡éªŒã€å‹ç¼©ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;é€†å‘å·¥ç¨‹æ€ç»´&quot;&gt;â€œé€†å‘å·¥ç¨‹â€æ€ç»´&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒä»æœ€ç»ˆç›®æ ‡å€’æ¨æ€è€ƒï¼šç›®æ ‡ï¼šå¯é çš„æ–­ç‚¹ç»­ä¼ â†’éœ€æ±‚ï¼šå¼‚å¸¸é€€å‡ºåèƒ½æ¢å¤ä¸‹è½½è¿›åº¦â†’çº¦æŸï¼šä¸èƒ½ä¾èµ–åºåˆ—åŒ–æ–‡ä»¶ï¼ˆå¯èƒ½ä¸¢å¤±ï¼‰â†’æ–¹æ¡ˆï¼šä¿¡æ¯å¿…é¡»æŒä¹…åŒ–åœ¨åˆ†æ®µæ–‡ä»¶æœ¬èº«â†’å®ç°ï¼šæ–‡ä»¶ååŒ…å«èŒƒå›´ä¿¡æ¯&lt;/p&gt;

&lt;h2 id=&quot;å…·ä½“æ”¹è¿›æ–¹æ³•&quot;&gt;å…·ä½“æ”¹è¿›æ–¹æ³•&lt;/h2&gt;

&lt;h3 id=&quot;å»ºç«‹è®¾è®¡æ£€æŸ¥æ¸…å•&quot;&gt;å»ºç«‹â€è®¾è®¡æ£€æŸ¥æ¸…å•â€&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ¯æ¬¡è®¾è®¡æ–¹æ¡ˆåï¼Œå¯¹ç…§æ£€æŸ¥ï¼š&lt;/p&gt;
&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;â–¡ å¼‚å¸¸é€€å‡ºåœºæ™¯æ˜¯å¦è€ƒè™‘ï¼Ÿ
â–¡ å¹¶å‘å†²çªå¦‚ä½•å¤„ç†ï¼Ÿ
â–¡ æ€§èƒ½ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿ
â–¡ æ‰©å±•æ€§å¦‚ä½•ï¼Ÿ
â–¡ æµ‹è¯•è¦†ç›–äº†è¾¹ç•Œæƒ…å†µå—ï¼Ÿ
â–¡ æœ‰å¤‡é€‰æ–¹æ¡ˆå—ï¼Ÿ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;çº¢é˜Ÿæ€ç»´æŠ¬æ &quot;&gt;â€œçº¢é˜Ÿæ€ç»´â€æŠ¬æ &lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒè®¾è®¡å®Œæ–¹æ¡ˆåï¼Œæ¢ä¸ªè§’è‰²è¯•å›¾â€æ”»å‡»â€æˆ‘çš„è®¾è®¡ï¼ŒæŠ¬æ è¦æŠŠè¿™ä¸ªç³»ç»Ÿå¼„å´©æºƒå¤±è´¥&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;åœ¨æœ€å…³é”®æ—¶åˆ»æ–­ç”µ&lt;/li&gt;
  &lt;li&gt;æ€è¿›ç¨‹ã€å¼‚å¸¸å´©æºƒ&lt;/li&gt;
  &lt;li&gt;æ¥å›åˆ‡æ¢åŠŸèƒ½ä¸‹è½½ï¼Œä¸åŒçš„èµ„æºä¸‹è½½-ç»ˆæ­¢-ä¸‹è½½-ç»ˆæ­¢â€¦&lt;/li&gt;
  &lt;li&gt;åŒæ—¶å¯åŠ¨1000ä¸ªä¸‹è½½&lt;/li&gt;
  &lt;li&gt;ç£ç›˜ç©ºé—´ä¸è¶³&lt;/li&gt;
  &lt;li&gt;ç½‘ç»œä¸ç¨³å®š&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å¤šå±‚æ€è€ƒè¹‚èº&quot;&gt;â€œå¤šå±‚æ€è€ƒâ€è¹‚èº&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒç¬¬ä¸€å±‚ï¼šè¿™ä¸ªæ–¹æ¡ˆèƒ½è§£å†³é—®é¢˜å—ï¼Ÿï¼ˆåŠŸèƒ½æ€§ï¼‰ç¬¬äºŒå±‚ï¼šåœ¨å„ç§å¼‚å¸¸æƒ…å†µä¸‹è¿˜èƒ½å·¥ä½œå—ï¼Ÿï¼ˆå¯é æ€§ï¼‰ç¬¬ä¸‰å±‚ï¼šåœ¨å¤§è§„æ¨¡ã€é«˜å¹¶å‘ä¸‹æ€§èƒ½å¦‚ä½•ï¼Ÿï¼ˆæ‰©å±•æ€§ï¼‰ã€‚ç±»ä¼¼è‡ªæˆ‘é—®ç­”å§ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å†™è®¾è®¡æ–‡æ¡£&quot;&gt;å†™â€è®¾è®¡æ–‡æ¡£â€&lt;/h3&gt;

&lt;div class=&quot;language-markdown highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gu&quot;&gt;## æ–¹æ¡ˆå¯¹æ¯”&lt;/span&gt;
| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é£é™© |
|------|------|------|------|
| åºåˆ—åŒ–info | ç®€å•ç›´è§‚ | å¼‚å¸¸é€€å‡ºä¸¢å¤± | é«˜ |
| æ–‡ä»¶ååŒ…å«ä¿¡æ¯ | å¯é æ€§é«˜ | æ–‡ä»¶åè¾ƒé•¿ | ä½ |

&lt;span class=&quot;gu&quot;&gt;## æ•…éšœåœºæ™¯åˆ†æ&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;1.&lt;/span&gt; ç¨‹åºå¼‚å¸¸é€€å‡º
&lt;span class=&quot;p&quot;&gt;2.&lt;/span&gt; ç£ç›˜ç©ºé—´ä¸è¶³
&lt;span class=&quot;p&quot;&gt;3.&lt;/span&gt; æƒé™é—®é¢˜
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;é‚£ä¸ºä»€ä¹ˆä¼šé¢‘ç¹è¿™æ ·å‘¢&quot;&gt;é‚£ä¸ºä»€ä¹ˆä¼šé¢‘ç¹è¿™æ ·å‘¢&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;æŠ—ä½å‹åŠ›&lt;/strong&gt;ï¼ç°å®æƒ…å†µå°±æ˜¯è¦æ±‚å¿«å¿«å¿«å¿«å¿«å¿«å¿«ï½ï½ï¼Œä»Šå¤©æå‡ºéœ€æ±‚æ˜å¤©å°±è¦çœ‹åˆ°åŸå‹ï¼Œâ€ç”¨AIå†™â€ã€â€å»GitHubæ‰’ä¸€å¥—ç°æˆçš„â€ï¼Œå„ç§å£°éŸ³ä¸ç»äºè€³ã€‚ä¸ç®¡æ€ä¹ˆæ ·å§ï¼Œå³ä½¿ç°å®æƒ…å†µæœ‰å¤šâ€æ¶åŠ£â€ï¼Œä¿æŒå¼€å‘å·¥ç¨‹çš„åˆå¿ƒã€å…¥è¡Œçš„åˆå¿ƒå§ã€‚&lt;strong&gt;æ‰›ä½å‹åŠ›ï¼Œè´¨é‡ä¸é€Ÿåº¦å…¼é¡¾&lt;/strong&gt;ï¼&lt;/p&gt;

</description>
        <pubDate>Mon, 01 Sep 2025 20:00:00 +0000</pubDate>
        <link>https://www.damonc.top/other/thinking_model.html</link>
        <guid isPermaLink="true">https://www.damonc.top/other/thinking_model.html</guid>
        
        <category>other</category>
        
        
        <category>other</category>
        
      </item>
    
      <item>
        <title>Unidownload_structure</title>
        <description>
</description>
        <pubDate>Tue, 10 Jun 2025 00:00:00 +0000</pubDate>
        <link>https://www.damonc.top/UniDownload_Structure.html</link>
        <guid isPermaLink="true">https://www.damonc.top/UniDownload_Structure.html</guid>
        
        
      </item>
    
      <item>
        <title>å¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ç¯‡(ä¸‰)</title>
        <description>&lt;p&gt;â€ƒâ€ƒUnityæœ‰ç€ä¸¥æ ¼çš„ä¸»çº¿ç¨‹é™åˆ¶ï¼ŒåŒæ—¶Unityçš„C#åº“ä¸€ç›´æ²¡æœ‰å¾—åˆ°åŠæ—¶çš„æ›´æ–°ï¼Œå¯¼è‡´å¾ˆå¤šC#çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼åœ¨Unityä¸­æ— æ³•ä½¿ç”¨ã€‚æŒç»­åˆ°Unity2020ç‰ˆæœ¬å‘å¸ƒåŠ å…¥äº†.net 4.xæ­£å¼ç‰ˆæœ¬çš„æ”¯æŒæ‰æœ‰äº†å®Œæ•´çš„C#å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ã€‚APMã€EAPã€async/awaitå¼‚æ­¥æ¨¡å¼éƒ½æœ‰äº†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;apmæ¨¡å¼&quot;&gt;APMæ¨¡å¼&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒAPMæ¨¡å¼æ˜¯åŸºäºå§”æ‰˜çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œå…¨ç§°&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Asynchronous Programming Model&lt;/code&gt;ï¼Œè¯¥æ¨¡å¼çš„å…¸å‹ç‰¹å¾æ˜¯BeginOperationNameå’ŒEndOperationNameï¼Œç”¨äºå¼€å§‹å’Œç»“æŸå¼‚æ­¥æ“ä½œOperationNameã€‚ä¾‹å¦‚ï¼ŒFileStreamç±»æä¾› BeginReadå’ŒEndReadæ–¹æ³•ã€‚Beginæ–¹æ³•è¿”å›ä¸€ä¸ªIAsyncResultå¯¹è±¡ï¼Œè°ƒç”¨Endæ–¹æ³•æ—¶éœ€è¦ä¼ å…¥IAsyncResultå¯¹è±¡ï¼ŒEndæ–¹æ³•ä¼šè¿”å›å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚&lt;/p&gt;

&lt;h3 id=&quot;iasyncresultå¯¹è±¡&quot;&gt;IAsyncResultå¯¹è±¡&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒè¯¥æ–¹æ³•BeginOperationNameå¼€å§‹å¼‚æ­¥æ“ä½œOperationNameå¹¶è¿”å›å®ç°IAsyncResultæ¥å£çš„å¯¹è±¡ã€‚IAsyncResultå¯¹è±¡å­˜å‚¨æœ‰å…³å¼‚æ­¥ä½œçš„ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æˆå‘˜&lt;/th&gt;
      &lt;th&gt;DESCRIPTION&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;AsyncState&lt;/td&gt;
      &lt;td&gt;ä¸€ä¸ªå¯é€‰çš„ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³å¼‚æ­¥ä½œçš„ä¿¡æ¯ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;AsyncWaitHandle&lt;/td&gt;
      &lt;td&gt;WaitHandleå¯ç”¨äºé˜»æ­¢åº”ç”¨ç¨‹åºæ‰§è¡Œï¼Œç›´åˆ°å¼‚æ­¥æ“ä½œå®Œæˆã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;CompletedSynchronously&lt;/td&gt;
      &lt;td&gt;ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼æŒ‡ç¤ºå¼‚æ­¥æ“ä½œæ˜¯å¦åœ¨ç”¨äºè°ƒç”¨ BeginOperationName çš„çº¿ç¨‹ä¸Šå®Œæˆï¼Œè€Œä¸æ˜¯åœ¨å•ç‹¬çš„ ThreadPool çº¿ç¨‹ä¸Šå®Œæˆã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IsCompleted&lt;/td&gt;
      &lt;td&gt;ä¸€ä¸ªè¡¨ç¤ºå¼‚æ­¥æ“ä½œæ˜¯å¦å·²å®Œæˆçš„å€¼ã€‚&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;å§”æ‰˜å¼‚æ­¥æ“ä½œ&quot;&gt;å§”æ‰˜å¼‚æ­¥æ“ä½œ&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ— å‚æ— è¿”å›å€¼çš„å§”æ‰˜å¼‚æ­¥æ“ä½œç¤ºä¾‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WorkerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;WorkerHandler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//å¯ä»¥ä¸ç”¨å›è°ƒå‡½æ•°å’Œè‡ªå®šä¹‰å‚æ•°&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IAsyncResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;BeginInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒBeginInvokeå‰å‡ ä¸ªå‚æ•°å¿…é¡»ä¸å§”æ‰˜ç­¾åä¸€è‡´ï¼Œæœ€åä¸¤ä¸ªå‚æ•°æ˜¯å›ºå®šçš„å›è°ƒå‡½æ•°å’Œè‡ªå®šä¹‰å‚æ•°ï¼Œæœ‰å‚æœ‰è¿”å›å€¼çš„å§”æ‰˜å¼‚æ­¥æ“ä½œç¤ºä¾‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WorkerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;WorkerHandler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//BeginInvokeå‰å‡ ä¸ªå‚æ•°å¿…é¡»ä¸å§”æ‰˜ç­¾åä¸€è‡´&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//BeginInvokeæœ€åä¸¤ä¸ªå‚æ•°æ˜¯å›ºå®šçš„å›è°ƒå‡½æ•°å’Œè‡ªå®šä¹‰å‚æ•°&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IAsyncResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;BeginInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒå®Œæˆå›è°ƒå‡½æ•°ä¸AsyncCallbackå§”æ‰˜çš„ç­¾åä¸€è‡´ï¼Œè‡ªå®šä¹‰å‚æ•°é€šè¿‡IAsyncResult.AsyncStateå±æ€§è·å–ï¼Œå¼‚æ­¥æ“ä½œçš„å®Œæˆå›è°ƒä¸è‡ªå®šä¹‰å‚æ•°ç¤ºä¾‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WorkerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;WorkerHandler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//å®Œæˆå›è°ƒå‡½æ•°ä¸AsyncCallbackå§”æ‰˜çš„ç­¾åä¸€è‡´&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;FinishCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IAsyncResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AsyncState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;IAsyncResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;BeginInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FinishCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;custom parameter&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å¼‚æ­¥æ“ä½œç­‰å¾…&quot;&gt;å¼‚æ­¥æ“ä½œç­‰å¾…&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒIAsyncResult.AsyncWaitHandleå±æ€§è¿”å›ä¸€ä¸ªWaitHandleå¯¹è±¡ï¼Œå¯ä»¥ç”¨äºé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å¼‚æ­¥æ“ä½œå®Œæˆã€‚å¼‚æ­¥æ“ä½œç­‰å¾…ç¤ºä¾‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// 1. ç›´æ¥é˜»å¡ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IAsyncResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;BeginInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 2. è½®è¯¢æ£€æŸ¥&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IAsyncResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;BeginInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// åšå…¶ä»–å·¥ä½œ&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 3. ä½¿ç”¨WaitHandle&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IAsyncResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;BeginInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AsyncWaitHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WaitOne&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…å®Œæˆ&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asyncResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;eapæ¨¡å¼&quot;&gt;EAPæ¨¡å¼&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒEAPæ¨¡å¼æ˜¯åŸºäºäº‹ä»¶çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œå…¨ç§°&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Event-based Asynchronous Pattern&lt;/code&gt;ï¼Œè¯¥æ¨¡å¼çš„å…¸å‹ç‰¹å¾æ˜¯äº‹ä»¶æ“ä½œã€‚å®ƒé€šè¿‡äº‹ä»¶å›è°ƒæ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚ç›¸æ¯”APMæ¨¡å¼ï¼ŒEAPæ¨¡å¼æ›´åŠ ç”¨æˆ·å‹å¥½ï¼Œæ”¯æŒå–æ¶ˆæ“ä½œå’Œè¿›åº¦æŠ¥å‘Šã€‚EAPæ¨¡å¼çš„æœ€å°è®¾è®¡åŒ…å«ä¸€ä¸ªBeginMethodNameæ–¹æ³•å’Œä¸€ä¸ªMethodNameCompletedäº‹ä»¶ã€‚BeginMethodNameæ–¹æ³•å¯åŠ¨å¼‚æ­¥æ“ä½œå¹¶è¿”å›IAsyncResultå¯¹è±¡ï¼ŒMethodNameCompletedäº‹ä»¶åœ¨å¼‚æ­¥æ“ä½œå®Œæˆæ—¶è§¦å‘ã€‚MethodNameCompletedEventArgsç±»æ´¾ç”Ÿè‡ªAsyncCompletedEventArgsï¼Œæä¾›å¼‚æ­¥æ“ä½œçš„ç»“æœå’Œä»»ä½•é”™è¯¯ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MethodNameCompletedEventHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;MethodNameCompletedEventArgs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MethodNameCompletedEventArgs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AsyncCompletedEventArgs&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MyReturnType&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;eapæ¨¡å¼çš„æ ¸å¿ƒç‰¹å¾&quot;&gt;EAPæ¨¡å¼çš„æ ¸å¿ƒç‰¹å¾&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ–¹æ³•/äº‹ä»¶&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;MethodNameAsync&lt;/td&gt;
      &lt;td&gt;æ–¹æ³• - å¯åŠ¨å¼‚æ­¥æ“ä½œ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;MethodNameCompleted&lt;/td&gt;
      &lt;td&gt;äº‹ä»¶ - å¼‚æ­¥æ“ä½œå®Œæˆæ—¶è§¦å‘&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;MethodNameCompletedEventArgs&lt;/td&gt;
      &lt;td&gt;äº‹ä»¶å‚æ•°ï¼ŒåŒ…å«ç»“æœå’Œé”™è¯¯ä¿¡æ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;CancelAsync&lt;/td&gt;
      &lt;td&gt;æ–¹æ³• - æ”¯æŒå–æ¶ˆæ“ä½œ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ProgressChanged&lt;/td&gt;
      &lt;td&gt;äº‹ä»¶ - æ”¯æŒè¿›åº¦æŠ¥å‘Š&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;å®ç°æ”¯æŒeapçš„ç±»&quot;&gt;å®ç°æ”¯æŒEAPçš„ç±»&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå®šä¹‰äº‹ä»¶å‚æ•°ç±»MethodNameCompletedEventArgsï¼Œæ´¾ç”Ÿè‡ªAsyncCompletedEventArgsï¼Œæä¾›å¼‚æ­¥æ“ä½œçš„ç»“æœå’Œä»»ä½•é”™è¯¯ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DownloadCompletedEventArgs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncCompletedEventArgs&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FilePath&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BytesDownloaded&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadCompletedEventArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cancelled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
        &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bytesDownloaded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cancelled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;FilePath&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;BytesDownloaded&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bytesDownloaded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DownloadProgressChangedEventArgs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ProgressChangedEventArgs&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BytesReceived&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TotalBytesToReceive&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadProgressChangedEventArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;progressPercentage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bytesReceived&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;totalBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;progressPercentage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;BytesReceived&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bytesReceived&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;TotalBytesToReceive&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;totalBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒå®šä¹‰æ”¯æŒEAPçš„ç±»DownloadManagerï¼ŒåŒ…å«MethodNameAsyncæ–¹æ³•å’ŒMethodNameCompletedäº‹ä»¶ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// 1. å®ç°EAPæ¨¡å¼çš„ä¸‹è½½å™¨ç±»&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DownloadManager&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebClient&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_lockObject&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// 2. å®šä¹‰äº‹ä»¶&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;event&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EventHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadCompletedEventArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DownloadCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;event&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EventHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadProgressChangedEventArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ProgressChanged&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// 3. å¼‚æ­¥æ–¹æ³•&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// æ£€æŸ¥æ˜¯å¦å·²æœ‰æ“ä½œåœ¨è¿›è¡Œ&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_lockObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InvalidOperationException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ä¸‹è½½æ“ä½œå·²åœ¨è¿›è¡Œä¸­&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WebClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// è®¢é˜…WebClientäº‹ä»¶&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadProgressChanged&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OnDownloadProgressChanged&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadFileCompleted&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OnDownloadFileCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// å¼€å§‹å¼‚æ­¥ä¸‹è½½&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DownloadFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
                &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DownloadState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Url&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FilePath&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UserState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œç«‹å³è§¦å‘å®Œæˆäº‹ä»¶&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;OnDownloadCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadCompletedEventArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// 4. å–æ¶ˆæ–¹æ³•&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancelAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_lockObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CancelAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// 5. å†…éƒ¨çŠ¶æ€ç±»&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DownloadState&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Url&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FilePath&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UserState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// 6. è¿›åº¦å˜åŒ–äº‹ä»¶å¤„ç†&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;OnDownloadProgressChanged&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DownloadProgressChangedEventArgs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadProgressChangedEventArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProgressPercentage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BytesReceived&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TotalBytesToReceive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            
        &lt;span class=&quot;n&quot;&gt;ProgressChanged&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Invoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// 7. å®Œæˆäº‹ä»¶å¤„ç†&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;OnDownloadFileCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncCompletedEventArgs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bytesDownloaded&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cancelled&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;bytesDownloaded&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;FileInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FilePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* å¿½ç•¥è·å–æ–‡ä»¶å¤§å°çš„é”™è¯¯ */&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// æ¸…ç†èµ„æº&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_lockObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadProgressChanged&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OnDownloadProgressChanged&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadFileCompleted&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OnDownloadFileCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// è§¦å‘å®Œæˆäº‹ä»¶&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;OnDownloadCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadCompletedEventArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cancelled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FilePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bytesDownloaded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// 8. å®‰å…¨è§¦å‘å®Œæˆäº‹ä»¶çš„æ–¹æ³•&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;OnDownloadCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadCompletedEventArgs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;DownloadCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Invoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// 9. é‡Šæ”¾èµ„æº&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_lockObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_webClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒä½¿ç”¨æ”¯æŒEAPçš„ç±»DownloadManagerï¼Œå¯ä»¥å®ç°å¼‚æ­¥ä¸‹è½½æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Program&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;downloader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;FileDownloader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// è®¢é˜…äº‹ä»¶&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;downloader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProgressChanged&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;ä¸‹è½½è¿›åº¦: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProgressPercentage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;% &quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;
                            &lt;span class=&quot;s&quot;&gt;$&quot;(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BytesReceived&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TotalBytesToReceive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; bytes)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;downloader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadCompleted&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cancelled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ä¸‹è½½å·²å–æ¶ˆ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;ä¸‹è½½å¤±è´¥: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;ä¸‹è½½å®Œæˆ: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FilePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;, å¤§å°: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BytesDownloaded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; bytes&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// å¼€å§‹å¼‚æ­¥ä¸‹è½½&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;https://example.com/largefile.zip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;@&quot;C:\temp\downloaded.zip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;å¼€å§‹ä¸‹è½½...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;downloader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DownloadFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;è‡ªå®šä¹‰çŠ¶æ€å¯¹è±¡&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// æ¨¡æ‹Ÿå…¶ä»–å·¥ä½œ&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// å¯ä»¥å–æ¶ˆä¸‹è½½&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;5ç§’åå–æ¶ˆä¸‹è½½&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;downloader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CancelAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;premonition warning&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon warning&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-warning&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; ä¸æ¨èEAPæ¨¡å¼ &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;ç›¸æ¯”äºAPMæ¨¡å¼ï¼ŒEAPæ¨¡å¼æ›´åŠ å¤æ‚ï¼Œè€Œä¸”å®¹æ˜“å‡ºç°èµ„æºæ³„æ¼ã€‚
åŒæ—¶å®˜æ–¹ä¹Ÿä¸æ¨èä½¿ç”¨EAPæ¨¡å¼ï¼Œæ”¹ç”¨async/awaitå¼‚æ­¥æ¨¡å¼ã€‚
Unityä¹‹å‰å¤§éƒ¨åˆ†éƒ½æ˜¯ç±»EAPæ¨¡å¼ï¼Œç°åœ¨æ¨èä½¿ç”¨async/awaitå¼‚æ­¥æ¨¡å¼ã€‚&lt;/p&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;h2 id=&quot;asyncawaitå¼‚æ­¥æ¨¡å¼&quot;&gt;async/awaitå¼‚æ­¥æ¨¡å¼&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒasync/awaitå¼‚æ­¥æ¨¡å¼å…¨ç§°&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Async/Await&lt;/code&gt;ï¼Œè¯¥æ¨¡å¼çš„å…¸å‹ç‰¹å¾æ˜¯async/awaitå…³é”®å­—ã€‚async/awaitå…³é”®å­—ç”¨äºå£°æ˜å¼‚æ­¥æ–¹æ³•ï¼Œawaitå…³é”®å­—ç”¨äºç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetStringAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;çŠ¶æ€æœº&quot;&gt;çŠ¶æ€æœº&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒasync/awaitçš„æœ¬è´¨æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„çŠ¶æ€æœºã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;å¼€å§‹ä¸‹è½½&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// åŒæ­¥æ‰§è¡Œ&lt;/span&gt;
    
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetStringAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// å¼‚æ­¥ç­‰å¾…ç‚¹&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ä¸‹è½½å®Œæˆ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// å¼‚æ­¥ç»§ç»­æ‰§è¡Œ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ToUpper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// åŒæ­¥æ‰§è¡Œ&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ç¼–è¯‘å™¨å®é™…ç”Ÿæˆçš„çŠ¶æ€æœºä¼ªä»£ç ï¼š&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// - çŠ¶æ€0ï¼šå¼€å§‹æ‰§è¡Œ&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// - çŠ¶æ€1ï¼šawaitä¹‹åçš„ç»§ç»­æ‰§è¡Œ&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;asyncå…³é”®å­—&quot;&gt;asyncå…³é”®å­—&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒasyncå…³é”®å­—ç”¨äºå£°æ˜å¼‚æ­¥æ–¹æ³•ï¼Œasyncå…³é”®å­—ç”¨äºä¿®é¥°æ–¹æ³•ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ã€‚å¦‚æœä¸æ˜¯å¼‚æ­¥æ–¹æ³•å°±ä¸è¦ä¹±åŠ asyncå…³é”®å­—ï¼Œå› ä¸ºè°ƒç”¨asyncæ–¹æ³•ä¼šæœ‰æ˜¾è‘—çš„æ€§èƒ½æŸå¤±ã€‚åŒæ ·çš„æ–¹æ³•ç”¨é€šå¸¸çš„åŒæ­¥å®šä¹‰ï¼Œè¦æ¯”åŠ ä¸Šasyncå…³é”®å­—ä¿®é¥°çš„å¿«40-50å€ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetStringAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒé¿å…ä½¿ç”¨async voidæ–¹æ³•ï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ï¼Œå¼‚å¸¸å¤„ç†å®¹æ˜“å¿½ç•¥ï¼Œå¤„ç†ä¸å½“å®¹æ˜“é€ æˆè¿›ç¨‹å´©æºƒã€‚å¦‚æœasyncæ–¹æ³•è¿”å›Taskï¼ŒTaskå¯¹è±¡å¾ˆå®¹æ˜“ç›‘æ§ï¼Œå¼‚å¸¸ä¹Ÿè¢«åŒ…è£…åœ¨å†…ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;å¼‚å¸¸&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;å¼‚å¸¸&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;å¼‚å¸¸&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;awaitå…³é”®å­—&quot;&gt;awaitå…³é”®å­—&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒawaitå…³é”®å­—ç”¨äºç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆã€‚awaitå…³é”®å­—ç”¨äºä¿®é¥°è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºè¯¥è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œæ§åˆ¶æƒä¼šè¿”å›åˆ°awaitè¯­å¥æ‰€åœ¨çš„ä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;

&lt;h3 id=&quot;configureawait&quot;&gt;ConfigureAwait&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒConfigureAwait(bool continueOnCapturedContext)ç”¨äºé…ç½®åœ¨ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œæ˜¯å¦ç»§ç»­åœ¨æ•è·çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚ä½¿ç”¨ConfigureAwait(false)å¯ä»¥é¿å…æ­»é”ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦å›åˆ°åŸå§‹ä¸Šä¸‹æ–‡å‡å°‘çº¿ç¨‹åˆ‡æ¢å¼€é”€ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;LibraryMethodAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// âœ… ä¸éœ€è¦å›åˆ°åŸå§‹ä¸Šä¸‹æ–‡&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetDataFromApiAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ConfigureAwait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;processed&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ConfigureAwait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;processed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å¼‚å¸¸å¤„ç†æ¨¡å¼&quot;&gt;å¼‚å¸¸å¤„ç†æ¨¡å¼&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¼‚æ­¥æ–¹æ³•ä¸­ä½¿ç”¨try/catchå—æ•è·å¼‚å¸¸ï¼Œé€ä¸€å±•å¼€å¼‚å¸¸ï¼Œé¿å…åæ‰å¼‚å¸¸ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// âœ… æ­£ç¡®çš„å¼‚å¸¸å¤„ç†æ¨¡å¼&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SafeExecuteAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ConfigureAwait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Success&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Cancelled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeoutException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Failure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;æ“ä½œè¶…æ—¶: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpRequestException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Failure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;ç½‘ç»œé”™è¯¯: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// è®°å½•æœªé¢„æœŸçš„å¼‚å¸¸&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Logger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;æœªå¤„ç†çš„å¼‚å¸¸&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Failure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;æœªçŸ¥é”™è¯¯: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// âŒ é”™è¯¯ï¼šåæ‰å¼‚å¸¸&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;BadExceptionHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;RiskyOperation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// é™é»˜å¿½ç•¥å¼‚å¸¸æ˜¯å±é™©çš„&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;valuetask&quot;&gt;ValueTask&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒValueTaskæ˜¯Taskçš„è½»é‡çº§ç‰ˆæœ¬ï¼Œç”¨äºé¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// é—®é¢˜åœºæ™¯ï¼šç¼“å­˜åœºæ™¯ä¸‹çš„Taskåˆ†é…&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryGetValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cachedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// âŒ å³ä½¿æ•°æ®å·²ç¼“å­˜ï¼ˆåŒæ­¥å¯ç”¨ï¼‰ï¼Œä»ç„¶åˆ†é…Taskå¯¹è±¡&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cachedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ç¼–è¯‘å™¨ä¼šåŒ…è£…æˆ Task.FromResult(cachedValue)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// åªæœ‰è¿™é‡Œæ‰çœŸæ­£éœ€è¦å¼‚æ­¥&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_database&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ä½¿ç”¨åœºæ™¯åˆ†æ&quot;&gt;ä½¿ç”¨åœºæ™¯åˆ†æ&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒç¼“å­˜åœºæ™¯ä¸‹çš„ValueTaskä½¿ç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ConcurrentDictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_userCache&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetUserAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_userCache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryGetValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cachedUser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cachedUser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// åŒæ­¥è·¯å¾„ï¼Œé›¶åˆ†é…&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_userService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LoadUserAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_userCache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryAdd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒæ¡ä»¶å¼‚æ­¥æ“ä½œçš„ValueTaskä½¿ç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;useAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;useAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// åŒæ­¥å¤„ç†&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ProcessSync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å¼‚æ­¥å¤„ç†&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ProcessAsyncInternal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒå¯èƒ½ç«‹å³å®Œæˆçš„I/Oæ“ä½œçš„ValueTaskä½¿ç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ReadAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// æ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦æœ‰æ•°æ®&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_internalBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Available&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ReadFromBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// åŒæ­¥å®Œæˆ&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// éœ€è¦ä»ç½‘ç»œè¯»å–&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ReadFromNetworkAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒçŠ¶æ€æœºä¼˜åŒ–çš„ValueTaskä½¿ç”¨ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NotStarted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InProgress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Completed&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncState&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_state&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NotStarted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetOrCreateAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Completed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ç«‹å³è¿”å›&lt;/span&gt;
            
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NotStarted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_state&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InProgress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CreateAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// å¼€å§‹å¼‚æ­¥æ“ä½œ&lt;/span&gt;
            
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InProgress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WaitForCompletionAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…å®Œæˆ&lt;/span&gt;
            
        &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InvalidOperationException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Sat, 07 Jun 2025 10:00:00 +0000</pubDate>
        <link>https://www.damonc.top/csharp/CSharp_Thread_Pattern.html</link>
        <guid isPermaLink="true">https://www.damonc.top/csharp/CSharp_Thread_Pattern.html</guid>
        
        <category>Thread</category>
        
        
        <category>CSharp</category>
        
      </item>
    
      <item>
        <title>å¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ç¯‡-Task(äºŒ)</title>
        <description>&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯task&quot;&gt;ä»€ä¹ˆæ˜¯Task&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒä»»åŠ¡æ˜¯å¯¹è±¡ï¼Œå…¶ä¸­å°è£…äº†ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œçš„å·¥ä½œã€‚è¿™å¬èµ·æ¥æœ‰ç‚¹å„¿è€³ç†Ÿï¼Œå§”æ‰˜ä¸ä¹Ÿæ˜¯å°è£…äº†ä»£ç çš„å¯¹è±¡å—ï¼ŸåŒºåˆ«åœ¨äºå§”æ‰˜æ˜¯åŒæ­¥çš„è€Œä»»åŠ¡æ˜¯å¼‚æ­¥çš„ã€‚å¦‚æœæ‰§è¡Œä¸€ä¸ªå§”æ‰˜(ä¾‹å¦‚ä¸€ä¸ªAction)ï¼Œå½“å‰çº¿ç¨‹çš„æ§åˆ¶ç‚¹ä¼šç«‹å³è½¬ç§»åˆ°å§”æ‰˜çš„ä»£ç ï¼›é™¤éå§”æ‰˜ç»“æŸï¼Œå¦åˆ™æ§åˆ¶ä¸ä¼šè¿”å›è°ƒç”¨è€…ã€‚ç®€å•åœ°è¯´ï¼Œ&lt;strong&gt;ä»»åŠ¡æ˜¯å°†å§”æ‰˜ä»åŒæ­¥æ‰§è¡Œæ¨¡å¼è½¬å˜æˆå¼‚æ­¥æ‰§è¡Œ&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒä»»åŠ¡æ˜¯.NET4.0å¼•å…¥çš„ï¼Œæ˜¯.NET4.0ä¸­æ–°å¢çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ã€‚ç”¨ä»¥å–ä»£å¤æ‚ã€è€æ—§çš„ã€ä»£ä»·é«˜æ˜‚çš„Threadç¼–ç¨‹æ¨¡å‹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;task-vs-çº¿ç¨‹&quot;&gt;Task vs çº¿ç¨‹&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Thread&lt;/code&gt;æ˜¯.NETä¸­æœ€åŸºç¡€çš„çº¿ç¨‹æ¨¡å‹ï¼Œå®ƒæä¾›äº†æœ€åº•å±‚çš„çº¿ç¨‹ç®¡ç†ã€‚ä½†æ˜¯Threadçš„åˆ›å»ºå’Œé”€æ¯æˆæœ¬å¾ˆé«˜ï¼Œè€Œä¸”ç¼–ç è¿‡ç¨‹ä¸èƒ½å¾ˆå¥½åœ°ç®¡ç†çº¿ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ThreadPool&lt;/code&gt;æ˜¯.NETä¸­åŸºç¡€ç»„ä»¶ï¼Œä¸ºæ‰€æœ‰å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æä¾›åº•å±‚æ”¯æŒå¹¶åœ¨ä¸æ–­æ”¹è¿›ä¸­ã€‚å®ƒæä¾›äº†çº¿ç¨‹çš„å¤ç”¨ï¼Œå¯ä»¥å¾ˆå¥½åœ°ç®¡ç†çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ã€‚ä½†æ˜¯ThreadPoolçš„çº¿ç¨‹åªé€‚åˆçŸ­æ—¶è½»é‡åŒ–ä»»åŠ¡ï¼Œåƒæ“ä½œI/Oè¿™æ ·çš„æ´»åŠ¨æˆ–è€…é•¿æ—¶é—´å ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹çš„æ–¹æ³•æå¯èƒ½æ‹–æ…¢çº¿ç¨‹é˜Ÿåˆ—ä¸­çš„å…¶ä»–ä»»åŠ¡ï¼Œåè€Œæ€§èƒ½é™ä½ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Task&lt;/code&gt;æ˜¯.NET4.0ä¸­æä¾›çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œæ˜¯åŸºäºThreadPoolå®ç°çš„ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°ç¼–å†™å¼‚æ­¥ä»£ç ã€‚Taskçš„å¼•å…¥ä½¿å¾—å¼‚æ­¥ç¼–ç¨‹å˜å¾—æ›´åŠ ç®€å•ã€ç›´è§‚ã€‚&lt;/p&gt;

&lt;h3 id=&quot;taskçš„ç”Ÿå‘½å‘¨æœŸ&quot;&gt;Taskçš„ç”Ÿå‘½å‘¨æœŸ&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒTaskçš„ç”Ÿå‘½å‘¨æœŸåŒ…å«åˆ›å»ºï¼ˆCreatedï¼‰ã€ç­‰å¾…è¿è¡Œï¼ˆWaitingToRunï¼‰ã€è¿è¡Œï¼ˆRunningï¼‰ã€å®Œæˆï¼ˆRanToCompletion/Completedï¼‰ã€å¤±è´¥ï¼ˆFaultedï¼‰æˆ–å·²å–æ¶ˆï¼ˆCanceledï¼‰ç­‰é˜¶æ®µã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-mermaid2&quot;&gt;graph LR
    A[Task Created&amp;lt;br/&amp;gt;Created] --&amp;gt; B{Task Started?}
    
    B --&amp;gt;|No| C[WaitingToRun]
    B --&amp;gt;|Yes| D[Running]
    
    C --&amp;gt; E[Task Started]
    E --&amp;gt; D
    
    D --&amp;gt; F{Task Completed?}
    D --&amp;gt; G{Task Cancelled?}
    D --&amp;gt; H{Task Faulted?}
    
    F --&amp;gt;|Yes| I[RanToCompletion]
    G --&amp;gt;|Yes| J[Cancelled]
    H --&amp;gt;|Yes| K[Faulted]
    
    I --&amp;gt; L[Task Completed&amp;lt;br/&amp;gt;Final State]
    J --&amp;gt; L
    K --&amp;gt; L
    
    style A fill:#e1f5fe
    style L fill:#c8e6c9
    style D fill:#fff3e0
    style I fill:#e8f5e8
    style J fill:#ffebee
    style K fill:#fff3e0
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;taskçš„api&quot;&gt;Taskçš„API&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒä»Taskæ„é€ å‡½æ•°åˆ›å»ºTaskå®ä¾‹å¼€å§‹ã€‚System.Threading.Taskså‘½åç©ºé—´ä¸‹æä¾›äº†Taskç±»ã€‚&lt;/p&gt;

&lt;h3 id=&quot;taskæ„é€ å‡½æ•°&quot;&gt;Taskæ„é€ å‡½æ•°&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒTaskçš„æ„é€ å‡½æ•°æœ‰å¤šä¸ªé‡è½½ï¼Œä¸»è¦ç”¨äºåˆ›å»ºTaskå¯¹è±¡ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// å†…éƒ¨æ„é€ å‡½æ•°ç­¾å&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Delegate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InternalTaskOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºä¸€ä¸ªTaskå¯¹è±¡ï¼Œå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å§”æ‰˜&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºä¸€ä¸ªTaskå¯¹è±¡ï¼Œå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å§”æ‰˜ï¼Œå‚æ•°ä¸ºå–æ¶ˆä»¤ç‰Œ&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºä¸€ä¸ªTaskå¯¹è±¡ï¼Œå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å§”æ‰˜ï¼Œå‚æ•°ä¸ºTaskCreationOptionsæšä¸¾çš„å€¼&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºä¸€ä¸ªTaskå¯¹è±¡ï¼Œå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å§”æ‰˜ï¼Œå‚æ•°ä¸ºå–æ¶ˆä»¤ç‰Œï¼Œå‚æ•°ä¸ºTaskCreationOptionsæšä¸¾çš„å€¼&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºä¸€ä¸ªTaskå¯¹è±¡ï¼Œå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å§”æ‰˜ï¼Œå‚æ•°æ˜¯ä¼ é€’ç»™å§”æ‰˜çš„&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºä¸€ä¸ªTaskå¯¹è±¡ï¼Œå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å§”æ‰˜ï¼Œå‚æ•°æ˜¯ä¼ é€’ç»™å§”æ‰˜çš„ï¼Œå‚æ•°ä¸ºå–æ¶ˆä»¤ç‰Œ&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºä¸€ä¸ªTaskå¯¹è±¡ï¼Œå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å§”æ‰˜ï¼Œå‚æ•°æ˜¯ä¼ é€’ç»™å§”æ‰˜çš„ï¼Œå‚æ•°ä¸ºTaskCreationOptionsæšä¸¾çš„å€¼&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºä¸€ä¸ªTaskå¯¹è±¡ï¼Œå‚æ•°ä¸ºè¦æ‰§è¡Œçš„å§”æ‰˜ï¼Œå‚æ•°æ˜¯ä¼ é€’ç»™å§”æ‰˜çš„ï¼Œå‚æ•°ä¸ºå–æ¶ˆä»¤ç‰Œï¼Œå‚æ•°ä¸ºTaskCreationOptionsæšä¸¾çš„å€¼&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒè™½ç„¶Taskçš„æ„é€ å‡½æ•°æœ‰å¤šä¸ªé‡è½½ï¼Œä½†æ˜¯&lt;a href=&quot;https://learn.microsoft.com/zh-cn/dotnet/api/system.threading.tasks.task.-ctor?view=net-9.0#system-threading-tasks-task-ctor(system-action)&quot;&gt;å®˜æ–¹ç¤ºä¾‹&lt;/a&gt;æ¨èå¸¸è§åšæ³•è¿˜æ˜¯ä½¿ç”¨Task.Runæˆ–TaskFactory.StartNewæ–¹æ³•æ¥åˆ›å»ºTaskå¯¹è±¡ã€‚&lt;/p&gt;

&lt;div class=&quot;premonition info&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon info&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-info&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; æ¨èä½¿ç”¨æ–¹å¼ &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;æ¯ä¸€ä¸ªTaskæ„é€ å‡½æ•°ï¼Œéƒ½æä¾›äº†å¯¹åº”ç‰ˆæœ¬çš„Task.Runæˆ–è€…TaskFactory.StartNewæ–¹æ³•ã€‚å®˜æ–¹ç¤ºä¾‹ä¸­çš„æ‰€æœ‰æ„é€ å‡½æ•°éƒ½å¤šæ¬¡æ¨èä½¿ç”¨ä¸Šè¿°æ–¹æ³•æ¥åˆ›å»ºTaskå¯¹è±¡ã€‚é™¤äº†è¦å®ç°ä¸€å¥—æ›´é«˜çº§åˆ«çš„åˆ†ç¦»ä»»åŠ¡åˆ›å»ºå’Œå¯åŠ¨çš„é«˜çº§æ–¹æ¡ˆã€‚&lt;/p&gt;



 &lt;/div&gt; &lt;/div&gt;

&lt;h3 id=&quot;ä½¿ç”¨taskrun&quot;&gt;ä½¿ç”¨Task.Run&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¯¹åœ¨ ThreadPool ä¸Šè¿è¡Œçš„æŒ‡å®šå·¥ä½œè¿›è¡Œæ’é˜Ÿï¼Œå¹¶ä¸ºè¯¥å·¥ä½œè¿”å›ä»»åŠ¡æˆ–Task&lt;TResult&gt;å¥æŸ„ã€‚å®ƒæ˜¯StartNewé‡è½½çš„è½»å‹æ›¿ä»£æ–¹æ³•ã€‚&lt;/TResult&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ–¹æ³•&lt;/th&gt;
      &lt;th&gt;æè¿°&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Run(Func&lt;Task&gt;, CancellationToken)&lt;/Task&gt;&lt;/td&gt;
      &lt;td&gt;åœ¨çº¿ç¨‹æ± ä¸Šæ’é˜Ÿè¿è¡Œä»»åŠ¡ï¼Œè¿”å›ä»»åŠ¡ä»£ç†ã€‚å¯å–æ¶ˆã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Run(Action, CancellationToken)&lt;/td&gt;
      &lt;td&gt;åœ¨çº¿ç¨‹æ± ä¸Šæ’é˜Ÿè¿è¡Œå·¥ä½œï¼Œè¿”å›Taskå¯¹è±¡ã€‚å¯å–æ¶ˆã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Run(Func&lt;Task&gt;)&lt;/Task&gt;&lt;/td&gt;
      &lt;td&gt;åœ¨çº¿ç¨‹æ± ä¸Šæ’é˜Ÿè¿è¡Œä»»åŠ¡ï¼Œè¿”å›ä»»åŠ¡ä»£ç†ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Run(Action)&lt;/td&gt;
      &lt;td&gt;åœ¨çº¿ç¨‹æ± ä¸Šæ’é˜Ÿè¿è¡Œå·¥ä½œï¼Œè¿”å›Taskå¯¹è±¡ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Run&lt;TResult&gt;(Func&amp;lt;Task&lt;TResult&gt;&amp;gt;)&lt;/TResult&gt;&lt;/TResult&gt;&lt;/td&gt;
      &lt;td&gt;åœ¨çº¿ç¨‹æ± ä¸Šæ’é˜Ÿè¿è¡Œä»»åŠ¡ï¼Œè¿”å›Task(TResult)ä»£ç†ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Run&lt;TResult&gt;(Func&lt;TResult&gt;)&lt;/TResult&gt;&lt;/TResult&gt;&lt;/td&gt;
      &lt;td&gt;åœ¨çº¿ç¨‹æ± ä¸Šæ’é˜Ÿè¿è¡Œå·¥ä½œï¼Œè¿”å›Task&lt;TResult&gt;å¯¹è±¡ã€‚&lt;/TResult&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Run&lt;TResult&gt;(Func&amp;lt;Task&lt;TResult&gt;&amp;gt;, CancellationToken)&lt;/TResult&gt;&lt;/TResult&gt;&lt;/td&gt;
      &lt;td&gt;åœ¨çº¿ç¨‹æ± ä¸Šæ’é˜Ÿè¿è¡Œä»»åŠ¡ï¼Œè¿”å›Task(TResult)ä»£ç†ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Run&lt;TResult&gt;(Func&lt;TResult&gt;, CancellationToken)&lt;/TResult&gt;&lt;/TResult&gt;&lt;/td&gt;
      &lt;td&gt;åœ¨çº¿ç¨‹æ± ä¸Šæ’é˜Ÿè¿è¡Œå·¥ä½œï¼Œè¿”å›Task&lt;TResult&gt;å¯¹è±¡ã€‚&lt;/TResult&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;â€ƒâ€ƒæ–°çº¿ç¨‹è¦è¿è¡Œçš„ä»£ç ç”±ä¼ ç»™Task.Run()æ–¹æ³•çš„å§”æ‰˜(æœ¬ä¾‹æ˜¯Actionç±»å‹)æ¥å®šä¹‰ã€‚è¿™ä¸ªå§”æ‰˜(ä»¥Lambdaè¡¨è¾¾å¼çš„å½¢å¼)åœ¨æ§åˆ¶å°ä¸æ–­æ‰“å°ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;-&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;premonition warning&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon warning&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-warning&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; ä»»åŠ¡çš„å†·ä¸çƒ­ &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;è°ƒç”¨Task.Run()ä¹‹åï¼Œä½œä¸ºå‚æ•°ä¼ é€’çš„ Actionå‡ ä¹ç«‹å³å¼€å§‹æ‰§è¡Œã€‚è¿™ç§°ä¸ºâ€œçƒ­â€ä»»åŠ¡ï¼Œå³å·²è§¦å‘å¹¶å¼€å§‹æ‰§è¡Œ(æˆ–å·²å¼€å§‹æ’é˜Ÿç­‰å¾…æ‰§è¡Œ)ã€‚&lt;/p&gt;

&lt;p&gt;new Task()åˆ™æ˜¯â€œå†·â€ä»»åŠ¡ï¼Œå®ƒéœ€è¦åœ¨æ˜¾å¼è§¦å‘startä¹‹åæ‰å¼€å§‹è¿›å…¥çº¿ç¨‹æ± æ’é˜Ÿå»æ‰§è¡Œä»»åŠ¡ã€‚åœ¨startä¹‹å‰ä¸èƒ½è°ƒç”¨waitã€getRuseltç­‰ã€‚&lt;/p&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;h3 id=&quot;ä½¿ç”¨taskfactory&quot;&gt;ä½¿ç”¨Task.Factory&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¯åŠ¨Taskå¯¹è±¡å¹¶å°†ä»»åŠ¡è°ƒåº¦åˆ°TaskSchedulerï¼Œå®ƒä¸Runæ–¹æ³•åŸºæœ¬ç›¸åŒï¼Œä½†è¿”å›Taskå¯¹è±¡è€Œä¸æ˜¯Task&lt;TResult&gt;ä»£ç†ã€‚å¯ä»¥è°ƒç”¨TaskFactoryç±»çš„æ„é€ å‡½æ•°æ¥é…ç½® TaskFactoryç±»åˆ›å»ºæ‰€éœ€è¦çš„æ¨¡ç‰ˆä»»åŠ¡ã€‚&lt;/TResult&gt;&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationTokenSource&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskFactory&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;factory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TaskFactory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PreferFairness&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ExecuteSynchronously&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CustomScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartNew&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/*...*/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;taskçš„æ ¸å¿ƒå±æ€§&quot;&gt;Taskçš„æ ¸å¿ƒå±æ€§&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;å±æ€§&lt;/th&gt;
      &lt;th&gt;æè¿°&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Status&lt;/td&gt;
      &lt;td&gt;è·å–ä»»åŠ¡çš„å½“å‰çŠ¶æ€ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IsCompleted&lt;/td&gt;
      &lt;td&gt;è¯¥å€¼æŒ‡ç¤ºTaskæ˜¯å¦å·²é€šè¿‡è¿è¡Œå…¶æ–¹æ³•å®Œæˆæ‰§è¡Œã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IsFaulted&lt;/td&gt;
      &lt;td&gt;è¯¥å€¼æŒ‡ç¤ºTaskæ˜¯å¦ç”±äºæœªå¤„ç†å¼‚å¸¸è€Œå®Œæˆæ‰§è¡Œã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IsCanceled&lt;/td&gt;
      &lt;td&gt;è¯¥å€¼æŒ‡ç¤ºTaskæ˜¯å¦ç”±äºè¢«å–æ¶ˆè€Œå®Œæˆæ‰§è¡Œã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Exception&lt;/td&gt;
      &lt;td&gt;è·å–ä¸€ä¸ªå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸æ˜¯Taskå› æœªå¤„ç†å¼‚å¸¸è€Œå®Œæˆæ—¶å¼•å‘çš„ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Result&lt;/td&gt;
      &lt;td&gt;è·å–Taskçš„ç»“æœå€¼ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Id&lt;/td&gt;
      &lt;td&gt;è·å–ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;taskçš„ç­‰å¾…å’ŒåŒæ­¥&quot;&gt;Taskçš„ç­‰å¾…å’ŒåŒæ­¥&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ–¹æ³•&lt;/th&gt;
      &lt;th&gt;è¿”å›ç±»å‹&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;WaitAny&lt;/td&gt;
      &lt;td&gt;int&lt;/td&gt;
      &lt;td&gt;è¿”å›å·²å®ŒæˆTaskåœ¨æ•°ç»„ä¸­çš„ç´¢å¼•&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;WaitAll&lt;/td&gt;
      &lt;td&gt;void&lt;/td&gt;
      &lt;td&gt;æ— è¿”å›å€¼ï¼Œé˜»å¡ç›´åˆ°æ‰€æœ‰å®Œæˆ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;WhenAny&lt;/td&gt;
      &lt;td&gt;Task&lt;Task&gt;&lt;/Task&gt;&lt;/td&gt;
      &lt;td&gt;è¿”å›ä¸€ä¸ªTaskï¼Œå…¶Resultæ˜¯ç¬¬ä¸€ä¸ªå®Œæˆçš„Task&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;WhenAll&lt;/td&gt;
      &lt;td&gt;Task æˆ– Task&amp;lt;TResult[]&amp;gt;&lt;/td&gt;
      &lt;td&gt;è¿”å›ä¸€ä¸ªTaskï¼Œå½“æ‰€æœ‰è¾“å…¥Taskå®Œæˆåå®Œæˆ&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Waitæ¥å£æ˜¯é˜»å¡æ–¹æ³•&lt;/code&gt;ã€‚æ˜¯ä¸ç®¡æ˜¯å“ªä¸€ç§Waitã€WaitAnyã€WaitAllä»–ä»¬éƒ½é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³ã€‚å¼‚å¸¸ä¼šç›´æ¥æŠ›å‡ºï¼Œéœ€è¦ç«‹å³å¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Whenæ¥å£æ˜¯éé˜»å¡æ–¹æ³•&lt;/code&gt;ã€‚éƒ½æ˜¯éé˜»å¡æ–¹æ³•ï¼Œå®ƒä»¬ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªTaskï¼Œå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œè¯¥Taskä¼šå®Œæˆã€‚å¼‚å¸¸è¢«åŒ…è£…åœ¨è¿”å›çš„Taskä¸­ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// ä¼ ç»Ÿæ–¹å¼ - é˜»å¡&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tasks&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WaitAny&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// é˜»å¡ç­‰å¾…&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;Task &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; completed first&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// å¼‚æ­¥æ–¹å¼ - éé˜»å¡&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;whenAnyResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WhenAny&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completedTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;whenAnyResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// ä¸é˜»å¡çº¿ç¨‹&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;First task completed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;taskæ¥å£ä¸€è‡´æ€§&quot;&gt;Taskæ¥å£ä¸€è‡´æ€§&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒFromResultã€FromExceptionã€FromCanceledæ˜¯Taskçš„é™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå·²å®Œæˆçš„Taskå¯¹è±¡ã€‚è¿™äº›æ–¹æ³•çš„ä¸»è¦ä»·å€¼åœ¨äºä¿æŒå¼‚æ­¥æ¥å£çš„ä¸€è‡´æ€§ï¼Œå°¤å…¶æ˜¯åœ¨æ— æ³•ä½¿ç”¨async/awaitå…³é”®å­—çš„æƒ…å†µä¸‹ï¼Œç¬¦åˆTask&lt;T&gt;çš„å¥‘çº¦ã€‚&lt;/T&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ–¹æ³•&lt;/th&gt;
      &lt;th&gt;æè¿°&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;FromResult&lt;/td&gt;
      &lt;td&gt;åˆ›å»ºä¸€ä¸ªå·²å®Œæˆçš„Taskå¯¹è±¡ï¼Œå‚æ•°ä¸ºç»“æœ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;FromException&lt;/td&gt;
      &lt;td&gt;åˆ›å»ºä¸€ä¸ªå·²å®Œæˆçš„Taskå¯¹è±¡ï¼Œå‚æ•°ä¸ºå¼‚å¸¸&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;FromCanceled&lt;/td&gt;
      &lt;td&gt;åˆ›å»ºä¸€ä¸ªå·²å®Œæˆçš„Taskå¯¹è±¡ï¼Œå‚æ•°ä¸ºå–æ¶ˆä»¤ç‰Œ&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IMathService&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DivideAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numerator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;denominator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MathService&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IMathService&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DivideAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numerator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;denominator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// åŒæ­¥çš„å‚æ•°éªŒè¯&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;denominator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// å‘ç°é”™è¯¯ï¼Œç«‹å³è¿”å›ä¸€ä¸ªå¤±è´¥çš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯æŠ›å‡ºé˜»å¡æ€§å¼‚å¸¸&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FromException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DivideByZeroException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Denominator cannot be zero.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// å¦‚æœéªŒè¯é€šè¿‡ï¼Œè¿›è¡ŒåŒæ­¥è®¡ç®—å¹¶è¿”å›æˆåŠŸç»“æœ&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numerator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;denominator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒé¿å…çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// ä¸å¥½ - ä¸å¿…è¦çš„çº¿ç¨‹åˆ‡æ¢v&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;BadExample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Hello&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// å¥½ - ç›´æ¥è¿”å›&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GoodExample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Hello&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;taskçš„å»¶ç»­æ“ä½œ&quot;&gt;Taskçš„å»¶ç»­æ“ä½œ&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒå»¶ç»­ä»»åŠ¡ï¼ˆContinuation Tasksï¼‰æ˜¯Taskå¹¶è¡Œåº“ä¸­æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒå…è®¸æ‚¨åœ¨æŸä¸ªä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ‰§è¡Œåç»­æ“ä½œï¼Œå½¢æˆä»»åŠ¡é“¾ã€‚å»¶ç»­ä»»åŠ¡çš„æ ¸å¿ƒæ–¹æ³•æ˜¯ContinueWithã€‚&lt;/p&gt;

&lt;h3 id=&quot;taskcontinuewith&quot;&gt;Task.ContinueWith&lt;/h3&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuationAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuationAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuationAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuationFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…³é”®ç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;éé˜»å¡æ€§ï¼šå»¶ç»­ä»»åŠ¡ä¸ä¼šé˜»å¡å‰ç½®ä»»åŠ¡çš„å®Œæˆ&lt;/li&gt;
  &lt;li&gt;è‡ªåŠ¨è°ƒåº¦ï¼šå½“ä»»åŠ¡å®Œæˆæ—¶ï¼Œå»¶ç»­ä»»åŠ¡ä¼šè‡ªåŠ¨è¢«è°ƒåº¦æ‰§è¡Œ&lt;/li&gt;
  &lt;li&gt;çŠ¶æ€æ„ŸçŸ¥ï¼šå»¶ç»­ä»»åŠ¡å¯ä»¥é€šè¿‡Taskå‚æ•°è®¿é—®å‰ç½®ä»»åŠ¡çš„çŠ¶æ€ã€ç»“æœå’Œå¼‚å¸¸&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;â€ƒâ€ƒå»¶ç»­ä»»åŠ¡çš„æ‰§è¡Œä¾èµ–äºå‰ç½®ä»»åŠ¡çš„çŠ¶æ€ï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;antecedent&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ComputeData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;antecedent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ä»»åŠ¡æˆåŠŸå®Œæˆ&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsFaulted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ä»»åŠ¡å‡ºç°å¼‚å¸¸&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exception&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCanceled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ä»»åŠ¡è¢«å–æ¶ˆ&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ä»»åŠ¡è¢«å–æ¶ˆ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å»¶ç»­ä»»åŠ¡çš„é€‰é¡¹&quot;&gt;å»¶ç»­ä»»åŠ¡çš„é€‰é¡¹&lt;/h3&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// 1. æ— æ¡ä»¶æ‰§è¡Œ - æ— è®ºå‰ç½®ä»»åŠ¡ä»€ä¹ˆçŠ¶æ€éƒ½æ‰§è¡Œ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;None&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 2. æ¡ä»¶æ‰§è¡Œé€‰é¡¹&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnRanToCompletion&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// ä»…åœ¨å‰ç½®ä»»åŠ¡æˆåŠŸå®Œæˆæ—¶æ‰§è¡Œ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnFaulted&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;// ä»…åœ¨å‰ç½®ä»»åŠ¡å¤±è´¥æ—¶æ‰§è¡Œ  &lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnCanceled&lt;/span&gt;          &lt;span class=&quot;c1&quot;&gt;// ä»…åœ¨å‰ç½®ä»»åŠ¡å–æ¶ˆæ—¶æ‰§è¡Œ&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 3. æ”¯æŒç»„åˆæ¡ä»¶&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;OnlyOnRanToCompletion&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OnlyOnFaulted&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;é“¾å¼å»¶ç»­ä»»åŠ¡&quot;&gt;é“¾å¼å»¶ç»­ä»»åŠ¡&lt;/h3&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnRanToCompletion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Uwarp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;processedData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SaveResults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;processedData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnRanToCompletion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒUnwrapæ˜¯Taskçš„æ‰©å±•æ–¹æ³•ï¼Œç”¨äºå°†Task&amp;lt;Task&lt;T&gt;&amp;gt;è§£åŒ…ä¸ºTask&lt;T&gt;ã€‚å¯ä»¥å°†é“¾å¼ä»»åŠ¡è§£åŒ…ï¼Œé¿å…åµŒå¥—çš„Taskã€‚&lt;/T&gt;&lt;/T&gt;&lt;/p&gt;

&lt;h2 id=&quot;taskçš„å¼‚å¸¸å¤„ç†&quot;&gt;Taskçš„å¼‚å¸¸å¤„ç†&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒä¸èƒ½ç”¨tryå—åŒ…è£…start()è°ƒç”¨æ¥æ•æ‰å¼‚å¸¸ï¼Œå› ä¸ºæ§åˆ¶ä¼šç«‹å³ä»è°ƒç”¨è¿”å›ï¼Œç„¶åæ§åˆ¶ä¼šç¦»å¼€tryå—ï¼Œè€Œè¿™æ—¶è·ç¦»å·¥ä½œè€…çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸å¯èƒ½è¿˜æœ‰å¥½ä¹…å‘¢ ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å°†ä»»åŠ¡çš„å§”æ‰˜ä¸»ä½“åŒ…è£…åˆ°try/catchå—ä¸­ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InvalidOperationException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Something went wrong&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// å¼‚å¸¸æ­¤æ—¶è¿˜æ²¡æœ‰æŠ›å‡º&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åªæœ‰åœ¨ä»¥ä¸‹æ“ä½œæ—¶æ‰ä¼šæŠ›å‡ºï¼š&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// ç›´æ¥æŠ›å‡ºå¼‚å¸¸&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æˆ–&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// é€šè¿‡ResultæŠ›å‡º&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æˆ–åœ¨asyncæ–¹æ³•ä¸­&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// awaitæ—¶æŠ›å‡º&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InvalidOperationException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å¼‚å¸¸ä¼ æ’­æœºåˆ¶&quot;&gt;å¼‚å¸¸ä¼ æ’­æœºåˆ¶&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå½“ä¸€ä¸ªTaskæŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸ä¼šè¢«æ•è·å¹¶å­˜å‚¨åœ¨Taskå¯¹è±¡ä¸­ï¼Œåªæœ‰åœ¨è®¿é—®Resultå±æ€§ã€è°ƒç”¨Wait()æˆ–awaitæ—¶æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¼‚å¸¸å¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹ä¸Šè¢«è§‚å¯Ÿåˆ°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;aggregateexceptionè¯¦è§£&quot;&gt;AggregateExceptionè¯¦è§£&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¤šä¸ªTaskçš„å¼‚å¸¸ä¼šè¢«åŒ…è£…æˆAggregateExceptionï¼Œå¯ä»¥åµŒå¥—å…¶ä»–AggregateExceptionã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{});&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InvalidOperationException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;exception&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WaitAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AggregateException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ae&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å¤„ç†èšåˆå¼‚å¸¸&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;innerEx&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ae&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnerExceptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;Inner exception: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;innerEx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// æˆ–è€…å±•å¼€æ‰€æœ‰å¼‚å¸¸&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ae&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Flatten&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;Flattened exception: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// è¡¨ç¤ºå·²å¤„ç†&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ&quot;&gt;å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒâ‘ ä½¿ç”¨awaitè¿›è¡Œè‡ªç„¶å¼‚å¸¸å¤„ç†ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// æ¨èï¼šå¼‚å¸¸è‡ªç„¶ä¼ æ’­&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// è°ƒç”¨æ–¹è‡ªç„¶å¤„ç†å¼‚å¸¸&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InvalidOperationException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ç›´æ¥å¤„ç†å…·ä½“å¼‚å¸¸ç±»å‹&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒâ‘¡èšåˆå¼‚å¸¸çš„å¤„ç†æ¨¡å¼&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// æ¨¡å¼1ï¼šå±•å¼€å¹¶é€ä¸ªå¤„ç†&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WhenAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AggregateException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ae&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ae&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Flatten&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// å¤„ç†IOå¼‚å¸¸&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValidationException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// å¤„ç†éªŒè¯å¼‚å¸¸&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// æœªå¤„ç†çš„å¼‚å¸¸ä¼šé‡æ–°æŠ›å‡º&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// æ¨¡å¼2ï¼šé‡æ–°æŠ›å‡ºç¬¬ä¸€ä¸ªå¼‚å¸¸&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AggregateException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ae&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ae&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InnerException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒâ‘¢é¿å…æ··ç”¨åŒæ­¥å’Œå¼‚æ­¥ç­‰å¾…&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// é¿å…ï¼šæ··ç”¨.Wait()å’Œawait&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWorkAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// ä¸è¦è¿™æ ·åš - å¯èƒ½å¯¼è‡´æ­»é”&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// é˜»å¡å½“å‰çº¿ç¨‹&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// è€Œåº”è¯¥ï¼š&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// æ­£ç¡®çš„æ–¹å¼&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒâ‘£å»¶ç»­ä»»åŠ¡çš„å¼‚å¸¸å¤„ç†&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsFaulted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å¤„ç†å‰ç½®ä»»åŠ¡çš„å¼‚å¸¸&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;Previous task failed: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å¤„ç†æˆåŠŸç»“æœ&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnRanToCompletion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æœªè§‚å¯Ÿå¼‚å¸¸çš„å¤„ç†&quot;&gt;æœªè§‚å¯Ÿå¼‚å¸¸çš„å¤„ç†&lt;/h3&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// å±é™©ï¼šåˆ›å»ºTaskä½†ä¸è§‚å¯Ÿå…¶ç»“æœ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;This will be unobserved!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// å±é™©ï¼šåˆ›å»ºTaskä½†ä¸è§‚å¯Ÿå…¶ç»“æœ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;New&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()=&amp;gt;{}).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Taskè¢«åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè§¦å‘UnobservedTaskException&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒUnityä¸­æœªè§‚å¯Ÿå¼‚å¸¸çš„å¤„ç†ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Unityä¸­å¤„ç†æœªè§‚å¯Ÿå¼‚å¸¸&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TaskExceptionHandler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Awake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UnobservedTaskException&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HandleUnobservedException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;OnDestroy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UnobservedTaskException&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HandleUnobservedException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HandleUnobservedException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UnobservedTaskExceptionEventArgs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// åœ¨ä¸»çº¿ç¨‹å¤„ç†å¼‚å¸¸ï¼Œé¿å…Unityå´©æºƒ&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;UnityEngine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;Unobserved Task Exception: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetObserved&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;taskçš„å–æ¶ˆæœºåˆ¶&quot;&gt;Taskçš„å–æ¶ˆæœºåˆ¶&lt;/h2&gt;

&lt;h3 id=&quot;cancellationtokensource&quot;&gt;CancellationTokenSource&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒCancellationTokenSourceæ˜¯Taskå–æ¶ˆæœºåˆ¶çš„æ ¸å¿ƒç±»ï¼Œè´Ÿè´£åˆ›å»ºå’Œç®¡ç†CancellationTokenå®ä¾‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºCancellationTokenSource&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CancellationTokenSource&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// è·å–ä»¤ç‰Œ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// å¯åŠ¨ä»»åŠ¡&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// æ‰§è¡Œå·¥ä½œ&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// è¯·æ±‚å–æ¶ˆ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Cancel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// æ¸…ç†èµ„æº&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;è¶…æ—¶cancellationtokensource&quot;&gt;è¶…æ—¶CancellationTokenSource&lt;/h4&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºå¸¦è¶…æ—¶çš„ä»¤ç‰Œæº&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CancellationTokenSource&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeSpan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromSeconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// æˆ–è€…æ‰‹åŠ¨è®¾ç½®è¶…æ—¶&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CancelAfter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeSpan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromSeconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// ä½¿ç”¨&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;LongRunningOperation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;é“¾æ¥cancellationtokensource&quot;&gt;é“¾æ¥CancellationTokenSource&lt;/h4&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;CancellationTokenSource&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CancellationTokenSource&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºé“¾æ¥çš„ä»¤ç‰Œæº&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linkedCts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CreateLinkedTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cts1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// ä»»ä½•ä¸€ä¸ªä»¤ç‰Œå–æ¶ˆéƒ½ä¼šå¯¼è‡´é“¾æ¥ä»¤ç‰Œå–æ¶ˆ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linkedCts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linkedCts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;cancellationtoken&quot;&gt;CancellationToken&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒCancellationTokenæ˜¯ä¸å¯å˜çš„å€¼ç±»å‹ï¼Œç”¨äºä¼ é€’å–æ¶ˆè¯·æ±‚ã€‚&lt;/p&gt;

&lt;h4 id=&quot;æ ¸å¿ƒå±æ€§å’Œæ–¹æ³•&quot;&gt;æ ¸å¿ƒå±æ€§å’Œæ–¹æ³•&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å±æ€§&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IsCancellationRequested&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// æ˜¯å¦è¯·æ±‚äº†å–æ¶ˆ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CanBeCanceled&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// æ˜¯å¦å¯ä»¥è¢«å–æ¶ˆ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WaitHandle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WaitHandle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;         &lt;span class=&quot;c1&quot;&gt;// ç”¨äºåŒæ­¥ç­‰å¾…&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// æ–¹æ³•&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ThrowIfCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// æŠ›å‡ºå–æ¶ˆå¼‚å¸¸&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationTokenRegistration&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// æ³¨å†Œå–æ¶ˆå›è°ƒ&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;åŸºæœ¬å–æ¶ˆæ£€æŸ¥æ¨¡å¼&quot;&gt;åŸºæœ¬å–æ¶ˆæ£€æŸ¥æ¨¡å¼&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWorkAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æ–¹å¼1ï¼šè½®è¯¢æ£€æŸ¥&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// è‡ªåŠ¨å¤„ç†å–æ¶ˆ&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// æ–¹å¼2ï¼šå®šæœŸæ£€æŸ¥&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ThrowIfCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoStep1Async&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ThrowIfCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoStep2Async&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;æ³¨å†Œå–æ¶ˆå›è°ƒ&quot;&gt;æ³¨å†Œå–æ¶ˆå›è°ƒ&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// æ³¨å†Œå–æ¶ˆæ—¶çš„å›è°ƒ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CancellationTokenRegistration&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;registration&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ä»»åŠ¡è¢«å–æ¶ˆï¼Œæ‰§è¡Œæ¸…ç†å·¥ä½œ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æ¸…ç†èµ„æº&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// å–æ¶ˆæ³¨å†Œï¼ˆå¯é€‰ï¼‰&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;registration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å–æ¶ˆæ“ä½œçš„æ¨¡å¼&quot;&gt;å–æ¶ˆæ“ä½œçš„æ¨¡å¼&lt;/h3&gt;

&lt;h4 id=&quot;åä½œå¼å–æ¶ˆæ¨¡å¼&quot;&gt;åä½œå¼å–æ¶ˆæ¨¡å¼&lt;/h4&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// é˜¶æ®µ1ï¼šæ•°æ®éªŒè¯&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ThrowIfCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ValidateDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// é˜¶æ®µ2ï¼šæ•°æ®å¤„ç†&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ThrowIfCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// é˜¶æ®µ3ï¼šç»“æœä¿å­˜&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ThrowIfCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SaveResultAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;åŸºäºå›è°ƒçš„å–æ¶ˆæ¨¡å¼&quot;&gt;åŸºäºå›è°ƒçš„å–æ¶ˆæ¨¡å¼&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// æ³¨å†Œå–æ¶ˆå›è°ƒ&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;registration&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Register&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CancelPendingRequests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// æ‰§è¡Œä¸‹è½½&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetStringAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;è¶…æ—¶å–æ¶ˆæ¨¡å¼&quot;&gt;è¶…æ—¶å–æ¶ˆæ¨¡å¼&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ExecuteWithTimeoutAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;TimeSpan&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TimeoutException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;æ“ä½œåœ¨&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TotalSeconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ç§’å†…æœªå®Œæˆ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;å¤åˆå–æ¶ˆæ¨¡å¼ç”¨æˆ·å–æ¶ˆ--è¶…æ—¶&quot;&gt;å¤åˆå–æ¶ˆæ¨¡å¼ï¼ˆç”¨æˆ·å–æ¶ˆ + è¶…æ—¶ï¼‰&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ExecuteWithUserCancellationAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeoutCts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeSpan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromMinutes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linkedCts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CreateLinkedTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;userToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeoutCts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;linkedCts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å–æ¶ˆæ“ä½œçš„ä¼ æ’­&quot;&gt;å–æ¶ˆæ“ä½œçš„ä¼ æ’­&lt;/h3&gt;

&lt;h4 id=&quot;çˆ¶å­ä»»åŠ¡çš„å–æ¶ˆä¼ æ’­&quot;&gt;çˆ¶å­ä»»åŠ¡çš„å–æ¶ˆä¼ æ’­&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessMultipleFilesAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IEnumerable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tasks&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; 
        &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å½“ä»»ä½•ä¸€ä¸ªä»»åŠ¡å¤±è´¥æˆ–å–æ¶ˆæ—¶ï¼Œå–æ¶ˆæ‰€æœ‰ä»»åŠ¡&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;allTasks&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WhenAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;allTasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å–æ¶ˆä¼ æ’­åˆ°æ‰€æœ‰å­ä»»åŠ¡&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;å»¶ç»­ä»»åŠ¡çš„å–æ¶ˆå¤„ç†&quot;&gt;å»¶ç»­ä»»åŠ¡çš„å–æ¶ˆå¤„ç†&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoInitialWork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// åªæœ‰å½“åˆå§‹ä»»åŠ¡æˆåŠŸå®Œæˆæ—¶æ‰æ‰§è¡Œå»¶ç»­&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuation1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å¤„ç†æˆåŠŸç»“æœ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnRanToCompletion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// æ— è®ºåˆå§‹ä»»åŠ¡ä»€ä¹ˆçŠ¶æ€éƒ½æ‰§è¡Œå»¶ç»­ï¼ˆç”¨äºæ¸…ç†ï¼‰&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuation2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æ‰§è¡Œæ¸…ç†å·¥ä½œ&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;CleanupResources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;å–æ¶ˆçŠ¶æ€çš„ä¼ æ’­&quot;&gt;å–æ¶ˆçŠ¶æ€çš„ä¼ æ’­&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ExecuteOperationAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWorkAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OperationResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Success&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å–æ¶ˆçŠ¶æ€ä¼ æ’­&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OperationResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Success&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WasCancelled&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å…¶ä»–å¼‚å¸¸&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OperationResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Success&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;èµ„æºæ¸…ç†çš„å–æ¶ˆä¼ æ’­&quot;&gt;èµ„æºæ¸…ç†çš„å–æ¶ˆä¼ æ’­&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessWithCleanupAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IDisposable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AcquireResourceAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// æ£€æŸ¥å–æ¶ˆçŠ¶æ€&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ThrowIfCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessResourceAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å³ä½¿å–æ¶ˆä¹Ÿè¦æ¸…ç†èµ„æº&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ç¡®ä¿èµ„æºè¢«æ¸…ç†&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;å–æ¶ˆè¯·æ±‚çš„çº§è”ä¼ æ’­&quot;&gt;å–æ¶ˆè¯·æ±‚çš„çº§è”ä¼ æ’­&lt;/h4&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationTokenSource&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;StartOperation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_cts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ExecuteOperationAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ExecuteOperationAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å­æ“ä½œä¹Ÿä¼šæ”¶åˆ°å–æ¶ˆè¯·æ±‚&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Step1Async&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Step2Async&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Step3Async&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å–æ¶ˆè¢«æ­£ç¡®å¤„ç†&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;æ“ä½œè¢«å–æ¶ˆ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;taskçš„è°ƒåº¦å’Œé…ç½®&quot;&gt;Taskçš„è°ƒåº¦å’Œé…ç½®&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒTaskScheduleræ˜¯Taskè°ƒåº¦ç³»ç»Ÿçš„æ ¸å¿ƒæŠ½è±¡ç±»ï¼Œè´Ÿè´£æ§åˆ¶Taskçš„æ‰§è¡Œæ–¹å¼å’Œä½ç½®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;taskschedulerè¯¦è§£&quot;&gt;TaskSchedulerè¯¦è§£&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒTaskSchedulerè°ƒåº¦å™¨ç»´æŠ¤äº†ä¸€ä¸ªç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶å†³å®šä»»åŠ¡æ‰§è¡Œçš„ä¼˜å…ˆçº§å’Œå¤„ç†ä»»åŠ¡çš„ä¾èµ–å…³ç³»ã€‚TaskSchedulerå¯ä»¥å†³å®šä»»åŠ¡åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œæ§åˆ¶å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ï¼Œå¤„ç†ä»»åŠ¡çš„å¼‚å¸¸ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// 1. çº¿ç¨‹æ± è°ƒåº¦å™¨ï¼ˆé»˜è®¤ï¼‰&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadPoolScheduler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 2. å½“å‰åŒæ­¥ä¸Šä¸‹æ–‡è°ƒåº¦å™¨&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentScheduler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Current&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 3. ä»åŒæ­¥ä¸Šä¸‹æ–‡ä¸­æ•è·çš„è°ƒåº¦å™¨&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;capturedScheduler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromCurrentSynchronizationContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// é»˜è®¤è°ƒåº¦å™¨ - ä½¿ç”¨çº¿ç¨‹æ± &lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;æ‰§è¡Œçº¿ç¨‹: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CurrentThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ManagedThreadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// æ˜¾å¼æŒ‡å®šè°ƒåº¦å™¨&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartNew&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;



&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Button_Click&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EventArgs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// åœ¨åå°çº¿ç¨‹æ‰§è¡Œ&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// è‡ªåŠ¨åˆ‡æ¢å›UIçº¿ç¨‹æ›´æ–°ç•Œé¢&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;textBox&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Text&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// æ˜¾å¼ä½¿ç”¨è°ƒåº¦å™¨&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;UpdateUI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uiScheduler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromCurrentSynchronizationContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartNew&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;LoadData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// åœ¨UIçº¿ç¨‹æ‰§è¡Œ&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;UpdateUI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uiScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;taskcreationoptions&quot;&gt;TaskCreationOptions&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒTaskCreationOptionsæšä¸¾ç”¨äºé…ç½®Taskçš„åˆ›å»ºè¡Œä¸ºã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;é€‰é¡¹&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
      &lt;th&gt;ä½¿ç”¨åœºæ™¯&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;None&lt;/td&gt;
      &lt;td&gt;é»˜è®¤è¡Œä¸º&lt;/td&gt;
      &lt;td&gt;æ ‡å‡†ä»»åŠ¡åˆ›å»º&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PreferFairness&lt;/td&gt;
      &lt;td&gt;å…¬å¹³è°ƒåº¦&lt;/td&gt;
      &lt;td&gt;ç¡®ä¿ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;LongRunning&lt;/td&gt;
      &lt;td&gt;é•¿è¿è¡Œä»»åŠ¡&lt;/td&gt;
      &lt;td&gt;CPUå¯†é›†å‹æˆ–é•¿æ—¶é—´è¿è¡Œä»»åŠ¡&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;AttachedToParent&lt;/td&gt;
      &lt;td&gt;é™„åŠ åˆ°çˆ¶ä»»åŠ¡&lt;/td&gt;
      &lt;td&gt;åˆ›å»ºå­ä»»åŠ¡å±‚æ¬¡ç»“æ„&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DenyChildAttach&lt;/td&gt;
      &lt;td&gt;æ‹’ç»å­ä»»åŠ¡é™„åŠ &lt;/td&gt;
      &lt;td&gt;ç‹¬ç«‹ä»»åŠ¡æ‰§è¡Œ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;HideScheduler&lt;/td&gt;
      &lt;td&gt;éšè—è°ƒåº¦å™¨&lt;/td&gt;
      &lt;td&gt;å†…éƒ¨ä½¿ç”¨&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;RunContinuationsAsynchronously&lt;/td&gt;
      &lt;td&gt;å¼‚æ­¥å»¶ç»­&lt;/td&gt;
      &lt;td&gt;é¿å…æ­»é”&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;â€ƒâ€ƒLongRunningé€‰é¡¹ç”¨äºå°†ä»»åŠ¡åˆ†é…ç»™ä¸“ç”¨çº¿ç¨‹ï¼Œé€‚ç”¨äºCPUå¯†é›†å‹æˆ–é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// é•¿è¿è¡Œä»»åŠ¡ - ä¸ºå…¶åˆ†é…ä¸“ç”¨çº¿ç¨‹&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;longRunningTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartNew&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// CPUå¯†é›†å‹è®¡ç®—&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å¤æ‚è®¡ç®—&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LongRunning&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒAttachedToParenté€‰é¡¹ç”¨äºå°†å­ä»»åŠ¡è‡ªåŠ¨é™„åŠ åˆ°çˆ¶ä»»åŠ¡ï¼Œé€‚ç”¨äºåˆ›å»ºå­ä»»åŠ¡å±‚æ¬¡ç»“æ„ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parentTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;çˆ¶ä»»åŠ¡å¼€å§‹&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å­ä»»åŠ¡è‡ªåŠ¨é™„åŠ åˆ°çˆ¶ä»»åŠ¡&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;childTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartNew&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;å­ä»»åŠ¡æ‰§è¡Œ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AttachedToParent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// çˆ¶ä»»åŠ¡ç­‰å¾…æ‰€æœ‰å­ä»»åŠ¡å®Œæˆ&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;çˆ¶ä»»åŠ¡ç»“æŸ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒPreferFairnessé€‰é¡¹ç”¨äºç¡®ä¿ä»»åŠ¡æŒ‰æäº¤é¡ºåºæ‰§è¡Œã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// ç¡®ä¿ä»»åŠ¡æŒ‰æäº¤é¡ºåºæ‰§è¡Œ&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartNew&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;ä»»åŠ¡ &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; æ‰§è¡Œ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PreferFairness&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;taskcontinuationoptions&quot;&gt;TaskContinuationOptions&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒTaskContinuationOptionsæ§åˆ¶å»¶ç»­ä»»åŠ¡çš„æ‰§è¡Œæ¡ä»¶å’Œè¡Œä¸ºã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å¯èƒ½æˆåŠŸã€å¤±è´¥æˆ–å–æ¶ˆ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ComputeResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 1. åªæœ‰æˆåŠŸæ—¶æ‰§è¡Œ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;successContinuation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;ç»“æœ: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnRanToCompletion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 2. åªæœ‰å¤±è´¥æ—¶æ‰§è¡Œ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failureContinuation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;é”™è¯¯: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnFaulted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 3. åªæœ‰å–æ¶ˆæ—¶æ‰§è¡Œ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cancellationContinuation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ä»»åŠ¡è¢«å–æ¶ˆ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnCanceled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 4. æ— è®ºä»€ä¹ˆæƒ…å†µéƒ½æ‰§è¡Œï¼ˆç”¨äºæ¸…ç†ï¼‰&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cleanupContinuation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;CleanupResources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ç»„åˆå¤šä¸ªé€‰é¡¹&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OnlyOnRanToCompletion&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RunContinuationsAsynchronously&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;TaskContinuationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AttachedToParent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continuation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;initialTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ContinueWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;è‡ªå®šä¹‰taskscheduler&quot;&gt;è‡ªå®šä¹‰TaskScheduler&lt;/h3&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UnityTaskScheduler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskScheduler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ConcurrentQueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_tasks&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;QueueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_tasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Enqueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TryExecuteTaskInline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;taskWasPreviouslyQueued&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TryExecuteTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IEnumerable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetScheduledTasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_tasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// åœ¨Unityä¸»çº¿ç¨‹è°ƒç”¨æ­¤æ–¹æ³•&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ExecutePendingTasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_tasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryDequeue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;TryExecuteTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// åœ¨MonoBehaviourä¸­ä½¿ç”¨&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TaskManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UnityTaskScheduler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_scheduler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_scheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ExecutePendingTasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RunOnMainThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCompletionSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartNew&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCreationOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_scheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;taskçš„é«˜çº§ç”¨æ³•&quot;&gt;Taskçš„é«˜çº§ç”¨æ³•&lt;/h2&gt;

&lt;h3 id=&quot;taskcompletionsource&quot;&gt;TaskCompletionSource&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒTaskCompletionSourceæ˜¯Taskå¹¶è¡Œåº“ä¸­æœ€å¼ºå¤§çš„å·¥å…·ä¹‹ä¸€ï¼Œå…è®¸åˆ›å»ºâ€å†·â€ä»»åŠ¡ï¼Œç”¨äºæ‰‹åŠ¨æ§åˆ¶Taskçš„ç”Ÿå‘½å‘¨æœŸå’Œå®ŒæˆçŠ¶æ€ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TaskCompletionSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// è·å–å…³è”çš„Taskå¯¹è±¡&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å®Œæˆæ§åˆ¶æ–¹æ³•&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SetResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;// è®¾ç½®æˆåŠŸç»“æœ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SetException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// è®¾ç½®å¼‚å¸¸&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SetException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IEnumerable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// è®¾ç½®å¤šä¸ªå¼‚å¸¸&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SetCanceled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;// è®¾ç½®ä¸ºå·²å–æ¶ˆ&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å°è¯•ç‰ˆæœ¬ï¼ˆå¦‚æœä»»åŠ¡å·²å®Œæˆåˆ™è¿”å›falseï¼‰&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TrySetResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TrySetException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TrySetCanceled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒåŒ…è£…å¼‚æ­¥å›è°ƒæ“ä½œ&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadFileAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCompletionSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WebClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DownloadStringCompleted&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cancelled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetCanceled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DownloadAssestAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;taskåœ¨unity3dä¸­çš„åº”ç”¨&quot;&gt;Taskåœ¨Unity3Dä¸­çš„åº”ç”¨&lt;/h2&gt;

&lt;h3 id=&quot;unityä¸»çº¿ç¨‹é™åˆ¶&quot;&gt;Unityä¸»çº¿ç¨‹é™åˆ¶&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒUnity3Dæœ‰ä¸¥æ ¼çš„ä¸»çº¿ç¨‹é™åˆ¶ï¼Œè¿™æ˜¯ä½¿ç”¨Taskæ—¶å¿…é¡»äº†è§£çš„æ ¸å¿ƒæ¦‚å¿µï¼š&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;Unity APIçš„çº¿ç¨‹å®‰å…¨æ€§é™åˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// âŒ é”™è¯¯ï¼šåœ¨åå°çº¿ç¨‹è°ƒç”¨Unity APIä¼šæŠ›å‡ºå¼‚å¸¸&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// è¿™ä¼šå¯¼è‡´å¼‚å¸¸ï¼š&quot;UnityEngine.Transform can only be called from the main thread&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Vector3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zero&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;GameObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Instantiate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// âœ… æ­£ç¡®ï¼šåœ¨ä¸»çº¿ç¨‹æ‰§è¡ŒUnity APIè°ƒç”¨&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UnityTaskManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ConcurrentQueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_mainThreadActions&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æ“ä½œ&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_mainThreadActions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryDequeue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Invoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RunOnMainThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCompletionSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;_mainThreadActions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Enqueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å¼‚æ­¥æ“ä½œçš„æœ€ä½³å®è·µ&quot;&gt;å¼‚æ­¥æ“ä½œçš„æœ€ä½³å®è·µ&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;ç½‘ç»œè¯·æ±‚çš„å¼‚æ­¥å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NetworkManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpClient&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_httpClient&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å¼‚æ­¥ä¸‹è½½å¹¶æ›´æ–°UI&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sprite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;LoadSpriteAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Image&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;targetImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// åå°çº¿ç¨‹ä¸‹è½½&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;imageData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_httpClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetByteArrayAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            
            &lt;span class=&quot;c1&quot;&gt;// ä¸»çº¿ç¨‹åˆ›å»ºSpriteå¹¶æ›´æ–°UI&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UnityTaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;RunOnMainThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;texture&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Texture2D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LoadImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;imageData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                
                &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sprite&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Sprite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
                    &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Rect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; 
                    &lt;span class=&quot;n&quot;&gt;Vector2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;one&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0.5f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;targetImage&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;targetImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sprite&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sprite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sprite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;åŠ è½½å›¾ç‰‡å¤±è´¥: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;æ–‡ä»¶I/Oçš„å¼‚æ­¥å¤„ç†&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SaveSystem&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SaveGameDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GameData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// åå°çº¿ç¨‹åºåˆ—åŒ–å’Œå†™å…¥æ–‡ä»¶&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;json&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JsonUtility&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ToJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Combine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;persistentDataPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;save.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteAllTextAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            
            &lt;span class=&quot;c1&quot;&gt;// ä¸»çº¿ç¨‹æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UnityTaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;RunOnMainThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nf&quot;&gt;ShowSaveSuccessMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;ä¿å­˜å¤±è´¥: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GameData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;LoadGameDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Combine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;persistentDataPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;save.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GameData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// è¿”å›é»˜è®¤æ•°æ®&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            
            &lt;span class=&quot;c1&quot;&gt;// åå°çº¿ç¨‹è¯»å–å’Œååºåˆ—åŒ–&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;json&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadAllTextAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JsonUtility&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FromJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GameData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;åŠ è½½å¤±è´¥: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GameData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;æ‰¹é‡æ“ä½œçš„è¿›åº¦æŠ¥å‘Š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AssetLoader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;LoadAssetsWithProgressAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetPaths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
        &lt;span class=&quot;n&quot;&gt;IProgress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;progress&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cancellationToken&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loadedCount&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;totalCount&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetPaths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tasks&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetPaths&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// åå°åŠ è½½èµ„æºæ•°æ®&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;LoadAssetDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                
                &lt;span class=&quot;c1&quot;&gt;// ä¸»çº¿ç¨‹åˆ›å»ºUnityå¯¹è±¡&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UnityTaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;RunOnMainThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;nf&quot;&gt;CreateUnityAsset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
                
                &lt;span class=&quot;c1&quot;&gt;// æ›´æ–°è¿›åº¦&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;Interlocked&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Increment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loadedCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentProgress&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loadedCount&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;totalCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                
                &lt;span class=&quot;c1&quot;&gt;// ä¸»çº¿ç¨‹æ›´æ–°UIè¿›åº¦&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UnityTaskScheduler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;RunOnMainThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;progress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Report&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentProgress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
                
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;åŠ è½½ &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; è¢«å–æ¶ˆ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;åŠ è½½ &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; å¤±è´¥: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WhenAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;åç¨‹-vs-task&quot;&gt;åç¨‹ vs Task&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;åŠŸèƒ½å¯¹æ¯”åˆ†æ&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;ç‰¹æ€§&lt;/th&gt;
      &lt;th&gt;åç¨‹(Coroutine)&lt;/th&gt;
      &lt;th&gt;Task&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;æ‰§è¡Œçº¿ç¨‹&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ä»…ä¸»çº¿ç¨‹&lt;/td&gt;
      &lt;td&gt;å¯å¤šçº¿ç¨‹&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;Unityé›†æˆ&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;åŸç”Ÿæ”¯æŒ&lt;/td&gt;
      &lt;td&gt;éœ€è¦é€‚é…å™¨&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;å–æ¶ˆæœºåˆ¶&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æ‰‹åŠ¨å®ç°&lt;/td&gt;
      &lt;td&gt;å†…ç½®CancellationToken&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;å¼‚å¸¸å¤„ç†&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;å¤æ‚&lt;/td&gt;
      &lt;td&gt;æ ‡å‡†try-catch&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;ç»„åˆæ€§&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æœ‰é™&lt;/td&gt;
      &lt;td&gt;å¼ºå¤§(WhenAll/WhenAny)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;æ€§èƒ½å¼€é”€&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ä½&lt;/td&gt;
      &lt;td&gt;ä¸­ç­‰&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;è°ƒè¯•æ”¯æŒ&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ä¸€èˆ¬&lt;/td&gt;
      &lt;td&gt;ä¼˜ç§€&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;åç¨‹çš„ä¼˜åŠ¿åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CoroutineExamples&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ç®€å•çš„æ—¶é—´å»¶è¿Ÿå’Œå¸§ç­‰å¾…&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IEnumerator&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SimpleAnimation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Vector3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;up&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0.1f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…ä¸€å¸§&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WaitForSeconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…1ç§’&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…ç‰¹å®šæ¡ä»¶&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WaitUntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetKeyDown&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;KeyCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// Unityç‰¹å®šçš„ç­‰å¾…æ¡ä»¶&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IEnumerator&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WaitForAnimation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;animator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Animator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;animator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetTrigger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Play&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…åŠ¨ç”»å®Œæˆ&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WaitForAnimatorState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;animator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;IdleState&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…ç‰©ç†æ›´æ–°&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WaitForFixedUpdate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;Taskçš„ä¼˜åŠ¿åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TaskExamples&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å¤æ‚çš„å¼‚æ­¥æ“ä½œç»„åˆ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ComplexAsyncOperation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// å¹¶è¡Œæ‰§è¡Œå¤šä¸ªç½‘ç»œè¯·æ±‚&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadUserDataAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadConfigAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DownloadAssetsAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            
            &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆ&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;results&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WhenAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            
            &lt;span class=&quot;c1&quot;&gt;// å¤„ç†ç»“æœ&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;ProcessResults&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;results&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpRequestException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;HandleNetworkError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;HandleCancellation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å¸¦è¶…æ—¶çš„æ“ä½œ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TryConnectWithTimeoutAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeSpan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromSeconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ConnectToServerAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;è¿æ¥è¶…æ—¶&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;æ··åˆä½¿ç”¨æ¨¡å¼&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HybridAsyncManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å°†Taskè½¬æ¢ä¸ºåç¨‹&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Coroutine&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StartTaskAsCoroutine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;onComplete&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;StartCoroutine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TaskToCoroutine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;onComplete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IEnumerator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskToCoroutine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;onComplete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…Taskå®Œæˆ&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsFaulted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;Taskå¤±è´¥: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCanceled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Taskè¢«å–æ¶ˆ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;onComplete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Invoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å°†åç¨‹è½¬æ¢ä¸ºTask&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CoroutineToTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IEnumerator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coroutine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TaskCompletionSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
        
        &lt;span class=&quot;nf&quot;&gt;StartCoroutine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CoroutineWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;IEnumerator&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CoroutineWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;StartCoroutine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coroutine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tcs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æ€§èƒ½è€ƒè™‘&quot;&gt;æ€§èƒ½è€ƒè™‘&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;Taskåˆ†é…ä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PerformanceOptimizedTaskManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ç¼“å­˜å¸¸ç”¨çš„å·²å®ŒæˆTask&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_trueTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_falseTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_completedTask&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CompletedTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// é¿å…ä¸å¿…è¦çš„Taskåˆ†é…&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ValidateAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// åŒæ­¥éªŒè¯ï¼Œç›´æ¥è¿”å›ç¼“å­˜çš„Task&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_falseTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_falseTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// åªæœ‰éœ€è¦å¼‚æ­¥æ“ä½œæ—¶æ‰åˆ›å»ºæ–°Task&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ValidateAsyncInternal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ValidateAsyncInternal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// å®é™…çš„å¼‚æ­¥éªŒè¯é€»è¾‘&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Task&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Contains&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;valid&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// ä½¿ç”¨ValueTaskå‡å°‘åˆ†é…&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetCachedValueAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryGetValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cachedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// åŒæ­¥è·¯å¾„ï¼Œä¸åˆ†é…Taskå¯¹è±¡&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cachedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// å¼‚æ­¥è·¯å¾„ï¼Œéœ€è¦åˆ†é…Task&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValueTask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LoadValueAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Fri, 06 Jun 2025 10:00:00 +0000</pubDate>
        <link>https://www.damonc.top/csharp/Csharp_Task_Base.html</link>
        <guid isPermaLink="true">https://www.damonc.top/csharp/Csharp_Task_Base.html</guid>
        
        <category>Task</category>
        
        
        <category>CSharp</category>
        
      </item>
    
      <item>
        <title>å¤šçº¿ç¨‹ç¼–ç¨‹åŸºç¡€ç¯‡-Thread(ä¸€)</title>
        <description>&lt;h2 id=&quot;å¤šçº¿ç¨‹æ¦‚å¿µ&quot;&gt;å¤šçº¿ç¨‹æ¦‚å¿µ&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒç°ä»£åº”ç”¨ç¨‹åºå¯èƒ½è¦åŒæ—¶å¤„ç†æ•°æ®è®¡ç®—ã€ç”»é¢æ¸²æŸ“ã€æ–‡ä»¶è¯»å†™ç­‰æ“ä½œï¼ŒåŒæ—¶è¦æ±‚æ“ä½œç³»ç»Ÿè¦æ»¡è¶³è¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œåæ¥éšç€ç°ä»£CPUçš„ä»å•æ ¸è¿›åŒ–åˆ°å¤šæ ¸ï¼Œä»ç‰©ç†æ ¸å¿ƒè¿›åŒ–åˆ°é€»è¾‘æ ¸å¿ƒã€‚å°±é€æ¸æœ‰äº†å¤šä»»åŠ¡æ‰§è¡Œæ¦‚å¿µã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹&quot;&gt;ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¤šçº¿ç¨‹æ˜¯ä¸€ç§è½¯ä»¶ç¼–ç¨‹æ¦‚å¿µï¼ŒIntelæå‡ºäº†&lt;a href=&quot;https://www.intel.cn/content/www/cn/zh/gaming/resources/hyper-threading.html&quot;&gt;è¶…çº¿ç¨‹æŠ€æœ¯ï¼ˆHyper-Threadingï¼‰&lt;/a&gt;æ˜¯å®ç°å¤šçº¿ç¨‹çš„ç¡¬ä»¶æŠ€æœ¯ï¼Œå°†å•ä¸ªç‰©ç†æ ¸å¿ƒè™šæ‹Ÿä¸ºå¤šä¸ªé€»è¾‘æ ¸å¿ƒï¼Œæ˜¯å¯¹å¤šçº¿ç¨‹çš„ç¡¬ä»¶æ”¯æŒã€‚é€»è¾‘æ ¸å¿ƒå…±äº«åŒä¸€ç‰©ç†æ ¸å¿ƒçš„ç¡¬ä»¶èµ„æºï¼ˆå¦‚ALUã€ç¼“å­˜ï¼‰ï¼Œä½†æ‹¥æœ‰ç‹¬ç«‹çš„å¯„å­˜å™¨ç»„å’Œçº¿ç¨‹çŠ¶æ€â€Œï¼Œå½“æŸä¸ªçº¿ç¨‹å› ç­‰å¾…æ•°æ®ï¼ˆå¦‚å†…å­˜è®¿é—®ï¼‰æš‚åœæ—¶ï¼Œç‰©ç†æ ¸å¿ƒç«‹å³åˆ‡æ¢è‡³å¦ä¸€çº¿ç¨‹æ‰§è¡Œï¼Œå¤ç”¨é—²ç½®èµ„æºä»¥æå‡åˆ©ç”¨ç‡â€Œã€‚&lt;strong&gt;çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°æ‰§è¡Œå•å…ƒï¼Œæ˜¯è¿›ç¨‹ä¸­çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ä»£ç æ‰§è¡Œè·¯å¾„å’Œç‹¬ç«‹çš„å †æ ˆç©ºé—´ï¼Œçº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«ç¨‹åºçš„æ•°æ®æ®µå’Œä»£ç æ®µ&lt;/strong&gt;ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œå®ç°â€Œå¹¶å‘â€Œï¼ˆConcurrencyï¼‰æˆ–â€Œå¹¶è¡Œâ€Œï¼ˆParallelismï¼‰ã€‚&lt;/p&gt;

&lt;h3 id=&quot;çº¿ç¨‹çš„ç›®æ ‡æ˜¯ä»€ä¹ˆ&quot;&gt;çº¿ç¨‹çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒä¸ºäº†é˜²æ­¢ä¸€ä¸ªåº”ç”¨ç¨‹åºæ§åˆ¶CPUè€Œå¯¼è‡´å…¶ä»–åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿæœ¬èº«æ°¸è¿œè¢«æŒ‚èµ·è¿™ä¸€å¯èƒ½æƒ…å†µï¼Œæ“ä½œç³»ç»Ÿä¸å¾—ä¸ä½¿ç”¨æŸç§æ–¹å¼å°†ç‰©ç†è®¡ç®—å•å…ƒåˆ†å‰²ä¸ºä¸€äº›è™šæ‹Ÿçš„è¿›ç¨‹ï¼Œå¹¶ç»™äºˆæ¯ä¸ªæ‰§è¡Œç¨‹åºä¸€å®šé‡çš„è®¡ç®—èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»å§‹ç»ˆèƒ½å¤Ÿä¼˜å…ˆè®¿é—®CPUï¼Œå¹¶èƒ½è°ƒæ•´ä¸åŒç¨‹åºè®¿é—®CPUçš„ä¼˜å…ˆçº§ã€‚çº¿ç¨‹æ­£æ˜¯è¿™ä¸€æ¦‚å¿µçš„å®ç°ã€‚å¯ä»¥è®¤ä¸ºçº¿ç¨‹æ˜¯ä¸€ä¸ªè™šæ‹Ÿè¿›ç¨‹ï¼Œç”¨äºç‹¬ç«‹è¿è¡Œä¸€ä¸ªç‰¹å®šçš„ç¨‹åºã€‚&lt;strong&gt;æé«˜ç¨‹åºçš„å“åº”é€Ÿåº¦ï¼Œå®ç°å¹¶è¡Œè®¡ç®—ï¼Œä»¥åŠæé«˜CPUåˆ©ç”¨ç‡ã€‚å®ƒå¯ä»¥è®©ä¸€ä¸ªç¨‹åºåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä»è€Œæ›´æœ‰æ•ˆåœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼ŒåŠ å¿«ç¨‹åºè¿è¡Œé€Ÿåº¦ï¼Œå¹¶æå‡ç”¨æˆ·ä½“éªŒã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;ç¨‹åºè¿›ç¨‹çº¿ç¨‹åç¨‹&quot;&gt;ç¨‹åºã€è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹&lt;/h3&gt;

&lt;p&gt;è¿›ç¨‹å’Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿé¢†åŸŸçš„ä¸¤ä¸ªé‡è¦æ¦‚å¿µï¼Œä¸¤è€…æ—¢æœ‰åŒºåˆ«åˆæœ‰è”ç³»ã€‚&lt;/p&gt;

&lt;h4 id=&quot;å¯æ‰§è¡Œç¨‹åº&quot;&gt;å¯æ‰§è¡Œç¨‹åº&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒC/C++æºæ–‡ä»¶ç»è¿‡ç¼–è¯‘å™¨ï¼ˆç¼–è¯‘+é“¾æ¥ï¼‰å¤„ç†åï¼Œä¼šäº§ç”Ÿå¯æ‰§è¡Œç¨‹åºæ–‡ä»¶ï¼Œä¸åŒç³»ç»Ÿæœ‰ä¸åŒæ ¼å¼ï¼Œæ¯”å¦‚Linuxç³»ç»Ÿçš„ELFæ ¼å¼ã€Windowsç³»ç»Ÿçš„EXEæ ¼å¼ï¼Œå¯æ‰§è¡Œç¨‹åºæ–‡ä»¶æ˜¯ä¸€ä¸ªé™æ€çš„æ¦‚å¿µã€‚&lt;/p&gt;

&lt;h4 id=&quot;è¿›ç¨‹æ˜¯ä»€ä¹ˆ&quot;&gt;è¿›ç¨‹æ˜¯ä»€ä¹ˆ&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒå¯æ‰§è¡Œç¨‹åºåœ¨æ“ä½œç³»ç»Ÿä¸Šçš„ä¸€æ¬¡æ‰§è¡Œå¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹æ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ¦‚å¿µï¼š&lt;strong&gt;è¿›ç¨‹æ˜¯æ‰§è¡Œä¸­çš„ç¨‹åº&lt;/strong&gt;ã€‚åŒä¸€ä»½å¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œå¤šæ¬¡ï¼Œä¼šäº§ç”Ÿå¤šä¸ªè¿›ç¨‹ï¼Œè¿™è·Ÿä¸€ä¸ªç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå®ä¾‹ä¸€æ ·ã€‚è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚&lt;/p&gt;

&lt;h4 id=&quot;çº¿ç¨‹æ˜¯ä»€ä¹ˆ&quot;&gt;çº¿ç¨‹æ˜¯ä»€ä¹ˆ&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒä¸€ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹ä»£è¡¨ç€å¤šä¸ªæ‰§è¡Œæµï¼Œè¿™äº›çº¿ç¨‹ä»¥å¹¶å‘æ¨¡å¼ç‹¬ç«‹æ‰§è¡Œã€‚æ“ä½œç³»ç»Ÿä¸­ï¼Œè¢«è°ƒåº¦æ‰§è¡Œçš„æœ€å°å•ä½æ˜¯çº¿ç¨‹è€Œéè¿›ç¨‹ã€‚è¿›ç¨‹æ˜¯é€šè¿‡å…±äº«å­˜å‚¨ç©ºé—´å¯¹ç”¨æˆ·å‘ˆç°çš„é€»è¾‘æ¦‚å¿µï¼ŒåŒä¸€è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å…±äº«åœ°å€ç©ºé—´å’Œæ–‡ä»¶æè¿°ç¬¦ï¼Œå…±äº«åœ°å€ç©ºé—´æ„å‘³ç€è¿›ç¨‹çš„ä»£ç ï¼ˆå‡½æ•°ï¼‰åŒºåŸŸã€å…¨å±€å˜é‡ã€å †ã€æ ˆéƒ½è¢«è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å…±äº«ã€‚&lt;/p&gt;

&lt;h4 id=&quot;è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»&quot;&gt;è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒå¯åŠ¨ä¸€ä¸ªç¨‹åºï¼Œç³»ç»Ÿä¼šåœ¨å†…å­˜è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ˜¯æ„æˆç¨‹åºè¿è¡Œçš„èµ„æºé›†åˆï¼ŒåŒ…æ‹¬è™šæ‹Ÿåœ°å€ç©ºé—´ã€æ–‡ä»¶å¥æŸ„ç­‰ã€‚åœ¨è¿›ç¨‹å†…éƒ¨ç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡å¼€å§‹æ‰§è¡ŒMainæ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºä¸»çº¿ç¨‹ã€‚å› æ­¤è¿›ç¨‹ä¹Ÿæ˜¯çº¿ç¨‹çš„ä¸€ä¸ªé›†åˆã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹åªåŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼Œä»ç¨‹åºçš„å¼€å§‹ä¸€ç›´æ‰§è¡Œåˆ°ç»“æŸã€‚&lt;/li&gt;
  &lt;li&gt;ä¸»çº¿ç¨‹ä¹Ÿå¯ä»¥ç»§ç»­æ´¾ç”Ÿçº¿ç¨‹ï¼Œè¿›ç¨‹å†…å¯èƒ½å«æœ‰ä¸åŒçŠ¶æ€çš„çº¿ç¨‹&lt;/li&gt;
  &lt;li&gt;å¦‚æœä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå®ƒä»¬å°†å…±äº«è¿›ç¨‹èµ„æº&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°æ‰§è¡Œå•å…ƒï¼Œæ˜¯è¿›ç¨‹ä¸­çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;åç¨‹&quot;&gt;åç¨‹&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒç”¨æˆ·æ€çš„å¤šæ‰§è¡Œæµï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬æ¯”çº¿ç¨‹æ›´ä½ï¼Œå¾®ä¿¡ç”¨åç¨‹æ”¹é€ åå°ç³»ç»Ÿåï¼Œè·å¾—äº†æ›´å¤§ååèƒ½åŠ›å’Œæ›´é«˜ç¨³å®šæ€§ã€‚å¦‚ä»Šï¼Œåç¨‹åº“ä¹Ÿè¿›äº†C++20æ–°æ ‡å‡†ã€‚Unityçš„åç¨‹å¹¶éå¤šçº¿ç¨‹ï¼Œè€Œæ˜¯å®Œå…¨è¿è¡Œåœ¨Unityä¸»çº¿ç¨‹ä¸Šï¼Œé€šè¿‡è¿­ä»£å™¨ï¼ˆIEnumeratorï¼‰å’ŒyieldæŒ‡ä»¤å®ç°é€»è¾‘åˆ†å¸§æ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹çš„UIå“åº”â€Œã€‚&lt;/p&gt;

&lt;h2 id=&quot;çº¿ç¨‹ç®€ä»‹&quot;&gt;çº¿ç¨‹ç®€ä»‹&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒç°åœ¨çš„C#ä»£ç ç›´æ¥ä½¿ç”¨New Thread()åˆ›å»ºçº¿ç¨‹ï¼Œè¿™æ˜¯æ¯”è¾ƒè€æ—§çš„ç”¨æ³•ï¼ŒC#æ›´æ¨èä½¿ç”¨Taskã€async/awitæ–¹å¼ã€‚ä½†æ˜¯è¦äº†è§£çº¿ç¨‹çŸ¥è¯†å°±è¦ä»c#çš„Threadçº¿ç¨‹è¯´èµ·ã€‚&lt;/p&gt;

&lt;h3 id=&quot;åˆ›å»ºçº¿ç¨‹&quot;&gt;åˆ›å»ºçº¿ç¨‹&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒè¦åˆ›å»ºå¹¶å¯åŠ¨ ä¸€ä¸ªçº¿ç¨‹ï¼Œéœ€è¦é¦–å…ˆå®ä¾‹åŒ–Threadå¯¹è±¡å¹¶è°ƒç”¨Startæ–¹æ³•ã€‚Threadçš„æœ€ç®€å•çš„æ„é€ å™¨æ¥æ”¶ä¸€ä¸ªThreadStartæ— å‚å§”æ‰˜æˆ–ParameterizedThreadStartæœ‰å‚å§”æ‰˜ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ThreadStart&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ParameterizedThreadStart&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ThreadStart&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxStackSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ParameterizedThreadStart&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxStackSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//c#1.0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ThreadStart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//c#2.0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ParameterizedThreadStart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;:ä¸€ä¸ªæ— å‚æ•°çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ‰§è¡Œçš„èµ·å§‹ä½ç½®ï¼Œä¾‹å¦‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Test2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//ä¸»çº¿ç¨‹æ‰“å°x&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//å­çº¿ç¨‹æ‰“å°y&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()=&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;y&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)=&amp;gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;y&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;premonition warning&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon warning&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-warning&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; çº¿ç¨‹çš„å‚æ•°ä¼ é€’ &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;çº¿ç¨‹çš„å‚æ•°ä¼ é€’éœ€è¦ä½¿ç”¨ParameterizedThreadStartå§”æ‰˜ï¼Œå¹¶ä¸”éœ€è¦å°†å‚æ•°ä¼ é€’ç»™Startæ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// å¦‚æœä½¿ç”¨è¿™ç§æ–¹å¼ä¼šå¼‚å¸¸&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()=&amp;gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;y&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å¦‚æœm_Delegateæ˜¯ThreadStartå§”æ‰˜ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m_Delegate&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ThreadStart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InvalidOperationException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetResourceString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;h3 id=&quot;çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ&quot;&gt;çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒçº¿ç¨‹æœ‰å¤šä¸ªçŠ¶æ€è¡¨ç¤ºä½¿ç”¨ThreadStateè¡¨ç¤ºï¼Œå…¶ä¸­æœ€é‡è¦çš„å‡ ä¸ªçŠ¶æ€å°±æ˜¯æš‚åœç­‰å¾…(ä¼‘çœ )ã€ç»ˆæ­¢&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;{});&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsBackground&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Priority&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ThreadPriority&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Highest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Interrupt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;æ–°å»ºçŠ¶æ€(New)&lt;/strong&gt;â€Œ new Thread()åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ—¶ï¼Œçº¿ç¨‹å¤„äºæ–°å»ºçŠ¶æ€ï¼Œæ­¤æ—¶å°šæœªåˆ†é…ç³»ç»Ÿèµ„æºâ€Œã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å‰å°/åå°çº¿ç¨‹&lt;/strong&gt; æ˜¾å¼åˆ›å»ºçš„çº¿ç¨‹æ˜¯å‰å°çº¿ç¨‹ï¼Œé€šè¿‡çº¿ç¨‹å¯¹è±¡çš„IsBackgroundå±æ€§å¯ä»¥æ§åˆ¶ã€‚&lt;strong&gt;è¿›ç¨‹ä¼šç­‰å¾…æ‰€æœ‰çš„å‰å°çº¿ç¨‹å®Œæˆåå†ç»“æŸå·¥ä½œï¼Œä½†æ˜¯å¦‚æœåªå‰©ä¸‹åå°çº¿ç¨‹ï¼Œåˆ™ä¼šç›´æ¥ç»“æ±å·¥ä½œã€‚&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;çº¿ç¨‹çš„ä¼˜å…ˆçº§&lt;/strong&gt; å‰å°çº¿ç¨‹çš„ä¼˜å…ˆçº§å¤§äºåå°çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹ä¼˜å…ˆçº§è®¾ç½®è¿‡å¤§ï¼Œåˆ™å¯èƒ½ä¼šå¹²æ¶‰åˆ°ç³»ç»Ÿè¿è¡Œï¼Œå¦‚ç£ç›˜å†™å…¥ã€é¼ æ ‡ç‚¹å‡»ç­‰éƒ½æ˜¯é«˜é€Ÿè¿è½¬çš„ï¼Œå¦‚æœç¨‹åºä¸­æœ‰å¤ªå¤šé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆç³»ç»Ÿéœ€è¦åˆ†é…å¤§é‡CPUæ—¶é—´è¿è¡Œè¿™äº›çº¿ç¨‹çš„ä»£ç ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿæ— å“åº”æˆ–å“åº”ç¼“æ…¢ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;â€Œå°±ç»ªçŠ¶æ€(Runnable)&lt;/strong&gt;â€Œ Start()æ–¹æ³•è°ƒç”¨åçº¿ç¨‹è¿›å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œç­‰å¾…CPUè°ƒåº¦æ‰§è¡Œâ€Œã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;â€Œè¿è¡ŒçŠ¶æ€(Running)â€Œ&lt;/strong&gt; å½“çº¿ç¨‹è·å¾—CPUæ—¶é—´ç‰‡æ—¶å¼€å§‹æ‰§è¡Œï¼Œç¤ºä¾‹ä¸­ç”±äºLambdaè¡¨è¾¾å¼ä¸ºç©ºï¼Œå®é™…ä¸æ‰§è¡Œæ“ä½œâ€Œã€‚â€Œ&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;é˜»å¡çŠ¶æ€(Blocked)â€Œ&lt;/strong&gt; Thread.Sleep(1000)ä½¿ä¸»çº¿ç¨‹ä¼‘çœ 1ç§’ï¼Œæ­¤æ—¶ä¸»çº¿ç¨‹å¤„äºå®šæ—¶ç­‰å¾…çŠ¶æ€â€Œã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;é˜»å¡çŠ¶æ€(Blocked)â€Œ&lt;/strong&gt; Join(1000)ä½¿ä¸»çº¿ç¨‹ç­‰å¾…ç›®æ ‡çº¿ç¨‹å®Œæˆï¼Œæœ€å¤šé˜»å¡1ç§’â€Œã€‚&lt;/li&gt;
  &lt;li&gt;â€Œ&lt;strong&gt;ä¸­æ–­çŠ¶æ€(Interrupted)â€Œ&lt;/strong&gt; Interrupt()å‘çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·ï¼Œè‹¥çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ä¼šæŠ›å‡ºInterruptedExceptionâ€Œã€‚&lt;/li&gt;
  &lt;li&gt;â€Œ&lt;strong&gt;ç»ˆæ­¢çŠ¶æ€(Aborted/Terminated)â€Œ&lt;/strong&gt; Abort()å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ï¼Œä¼šæŠ›å‡ºThreadAbortExceptionå¼‚å¸¸â€Œã€‚æ³¨æ„è¯¥æ–¹æ³•åœ¨.NETä¸­å·²è¿‡æ—¶ï¼Œæ¨èä½¿ç”¨åä½œå¼å–æ¶ˆæ¨¡å¼â€Œã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;â€ƒâ€ƒçº¿ç¨‹çŠ¶æ€æšä¸¾ThreadStateï¼Œçº¿ç¨‹çŠ¶æ€çš„è½¬æ¢å›¾å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ThreadState&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Running&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹æ­£åœ¨è¿è¡Œ&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;StopRequested&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹è¯·æ±‚åœæ­¢&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SuspendRequested&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹è¯·æ±‚æŒ‚èµ·&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Background&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹æ˜¯åå°çº¿ç¨‹&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Unstarted&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹æœªå¯åŠ¨&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Stopped&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹å·²åœæ­¢&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;WaitSleepJoin&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹ç­‰å¾…ã€ä¼‘çœ æˆ–åŠ å…¥&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Suspended&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹æŒ‚èµ·&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;AbortRequested&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;128&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹è¯·æ±‚ç»ˆæ­¢&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Aborted&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// çº¿ç¨‹å·²ç»ˆæ­¢&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts\2025\month6\thread_state.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå›¾ç¤º.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;div class=&quot;premonition warning&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon warning&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-warning&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; çº¿ç¨‹ç»ˆæ­¢è­¦å‘Š &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;Interrupt()å’ŒAbort()çš„è°ƒç”¨æ—¶æœºä¼šå½±å“çº¿ç¨‹çŠ¶æ€è½¬æ¢ç»“æœï¼Œè‹¥çº¿ç¨‹å·²ç»ˆæ­¢åˆ™è¿™äº›æ“ä½œæ— æ•ˆâ€Œã€‚åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­åº”è°¨æ…ä½¿ç”¨å¼ºåˆ¶ç»ˆæ­¢æ–¹æ³•ï¼Œå¯èƒ½å¼•å‘èµ„æºæœªé‡Šæ”¾ç­‰é—®é¢˜â€Œã€‚&lt;/p&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;h3 id=&quot;çº¿ç¨‹çš„åŒæ­¥å’Œäº’æ–¥&quot;&gt;çº¿ç¨‹çš„åŒæ­¥å’Œäº’æ–¥&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒCLRè¿è¡Œæ—¶ç®¡ç†åˆ†é…ç€æ¯ä¸€ä¸ªçº¿ç¨‹æ‰€éœ€å¤šç‹¬ç«‹å†…å­˜æ ˆï¼Œä»è€Œä¿è¯äº†å±€éƒ¨å˜é‡çš„éš”ç¦»ã€‚å¦‚æœä¸åŒçš„çº¿ç¨‹æ‹¥æœ‰åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œåˆ™è¿™äº›çº¿ç¨‹ä¹‹é—´å°±å…±äº«äº†æ•°æ®ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šå°†Lambdaè¡¨è¾¾å¼æ•è·çš„å±€éƒ¨å˜é‡æˆ–åŒ¿åå§”æ‰˜è½¬æ¢ä¸ºå­—æ®µï¼Œå› æ­¤å®ƒä»¬ä¹Ÿå¯ä»¥è¢«å…±äº«ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ThreadTest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ThreadStart&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aciont&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Done&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒä¸Šè¿°ä»£ç ï¼Œä¸»çº¿ç¨‹è°ƒç”¨äº†actionï¼ŒåŒæ—¶newäº†ä¸€ä¸ªå­çº¿ç¨‹ç»‘å®šäº†åŒ¿åå‡½æ•°æ•è·äº†å¤–éƒ¨å˜é‡doneï¼Œè¿™ä¸ªâ€œDoneâ€æ˜¯æœ‰å¯èƒ½è¾“å‡ºä¸¤æ¬¡çš„ã€‚ä¸»çº¿ç¨‹æ­£åœ¨æ‰“å°â€œDoneâ€æ—¶ï¼Œå­çº¿ç¨‹å¯èƒ½å·²ç»è¿›å…¥åˆ°åŒ¿åå‡½æ•°æ­£åœ¨åˆ¤å®šã€‚&lt;/p&gt;

&lt;h4 id=&quot;lockçº¿ç¨‹é”&quot;&gt;lockçº¿ç¨‹é”&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒé”æœ‰ä¸‰ç§ç»“æ„ï¼šLockã€Mutexå’ŒSpinLockï¼Œå…¶ä¸­Lockæ˜¯æœ€å¸¸ç”¨æœ€æ–¹ä¾¿çš„é”ç»“æ„ã€‚é”å…è®¸å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªèƒ½å¤Ÿè®¿é—®è¢«é”å®šçš„èµ„æºï¼Œä»è€Œé¿å…ç«æ€æ¡ä»¶å’Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;System.Threading&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Program&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lockObject&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// é”å¯¹è±¡&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sharedValue&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IncrementSharedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IncrementSharedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;thread1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;thread2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;thread1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;thread2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Final shared value: &quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sharedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;IncrementSharedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lockObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ä½¿ç”¨é”&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;sharedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å¯¹sharedValueè¿›è¡Œäº†100000æ¬¡çš„å¢åŠ æ“ä½œï¼Œä½†ç”±äºä½¿ç”¨äº†é”æœºåˆ¶ï¼Œå®ƒä»¬ä¸ä¼šäº¤å‰å¹¶å‘åœ°ä¿®æ”¹sharedValueï¼Œä»è€Œç¡®ä¿äº†æ•°æ®ä¸€è‡´æ€§ã€‚thread1.Join()ä¸thread2.Join()ç®€å•ç†è§£å°±æ˜¯æŠŠthread1/2åˆå¹¶åˆ°ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹é»˜è®¤æ˜¯å‰å°çº¿ç¨‹éœ€è¦ç­‰å¾…thread1/2æ‰§è¡Œå®Œæˆåæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚å¦‚æœä¸è°ƒç”¨Joiné‚£ä¹ˆç›´æ¥æ‰“å°äº†Final shared valueç»“æœä¼šä¸å‡†ç¡®ã€‚&lt;/p&gt;

&lt;div class=&quot;premonition info&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon info&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-info&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; é”çš„å¼€é”€æç¤º &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;ä½¿ç”¨é”æœºåˆ¶å¯èƒ½ä¼šå¼•å…¥æ€§èƒ½å¼€é”€ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªçº¿ç¨‹è®¿é—®é”å®šä»£ç å—æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡å¤šçº¿ç¨‹åº”ç”¨æ—¶ï¼Œåº”æ ¹æ®å®é™…éœ€æ±‚å’Œæ€§èƒ½è¦æ±‚åˆç†åœ°ä½¿ç”¨é”æœºåˆ¶ï¼Œé¿å…é”çš„è¿‡åº¦ä½¿ç”¨å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚&lt;/p&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;h4 id=&quot;æ­»é”&quot;&gt;æ­»é”&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒæ­»é”å°†å¯¼è‡´ç¨‹åºåœæ­¢å·¥ä½œæ˜¯æœ€å¸¸è§çš„å¤šçº¿ç¨‹é”™è¯¯ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ­»é”ç¤ºä¾‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locker1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locker2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadA&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;locker1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;locker2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//Deadlock&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;threadA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;locker2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;locker1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//Deadlock&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//ä½¿ç”¨ä¸‰ä¸ªæˆ–è€…æ›´å¤šçš„çº¿ç¨‹åˆ™å¯èƒ½å½¢æˆæ›´åŠ å¤æ‚çš„æ­»é”é“¾ã€‚&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒæ­»é”çš„å½¢æˆè¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆå§‹çŠ¶æ€&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;åˆ›å»ºäº†ä¸¤ä¸ªé”å¯¹è±¡ï¼šlocker1å’Œlocker2&lt;/li&gt;
  &lt;li&gt;æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼šçº¿ç¨‹Aï¼ˆæ–°åˆ›å»ºçš„çº¿ç¨‹ï¼‰å’Œä¸»çº¿ç¨‹&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;æ­¥éª¤1&lt;/strong&gt;ï¼šçº¿ç¨‹å¯åŠ¨ï¼ˆt=0msï¼‰&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;çº¿ç¨‹A å¼€å§‹æ‰§è¡Œï¼Œè¿›å…¥ç¬¬ä¸€ä¸ªlock(locker1)&lt;/li&gt;
  &lt;li&gt;çº¿ç¨‹A æˆåŠŸè·å–lock(locker1)çš„é”&lt;/li&gt;
  &lt;li&gt;åŒæ—¶ï¼Œä¸»çº¿ç¨‹ æ‰§è¡Œåˆ°lock(locker2)&lt;/li&gt;
  &lt;li&gt;ä¸»çº¿ç¨‹ æˆåŠŸè·å–lock(locker2)çš„é”&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;æ­¥éª¤2&lt;/strong&gt;ï¼šå»¶æ—¶é˜¶æ®µï¼ˆt=0-1000msï¼‰&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;çº¿ç¨‹A æŒæœ‰lock(locker1)ï¼Œæ‰§è¡ŒThread.Sleep(1000)&lt;/li&gt;
  &lt;li&gt;ä¸»çº¿ç¨‹ æŒæœ‰lock(locker2)ï¼Œæ‰§è¡ŒThread.Sleep(1000)&lt;/li&gt;
  &lt;li&gt;æ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨ç¡çœ ï¼Œå„è‡ªæŒæœ‰ä¸€ä¸ªé”&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;æ­¥éª¤3&lt;/strong&gt;ï¼šæ­»é”å½¢æˆï¼ˆt=1000msåï¼‰&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;çº¿ç¨‹A ä»ç¡çœ ä¸­é†’æ¥ï¼Œå°è¯•è·å–lock(locker2)ï¼Œä½†æ˜¯locker2å·²ç»è¢«ä¸»çº¿ç¨‹æŒæœ‰ï¼Œçº¿ç¨‹Aè¢«é˜»å¡ï¼Œç­‰å¾…lock(locker2)é‡Šæ”¾&lt;/li&gt;
  &lt;li&gt;ä¸»çº¿ç¨‹ ä»ç¡çœ ä¸­é†’æ¥ï¼Œå°è¯•è·å–lock(locker1)ï¼Œä½†æ˜¯locker1 å·²ç»è¢«çº¿ç¨‹AæŒæœ‰ï¼Œä¸»çº¿ç¨‹è¢«é˜»å¡ï¼Œç­‰å¾…lock(locker1)é‡Šæ”¾&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class=&quot;language-mermaid2&quot;&gt;graph LR
    A[çº¿ç¨‹A] --&amp;gt; |æŒæœ‰| L1[locker1]
    A --&amp;gt; |ç­‰å¾…| L2[locker2]
    B[ä¸»çº¿ç¨‹] --&amp;gt; |æŒæœ‰| L2
    B --&amp;gt; |ç­‰å¾…| L1
    
    L1 -.-&amp;gt; |é˜»å¡| B
    L2 -.-&amp;gt; |é˜»å¡| A
    
    style A fill:#ff9999
    style B fill:#99ccff
    style L1 fill:#ffcc99
    style L2 fill:#ffcc99
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;monitoré”å®šèµ„æº&quot;&gt;Monitoré”å®šèµ„æº&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒMonitoræ˜¯C#ä¸­ç”¨äºå®ç°çº¿ç¨‹åŒæ­¥å’Œäº’æ–¥çš„å¦ä¸€ç§æœºåˆ¶ï¼ŒåŒæ—¶lockå…³é”®å­—æ˜¯Monitorç±»çš„ä¸€ç§è¯­æ³•ç³–ã€‚å®ƒæä¾›äº†æ›´é«˜çº§çš„æ–¹æ³•TryEenter()ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;acquiredLock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Monitor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Enter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lockObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;acquiredLock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Code that accesses resources that are protected by the lock.&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;finally&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acquiredLock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Monitor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lockObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒMonitorç±»çš„ä½¿ç”¨æ–¹å¼ç›¸å¯¹äºlocké”æœºåˆ¶æ›´çµæ´»ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨Monitorç±»çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´æ§åˆ¶è®¿é—®é¡ºåºï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;System.Threading&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Program&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;syncLock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentThread&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 1è¡¨ç¤ºçº¿ç¨‹1ï¼Œ2è¡¨ç¤ºçº¿ç¨‹2&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;thread1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;thread2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;thread1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;thread2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadIdObj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threadIdObj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;syncLock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentThread&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;Monitor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;syncLock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;Thread &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;currentThread&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;Monitor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Pulse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;syncLock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®Workeræ—¶é€šè¿‡åˆ¤å®šçº¿ç¨‹IDæ˜¯å¦ä¸€è‡´ç¡®å®šè¯¥çº¿ç¨‹æ˜¯å¦ç»§ç»­æ‰§è¡Œï¼Œä¸ä¸€è‡´å°±ä½¿ç”¨Monitor.Wait()æ–¹æ³•ä¼šä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å…¶å®ƒçº¿ç¨‹å®Œæˆè®¿é—®Workeré€šè¿‡Monitor.Pulse()æ–¹æ³•é€šçŸ¥å…¶ä»–ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚&lt;/p&gt;

&lt;div class=&quot;premonition warning&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon warning&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-warning&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; Monitorä¹Ÿä¼šæœ‰æ­»é” &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;ä½¿ç”¨Monitorç±»å¯ä»¥åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹æ§åˆ¶çº¿ç¨‹ä¹‹é—´çš„è®¿é—®é¡ºåºï¼Œä½†ä¹Ÿéœ€è¦å°å¿ƒé¿å…æ­»é”ç­‰é—®é¢˜ã€‚è¿™ç§æ–¹æ³•éœ€è¦çº¿ç¨‹ä¹‹é—´ç›¸äº’é…åˆï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„æ‰§è¡Œé¡ºåºã€‚&lt;/p&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;h4 id=&quot;mutexåŒæ­¥&quot;&gt;MutexåŒæ­¥&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒMutexå’Œlockç±»ä¼¼ï¼Œä½†æ˜¯å®ƒå¯ä»¥æ”¯æŒå¤šä¸ªè¿›ç¨‹ã€‚å…¶åªå¯¹ä¸€ä¸ªçº¿ç¨‹æˆäºˆå¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ã€‚Mutexç±»çš„WaitOneæ–¹æ³•å°†è·å¾—è¯¥é”ï¼ŒReleaseMutexæ–¹æ³•å°†é‡Šæ”¾è¯¥é”ã€‚Mutexåªèƒ½åœ¨è·å¾—é”çš„çº¿ç¨‹é‡Šæ”¾é”ã€‚é‡Šæ”¾Mutexéœ€è¦å¤§çº¦ä¸€å¾®ç§’çš„æ—¶é—´ï¼Œå¤§æ¦‚æ¯”1ockè¦æ…¢20å€&lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MutexName&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;CSharpThreadingCookbook&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Mutex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MutexName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WaitOne&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeSpan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromSeconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Second instance is running!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Running!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReleaseMutex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;semaphoreä¿¡å·é‡&quot;&gt;Semaphoreä¿¡å·é‡&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒä¿¡å·é‡æ˜¯ä¸€ç§è®¡æ•°å™¨ï¼Œç”¨äºé™åˆ¶åŒæ—¶è®¿é—®æŸä¸ªèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚ä¿¡å·é‡å¯ç”¨äºé™åˆ¶å¹¶å‘æ€§ï¼Œé˜²æ­¢å¤ªå¤šçš„çº¿ç¨‹åŒæ—¶æ‰§è¡Œç‰¹å®šçš„ä»£ç ã€‚åœ¨C#4.0å¼•å…¥äº†è½»é‡çº§Semaphoreslimä¿¡å·é‡ï¼ŒSemaphoreåœ¨è°ƒç”¨WaitOneå’ŒReleaseæ–¹æ³•æ—¶å¤§æ¦‚ä¼šæ¶ˆè€—1å¾®ç§’çš„æ—¶é—´ï¼Œè€ŒSemaphoreslimçš„å¼€é”€åªæœ‰å‰è€…çš„ååˆ†ä¹‹ä¸€&lt;sup id=&quot;fnref:3&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;System.Threading&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Program&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Semaphoreslim&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;semaphore&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Semaphoreslim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DoWork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoWork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;semaphore&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WaitOne&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…è·å–ä¿¡å·é‡&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Thread &quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; is working...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Thread &quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; finished.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;semaphore&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Release&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// é‡Šæ”¾ä¿¡å·é‡&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;çº¿ç¨‹æ± &quot;&gt;çº¿ç¨‹æ± &lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒæ¯å½“å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œéƒ½éœ€è¦ä¸€å®šæ—¶é—´(ä¸Šç™¾æ¯«ç§’)æ¥åˆ›å»ºæ–°çš„å±€éƒ¨å˜é‡æ ˆã€‚å¦‚æœä½¿ç”¨çº¿ç¨‹æ± é¢„å…ˆåˆ›å»ºå¯å›æ”¶çº¿ç¨‹å¯å¤§å¹…é™ä½åˆ›å»ºå¼€é”€ã€‚ä½†æ˜¯&lt;strong&gt;çº¿ç¨‹æ± çš„çº¿ç¨‹éƒ½æ˜¯åå°çº¿ç¨‹ï¼Œé˜»å¡çº¿ç¨‹æ± å°†ä¼šå½±å“æ€§èƒ½&lt;/strong&gt;ã€‚Thread.CurrentThread.IsThreadPoolThreadå±æ€§å¯ç¡®è®¤å½“å‰çº¿ç¨‹æ˜¯å¦å±äºçº¿ç¨‹æ± ã€‚&lt;/p&gt;

&lt;h3 id=&quot;çº¿ç¨‹æ± ç®€ä»‹&quot;&gt;çº¿ç¨‹æ± ç®€ä»‹&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒçº¿ç¨‹æ± çº¿ç¨‹æ˜¯åå°çº¿ç¨‹ã€‚ æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨é»˜è®¤å †æ ˆå¤§å°ï¼Œä»¥é»˜è®¤ä¼˜å…ˆçº§è¿è¡Œï¼Œå¹¶ä¸”ä½äºå¤šçº¿ç¨‹å•å…ƒä¸­ã€‚ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å®Œæˆå…¶ä»»åŠ¡åï¼Œå®ƒå°†è¿”å›åˆ°ç­‰å¾…çº¿ç¨‹çš„é˜Ÿåˆ—ã€‚ ä»æ­¤åˆ»èµ·ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨å®ƒã€‚ è¿™æ ·ï¼Œåº”ç”¨ç¨‹åºå°±å¯ä»¥é¿å…ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºæ–°çº¿ç¨‹çš„æˆæœ¬ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;æ¯ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ± å®ä¾‹ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;çº¿ç¨‹æ± çš„ä½¿ç”¨&quot;&gt;çº¿ç¨‹æ± çš„ä½¿ç”¨&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒé€šè¿‡System.Threading.ThreadPoolç±»å¯ä»¥è·å–çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œé€šè¿‡QueueUserWorkItemé™æ€æ–¹æ³•å°†ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± é˜Ÿåˆ—ä¸­ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå§”æ‰˜è¡¨ç¤ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¼‚æ­¥æ“ä½œã€‚åœ¨è°ƒç”¨QueueUserWorkItemæ–¹æ³•æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™è¯¥æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œå§”æ‰˜ä»»åŠ¡ã€‚å¦‚æœè¿‡å¿«è°ƒç”¨QueueUserWorkItemæ–¹æ³•ï¼Œåˆ™çº¿ç¨‹æ± ä¼šåˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ï¼Œæ–°çš„å§”æ‰˜æ“ä½œå°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ç›´åˆ°çº¿ç¨‹æ± ä¸­çº¿ç¨‹ç©ºé—²ï¼Œæ‰€ä»¥è¿‡å¿«çš„è°ƒç”¨ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚&lt;/p&gt;

&lt;div class=&quot;premonition warning&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon warning&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-warning&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; çº¿ç¨‹æ± è­¦å‘Š &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;ol&gt;
  &lt;li&gt;çº¿ç¨‹æ± é€‚åˆçŸ­æ—¶ä»»åŠ¡ï¼Œä¸é€‚åˆé•¿æ—¶é—´è¿è¡Œä¸”è®¡ç®—å¯†é›†å‹æ“ä½œã€‚&lt;/li&gt;
  &lt;li&gt;çº¿ç¨‹æ˜¯è¢«CLRç®¡ç†çš„ä½œä¸ºç³»ç»Ÿçº§èµ„æºï¼Œå¦‚æœåº”ç”¨å¤§é‡å ç”¨çº¿ç¨‹æ± çº¿ç¨‹å¯¼è‡´é˜»å¡ï¼Œä¼šæ˜¾è‘—æ‹–æ…¢è¿›ç¨‹çš„å“åº”é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;/ol&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;RunTestThreadPool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//public delegate void AsyncCallback(IAsyncResult ar);&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//åªè¦è·ŸAsyncCallbackå§”æ‰˜çš„ç­¾åä¸€è‡´å³å¯&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;FinishCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IAsyncResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;callback called&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;çº¿ç¨‹çŠ¶æ€=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AsyncState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;çº¿ç¨‹Id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CurrentThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ManagedThreadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Thread starting&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;Thread id = &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CurrentThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ManagedThreadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CurrentThread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ManagedThreadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;Thread id = &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//å…¥å£å‡½æ•°&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ThreadPoolStart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ä½¿ç”¨Threadåˆ›å»ºçº¿ç¨‹&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//åˆ›å»ºçº¿ç¨‹idç¡®å®šä¸æ˜¯æ¥è‡ªçº¿ç¨‹æ± çš„çº¿ç¨‹id&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;new Thread id &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thread1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ä½¿ç”¨çº¿ç¨‹æ± è¿è¡Œå§”æ‰˜&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;RunTestThreadPool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;poolDelegate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°å’Œè‡ªå®šä¹‰å‚æ•°ï¼Œå¹¶ç†è§£è¿”å›IAsyncResultå¯¹è±¡&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IAsyncResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;poolDelegate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;BeginInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FinishCallback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;delegate async callback&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…çº¿ç¨‹æ± çº¿ç¨‹å®Œæˆï¼Œåé¢çš„ä»£ç å¼€å§‹æŒ‚èµ·ï¼Œå…è®¸ç»§ç»­å…¶ä»–å·¥ä½œ&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AsyncWaitHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WaitOne&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// è·å–çº¿ç¨‹æ± çº¿ç¨‹è¿”å›å€¼&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;poolDelegate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndInvoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thread2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æ‰“å°çº¿ç¨‹æ± çº¿ç¨‹id&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;thread pool threaId &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threadId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æ‰“å°çº¿ç¨‹æ± çº¿ç¨‹è¿”å›å€¼&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Debug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ç­‰å¾…1ç§’&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒBeginInvoke/EndInvokeçš„å‰xä¸ªå‚æ•°ä¸å§”æ‰˜çš„ç­¾åå‚æ•°æ˜¯è¦ä¸€è‡´çš„ï¼Œç„¶ååä¸€ä¸ªå‚æ•°æ˜¯å®Œæˆå›è°ƒï¼Œæœ€åæ˜¯è‡ªå®šä¹‰objectå‚æ•°æ˜¯åœ¨EndInvokeçš„è¿”å›å€¼ã€‚ä½¿ç”¨Begin/Endæ–¹æ³•å’ŒIAsyncResultå¯¹è±¡å¯ä»¥å®ç°å¼‚æ­¥è°ƒç”¨è¢«ç§°ä¸ºå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹&lt;a href=&quot;../CSharp/CSharp_Thread_Pattern.html#apmæ¨¡å¼&quot;&gt;APMæ¨¡å‹&lt;/a&gt;ã€‚&lt;sup id=&quot;fnref:4&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;div class=&quot;premonition error&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon error&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-error&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; Threadå·²è¿‡æ—¶ &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;ç°ä»£C#ä¸å†æ¨èç›´æ¥æ“ä½œä½¿ç”¨Threadã€ThreadPoolï¼ŒC#åœ¨4.0ä»¥åæ¨å‡ºäº†ä¸€å¥—æŠ½è±¡ç¨‹åº¦æ›´é«˜çš„TPLçš„APIå°†ThreadPoolä½œä¸ºåº•å±‚å®ç°åŒ…è£…èµ·æ¥ã€‚&lt;/p&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;h4 id=&quot;çº¿ç¨‹æ± åˆ›å»º&quot;&gt;çº¿ç¨‹æ± åˆ›å»º&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒè§‚å¯Ÿåˆ›å»ºçº¿ç¨‹éœ€è¦çš„æ—¶é—´ï¼Œçº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹çš„æ•ˆç‡æ¯”new Thread()åˆ›å»ºçº¿ç¨‹çš„æ•ˆç‡è¦é«˜ï¼Œå› ä¸ºçº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹æ˜¯å¯å¤ç”¨çš„ï¼Œè€Œnew Thread()åˆ›å»ºçº¿ç¨‹æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Stopwatch&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stopwatch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Stopwatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;stopwatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// new Thread(() =&amp;gt; { }).Start();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ThreadPool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;QueueUserWorkItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;stopwatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;åˆ›å»º100ä¸ªçº¿ç¨‹éœ€è¦èŠ±è´¹æ—¶é—´(æ¯«ç§’)ï¼š&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stopwatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ElapsedMilliseconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒç”¨æˆ‘çš„Mac intel 6æ ¸CPUæµ‹è¯•åˆ°ç›´æ¥New Threadåˆ›å»ºæ¶ˆè€—260msï¼Œè€Œçº¿ç¨‹æ± åˆ›å»º100ä¸ªå¯å¤ç”¨çš„çº¿ç¨‹æ¶ˆè€—åªæœ‰3msã€‚&lt;/p&gt;

&lt;h4 id=&quot;çº¿ç¨‹æ± æ•°é‡&quot;&gt;çº¿ç¨‹æ± æ•°é‡&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡æ˜¯æ ¹æ®CPUæ ¸å¿ƒæ•°æ¥å†³å®šçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ä¸ºCPUæ ¸å¿ƒæ•°ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡SetMinThreads()å’Œ SetMaxThreads()è®¾ç½®çº¿ç¨‹æ± å·¥ä½œçš„æœ€å°å’Œæœ€å¤§çº¿ç¨‹æ•°ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SetMinThreads&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completionPortThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SetMaxThreads&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completionPortThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetMinThreads&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completionPortThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetMaxThreads&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;workerThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;completionPortThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;workerThreads&lt;/strong&gt;ï¼šå·¥ä½œçº¿ç¨‹æ•°ï¼Œè¿™äº›çº¿ç¨‹ç”¨äºå¤„ç†ä¸€èˆ¬çš„CPUå¯†é›†å‹ä»»åŠ¡å’Œæ™®é€šçš„å¼‚æ­¥æ“ä½œï¼Œé»˜è®¤å€¼é€šå¸¸ç­‰äºCPUæ ¸å¿ƒæ•°ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;completionPortThreads&lt;/strong&gt;ï¼šI/Oå®Œæˆç«¯å£çº¿ç¨‹æ•°ï¼Œè¿™äº›çº¿ç¨‹ä¸“é—¨ç”¨äºå¤„ç†å¼‚æ­¥I/Oæ“ä½œçš„å®Œæˆé€šçŸ¥ï¼Œå¤„ç†æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ç­‰I/Oå¯†é›†å‹æ“ä½œçš„å›è°ƒã€‚
â€ƒâ€ƒ&lt;strong&gt;è¿”å›å€¼&lt;/strong&gt;ï¼šSetå·¥ä½œçº¿ç¨‹æ•°é‡è¿”å›å€¼boolä¸ºtrueè¡¨ç¤ºæˆåŠŸï¼Œå¤±è´¥false(ç³»ç»Ÿå‚æ•°ä¸ºè´Ÿã€å†…å­˜ä¸è¶³ã€è¶…è¿‡å—é™å€¼)ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// æ£€æŸ¥å½“å‰è®¾ç½®&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentWorker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ThreadPool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetMaxThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentWorker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentWorker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; completionPortThreads=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWorker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ThreadPool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetMinThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWorker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;çº¿ç¨‹æ± æœ€å°çº¿ç¨‹æ•°=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxWorker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; completionPortThreads=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// å®‰å…¨è®¾ç½®æœ€å°çº¿ç¨‹æ•°ï¼Œä¸è¶…è¿‡æœ€å¤§å€¼&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;desiredWorker&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Min&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWorker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;desiredIO&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Min&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ThreadPool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetMinThreads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;desiredWorker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;desiredIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å¤„ç†å¤±è´¥æƒ…å†µ&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;çº¿ç¨‹æ± è°ƒåº¦&quot;&gt;çº¿ç¨‹æ± è°ƒåº¦&lt;/h4&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;çº¿ç¨‹æ± ä½¿ç”¨çš„ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;SetMaxThreads()è®¾ç½®çš„æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°æˆ–I/Oçº¿ç¨‹æ•°ï¼Œä¸èƒ½å°äºSetMinThreads()è®¾ç½®çš„æœ€å°å·¥ä½œçº¿ç¨‹æ•°æˆ–I/Oçº¿ç¨‹æ•°ã€‚&lt;/li&gt;
  &lt;li&gt;SetMaxThreads()è®¾ç½®çš„å·¥ä½œçº¿ç¨‹æˆ–I/Oå®Œæˆçº¿ç¨‹æ•°ç›®ä¸èƒ½è®¾ç½®ä¸ºå°äºè®¡ç®—æœºä¸Šçš„å¤„ç†å™¨æ•°ã€‚&lt;/li&gt;
  &lt;li&gt;å¦‚æœå°†çº¿ç¨‹æ± æœ€å°æ•°è®¾ç½®å¾—è¿‡å¤§(SetMinThreads())ï¼Œä¼šå¯¼è‡´ä»»åŠ¡åˆ‡æ¢å¼€é”€å˜å¤§ï¼Œæ¶ˆè€—æ›´å¤šå¾—æ€§èƒ½èµ„æºã€‚&lt;/li&gt;
  &lt;li&gt;å¦‚æœåŠ å…¥çš„ä»»åŠ¡å¤§äºè®¾ç½®çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå°†ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;â€ƒâ€ƒçº¿ç¨‹æ± è°ƒåº¦ç®—æ³•&lt;sup id=&quot;fnref:5&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:5&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;ï¼Œè¿™ä¸ªæœç´¢äº†Googleå’ŒAIï¼š&lt;/p&gt;

&lt;div class=&quot;premonition info&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon info&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-info&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; çº¿ç¨‹è°ƒåº¦ &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;å¦‚æœçº¿ç¨‹æ•°è®¾ç½®è¿‡å°ï¼Œé‚£ä¹ˆä»»åŠ¡å¾ˆå¤šæ—¶ï¼Œé˜Ÿåˆ—ä¼šæœ‰å¤§é‡ä»»åŠ¡éœ€è¦ç­‰å¾…ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬è¦æ‰§è¡Œçš„ä»»åŠ¡ä¸èƒ½é©¬ä¸Šå®Œæˆï¼Œå¾ˆå¤šè¦æ‰§è¡Œçš„å‡½æ•°é˜»å¡ç­‰å¾…ã€‚
c#çº¿ç¨‹æ± è°ƒåº¦ç®—æ³•æœ‰å·¥ä½œçªƒå–æ³•æ¼”è¿›åˆ°çˆ¬å±±ç®—æ³•ã€‚&lt;/p&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;h2 id=&quot;çº¿ç¨‹ç»ˆæ­¢&quot;&gt;çº¿ç¨‹ç»ˆæ­¢&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒç»ˆæ­¢çº¿ç¨‹æ–¹å¼åŒ…æ‹¬ï¼šä»»åŠ¡å®Œæˆè‡ªåŠ¨ç»ˆæ­¢ã€å¼‚å¸¸ç»ˆæ­¢ã€è¶…æ—¶ç»ˆæ­¢ã€æ‰‹åŠ¨ç»ˆæ­¢()ã€‚ä¸»è¦æ³¨æ„çš„æ‰‹åŠ¨ç»ˆæ­¢æ–¹å¼æ–¹æ³•ã€‚çœ‹äº†å¥½å‡ æœ¬å…³äºçº¿ç¨‹çš„ä¹¦ç±éƒ½åœ¨å¼ºè°ƒä¸å¯è½»æ˜“è°ƒç”¨ç”¨Thread.Abort()ã€‚ç›´æ¥è°ƒç”¨Abortå¹¶ä¸èƒ½è¡¨æ˜è¯¥çº¿ç¨‹å°±åœæ­¢è¿è¡Œï¼Œæ ¹æ®&lt;a href=&quot;../CSharp/CSharp_Thread_Pattern.html###çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ&quot;&gt;çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå›¾&lt;/a&gt;å’Œçº¿ç¨‹çŠ¶æ€è½¬æ¢æšä¸¾ï¼Œå®ƒä»…ä»…æ˜¯å‘å‡ºäº†AbortRequestè¯·æ±‚CLRç»ˆæ­¢è¯¥çº¿ç¨‹ï¼Œè‡³äºç»ˆæ­¢æ—¶æœºå®Œå…¨ç”±CLRå†³å®šã€‚çº¿ç¨‹ç»ˆæ­¢åçŠ¶æ€ä¼šå˜ä¸ºAbortedï¼ŒCLRä¼šè‡ªåŠ¨å›æ”¶çº¿ç¨‹èµ„æºã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ç»ˆæ­¢çº¿ç¨‹åè·å–çŠ¶æ€&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;çº¿ç¨‹æ˜¯å¦å­˜æ´»=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsAlive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;  çº¿ç¨‹çŠ¶æ€=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ThreadState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// ç»ˆæ­¢çº¿ç¨‹åå¹¶è®©ä¸»çº¿ç¨‹ç­‰å¾…testçº¿ç¨‹å®Œæˆï¼Œè·å–çŠ¶æ€&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;çº¿ç¨‹æ˜¯å¦å­˜æ´»=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsAlive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;  çº¿ç¨‹çŠ¶æ€=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ThreadState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ä»¤ç‰Œæ–¹å¼ç»ˆæ­¢&quot;&gt;ä»¤ç‰Œæ–¹å¼ç»ˆæ­¢&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ¨èä½¿ç”¨CancellationTokenSourceæ¥ç»ˆæ­¢çº¿ç¨‹ã€‚CancellationTokenSourceç±»æä¾›äº†ä¸€ä¸ªCancellationTokenå¯¹è±¡ï¼Œå¯ä»¥ç”¨äºå–æ¶ˆå¼‚æ­¥æ“ä½œã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;CancellationTokenSource&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CancellationToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ThrowIfCancellationRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationCanceledException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Cancel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;çº¿ç¨‹æ˜¯å¦å­˜æ´»=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsAlive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;  çº¿ç¨‹çŠ¶æ€=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ThreadState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒCancellationTokenSourceå‘å‡ºå–æ¶ˆä¿¡å·ï¼ŒCancellationToken.IsCancellationRequestedæ£€æŸ¥æ˜¯å¦è¯·æ±‚å–æ¶ˆï¼ŒCancellationToken.ThrowIfCancellationRequested()åœ¨å–æ¶ˆæ—¶æŠ›å‡ºå¼‚å¸¸åŒæ—¶IsCancellationRequestedè®¾ç½®ä¸ºtrueã€‚è¿™é‡Œtoken.ThrowIfCancellationRequested()æ˜¯å¦æŠ›å‡ºå¼‚å¸¸æ ¹æ®å®é™…éœ€æ±‚æ¥å†³å®šã€‚&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;å‚è€ƒä¹¦ç±ï¼šC#å¤šçº¿ç¨‹ç¼–ç¨‹å®æˆ˜ã€‚Â &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;å‚è€ƒä¹¦ç±ï¼šC#7.0æœ¬è´¨è®ºlockéƒ¨åˆ†ã€‚Â &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;å‚è€ƒä¹¦ç±ï¼šC#7.0æœ¬è´¨è®ºä¿¡å·é‡ã€‚Â &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;å‚è€ƒ&lt;a href=&quot;https://learn.microsoft.com/zh-cn/dotnet/navigate/advanced-programming/&quot;&gt;å¾®è½¯æ–‡æ¡£&lt;/a&gt;ã€‚Â &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;å‚è€ƒä¹¦ç±ï¼šC#5.0æœ¬è´¨è®ºçº¿ç¨‹è°ƒåº¦ç®—æ³•åŸç†ã€‚Â &lt;a href=&quot;#fnref:5&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Tue, 03 Jun 2025 20:00:00 +0000</pubDate>
        <link>https://www.damonc.top/csharp/CSharp_Thread_Base.html</link>
        <guid isPermaLink="true">https://www.damonc.top/csharp/CSharp_Thread_Base.html</guid>
        
        <category>Thread</category>
        
        
        <category>CSharp</category>
        
      </item>
    
      <item>
        <title>Unity Addressable Systemä½¿ç”¨åˆ†æ(ä¸‰)</title>
        <description>&lt;h2 id=&quot;addressableåˆå§‹åŒ–&quot;&gt;Addressableåˆå§‹åŒ–&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒAAåˆå§‹åŒ–è°ƒç”¨å‡½æ•°&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Addressables.InitializeAsync(autoReleaseHandle)&lt;/code&gt;ï¼Œè¿”å›AsyncOperationHandleã€‚å‚æ•°autoReleaseHandleæ˜¯æ§åˆ¶Handleæ˜¯å¦è‡ªåŠ¨é‡Šæ”¾ï¼Œé»˜è®¤æ˜¯trueä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚è™½ç„¶æˆåŠŸæ‰§è¡Œäº†åˆå§‹åŒ–ï¼Œä½†æ˜¯æƒ³è¦æ‹¿åˆ°AsyncOperationHandleçš„ç»“æœå°±ä¸èƒ½è®©å®ƒè‡ªåŠ¨é‡Šæ”¾ï¼Œå¦‚æœè®¿é—®ä¼šæç¤ºhandleæ— æ•ˆã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;AsyncOperationHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Addressables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;InitializeAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Status&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncOperationStatus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Succeeded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Initialization Error&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒAAåˆå§‹åŒ–è¿”å›ç»“æœå°±æ˜¯æœ¬åœ°çš„Catalog.bundleå¯¹è±¡ï¼Œä½¿ç”¨DefaultBuildScriptæ‰“AssetBundleç»“æœä¼šä¿å­˜åœ¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Library/com.unity.addressables/aa/å¹³å°/&lt;/code&gt;ã€‚InitialåŠ è½½çš„å°±æ˜¯æœ¬åœ°æœ€æ–°çš„Catalogå¯¹è±¡ï¼Œå¦‚æœæ˜¯çœŸæœºå°±ä¼šåŠ è½½æ‰“åŒ…APKæ—¶æœ€åˆæ‰“è¿›åŒ…çš„Catalogå¯¹è±¡ã€‚&lt;/p&gt;

&lt;h3 id=&quot;catalogç»“æ„&quot;&gt;Catalogç»“æ„&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒCatalogåŠ è½½åä¼šæ„å»ºæˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResourceLocationMap&lt;/code&gt;å¯¹è±¡ï¼Œè¯¥æ•°æ®å¯¹è±¡å°±æ˜¯è®°å½•äº†ä¸€ä¸ªBundleçš„æ‰€ä¿å­˜çš„åœ°å€ä¿¡æ¯(æœ¬åœ°è¿˜æ˜¯è¿œç¨‹)ã€‚åŠ è½½Catalogæµç¨‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// ç”¨æˆ·ä»£ç ä¸­è°ƒç”¨&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Addressables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;InitializeAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// å†…éƒ¨å®é™…è°ƒç”¨&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;AddressablesImpl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;InitializeAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;â†’&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResourceManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartOperation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// åœ¨ InitializeAsync å†…éƒ¨&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;InitializationOperation&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InitializationOperation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResourceManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartOperation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// InitializationOperation ä¸­&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// 1. é¦–å…ˆåŠ è½½ä¸» Catalog æ–‡ä»¶&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;LoadContentCatalogInternal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m_ResourceLocators&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s_Settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;catalogLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 2. ç„¶ååŠ è½½é¢å¤–çš„ Catalog æ–‡ä»¶ï¼ŒåŒ…æ‹¬è¿œç¨‹çš„catalog(å¦‚æœæœ‰é…ç½®)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;catalogLocation&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s_Settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;catalogLocations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LoadContentCatalogInternal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m_ResourceLocators&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;catalogLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒå½“ Catalog åŠ è½½å®Œæˆåï¼Œç³»ç»Ÿä¼šè§£æå…¶ä¸­çš„å†…å®¹å¹¶æ„å»º ResourceLocationMapï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// åœ¨ContentCatalogProvider.cs ä¸­&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ContentCatalogProvider&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IResourceProvider&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;OnCatalogLoaded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ContentCatalogData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;catalogData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// åˆ›å»º ResourceLocationMap&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locMap&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResourceLocationMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;catalogData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// å¤„ç†å†…éƒ¨ ID æ˜ å°„&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kvp&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;catalogData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InternalIds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// å»ºç«‹ key -&amp;gt; location[]çš„æ˜ å°„&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kvp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;IList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locations&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
            
            &lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kvp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// ä¸ºæ¯ä¸ªå†…éƒ¨IDåˆ›å»º ResourceLocation&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CreateLocationForCatalogEntry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;catalogData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;locations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            
            &lt;span class=&quot;c1&quot;&gt;// å°† locations æ·»åŠ åˆ° ResourceLocationMap ä¸­&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;locMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// å…¶ä»–å¤„ç†...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResourceLocationMap&lt;/code&gt;æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå­—å…¸ç»“æ„ï¼Œå®ƒå°†ç”¨æˆ·å¯è®¿é—®çš„é”®æ˜ å°„åˆ°å¯¹åº”çš„èµ„æºä½ç½®åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// ResourceLocationMap çš„ç®€åŒ–ç»“æ„&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ResourceLocationMap&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IResourceLocator&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// æ ¸å¿ƒæ•°æ®ç»“æ„ï¼šé”® -&amp;gt; èµ„æºä½ç½®åˆ—è¡¨çš„æ˜ å°„&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m_Locations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResourceLocationMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ContentCatalogData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;catalogData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;m_Locations&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;();&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// åˆå§‹åŒ–å…¶ä»–å…ƒæ•°æ®...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;m_Locations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// IResourceLocator æ¥å£å®ç°&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Locate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m_Locations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryGetValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// æ ¹æ®ç±»å‹ç­›é€‰ä½ç½®...&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;locations&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;â€ƒâ€ƒå½“æ‰€æœ‰ Catalog éƒ½å¤„ç†å®Œæˆåï¼ŒResourceLocationMap è¢«æ³¨å†Œåˆ° Addressables ç³»ç»Ÿï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// åœ¨åˆå§‹åŒ–å®Œæˆæ—¶&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locator&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m_ResourceLocators&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å°†æ„å»ºå¥½çš„ ResourceLocationMap æ³¨å†Œåˆ° ResourceManager&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ResourceManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;RegisterLocator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;locator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;åŠ è½½è¿œç¨‹catalog&quot;&gt;åŠ è½½è¿œç¨‹Catalog&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒæ¯æ¬¡ä¿®æ”¹æ–‡ä»¶æ‰“åŒ…AssetBundleåCatalogæ˜¯æœ‰å·®å¼‚çš„ï¼Œä¸ºäº†å¾—åˆ°æœ€æ–°AssetBundleå°±è¦å…ˆä¸‹è½½åˆ°æœ€æ–°çš„Catalogæ–‡ä»¶ç„¶åä¿å­˜åœ¨æœ¬åœ°Documentç›®å½•ã€‚AAä¹Ÿæä¾›åŠ è½½æŒ‡å®šåœ°å€çš„Catalogï¼Œå¯ä»¥æ˜¯file:///ï¼Œä¹Ÿå¯ä»¥æ˜¯http(s)ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// remoteUrl -&amp;gt; http://localhost:8000/&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;AsyncOperationHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remoteHandle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Addressables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LoadContentCatalogAsync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remoteUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;catalog.bundle&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remoteHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remoteHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Status&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AsyncOperationStatus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Succeeded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;InitRemoteLocation Error&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒæœ¬åœ°æ¨¡æ‹ŸServerï¼ŒæŠŠ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Library/com.unity.addressables/aa/å¹³å°/&lt;/code&gt;ä¸‹é¢çš„Assetbundleå’Œcatalogå¤åˆ¶åˆ°ä¸€ä¸ªç›®å½•ï¼Œåœ¨è¯¥ç›®å½•æ‰“å¼€cmdï¼Œè¾“å…¥python -m http.server 8000ä¼šæ¨¡æ‹Ÿä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ã€‚
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/simulator_server.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;æ¨¡æ‹Ÿæ–‡ä»¶æœåŠ¡å™¨.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;p&gt;â€ƒâ€ƒä¸‹è½½å¥½ä¹‹åå°±èƒ½è·å–åˆ°è¿œç¨‹&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResourceLocationMap&lt;/code&gt;ã€‚ç°åœ¨æœ‰äº†æœ¬åœ°å’Œè¿œç¨‹Locationä¿¡æ¯ï¼Œé€šè¿‡å¯¹æ¯”å°±èƒ½çŸ¥é“æœ‰å“ªäº›AssetBundleäº§ç”Ÿå˜åŒ–ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// ç¼“å­˜AssetBundle Location&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_missingBundle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_localBundle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IEnumerator&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CheckRemoteLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IResourceLocator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; 
    &lt;span class=&quot;c1&quot;&gt;// æ£€æŸ¥æœ¬åœ°èµ„æºåœ¨è¿œç¨‹æ˜¯å¦å­˜åœ¨&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Keys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// é»˜è®¤æ‰“åŒ…çš„AssetBundleæ–‡ä»¶åç¼€å¸¦äº†.bundleï¼Œå¦‚æœä¿®æ”¹AAä»£ç å°±ç”¨è‡ªå®šä¹‰&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ä¸€å®šè¦å¢åŠ ä¸€ä¸ªæ ‡è®°ï¼Œå¦åˆ™å°±ä¸èƒ½åŒºåˆ«bundleåå’Œå…¶ä»–ä¿¡æ¯çš„æè¿°å&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndsWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.bundle&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iAbType&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IAssetBundleResource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Locateå®šä½remoteKeyæ˜¯å¦åœ¨localå†…ï¼Œè‹¥æœ‰è¡¨ç¤ºè¯¥ABæ–‡ä»¶æ²¡æœ‰å·®å¼‚ä¸ç”¨æ›´æ–°&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;local&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Locate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iAbType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;localLocations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// remoteKeyä¸åœ¨localå†…ï¼Œè¯¥ABæœ‰å·®å¼‚æ˜¯æœ€æ–°çš„éœ€è¦æ›´æ–°ä¸‹è½½&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Locate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;iAbType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remoteLocations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remoteLoc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remoteLocations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;_missingBundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remoteLoc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PrimaryKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;localLocations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;_localBundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PrimaryKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æ›´æ–°assetbundle&quot;&gt;æ›´æ–°AssetBundle&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒç°åœ¨æ‹¿åˆ°äº†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_missingBundle&lt;/code&gt;å’Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_localBundle&lt;/code&gt;ï¼Œç°åœ¨å°±è¦æ›´æ–°AssetBundleã€‚æ›´æ–°AssetBundleå°±è¦è·å–å®ƒçš„æœ€æ–°åœ°å€ï¼Œé‚£ä¹ˆAAä¹Ÿæä¾›äº†ä¸€ä¸ªå›è°ƒæ¥å£&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Addressables.InternalIdTransformFunc&lt;/code&gt;ï¼Œåªè¦æ³¨å†Œäº†è¯¥å›è°ƒï¼Œä»»ä½•åŠ è½½åŠ¨ä½œéƒ½ä¼šè¿›å…¥åˆ°è¯¥å›è°ƒï¼Œå°±å¯ä»¥åœ¨å›è°ƒé‡Œé¢è¿›è¡Œå¤„ç†ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Addressables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InternalIdTransformFunc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InternalIdTransformFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InternalIdTransformFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_missingBundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryGetValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PrimaryKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remoteUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PrimaryKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_localBundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryGetValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PrimaryKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InternalId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InternalId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IResourceLocation&lt;/code&gt;æœ‰ä¸‰ä¸ªå…³é”®ä¿¡æ¯ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PrimaryKey&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;InternalId&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResourceType&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// èµ„æºåŠ è½½åçš„ä¸»è¦æ ‡è¯†ç¬¦&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PrimaryKey&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// èµ„æºåŠ è½½åœ°å€&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InternalId&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// èµ„æºåŠ è½½ç±»å‹ï¼Œé‡ç‚¹å¤„ç†IAssetBundleResourceã€catalogç±»å‹&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ResourceType&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;å…ˆå¤„ç†å¦‚ä½•ä¸‹è½½ã€åŠ è½½æœ€æ–°çš„catalog
â€ƒâ€ƒä¸ç®¡æ˜¯Initialæœ¬åœ°Catalogè¿˜æ˜¯Loadè¿œç¨‹Catalogï¼Œåªè¦æ³¨å†Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;InternalIdTransformFunc&lt;/code&gt;å°±å¯ä»¥åœ¨å‡½æ•°å†…å¤„ç†ï¼š
    &lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InternalIdTransformFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IResourceLocation&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;// å¦‚æœargResourceTypeæ˜¯catalogç±»å‹&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;// åˆ¤å®šæœ¬åœ°ç¼“å­˜ç›®å½•æ˜¯å¦æœ‰Catalog.bundleï¼Œè®¡ç®—bundleçš„hashæ˜¯å¦ä¸catalog.hashä¸€è‡´&lt;/span&gt;
         &lt;span class=&quot;c1&quot;&gt;// å¦‚æœä¸€è‡´å°±åŠ è½½ï¼Œç›´æ¥è¿”å›$&quot;{ç¼“å­˜ç›®å½•}/Catalog.bundle&quot;&lt;/span&gt;
         &lt;span class=&quot;c1&quot;&gt;// å¦‚æœæ²¡æœ‰Catalog.bundleå°±ç”¨åŒ…ä½“å†…çš„Catalogç›´æ¥è¿”å›arg.InternalId&lt;/span&gt;

 &lt;span class=&quot;c1&quot;&gt;// å¦‚æœargResourceTypeæ˜¯IAssetBundleResourceç±»å‹&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;// åˆ¤å®šç¼“å­˜ç›®å½•æœ‰è¯¥æ–‡ä»¶&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;// æœ‰ï¼Œç›´æ¥è¿”å›$&quot;{ç¼“å­˜ç›®å½•}/xxx.bundle&quot;&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;// æ²¡æœ‰ï¼Œç›´æ¥è¿”å›$&quot;{remoteUrl}/xxx.bundle&quot;å»ä¸‹è½½&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;// åªè¦èƒ½ç¡®ä¿Catalogæ˜¯æœ€æ–°ï¼Œä¸‹è½½çš„AssetBundleæ–‡ä»¶æ˜¯ä¸€å®šæ˜¯æœ€æ–°çš„&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;å¤æ‚çš„æ›´æ–°ç­–ç•¥&quot;&gt;å¤æ‚çš„æ›´æ–°ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒä¸Šé¢æˆ‘æ˜¯æ¼”ç¤ºç”¨äº†ä¸€ç§æœ€ç®€å•çš„æ›´æ–°ç­–ç•¥ï¼Œè‚¯å®šæ˜¯ä¸èƒ½æ»¡è¶³å¤æ‚éœ€æ±‚çš„ã€‚å¦‚æœè®¾å®šGroupæ‰“åŒ…ä½¿ç”¨hash of file nameï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ„å»ºæ—¶æ¯ä¸ªAssetBundleåä¸å˜ï¼Œæ–‡ä»¶å†…å®¹hashä¼šå‘ç”Ÿäº†å˜åŒ–ã€‚é‚£ä¹ˆå°±è¦ç»´æŠ¤ä¸€ä»½bundleåæ˜ å°„hashè¡¨ï¼Œä¸€ä¸ªæœ¬åœ°ä¸€ä¸ªè¿œç¨‹ï¼Œæ¯æ¬¡å¯åŠ¨å°±è¦æ£€æŸ¥ä¸¤å¼ è¡¨æ˜¯å¦ä¸€è‡´ã€æ˜¯å¦æœ‰å˜åŒ–ï¼ŒåŒæ—¶æ£€æŸ¥ç¼“å­˜çš„æœ€æ–°æ–‡ä»¶æœ‰æ²¡æœ‰ä¸¢å¤±ã€‚å½“ç„¶ä¹Ÿè¿˜æœ‰å…¶ä»–çš„ç­–ç•¥å°±ä¸è®¨è®ºäº†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;è¸©å‘&quot;&gt;è¸©å‘&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒ1. ä¸èƒ½åŒæ—¶å­˜åœ¨å¤šä¸ªCatalogå¯¹è±¡ï¼Œå°±æ˜¯InstantiateAsyncäº†æœ¬åœ°Catalogåè·å–äº†Resultåæœ€å¥½æ˜¯ç«‹å³é‡Šæ”¾æ‰&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;localLocator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;localHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Addressables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Release&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;localHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Addressables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;RemoveResourceLocator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;localLocator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒ2. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Addressables.ClearResourceLocators()&lt;/code&gt;ä¸èƒ½éšä¾¿è°ƒç”¨ï¼Œä¼šä¸¢å¼ƒæ‰€æœ‰Catalogå¯¹è±¡ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ3. æ¸¸æˆé‡å¯ï¼Œå¦‚æœæ˜¯åœ¨æ¸¸æˆå†…é‡å¯å°±ä¸èƒ½å†æ¬¡åˆå§‹åŒ–&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;InstantiateAsync&lt;/code&gt;äº†ï¼Œå†…éƒ¨æ ‡è®°äº†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hasStartedInitialization&lt;/code&gt;ã€‚&lt;/p&gt;
</description>
        <pubDate>Mon, 15 Jul 2024 20:00:00 +0000</pubDate>
        <link>https://www.damonc.top/unity3d/Unity_Addressable_Build.html</link>
        <guid isPermaLink="true">https://www.damonc.top/unity3d/Unity_Addressable_Build.html</guid>
        
        <category>Addressable System</category>
        
        
        <category>Unity3d</category>
        
      </item>
    
      <item>
        <title>Unity Addressable Systemä½¿ç”¨åˆ†æ(äºŒ)</title>
        <description>&lt;h2 id=&quot;æ„å»ºå‰ç½®å‡†å¤‡&quot;&gt;æ„å»ºå‰ç½®å‡†å¤‡&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒAAæ‰“åŒ…æä¾›äº†è‡ªå¸¦è„šæœ¬&lt;strong&gt;&lt;em&gt;BuildScriptPackedMode&lt;/em&gt;&lt;/strong&gt;æ‰“åŒ…å…¥å£æœ‰ä¸¤ä¸ªï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;ä¸å¸¦æ‰“åŒ…ç»“æœè¿”å›ï¼šAddressableAssetSettings.BuildPlayerContent();&lt;/li&gt;
  &lt;li&gt;å¸¦æ‰“åŒ…ç»“æœçš„æ¥å£ï¼šAddressableAssetSettings.BuildPlayerContent(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;out AddressablesPlayerBuildResult rst&lt;/code&gt;);&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;å¼€å§‹æ„å»º&quot;&gt;å¼€å§‹æ„å»º&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒAddressablesPlayerBuildResultä¸»è¦è®°å½•äº†æ‰“åŒ…æˆåŠŸåè·å–åˆ°bundleåˆ—è¡¨ä¿¡æ¯ï¼Œæ¯ä»½bundleéƒ½æœ‰ç”Ÿæˆï¼Œç±»ä¼¼äºä»¥å‰çš„AssetBundle Menifestç»“æ„ã€‚è¿™ä¸ªç»“æœå¯ä»¥åºåˆ—åŒ–ä¿å­˜åœ¨æœ¬åœ°ï¼Œæ–¹ä¾¿æŸ¥çœ‹è°ƒè¯•å„èµ„æºä¹‹é—´ä¾èµ–æƒ…å†µã€‚&lt;/p&gt;

&lt;div class=&quot;premonition note&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon note&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-note&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; AddressablesPlayerBuildResultç»“æ„ &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; 
&lt;pre&gt;&lt;code class=&quot;language-CSHARP&quot;&gt;//bundleæ„å»ºåçš„ä¿¡æ¯
class BundleBuildResult{
 public string FilePath;
 public string InternalBundleName;
 public AddressableAssetGroup SourceAssetGroup;
 public uint Crc;
 public string Hash;
}
public List&amp;lt;BundleBuildResult&amp;gt; AssetBundleBuildResults =&amp;gt; m_AssetBundleBuildResults;
//catalog hashçš„è·¯å¾„
public string RemoteCatalogHashFilePath { get; internal set; }
//catalog jsonçš„è·¯å¾„
public string RemoteCatalogJsonFilePath { get; internal set; }
//content stateçš„è·¯å¾„
public string ContentStateFilePath { get; internal set; }
&lt;/code&gt;&lt;/pre&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒè¿›å…¥åˆ°&lt;strong&gt;&lt;em&gt;BuildPlayerContent&lt;/em&gt;&lt;/strong&gt;å‡½æ•°ï¼Œæœ€ä¸»è¦å·¥ä½œä¹‹ä¸€æ˜¯å¯¹æ‰€æœ‰Groupå†…çš„æ‰€æœ‰Entryèµ„æºåœ¨æ‰“åŒ…ä¹‹å‰æŠŠ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BundleFileId&lt;/code&gt;ç½®ç©ºï¼Œè¿™ä¸ªå­—æ®µåœ¨ç¼–è¾‘å™¨æ‰“åŒ…æ—¶æœ‰ç”¨åˆ°ã€‚è¯¥å˜é‡å€¼åœ¨æ‰“åŒ…æ—¶å¤šæ¬¡ä½¿ç”¨ï¼Œéå¸¸é‡è¦ï¼
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/bundle_field_id.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Debugæ¨¡å¼æŸ¥çœ‹åˆ°BundleFileId.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;p&gt;â€ƒâ€ƒè¿›å…¥åˆ°&lt;strong&gt;&lt;em&gt;BuildPlayerContentImpl&lt;/em&gt;&lt;/strong&gt;å‡½æ•°ï¼Œä¸»è¦åšäº†ä¸‰å—å·¥ä½œã€‚&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;æ£€æŸ¥Addressables BuildPathç›®å½•ï¼Œå­˜åœ¨å°±æ¸…ç©ºè¯¥ç›®å½•ã€‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BuildPath&lt;/code&gt;å°±æ˜¯æ„å»ºbundleçš„å­˜æ”¾ç›®å½•ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;æ¸…ç©ºè¯¥ç›®å½•&lt;/code&gt;çš„æ“ä½œã€‚&lt;/li&gt;
  &lt;li&gt;å®ä¾‹åŒ–&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddressablesDataBuilderInput&lt;/code&gt;å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å†…éƒ¨åˆå§‹åŒ–ï¼šæŒ‡å®šæ„å»ºå¹³å°ã€æ„å»ºç‰ˆæœ¬å·ã€FileRegistryå®¹å™¨ã€PreviousContentStateç½®ç©ºã€‚&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨æŒ‡å®šçš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ActivePlayerDataBuilder&lt;/code&gt;æ„å»ºå¯¹è±¡å¼€å§‹æ„å»ºbundleã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;premonition note&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;svg class=&quot;icon note&quot; aria-hidden=&quot;true&quot;&gt; &lt;use xlink:href=&quot;#icon-note&quot;&gt;&lt;/use&gt; &lt;/svg&gt; &lt;div class=&quot;title&quot;&gt; æ¸…ç©ºç›®å½•å¦‚ä½•åšåˆ°å¢é‡æ‰“åŒ…ï¼Ÿ &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;p&gt;â€ƒâ€ƒå¯¹äºä¹‹å‰ä½¿ç”¨&lt;strong&gt;&lt;em&gt;BuildPipeline.BuildAssetBundles&lt;/em&gt;&lt;/strong&gt;æ¥å£æ‰“åŒ…ï¼Œé»˜è®¤è‡ªå¸¦å¢é‡æ‰“åŒ…å‚æ•°ï¼Œé™¤éä½¿ç”¨ForceRebuildAssetBundleå‚æ•°æŒ‡å®šã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒä»¥å‰çš„å¢é‡æ‰“åŒ…çš„æ‰€éœ€æ¡ä»¶ï¼š&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;(1)&lt;/strong&gt;èµ„æºæ²¡å˜åŒ–ä¸”ç”Ÿæˆç›®å½•ä¸‹çš„bundleåŒ…å’Œå¯¹åº”manifestå­˜åœ¨ï¼Œä¸ä¼šé‡æ–°æ‰“åŒ…ï¼›&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;(2)&lt;/strong&gt;èµ„æºæ²¡å˜åŒ–å³ä½¿ç”Ÿæˆç›®å½•ä¸‹çš„bundleåŒ…è¢«åˆ é™¤äº†ï¼Œä¸ä¼šé‡æ–°æ‰“åŒ…ï¼›&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;(3)&lt;/strong&gt;åªè¦ç”Ÿæˆç›®å½•ä¸‹çš„bundleåŒ…å¯¹åº”çš„manifaseè¢«åˆ é™¤äº†ï¼Œä¼šé‡æ–°æ‰“åŒ…ï¼›&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒè€Œç°åœ¨å³ä½¿åˆ é™¤äº†Bundleå­˜æ”¾ç›®å½•ï¼Œå¯¹äºå¢é‡æ‰“åŒ…çš„ä½¿ç”¨addressables_content_stateæ–‡ä»¶å’ŒBuildCacheä¿¡æ¯ç»„åˆåˆ¤æ–­ã€‚&lt;/p&gt;



 &lt;/div&gt; &lt;/div&gt;
&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ActivePlayerDataBuilder&lt;/code&gt;åˆ†æï¼šè¯¥å¯¹è±¡ä¸€å®šè¦ç»§æ‰¿è‡ªBuildScriptBaseã€‚ä¸€å®šè¦æ”¾åœ¨Data Buildersåˆ—è¡¨ã€‚ä¸€å®šè¦ç»™ActivePlayerDataBuilderIndexèµ‹å€¼ï¼Œæˆ–è€…åœ¨Settingsçš„Data Buildersåˆ—è¡¨æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œè¯»å–ActivePlayerDataBuilderIndexä¼˜å…ˆçº§æ˜¯é«˜äºåˆ—è¡¨é¡ºåºã€‚
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/build_play_scripts.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Data Buildersåˆ—è¡¨å°±æ˜¯è¿™ä¸ªScriptsåˆ—è¡¨.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FileRegistry&lt;/code&gt;åˆ†æï¼šæ–‡ä»¶æ³¨å†Œè¡¨çš„ä½œç”¨åœ¨æ„å»ºBundleæœŸé—´ä¿å­˜åˆ›å»ºBundleæ—¶çš„å­˜æ”¾è·¯å¾„(å¸¦hashä¿¡æ¯)ï¼Œç„¶ååœ¨Bundleæ„å»ºçš„åå¤„ç†ä½¿ç”¨ReplaceBundleEntryï¼Œä½¿ç”¨æ— hashçš„è·¯å¾„æ›¿æ¢å¸¦hashè·¯å¾„ã€‚æš‚æ—¶ä¸é‡è¦ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddressablesContentState&lt;/code&gt;ç»“æ„ä¸&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BundleFileId&lt;/code&gt;åˆ†æï¼šAddressablesContentStateä¿å­˜äº†å½“æ¬¡æ„å»ºæ—¶æ‰€æœ‰çš„Assetç¼“å­˜ä¿¡æ¯å’ŒBundleä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨ä¸‹æ¬¡æ„å»ºbundleæ—¶è¯»å–è¿™äº›ç¼“å­˜ä¿¡æ¯ã€‚BundleFileIdå°±åŒ…å«åœ¨è¿™äº›ç¼“å­˜ä¿¡æ¯å†…ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AddressablesContentState&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;editorVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CachedAssetState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cachedInfos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remoteCatalogLoadPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CachedBundleState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cachedBundles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CachedAssetState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IEquatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CachedAssetState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AssetState&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AssetState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;groupGuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bundleFileId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Equals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CachedAssetState&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CachedBundleState&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bundleFileId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;åˆå§‹åŒ–icontextobject&quot;&gt;åˆå§‹åŒ–IContextObject&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒè¿›å…¥&lt;strong&gt;&lt;em&gt;BuildDataImplementation&lt;/em&gt;&lt;/strong&gt;å†…ï¼Œä¼šç»§ç»­åˆå§‹åŒ–ä¸€äº›æ•°æ®ï¼šè°ƒç”¨åœºæ™¯ä¿å­˜(ä½¿ç”¨SBPç®¡çº¿æ„å»ºBundleå‰ä¸€å®šè¦ä¿å­˜åœºæ™¯)ã€åˆå§‹åŒ–AddressableAssetsBuildContextå¯¹è±¡ã€å¤„ç†æ‰€æœ‰Groupå¯¹è±¡ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResourceManagerRuntimeData&lt;/code&gt;ï¼šç”¨äºåˆå§‹åŒ–AAçš„è¿è¡Œæ—¶æ•°æ®ï¼ŒåŒ…å«è®¸å¤šAAè®¾ç½®æ—¶çš„å‚æ•°ï¼Œæ¯æ¬¡æ„å»ºéƒ½ä¼šé‡æ–°ç”Ÿæˆã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddressableAssetsBuildContext&lt;/code&gt;ï¼šç”¨äºæ„å»ºè¿‡ç¨‹ä¸­æ•°æ®ä¼ é€’ï¼Œåœ¨åé¢çš„Taskæµçš„ä¼šå¤šæ¬¡ç”¨åˆ°IContextObjectæˆ–IAddressableAssetsBuildContextæ¥å£æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;span id=&quot;jump1&quot;&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;å¤„ç†group&quot;&gt;å¤„ç†Group&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¯¹æ¯ä¸ªGroupçš„Schemaè¿›è¡Œé¢„å¤„ç†ï¼Œå¯¹Groupå†…æ‰€æœ‰AssetEntryç”Ÿæˆä¸€ä»½&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ContentCatalogDataEntry&lt;/code&gt;è¿è¡Œæ—¶å¯»å€æ•°æ®ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;(1)PlayerDataGroupSchema&lt;/strong&gt;åˆ†åˆ«æœ‰åœºæ™¯å†…çš„èµ„æºå’ŒResourceç›®å½•å†…çš„èµ„æºã€‚æŠŠè¯¥Schemaå†…æ‰€æœ‰çš„AssetEntryæ‰§è¡ŒGatherAllAssetsï¼šæ”¶é›†è¯¥Schemaå†…æ‰€æœ‰èµ„æº(åŒ…æ‹¬subAssetã€spriteç²¾çµ)è£…å…¥AddressableAssetEntryæ”¶é›†åˆ—è¡¨ã€‚éå†æ”¶é›†åˆ—è¡¨æ‰§è¡ŒCreateCatalogEntriesåˆ›å»º&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ContentCatalogDataEntry&lt;/code&gt;æ•°æ®(IResourceLocationå¯»å€æ•°æ®ï¼Œåœ¨è¿è¡Œæ—¶åˆå§‹åŒ–AAå’ŒåŠ è½½Catalogè¿™ä¸€æ•°æ®éå¸¸é‡è¦)ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;(2)BundledAssetGroupSchema&lt;/strong&gt;æ„å»ºbundleé…ç½®å’ŒåŒ…å«åœ¨Entriesåˆ—è¡¨é‡Œçš„èµ„æºï¼Œæ ¹æ®BundlePackingModeç”Ÿæˆé¢„å®šä¹‰Bundleåï¼Œä¸‰è€…çš„åŒºåˆ«æ˜¯å¯»å€è·¯å¾„å‚æ•°ä¸ä¸€æ ·ï¼Œ&lt;strong&gt;Bundleå‘½åæ ¼å¼&lt;/strong&gt;ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;groupGuid + _assets_ + address + .bundle&lt;/code&gt;ã€‚é‡ç‚¹è¯´ä¸€ä¸‹PackTogetherByLabelï¼Œæ ¹æ®AssetEntryå¯¹è±¡å†…çš„æ ‡ç­¾ç”ŸæˆBundleåï¼Œé€‰æ‹©è¿™ä¸ªæ¨¡å¼å‘½åBundleï¼Œæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ä¸€èˆ¬æ¯ä¸ªAssetåªéœ€è¦ä¸€ä¸ªæ ‡ç­¾å³å¯ï¼Œè¿™æ ·ä¸€ä¸ªæ ‡ç­¾å¯¹åº”å¤šä¸ªèµ„æºå°±å¯ä»¥æ‰“æˆä¸€ä¸ªBundleã€‚ä¸‰ç§æ¨¡å¼éƒ½ä¼šç”Ÿæˆä¸€ä»½AssetBundleBuild[]æ‰“åŒ…æ•°æ®ï¼Œç„¶åæŠŠè¯¥ä»½æ•°æ®æ¯ä¸ªBundleNameæ‰§è¡ŒReHashæ›¿æ¢(è¿™ä¸€æ­¥å¯ä»¥å®šåˆ¶bundle name)ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å¼€å§‹æ‰“åŒ…&quot;&gt;å¼€å§‹æ‰“åŒ…&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒå®ä¾‹åŒ–ExtractDataTaskå¯¹è±¡ï¼Œå®ä¾‹åŒ–AddressableAssetsBundleBuildParameterså¯¹è±¡ï¼Œåˆå§‹åŒ–buildTasksï¼Œè°ƒç”¨SBPç®¡çº¿ContentPipeline.BuildAssetBundlesæ¥å£å¼€å§‹æ‰“åŒ…ã€‚&lt;/p&gt;

&lt;h3 id=&quot;contentpipeline&quot;&gt;ContentPipeline&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒContentPipelineæ˜¯SBPæ‰“åŒ…ç®¡çº¿å…¥å£çš„é™æ€ç±»ã€‚åœ¨è°ƒç”¨BuildAssetBundlesåè¿›è¡Œäº†ä¸€ç³»åˆ—çš„å®‰å…¨æ£€æŸ¥ï¼›æŠŠIBuildTaskéœ€è¦çš„æ•°æ®è£…å…¥BuildContextå¯¹è±¡çš„m_ContextObjectså­—å…¸ï¼›åœ¨æ‰§è¡ŒRunTaskä¹‹å‰å…ˆé€šè¿‡Injectå‡½æ•°æ“ä½œTaskæˆå‘˜å˜é‡çš„FieldInfoï¼Œå†ä»BuildContextçš„m_ContextObjectsæ ¹æ®æˆå‘˜å˜é‡ç±»å‹å–å‡ºValueå¹¶å†™å…¥Fieldï¼›æ‰§è¡ŒTask Runningæ“ä½œï¼›ç„¶åå†æŠŠTaskæ‰§è¡Œåæ›´æ–°çš„æˆå‘˜å˜é‡æ•°æ®å–å‡ºè£…å…¥BuildContextå€¼ã€‚&lt;/p&gt;

&lt;h2 id=&quot;taskç®¡çº¿&quot;&gt;Taskç®¡çº¿&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒæ¯ä¸ªTaskå†…çš„æˆå‘˜å˜é‡ç”¨å±æ€§æ ‡è®°ï¼ŒContextUsage.Inæ˜¯ä»BuildContextå–å‡ºï¼ŒContextUsage.InOutæ˜¯è¾“å…¥è¾“å‡ºåŒå‘ï¼ŒContextUsage.Outè¾“å‡ºã€‚&lt;/p&gt;

&lt;h3 id=&quot;switchtobuildplatform&quot;&gt;SwitchToBuildPlatform&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒåˆ‡æ¢åˆ°æŒ‡å®šçš„æ‰“åŒ…å¹³å°(å¦‚æœå½“å‰å¹³å°ä¸æ˜¯ç›®æ ‡å¹³å°è§¦å‘åˆ‡æ¢åŸºæœ¬è¦å¥½å‡ ååˆ†é’Ÿå§).&lt;/p&gt;

&lt;h3 id=&quot;rebuildspriteatlascache&quot;&gt;RebuildSpriteAtlasCache&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒè§¦å‘æ‰€æœ‰Sprite Atlas Packingæ“ä½œï¼Œç”Ÿæˆæ‰€æœ‰ç²¾çµå›¾é›†çš„ç¼“å­˜æ•°æ®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;buildplayerscripts&quot;&gt;BuildPlayerScripts&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒè§¦å‘æ‰€æœ‰è„šæœ¬ç¼–è¯‘ã€‚&lt;/p&gt;

&lt;h3 id=&quot;postscriptscallback&quot;&gt;PostScriptsCallback&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒç¼–è¯‘è„šæœ¬æ—¶çš„å›è°ƒï¼Œè¦ç”¨åˆ°è¿™ä¸ªå›è°ƒéœ€è¦ç»™ContentPipeline.BuildCallbacksæ³¨å†Œã€‚&lt;/p&gt;

&lt;h3 id=&quot;calculatescenedependencydata&quot;&gt;CalculateSceneDependencyData&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ”¶é›†Sceneçš„ä¾èµ–èµ„æºä¿¡æ¯ã€‚&lt;/p&gt;

&lt;h3 id=&quot;calculateassetdependencydata&quot;&gt;CalculateAssetDependencyData&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ”¶é›†èµ„æºçš„ä¾èµ–ä¿¡æ¯ï¼Œæœ‰ä¸‰ä¸ªæœ€é‡è¦çš„è¾“å‡ºæ•°æ®æ”¶é›†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IBuildResultsã€IBuildSpriteDataã€IBuildExtendedAssetData&lt;/code&gt;ä¼ é€’ç»™ä¸‹ä¸€ä¸ªTaskï¼Œè¿™é‡Œæœ‰è®¸å¤šUnityå†…éƒ¨ä»£ç ç°åœ¨çœ‹ä¸åˆ°ï¼Œç”¨è¿™ä¸‰ä¸ªç»“æœæ•°æ®å€’æ¨è¿™ä¸ªæ”¶é›†æµç¨‹ï¼Œå…ˆçœ‹çœ‹è¿™ä¸‰ä¸ªæ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IBuildResults&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IContextObject&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ScriptCompilationResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ScriptResults&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WriteResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WriteResults&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SerializedFileMetaData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WriteResultsMetaData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GUID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AssetResultData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AssetResults&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;WriteResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{...}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SerializedFileMetaData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{...}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AssetResultData&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GUID&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Guid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Hash128&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ObjectIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IncludedObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ObjectIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ReferencedObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ObjectIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;]&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ObjectTypes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IBuildSpriteData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IContextObject&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GUID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SpriteImporterData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ImporterData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IBuildExtendedAssetData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IContextObject&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GUID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ExtendedAssetData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ExtendedData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;(1) ä¾èµ–æ•°æ®æ–°æ—§å¯¹æ¯”&lt;/strong&gt;ï¼Œå…ˆç”¨TaskOutputçš„ä¸´æ—¶ç»“æ„AssetOutputä¿å­˜ï¼ŒAssetOutputåŒ…å«æœ‰ä¸Šè¿°æœ€é‡è¦ä¸‰ä¸ªæ•°æ®ã€‚é€šè¿‡BuildCacheæ¥å£æ ¹æ®Asset GUIDè·å–èµ„äº§ä¿¡æ¯ï¼Œè¿™é‡Œçš„ç¼“å­˜éƒ½æ˜¯ä»Libraryä¸‹çš„BuildCacheè¯»å–ï¼Œè‹¥æ²¡æœ‰ç¼“å­˜ä¼šè·³è¿‡åç»­çš„æ›´æ–°ç¼“å­˜æ•°æ®æ“ä½œï¼Œç„¶åç”Ÿæˆç¼“å­˜ä¿å­˜ï¼›è‹¥æœ‰ä¸Šæ¬¡æ‰“åŒ…çš„ç¼“å­˜æ•°æ®ï¼Œåˆ™æ£€æŸ¥Spriteä¸Atlasçš„å…³è”æ•°æ®åœ¨è¿™æ¬¡æ‰“åŒ…å‰æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼ŒæŠŠç¼“å­˜ä¸­æœ‰è¿‡æ—¶çš„æ•°æ®éœ€è¦é‡æ–°ç”Ÿæˆæ•°æ®æ›¿æ¢ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;(2) ä¾èµ–æ•°æ®æ”¶é›†&lt;/strong&gt;ï¼Œ(å¯è·³è¿‡ä¸é˜…è¯»)ï¼Œå…·ä½“æµç¨‹&lt;strong&gt;1)&lt;/strong&gt;éå†æ¯ä¸ªAsset GUIDè·å–Cache Infoï¼Œå¦‚æœData[2]ç±»å‹æ˜¯Spriteå°±åŠ å…¥packedSpritesè¡¨ï¼›&lt;strong&gt;2)&lt;/strong&gt;è·å–è¯¥Asset CacheInfo Data[4]ç±»å‹è¡¨å¹¶éå†ï¼Œè‹¥æ˜¯Spirteè¿›å…¥GetPlayerDependenciesForAssetæ£€æŸ¥å…¶ä¾èµ–ï¼›&lt;strong&gt;3)&lt;/strong&gt;éå†æ‰€æœ‰includedObjectså¯¹è±¡å¹¶ä½¿ç”¨ContentBuildInterface.GetPlayerDependenciesForObjectsè·å–è¯¥å¯¹è±¡çš„æ‰€æœ‰ä¾èµ–ï¼Œè·³è¿‡inputè‡ªèº«æŠŠå…¶ä»–ä¾èµ–åŠ å…¥otherReferencedAssetObjectsHashSetè¡¨ï¼›&lt;strong&gt;4)&lt;/strong&gt;ä½¿ç”¨objectLookingAtæ ˆå¯¹æ”¶é›†åˆ°çš„ä¾èµ–å¯¹è±¡å†æ¬¡éå†æŸ¥æ‰¾ï¼Œa.å¯¹äºä¸æ˜¯inputè‡ªèº«ä¸”æ²¡æœ‰åœ¨explicitAssetsè¡¨å†…å°±åŠ å…¥encounteredExplicitAssetDependenciesï¼Œè‹¥æ˜¯éæ‰“åŒ…ç²¾çµåŠ å…¥mainRepresentationNeededï¼Œb.å¯¹äºæœªå¤„ç†è¿‡çš„éšå¼èµ„æºï¼Œæ›´æ–°æˆ–åˆ›å»ºimplicitOutputï¼ŒæŸ¥æ‰¾ç¼“å­˜ä¾èµ–ï¼Œå°†æ–°å‘ç°çš„ä¾èµ–å‹å…¥objectLookingAtæ ˆä¸­ç»§ç»­éå†ï¼›&lt;strong&gt;5)&lt;/strong&gt;æœ€åå†æ‰§è¡Œåˆå¹¶collectedImmediateReferencesè¡¨å’ŒmainRepresentationNeededè¡¨è¿”å›æœ€ç»ˆçš„ä¾èµ–ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;(3) æ”¶é›†IBuildResultsã€IBuildSpriteDataã€IBuildExtendedAssetData&lt;/strong&gt;ï¼ŒéSpriteèµ„æºèµ°ProcessAssetå¤„ç†ï¼Œä½¿ç”¨GetPlayerObjectIdentifiersInAssetè·å–includedObjects IDè¡¨ï¼Œç»§ç»­ä½¿ç”¨GetPlayerDependenciesForAssetæ”¶é›†ä¾èµ–ï¼Œç„¶åæ”¶é›†èµ„æºçš„è¡¨ç¤ºè£…å…¥ExtendedAssetDataï¼Œç„¶åå°†ä¾èµ–é¡¹æ‰©å±•ä¸ºæ˜¾å¼èµ„äº§ã€‚æœ€åå°†assetOutput.assetè£…å…¥å„è‡ªçš„æ•°æ®ç»“æ„ä¸­ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AssetOutput&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GUID&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;asset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Hash128&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AssetLoadInfo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assetInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ObjectDependencyInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectDependencyInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BuildUsageTagSet&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;usageTags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SpriteImporterData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spriteData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ExtendedAssetData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extendedData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ObjectTypes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectTypes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CachedInfo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ICachedData&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CacheEntry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Asset&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CacheEntry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dependencies&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/*
    [0]AssetLoadInfo
    [1]BuildUsageTagSet
    [2]SpriteImporterData
    [3]ExtendedAssetData
    [4]List&amp;lt;ObjectTypes&amp;gt;
    [5]List&amp;lt;ObjectDependencyInfo&amp;gt;
    */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;addhashtobundlenametask&quot;&gt;AddHashToBundleNameTask&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¦‚æœä½¿ç”¨äº†UniqueBundleIdså®šä¹‰Bundleå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œ&lt;/p&gt;

&lt;h3 id=&quot;stripunusedspritesources&quot;&gt;StripUnusedSpriteSources&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå‰¥ç¦»æœªä½¿ç”¨çš„Spiriteï¼Œä»ä¾èµ–åˆ†æçš„Taskè·å–çš„IBuildSpriteDataæ•°æ®è¿›è¡Œéå†ï¼Œåœ¨m_DependencyDataæ²¡æœ‰ç”¨åˆ°çš„Spriteç»Ÿç»Ÿå‰¥ç¦»ï¼Œå¹¶ä»IBuildExtendedAssetDataçš„ExtendedDataå†…åˆ é™¤ã€‚&lt;/p&gt;

&lt;h3 id=&quot;generatebundlepacking&quot;&gt;GenerateBundlePacking&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¤„ç†èµ„æºåŒ…æ‰“åŒ…ç”Ÿæˆå†…éƒ¨æ–‡ä»¶åã€æ”¶é›†èµ„æºçš„å¯¹è±¡æ ‡è¯†ç¬¦ã€è¿‡æ»¤å’Œå¤„ç†èµ„æºå¼•ç”¨ã€è®°å½•èµ„æºåˆ°æ–‡ä»¶çš„æ˜ å°„ï¼Œè¿‡æ»¤é€»è¾‘ç§»é™¤é»˜è®¤èµ„æºå¼•ç”¨ã€å¤„ç†èµ„æºé—´çš„å¾ªç¯å¼•ç”¨ã€å»é™¤é‡å¤æˆ–ä¸å¿…è¦çš„å¼•ç”¨&lt;/p&gt;

&lt;h3 id=&quot;updatebundleobjectlayout&quot;&gt;UpdateBundleObjectLayout&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ›´æ–°bundleçš„ç»„ç»‡ç»“æ„ï¼Œæœ€å¼€å§‹çš„æ•°æ®æ˜¯ä»ContentPipeline.BuildAssetBundlesæ‰“åŒ…æ¥å£å‚æ•°BundleBuildContent(m_AllBundleInputDefs)å¯¹è±¡ç”Ÿæˆï¼Œé€šè¿‡Bundle Packingæ›´æ–°ä¾èµ–æ•°æ®åï¼Œè¿™å—çš„bundleå†…éƒ¨ç»“æ„æ•°æ®ä¹Ÿè¦æ›´æ–°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;generatebundlecommands&quot;&gt;GenerateBundleCommands&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒä¸ºèµ„æºå’Œåœºæ™¯ç”Ÿæˆæ‰“åŒ…å‘½ä»¤ï¼Œå¤„ç†è‡ªå®šä¹‰èµ„æºã€éå†èµ„æºåŒ…å¸ƒå±€ï¼Œæ ¹æ®èµ„æºç±»å‹åˆ›å»ºä¸åŒçš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;èµ„æºåŒ…å‘½ä»¤ (CreateAssetBundleCommand)ï¼šåˆ›å»ºå†™å…¥å‘½ä»¤ã€åˆ›å»ºä½¿ç”¨çš„åˆ—è¡¨é›†ã€åˆ›å»ºå¼•ç”¨æ˜ å°„ã€å¤„ç†ä¾èµ–å“ˆå¸Œå¹¶æ’åºã€ç”Ÿæˆèµ„æºåŒ…å†™å…¥æ“ä½œã€‚&lt;/li&gt;
  &lt;li&gt;åœºæ™¯åŒ…å‘½ä»¤ (CreateSceneBundleCommand)ï¼šè·å–åœºæ™¯æ–‡ä»¶å¯¹è±¡ã€åˆ›å»ºå†™å…¥å‘½ä»¤ã€å¤„ç†é¢„åŠ è½½å¯¹è±¡ã€ç”Ÿæˆåœºæ™¯åŠ è½½ä¿¡æ¯ã€åˆ›å»ºåœºæ™¯åŒ…å†™å…¥æ“ä½œã€‚&lt;/li&gt;
  &lt;li&gt;åœºæ™¯æ•°æ®å‘½ä»¤ (CreateSceneDataCommand)ï¼šç±»ä¼¼åœºæ™¯åŒ…å‘½ä»¤ã€ä¸“é—¨å¤„ç†é¢å¤–çš„åœºæ™¯æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;generatesubassetpathmaps&quot;&gt;GenerateSubAssetPathMaps&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒåˆ›å»ºå­èµ„æºçš„åŠ è½½ä¿¡æ¯ï¼Œèµ„æºåŒ…å†™å…¥æ“ä½œé›†è½¬ä¸ºinternalNameä¸Valueçš„å­—å…¸æ˜ å°„ï¼Œéå†ExtendedDataçš„guidæ•°æ®ï¼Œé€šè¿‡AssetToFileså–å‡ºä¸»èµ„æºï¼Œé€šè¿‡ä¸»èµ„æºè·å–å½“å‰guidçš„infoï¼Œæ ¹æ®infoå’Œèµ„æºè¡¨ç¤ºå½¢å¼CreateSubAssetLoadInfoï¼Œç„¶åæ’å…¥åˆ°ä¸»èµ„æºinfoçš„BundleAssetsã€‚&lt;/p&gt;

&lt;h3 id=&quot;generatebundlemaps&quot;&gt;GenerateBundleMaps&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå¯¹AssetBundleç”Ÿæˆä¾èµ–æ˜ å°„å’Œä½¿ç”¨é›†åˆï¼ŒBuildReferenceMapè¯¦ç»†è¯´æ˜æºåŒ…ä¸­çš„å¯¹è±¡æ‰€ä¾èµ–çš„å…¶ä»–åŒ…ä¸­å­˜åœ¨å“ªäº›å¯¹è±¡ï¼ˆå‰å‘ä¾èµ–é¡¹ï¼‰ï¼›BuildUsageTagSet è¯¦ç»†è¯´æ˜äº†æºåŒ…ä¸­çš„å¯¹è±¡éœ€è¦å†™å…¥çš„æ¡ä»¶æ•°æ®ï¼Œè¯¥æ•°æ®ç”±å…¶ä»–åŒ…ä¸­çš„å¯¹è±¡ä½¿ç”¨ï¼ˆåå‘ä¾èµ–ï¼‰ã€‚&lt;/p&gt;

&lt;h3 id=&quot;writeserializedfiles&quot;&gt;WriteSerializedFiles&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæŠŠèµ„æºåŒ…æ•°æ®åˆ†æ®µå†™å…¥AssetBundleã€‚é€šè¿‡TaskCachingUtility.RunCachedOperationæ³¨å†Œæœ¬åœ°å›è°ƒå‡½æ•°åˆ†å¸ƒæ“ä½œå†™å…¥ï¼šè·å–ç¼“å­˜ã€å¤„ç†æœªç¼“å­˜æ–‡ä»¶hashå†™å…¥SerializedFileMetaDataã€ä¿å­˜MetaDataæ•°æ®ä¸WriteResultæ•°æ®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;archiveandcompressbundles&quot;&gt;ArchiveAndCompressBundles&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒå‹ç¼©å†™å…¥èµ„æºåŒ…ï¼Œåˆ›å»ºArchiveWorkItemé›†ã€æ‰§è¡Œå‹ç¼©Itemçš„ResourceFilesæ‰€æœ‰æ–‡ä»¶å¹¶è¿”å›crcã€‚&lt;/p&gt;

&lt;h3 id=&quot;generatelocationliststask&quot;&gt;GenerateLocationListsTask&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒåˆ›å»ºå¯»å€èµ„äº§çš„ä½ç½®åˆ—è¡¨ï¼Œç”¨äºæè¿°èµ„æºåœ¨æœ€ç»ˆæ„å»ºåŒ…ä¸­çš„ä½ç½®å’ŒåŠ è½½æ–¹å¼ã€‚æ¯ä¸ªä½ç½®åˆ—è¡¨æ¡ç›®åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼šèµ„æºç±»å‹ã€åŠ è½½è·¯å¾„ã€æä¾›ç¨‹åºã€å…¶ä»–å…ƒæ•°æ®ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ‰“åŒ…åå¤„ç†&quot;&gt;æ‰“åŒ…åå¤„ç†&lt;/h2&gt;

&lt;p&gt;â€ƒâ€ƒéå†ContentCatalogDataEntryé›†åˆç”Ÿæˆä¸»é”®æ˜ å°„ã€Bundle ReNameã€Catalog ReMapã€åˆ›å»ºCatalog Fileã€ä¿å­˜ContentStateã€‚&lt;/p&gt;

&lt;h3 id=&quot;bundleåå¤„ç†&quot;&gt;Bundleåå¤„ç†&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒè¿™ä¸€æ­¥åœ¨Bundleå‹ç¼©å†™å…¥åã€‚åˆ›å»ºä¸‹è½½ä¿¡æ¯AssetBundleRequestOptionsæ˜¯æä¾›ç»™AssetBundleProviderä¸‹è½½æ—¶ä½¿ç”¨ã€‚æ ¹æ®BundleNamingæ¨¡å¼é‡æ„AssetBundleNameï¼Œé‡æ„å‘½åè¿™ä¸€æ­¥ä¼šå½±å“bundleå‘½åæ ¼å¼ï¼Œå°¤å…¶ä¼šç ´å&lt;a href=&quot;#jump1&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1.3å¤„ç†Group&lt;/code&gt;&lt;/a&gt;è¿™ä¸€æ­¥çš„é¢„å‘½åã€‚&lt;/p&gt;
</description>
        <pubDate>Fri, 12 Jul 2024 20:00:00 +0000</pubDate>
        <link>https://www.damonc.top/unity3d/Unity_Addressabel_Group.html</link>
        <guid isPermaLink="true">https://www.damonc.top/unity3d/Unity_Addressabel_Group.html</guid>
        
        <category>Addressable System</category>
        
        
        <category>Unity3d</category>
        
      </item>
    
      <item>
        <title>Unity Addressable Systemä½¿ç”¨åˆ†æ(ä¸€)</title>
        <description>&lt;h2 id=&quot;addressableå®‰è£…&quot;&gt;Addressableå®‰è£…&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒæ€»ç»“åœ¨ä½¿ç”¨Unity Addressable Systemè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œè¯¥ç¯‡ä¸»è¦è®°å½•Addressableåœ¨Unityç¼–è¾‘å™¨çš„å„ç§ç»„ç»‡ç»“æ„ï¼Œæœ¬æ–‡Addressableåç»­ç®€ç§°AAï¼ŒåŸºäº1.21.19ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;h3 id=&quot;packageå®‰è£…&quot;&gt;Packageå®‰è£…&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒæ‰“å¼€Unity Window - Package Mangerï¼Œæ‰¾åˆ°Addressableå®‰è£…æ‰¾ä¸€ä¸ªåˆé€‚çš„ç‰ˆæœ¬ï¼š
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/addressable_win_pkg_mgr.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Addressable Version Seleclt.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h3 id=&quot;æ‰‹åŠ¨å®‰è£…&quot;&gt;æ‰‹åŠ¨å®‰è£…&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒåœ¨Package Manageré€‰æ‹©ä¸€ä¸ªåˆé€‚çš„Addressableç‰ˆæœ¬è¿˜è¦ç»“åˆAddressableæ›´æ–°logï¼Œæ‰“å¼€&lt;a href=&quot;httpsï¼š//docs.unity3d.com/Packages/com.unity.addressables@1.21/changelog/CHANGELOG.html&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Addressableæ›´æ–°æ—¥å¿—&lt;/code&gt;&lt;/a&gt;ï¼Œç‰ˆæœ¬åˆ—è¡¨å±•ç¤ºäº†Address ableå¯¹åº”çš„Unityç‰ˆæœ¬ï¼š
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/addressable_version.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Addressable Version List.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;p&gt;â€ƒâ€ƒUnityè¿™é‡Œåˆ†äº†ä¸¤ä¸ªåˆ†æ”¯ç»´æŠ¤Addressableï¼Œå…¶ä¸­ä¸€ä¸ªåˆ†æ”¯æ˜¯1.21ç‰ˆæœ¬å¯¹åº”çš„Unityç‰ˆæœ¬æ˜¯2019+ï¼Œå¦ä¸€ä¸ªåˆ†æ”¯æ˜¯2.0ç‰ˆæœ¬å¯¹åº”çš„Unityç‰ˆæœ¬æ˜¯2023+ï¼š
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/addressable_1_21.png&quot; width=&quot;250&quot; /&gt;&lt;body&gt;&lt;/body&gt;
        &lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/addressable_2_0.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Addressable Branch.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;â€ƒâ€ƒ2.0ä»¥ä¸Šç‰ˆæœ¬ä¹Ÿå¯ä»¥ç”¨åœ¨é2023ç‰ˆçš„å¼•æ“ï¼Œä¸»è¦è¿˜æ˜¯é’ˆå¯¹2023+ Unityå¼•æ“æ”¯æŒæ–°çš„APIä»€ä¹ˆçš„ã€‚å¦‚æœæƒ³æŠŠ2.0ç‰ˆæœ¬åˆåˆ°1.21ï¼Œå¼€ä¸€Beyond Compareåˆå¹¶å·®å¼‚ä¹Ÿè¡Œã€‚æ‰“å¼€&lt;a href=&quot;httpsï¼š//packages.unity.com/com.unity.addressables&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Addressable Package Json&lt;/code&gt;&lt;/a&gt;ï¼Œè¿™é‡Œåˆ—æ˜äº†æ¯ä¸€ä¸ªAddressableç‰ˆæœ¬å¯¹åº”çš„Unityç‰ˆæœ¬ï¼Œç»“åˆ&lt;a href=&quot;httpsï¼š//docs.unity3d.com/Packages/com.unity.addressables@1.21/changelog/CHANGELOG.html&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Addressableæ›´æ–°æ—¥å¿—&lt;/code&gt;&lt;/a&gt;æ‰¾åˆ°ä¸€ä¸ªBugæœ€å°‘åˆç¬¦åˆå¯¹Unityç‰ˆæœ¬è¦æ±‚çš„Addressableç‰ˆæœ¬ã€‚æ‰¾åˆ°åˆé€‚çš„Addressableç‰ˆæœ¬åï¼Œæ‰“å¼€Packages/manifest.jsonï¼Œæ‰‹åŠ¨æ–°å¢åŒ…â€com.unity.addressablesâ€:â€1.21.19â€ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å®‰è£…addressableä¾èµ–&quot;&gt;å®‰è£…Addressableä¾èµ–&lt;/h3&gt;
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/addressable_deps.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Addressable Dependencies.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;p&gt;â€ƒâ€ƒAddressableæœ€é‡è¦çš„ä¾èµ–æ˜¯ScriptableBuildPipelineï¼ŒSBPè¿™ä¸ªåŒ…è¦æ›´æ–°åˆ°1.21.23æˆ–2.1.xä»¥ä¸Šï¼Œæ—§ç‰ˆSBPå¯¹SpriteAtlaså›¾é›†æ‰“åŒ…ä¼šæœ‰å†—ä½™ã€‚æ‰“å¼€Packages/manifest.jsonï¼Œå¼ºåˆ¶æŒ‡å®šSBPç‰ˆæœ¬â€com.unity.scriptablebuildpipelineâ€:â€1.21.23â€,
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/sbp_upgrade.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;SBPæŒ‡å®šç‰ˆæœ¬.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h3 id=&quot;addressableç»“æ„é¢„è§ˆ&quot;&gt;Addressableç»“æ„é¢„è§ˆ&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒå®‰è£…å¥½äº†AAä¹‹åï¼Œä¼šåœ¨Assetsç”Ÿæˆä»¥ä¸‹ç›®å½•ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ç›®å½•&lt;/td&gt;
      &lt;td&gt;è¯´æ˜&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;AddressableAssetsData&lt;/td&gt;
      &lt;td&gt;æ ¹ç›®å½•ä¹ŸåŒ…å«å‡ ä¸ªé‡è¦æ–‡ä»¶&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;##Platform&lt;/td&gt;
      &lt;td&gt;æ ¹æ®å½“å‰å¹³å°æ„å»ºä¸€æ¬¡ABåŒ…åç”Ÿæˆçš„ç›®å½•&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;AssetGroups&lt;/td&gt;
      &lt;td&gt;ç»™æŸèµ„æºè®¾ç½®å¯»å€åœ°å€å¹¶æŒ‡å®šGroupåçš„Groupæè¿°æ–‡ä»¶&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Schemas&lt;/td&gt;
      &lt;td&gt;Groupç»„çš„é…ç½®åŒ…å«é€»è¾‘ç»“æ„å’Œç‰¹æ€§æè¿°æ–‡ä»¶&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;AssetGroupTemplates&lt;/td&gt;
      &lt;td&gt;ç”ŸæˆGroupçš„æ¨¡ç‰ˆæè¿°æ–‡ä»¶&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DataBuilders&lt;/td&gt;
      &lt;td&gt;è‡ªå®šä¹‰AssetBundleæ‰“åŒ…è„šæœ¬ç›®å½•&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;addressableå„é¡¹é…ç½®&quot;&gt;Addressableå„é¡¹é…ç½®&lt;/h2&gt;

&lt;h3 id=&quot;addressableassetsettings&quot;&gt;AddressableAssetSettings&lt;/h3&gt;
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/addressable_assets_settings.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;AddressableAssetSettingsé¢„è§ˆ.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;p&gt;â€ƒâ€ƒAAçš„å…¨å±€é…ç½®æ–‡ä»¶ï¼Œæ¶‰åŠä¸€äº›æ‰“åŒ…é…ç½®ã€çƒ­æ›´é…ç½®ã€ä¸‹è½½é…ç½®ç­‰ç­‰ï¼Œä¸‹é¢æ˜¯æ¯é¡¹å‚æ•°é…ç½®è¯´æ˜ã€‚&lt;/p&gt;

&lt;h3 id=&quot;profile&quot;&gt;Profile&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;Profile&lt;/strong&gt;ä¸»è¦ä½œç”¨æ˜¯æŒ‡å®šæ‰“åŒ…åœ°å€å’ŒåŠ è½½åœ°å€ï¼Œè¿™é‡Œå¯ä»¥é…ç½®æ–°å¢æ‰“åŒ…Abçš„ä¿å­˜ç›®å½•å’ŒHotUpdateçƒ­æ›´èµ„æºç›®å½•çš„æŒ‡å®šè·¯å¾„ï¼Œå»ºè®®è‡ªå®šä¹‰è·¯å¾„ã€‚&lt;/p&gt;

&lt;p&gt;â€ƒâ€ƒè¿™ä¸¤ä¸ªå‚æ•°çš„ä½¿ç”¨åœ°æ–¹åœ¨ä¸åŒçš„AAç‰ˆæœ¬æœ‰ä¸€ç‚¹å·®åˆ«ï¼š1.20ä»¥å‰çš„ç‰ˆæœ¬åœ¨Content Updateæœ‰ç”¨åˆ°ï¼Œ1.20ä»¥åçš„ç‰ˆæœ¬åœ¨Catalogæœ‰ä½¿ç”¨ã€‚è§&lt;a href=&quot;#jump1&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Catalog&lt;/code&gt;&lt;/a&gt;
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/profile_in_use.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Profileé¢„è§ˆ.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;p&gt;Profile In Useå¯ä»¥é€‰æ‹©ç³»ç»Ÿè‡ªå¸¦æˆ–è‡ªå®šä¹‰ï¼Œå…¶ä¸­è‡ªå®šä¹‰ä½¿ç”¨ManageræŒ‰é’®æ‰“å¼€Profile Windowï¼Œç‚¹å‡»CreateæŒ‰é’®æ–°å¢å˜é‡ç­‰å‚æ•°ã€‚
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/profile_window.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Profile Window.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;&lt;span id=&quot;jump1&quot;&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;catalog&quot;&gt;Catalog&lt;/h3&gt;
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/catalog_attribute.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Catalogè®¾ç½®é¢æ¿.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;p&gt;â€ƒâ€ƒCatalogç±»ä¼¼äºæ ¹bundleï¼Œè®°å½•äº†å½“å‰æ„å»ºbundleæ—¶çš„ä¾èµ–å’ŒAAçš„å„é¡¹è®¾ç½®ã€‚&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;(1) Player Version Override&lt;/strong&gt;ï¼š è¿™ä¸ªå‚æ•°ä¼šå¯¹æ„å»ºå¥½çš„catalogè¿›è¡Œé‡å‘½åï¼Œunityä½¿ç”¨æ—¶é—´æˆ³ï¼Œæˆ‘ä»¬è‡ªå·±å¯ä»¥ç”¨è‡ªå·±çš„æ„å»ºç‰ˆæœ¬å·ï¼Œæ ¼å¼å¯ä»¥æ˜¯catalog_1.2.1720684396.jsonã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(2) Compress Local Catalog&lt;/strong&gt;ï¼š å¯ç”¨ä¼šå°†Catalog.jsonå‹ç¼©æˆCatalog.bundleï¼Œæ˜¾è‘—å‡å°‘æ–‡ä»¶sizeã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(3) Build Remote Catalog&lt;/strong&gt;ï¼š è¦çƒ­æ›´Catalogå°±è¦å¯ç”¨ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(4) Build Path&lt;/strong&gt;ï¼š æ„å»ºAssetbundleçš„ä¿å­˜åœ°å€ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(5) Load Path&lt;/strong&gt;ï¼š åŠ è½½AssetBundleçš„åœ°å€ï¼Œè¿™é‡Œæˆ‘æ˜¯åœ¨Profilesè®¾ç½®æˆäº†ç›¸å¯¹åœ°å€ï¼Œç„¶ååœ¨åŠ è½½è„šæœ¬å›è°ƒåœ°å€é€»è¾‘å®Œæˆåç»„è£…å®Œæ•´çš„åŠ è½½åœ°å€ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(6) Only Update catalogs manually&lt;/strong&gt;ï¼š æ‰‹åŠ¨æ§åˆ¶æ›´æ–°Catalogæ—¶æœºå’Œæ–¹å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;update-a-previous-build&quot;&gt;Update a Previous Build&lt;/h3&gt;
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/update_download.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Update Downloadsè®¾ç½®.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;(1) Check for Update Issues&lt;/strong&gt;ï¼šå®˜æ–¹æ¨èä½¿ç”¨List Restricted Assetsï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­å¯¹ä½¿ç”¨äº†é™åˆ¶æ›´æ–°çš„Groupæœ‰é™åˆ¶ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(2) Content State Build Path&lt;/strong&gt;ï¼šæŒ‡å®šaddressables_content_state.binçš„ä¿å­˜åœ°å€ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;â€ƒâ€ƒè¯¥content_stateæ–‡ä»¶åªåœ¨æœ¬åœ°æ„å»ºæ—¶è¯»å–è¿›è¡Œå¢é‡æ‰“åŒ…ï¼Œå¯ä»¥çœ‹çœ‹&lt;a href=&quot;httpsï¼š//docs.unity3d.com/Packages/com.unity.addressables@2.2/manual/content-update-builds-overview.html&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;å®˜æ–¹workflow&lt;/code&gt;&lt;/a&gt;ã€‚ç®€åŒ–æè¿°å°±æ˜¯è¦æ„å»ºæ›´æ–°çš„AssetBundleï¼Œè¯·è¿è¡ŒUpdate a Previous Buildè„šæœ¬ã€‚æ­¤å·¥å…·è¿˜ä½¿ç”¨åˆ°&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addressables_content_state.bin&lt;/code&gt;æ–‡ä»¶ï¼Œå®ƒä¼šé‡æ–°æ„å»ºæ‰€æœ‰å†…å®¹å¹¶ä¼šç”Ÿæˆåˆ°ä¸€ä¸ªä¿®æ”¹è¿‡çš„ç›®å½•ï¼Œè¯¥ç›®å½•å¯ä»¥è®¿é—®åŸå§‹AssetBundleä¸­æœªæ›´æ”¹çš„å†…å®¹ä»¥åŠæ–°AssetBundleä¸­æ›´æ”¹è¿‡çš„å†…å®¹ã€‚é€šè¿‡æ‰“å¼€Groupsé¢æ¿Toolsé€‰é¡¹Check Content Update Restrictionsçª—å£ï¼Œåªè¦Groupå†…æŸä¸ªèµ„æºæœ‰ä¿®æ”¹ï¼Œå°±ä¼šå‡ºç°åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­ã€‚ä½†æ˜¯å¦‚æœç©å®¶æœ¬åœ°ç”¨æˆ·ç›®å½•çš„bundleä¸å°å¿ƒæŸåäº†æˆ–è€…éœ€è¦å›é€€èµ„æºç‰ˆæœ¬ï¼Œç›´æ¥ä½¿ç”¨Unityè¿™ä¸ªæ–¹æ¡ˆå°±ä¸å¥½åŠã€‚
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/modify_update_remote.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;ä¿®æ”¹è¿‡çš„groupåˆ—è¡¨.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;â€ƒâ€ƒç”±äºæˆ‘å¼€äº†æ‰‹åŠ¨æ›´æ–°Catalogï¼ŒåŒæ—¶è‡ªå·±ç»´æŠ¤äº†ä¸€å¥—å®Œæ•´çš„æ›´æ–°åˆ—è¡¨ï¼Œå°±ç¦ç”¨äº†è¿™æ¡å±æ€§ã€‚&lt;/p&gt;

&lt;h3 id=&quot;downloads&quot;&gt;Downloads&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒè‡ªå®šä¹‰è¯ä¹¦ã€ä¸‹è½½å¹¶å‘æ•°é‡ã€è¶…æ—¶ç­‰è®¾ç½®&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;(1) Custom certificate handler&lt;/strong&gt;ï¼šè‡ªå®šä¹‰è¯ä¹¦ç±»è¦å®ç°CertificateHandlerã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(2) Max Concurrent Web Requests&lt;/strong&gt;ï¼šè®¾ç½®Webå¹¶å‘ä¸‹è½½æ•°é‡å®˜æ–¹å»ºè®®2-4ä¸ªã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(3) Catalog Download Timeout&lt;/strong&gt;ï¼šè¶…æ—¶è®¾ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;builds&quot;&gt;Builds&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ„å»ºABåŒ…çš„ä¸€äº›è®¾ç½®
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/setting_build.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Buildè®¾ç½®.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;(1) Build Addressables on Player Build&lt;/strong&gt;ï¼š æ‰“APKçš„æ—¶å€™ä¸€èµ·å…ˆæ‰“Assetbundleåœ¨æ‰“APKï¼Œè¿™é‡Œæˆ‘å…³äº†ä¸éœ€è¦ï¼Œä¸€èˆ¬æ˜¯å•ç‹¬å‡ºBundleèµ„æºçš„ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(2) Ignore Invalid/Unsupported Files in Build&lt;/strong&gt;ï¼š æ„å»ºæ—¶æ’é™¤æ— æ•ˆæ–‡ä»¶ï¼Œå¦‚æœæœªå¯ç”¨å¯èƒ½å¯¼è‡´ä¸­æ–­æ„å»ºã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(3) Unique Bundle IDs&lt;/strong&gt;ï¼š æŒ‡å®šæ¯ä¸ªAssetbundleç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(4) Contiguous Bundles&lt;/strong&gt;ï¼š å®šä¹‰çš„Assetbundleå†…å®¹å¸ƒå±€ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(5) Non-Recursive Dependency Calculation&lt;/strong&gt;ï¼š å¾ªç¯ä¾èµ–è®¡ç®—è€—è´¹æ—¶é—´ï¼Œå¼€å¯åªè®¡ç®—ç›´æ¥ä¾èµ–ã€‚(æŸäº›æƒ…å†µä¸‹æ‰€æœ‰è®¾ç½®éƒ½æ­£ç¡®å´æ— æ³•åŠ è½½Bundleï¼Œä¸€èˆ¬æ˜¯Groupå†…çš„èµ„æºä¾èµ–æœ‰é—®é¢˜ã€‚)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(6) Strip Unity Version From AssetBundles&lt;/strong&gt;ï¼š è£å‰ªAssetbundleå†…çš„unityç‰ˆæœ¬å·ï¼Œå¯ç”¨ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(7) Disable Visible Sub Asset Representations&lt;/strong&gt;ï¼š ä¸ç›´æ¥æ‹–æ‹½å¼•ç”¨æŸä¸ªspriteï¼Œå¼€å¯è¯¥é¡¹å¯ä»¥åŠ å¿«æ„å»ºæ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;build-and-play-mode-scripts&quot;&gt;Build And Play Mode Scripts&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒæ„å»ºABçš„ä¸€äº›è„šæœ¬é…ç½®ï¼Œå¯ä»¥å®ç°IDataBuilderæ¥å£è‡ªå®šä¹‰æ‰“åŒ…æµç¨‹ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/build_play_scripts.png&quot; width=&quot;250&quot; /&gt;&lt;body&gt;&lt;/body&gt;
        &lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/play_mode.png&quot; width=&quot;250&quot; /&gt;&lt;body&gt;&lt;/body&gt;
        &lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/build_mode.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Build Bundleè®¾ç½®.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;p&gt;â€ƒâ€ƒPlay modeæŒ‡å®šåœ¨ç¼–è¾‘å™¨æ˜¯æ€ä¹ˆåŠ è½½èµ„æºï¼Œæœ¬åœ°æµ‹è¯•ç”¨&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;(1) Fast Mode&lt;/strong&gt;ï¼š ä¸æ‰“åŒ…ç›´æ¥åŠ è½½æ–‡ä»¶ï¼Œé€Ÿåº¦å¿«ä½†åœ¨Profilerä¸­æä¾›çš„ä¿¡æ¯è¾ƒå°‘&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(2) Virtual Mode&lt;/strong&gt;ï¼š è™šæ‹Ÿç¯å¢ƒæ¨¡æ‹Ÿç±»ä¼¼äºAssetBundleçš„è¡Œä¸ºï¼Œæ— éœ€æ‰“åŒ…&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(3) Packed Mode&lt;/strong&gt;ï¼š ä»å®é™…çš„AssetBundleä¸­åŠ è½½èµ„æºï¼ŒçœŸå®ç¯å¢ƒ&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;addressablegroupsåˆ†æ&quot;&gt;AddressableGroupsåˆ†æ&lt;/h2&gt;

&lt;h3 id=&quot;groupé…ç½®&quot;&gt;Groupé…ç½®&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒAssetGroupsæ˜¯Addressableç»„ç»‡bundleçš„ä¸€ç§å®¹å™¨ï¼Œå¿…é¡»è¦æŠŠèµ„æºåŠ å…¥Groupæ‰èƒ½å‚ä¸æ‰“åŒ…ã€‚
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/group_view.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Groupè®¾ç½®.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;(1) Buildin&amp;amp;Load Path&lt;/strong&gt;ï¼šé€‰æ‹©Localæˆ–Remoteï¼Œä¸€èˆ¬é€‰RemotRemoteeä»¥æ”¯æŒçƒ­æ›´ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰èµ„æºéƒ½å¯èƒ½ä¼šçƒ­æ›´ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(2) AB Compression&lt;/strong&gt;ï¼šæŒ‡å®šABåŒ…ç”¨å“ªç§å‹ç¼©ç®—æ³•ï¼šä¸å‹ç¼©ã€LZ4ã€LZMAã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(3) Include In Build&lt;/strong&gt;ï¼š å¯ç”¨æ‰èƒ½æ„å»ºè¯¥ç»„å†…æ‰€åŒ…å«çš„Asset Entryã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(4) Force Unique Provider&lt;/strong&gt;ï¼šæ˜¯å¦æŒ‡å®šå”¯ä¸€çš„GroupåŠ è½½å®ä¾‹ï¼Œå¦‚æœGroupæœ‰ä¸Šç™¾ä¸ªå°±ä¸è¦å‹¾é€‰äº†ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(5) Use AB Cache&lt;/strong&gt;ï¼šä»è¿œç¨‹ä¸‹è½½çš„ABæ˜¯å¦ä½¿ç”¨AAçš„ç¼“å­˜æœºåˆ¶ã€‚(è¿™ä¸ªç¼“å­˜åŒ…æ‹¬ABèµ„æºå’Œå½“å‰æ›´æ–°æ—¶çš„AAç‰ˆæœ¬ä¿¡æ¯)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(6) Use UnityWebRequest for Local Asset Bundles&lt;/strong&gt;ï¼šå¯¹äºæœ¬åœ°çš„ABèµ„æºæ˜¯å¦ä½¿ç”¨UnityWebRequestAssetBundle GetAssetBundleåŠ è½½ï¼Œè¿˜æ˜¯ä½¿ç”¨AssetBundle LoadFromFileAsyncåŠ è½½ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(7) Request Timeout&lt;/strong&gt;ï¼šè®¾ç½®ä¸‹è½½è¶…æ—¶ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(8) Use Http Chunked Transfer&lt;/strong&gt;ï¼šå¼€å¯åˆ†å—ä¼ è¾“ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(9) Http Redirect Limit&lt;/strong&gt;ï¼šè®¾ç½®é‡å®šå‘æ¬¡æ•°ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(9) Retry Count&lt;/strong&gt;ï¼šè®¾ç½®ä¸‹è½½å¤±è´¥é‡è¯•æ¬¡æ•°ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(10) Include Addresses in Catalog&lt;/strong&gt;ï¼š ç¦ç”¨åæ„å»ºbundleæ—¶ä¸ä¼šåŒ…å«åœ¨catalog.jsonã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(11) Include GUIDs in Catalog&lt;/strong&gt;ï¼š ä½¿ç”¨AssetReferenceæ‹–æ‹½å¼•ç”¨å°±å¾—å¯ç”¨ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(12) Include Labels in Catalog&lt;/strong&gt;ï¼š ä¸é€šè¿‡labelæ ‡ç­¾åŠ è½½èµ„æºï¼Œæˆ‘è¿™é‡Œä¸ä½¿ç”¨labelå»åŠ è½½èµ„æºã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(13) Internal Asset Naming Mode&lt;/strong&gt;ï¼šABåŒ…å†…èµ„æºçš„IDæ ‡è¯†æ–¹å¼ï¼Œæœ‰ä¸‰ç§ï¼šFull Path(èµ„æºå…¨è·¯å¾„)ã€Filename(èµ„æºå)ã€GUID(unityå¯¼å…¥æ—¶è®¾ç½®çš„ID)ã€Dynamic(å®˜æ–¹æ¨èä½¿ç”¨)ã€‚è¿™ä¸ªæ¨¡å¼å½±å“Abçš„CRCå’ŒHASHï¼Œè®¾ç½®è¯¥æ¨¡å¼ä¸­ä»»æ„ä¸€ç§ä¹Ÿä¸ä¼šå½±å“æˆ‘ä»¬ä»ABåŒ…å†…è¯»å–æŸä¸ªèµ„æºã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(14) Cache Clear Behavior&lt;/strong&gt;ï¼šè®¾ç½®APKåŒ…å†…ç¼“å­˜AAä¸‹è½½çš„ABèµ„æºæ—¶é•¿ï¼Œåˆ°æœŸè‡ªåŠ¨æ¸…é™¤ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(15) Bundle Mode&lt;/strong&gt;ï¼šæ„å»ºABçš„æ¨¡å¼ï¼Œæœ‰ä¸‰ç§ï¼šGroupå†…æ‰€æœ‰èµ„æºæ‰“æˆä¸€ä¸ªABã€Groupå†…èµ„æºåˆ†åˆ«å•ç‹¬æ‰“æˆABã€æ ¹æ®ç»„å†…æ ‡ç­¾æ‰“åŒ…ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(16) Bundle Naming Mode&lt;/strong&gt;ï¼šè®¾ç½®ABåï¼Œæœ‰ä¸‰ç§ï¼šGroupåã€ Groupåè¿½åŠ HASHã€ä½¿ç”¨Bundleçš„HASH(æ¨è-ä½†è¦åšç»„åä¸HASHä¹‹é—´çš„æ˜ å°„ï¼ŒåŠ è½½Bundleå…ˆæ‹¿åˆ°ç»„åæ˜ å°„çš„HASHå»æ‰¾BundleåŠ è½½)ã€ä½¿ç”¨Groupç»„åçš„å­—ç¬¦HASHã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(17) Asset Load Mode&lt;/strong&gt;ï¼šèµ„æºåŠ è½½æ¨¡å¼ï¼Œæœ‰ä¸¤ç§ï¼šä»bundleè¯·æ±‚åŠ è½½çš„èµ„æºåŠå…¶ä¾èµ–ä¸€èµ·åŠ è½½ã€bundleå†…æ‰€æœ‰çš„èµ„æºå…¨éƒ¨åŠ è½½ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(18) Asset Provider&lt;/strong&gt;ï¼šä»Bundleå†…åŠ è½½Assetï¼Œå®˜æ–¹æ¨èä½¿ç”¨è‡ªå¸¦çš„Asset from Bundle Provider,ä¹Ÿå¯ä»¥æ ¹æ®Groupå†…æ–‡ä»¶ç±»å‹é€‰æ‹©Jsonã€Spritesç­‰providerã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(19) Asset Bundle Provider&lt;/strong&gt;ï¼šåŠ è½½AssetBundleæ¥å£ï¼Œå®˜æ–¹æ¨èAssetBundle Providerï¼Œæˆ–è€…è‡ªå·±å®ç°ä¸€å¥—Provider(å¯ä»¥å®ç°åŠ å¯†è§£å¯†)ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;content-update&quot;&gt;Content Update&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;(1) Prevent Updates&lt;/strong&gt;ï¼šæ˜¯å¦å¯ç”¨ç¦æ­¢æ›´æ–°ç§»åŠ¨Assetã€‚å½“ä½¿ç”¨äº†AAè‡ªå¸¦çš„&lt;strong&gt;Check for Content Update Restrictions tool&lt;/strong&gt;ï¼Œä¸å¯ç”¨æ—¶å¦‚æœç»„å†…æœ‰èµ„æºå‘ç”Ÿå˜æ›´ï¼Œè¿™ä¸ªå·¥å…·ä¼šæŠŠå˜æ›´çš„èµ„æºç§»åŠ¨åˆ°éœ€è¦ç”Ÿæˆçš„Remote Groupå†…ã€‚(æˆ‘æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªå·¥å…·ä¹Ÿæ²¡æœ‰å¯ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œç»„å†…çš„èµ„æºç§»åŠ¨å®ç°äº†ä¸€ä¸ªè„šæœ¬è§„åˆ™æ£€æŸ¥)ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;group-schemaé…ç½®&quot;&gt;Group Schemaé…ç½®&lt;/h3&gt;

&lt;p&gt;â€ƒâ€ƒBundledAssetGroupSchemaä¸»è¦æ˜¯Groupé¢æ¿é…ç½®ï¼Œä¸€ä¸ªGroupä¼šç”Ÿæˆä¸¤ä»½Schemaï¼Œ&lt;strong&gt;#GroupName_BundledAssetGroupSchema&lt;/strong&gt;ã€&lt;strong&gt;#GroupName_BundledAssetGroupSchema&lt;/strong&gt;ã€‚
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;&lt;/p&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/group_serialize.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Group Debugæ¨¡å¼.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/schema_serialize1.png&quot; width=&quot;250&quot; /&gt;&lt;body&gt;&lt;/body&gt;
        &lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2024/month7/addressable_system/schema_serialize2.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Schema Debugæ¨¡å¼.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;â€ƒâ€ƒé€šè¿‡Debugæ¨¡å¼å¯ä»¥çœ‹åˆ°Groupä¸»è¦æ˜¯ä¿å­˜äº†&lt;strong&gt;SerializeEntries&lt;/strong&gt;èµ„æºã€&lt;strong&gt;Schema&lt;/strong&gt;é…ç½®ï¼Œæ‰€ä»¥é…ç½®å®é™…ä¸Šæ˜¯ç”±Schemaä¿å­˜çš„ã€‚åœ¨å†™ä»£ç åˆ›å»ºGroupæ—¶ï¼Œè¦æŠŠèµ„æºåŠ å…¥åˆ°Groupå†…ã€é…ç½®å†™åˆ°Schemaå†…ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-CSHARP&quot;&gt;//...
group = settings.CreateGroup(key, i == 0, false, false, null);
AddressableBuildUtil.CheckSchemaValue(group, _keyIdArray);
AddressableBuildUtil.CheckUpdateSchema(group);
//...

SetSchemaBuildLoadPath(schema, keyIds);
schema.ChunkedTransfer = true;
//disable crc ä½¿ç”¨md5ä»£æ›¿
schema.UseAssetBundleCrc = false;
schema.UseAssetBundleCrcForCachedBundles = false;
//disable guid
schema.IncludeGUIDInCatalog = false;
schema.IncludeLabelsInCatalog = false;
schema.RedirectLimit = 2;
schema.RetryCount = 2;
schema.Timeout = 30;

SetBundleCache(schema);
//load asset by name
SetSchemaNameMode(schema, BundledAssetGroupSchema.AssetNamingMode.Filename);
//pack modeæ‰“åŒ…æ¨¡å¼
SetSchemaPackMode(schema, BundledAssetGroupSchema.BundlePackingMode.PackTogetherByLabel);
//bundle name
SetSchemaNameStyle(schema, BundledAssetGroupSchema.BundleNamingStyle.FileNameHash);
//bundle id
SetSchemaBundleIdMode(schema, BundledAssetGroupSchema.BundleInternalIdMode.GroupGuid);
//bundle compression
SetSchemaBundleCompressionMode(schema, BundledAssetGroupSchema.BundleCompressionMode.LZ4);

//è®¾ç½®Schema Valueä¼šè§¦å‘Group dirtyé€šçŸ¥ï¼Œè¦åˆ¤æ–­å€¼æœ‰æ²¡æœ‰å˜å†è®¾ç½®
if (schema.BundleMode ~= packMode)
{
    schema.BundleMode = packMode;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;assetgrouptemplates&quot;&gt;AssetGroupTemplates&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒGroupæ¨¡ç‰ˆé…ç½®,å¯ä»¥é¢„å…ˆè®¾ç½®å¥½Groupçš„é…ç½®ï¼Œä½¿ç”¨è¯¥æ¨¡ç‰ˆåˆ›å»ºGroupã€‚&lt;/p&gt;

&lt;h2 id=&quot;databuilders&quot;&gt;DataBuilders&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒå­˜æ”¾æ‰“åŒ…è„šæœ¬å’ŒEditoræµ‹è¯•åŠ è½½è„šæœ¬çš„ç›®å½•ï¼ŒAAæä¾›äº†å››ä¸ªè‡ªå¸¦è„šæœ¬ã€‚&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;(1) BuildScriptFastMode&lt;/strong&gt;ï¼šå¯¹åº”&lt;strong&gt;Use Asset Database (fastest)&lt;/strong&gt;æŒ‰é’®ï¼Œå¿«é€ŸåŠ è½½æ¨¡å¼ï¼Œç±»ä¼¼AssetdataBaseåŠ è½½èµ„æºã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(2) BuildScriptPackedMode&lt;/strong&gt;ï¼šå¯¹åº”&lt;strong&gt;Default Build Script&lt;/strong&gt;æ‰“åŒ…æŒ‰é’®ï¼Œé»˜è®¤çš„æ‰“ABåŒ…è„šæœ¬ï¼Œå¯ä»¥æ ¹æ®è¿™ä¸ªè„šæœ¬ä¿®æ”¹è‡ªå·±çš„æ‰“åŒ…å‰åæµç¨‹ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(3) BuildScriptPackedPlayMode&lt;/strong&gt;ï¼šå¯¹åº”&lt;strong&gt;Use Existing Build(#Platform)&lt;/strong&gt;ï¼ŒçœŸå®å®Œæ•´çš„ABåŠ è½½åœºæ™¯æ¨¡å¼ï¼Œåœ¨Editoræµ‹è¯•ABæ˜¯å¦æ­£ç¡®ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;(4) BuildScriptVirtualMode&lt;/strong&gt;ï¼šå¯¹åº”&lt;strong&gt;Simulate Groups (advanced)&lt;/strong&gt;æŒ‰é’®ï¼Œä¸ç”¨æ‰“ABåŒ…å¯æ¨¡æ‹ŸåŠ è½½ABæ¨¡å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Wed, 10 Jul 2024 20:00:00 +0000</pubDate>
        <link>https://www.damonc.top/unity3d/Unity_Addressable_Editor.html</link>
        <guid isPermaLink="true">https://www.damonc.top/unity3d/Unity_Addressable_Editor.html</guid>
        
        <category>Addressable System</category>
        
        
        <category>Unity3d</category>
        
      </item>
    
      <item>
        <title>è§†å·®å’Œæ³•çº¿ã€é«˜åº¦å›¾å›é¡¾(ç¿»è¯‘äºŒå)</title>
        <description>&lt;p&gt;ç”±äºè§†è§’çš„åŸå› ï¼Œå½“è°ƒæ•´æ‘„åƒæœºä½ç½®æ—¶ï¼Œè§‚å¯Ÿåˆ°çš„äº‹ç‰©çš„ç›¸å¯¹ä½ç½®ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ç§è§†è§‰ç°è±¡ç§°ä¸ºè§†å·®ã€‚åœ¨åç«è½¦é«˜é€Ÿè¡Œé©¶çœ‹çª—å¤–çš„æ™¯ç‰©ï¼Œé™„è¿‘çš„ç‰©ä½“çœ‹èµ·æ¥å¾ˆå¤§å¹¶ä¸”ç§»åŠ¨å¾ˆå¿«ï¼Œè€Œè¿œå¤„çš„èƒŒæ™¯çœ‹èµ·æ¥å¾ˆå°å¹¶ä¸”ç§»åŠ¨è¾ƒæ…¢ã€‚æ¸²æŸ“æ—¶ï¼Œç›¸æœºä½¿ç”¨é€è§†æ¨¡å¼æ—¶ï¼Œä¹Ÿä¼šå‡ºç°è§†å·®ã€‚&lt;/p&gt;

&lt;h2 id=&quot;è§†å·®çº¹ç†&quot;&gt;è§†å·®çº¹ç†&lt;/h2&gt;

&lt;p&gt;ä¹‹å‰ç¿»è¯‘ä½¿ç”¨è¿‡æ³•çº¿è´´å›¾å°†è¡¨é¢ä¸è§„åˆ™æ„Ÿæ·»åŠ åˆ°å¹³æ»‘è¡¨é¢ã€‚ å®ƒä¼šå½±å“ç…§æ˜ï¼Œä½†ä¸ä¼šå½±å“è¡¨é¢çš„å®é™…å½¢çŠ¶ã€‚ å› æ­¤ï¼Œè¯¥æ•ˆæœè§†å·®ä¸æ˜æ˜¾ï¼Œé€šè¿‡å®ç°æ³•çº¿è´´å›¾åŸºäºè§†é‡æ·±åº¦çš„å¹»è§‰æœ‰è®¸å¤šé™åˆ¶ã€‚è¿™ä¸€ç¯‡çš„ç›®çš„å°±æ˜¯è§£å†³è¯¥é™åˆ¶ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ³•çº¿è´´å›¾æ•ˆæœå›é¡¾&quot;&gt;æ³•çº¿è´´å›¾æ•ˆæœå›é¡¾&lt;/h3&gt;

&lt;p&gt;ä¸‹é¢ç»™å‡ºè®¸å¤šalbedo map å’Œ normal mapå·®å¼‚å¯¹æ¯”ï¼š&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200615181223145-1229624244.png&quot; width=&quot;250&quot; /&gt;&lt;body&gt;&lt;/body&gt;
        &lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200615181223966-473200226.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;albedo map å’Œ normal map.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;å¦‚æœæ²¡æœ‰æ³•çº¿è´´å›¾ï¼Œè¡¨é¢çœ‹èµ·æ¥å¾ˆå¹³å¦ã€‚ æ·»åŠ æ³•çº¿è´´å›¾ä¼šä½¿å®ƒçœ‹èµ·æ¥å¥½åƒå…·æœ‰ä¸è§„åˆ™çš„è¡¨é¢ã€‚ ä½†æ˜¯ï¼Œé«˜åº¦æµ·æ‹”å·®å¼‚çœ‹èµ·æ¥ä¸æ˜æ˜¾ã€‚ å½“ä»å…¥å°„è§†è§’ä¸è¡¨é¢çš„å¤¹è§’è¶Šè¶‹äº0ï¼Œé«˜åº¦å·®è¶Šä¸æ˜æ˜¾ã€‚å¦‚æœé«˜ç¨‹å·®å¼‚è¾ƒå¤§ï¼Œåˆ™è¡¨é¢ç‰¹å¾çš„ç›¸å¯¹è§†è§‰ä½ç½®åº”ç”±äºè§†å·®è€Œå‘ç”Ÿå¾ˆå¤§å˜åŒ–ï¼Œä½†ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ æˆ‘ä»¬çœ‹åˆ°çš„è§†å·®æ˜¯å¹³å¦çš„è¡¨é¢ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200616191420845-1957506928.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;å¹³å¦çš„è§†è§’.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;è™½ç„¶å¯ä»¥å¢åŠ æ³•çº¿è´´å›¾çš„å¼ºåº¦ï¼Œä½†è¿™ä¸ä¼šæ”¹å˜è§†å·®ã€‚åŒæ ·ï¼Œå½“æ³•çº¿è´´å›¾å˜å¾—å¤ªå¼ºæ—¶ï¼Œå®ƒä¼šçœ‹èµ·æ¥å¾ˆå¥‡æ€ªã€‚å®ƒå½±å“äº†å¹³å¦è¡¨é¢çš„å…‰çº¿çš„æ˜æš—å˜æ¢ï¼Œè€Œè§†å·®æ•ˆæœå®ƒä»¬ç¡®å®æ˜¯å¹³çš„ã€‚æ‰€ä»¥æ³•çº¿è´´å›¾åªé€‚ç”¨äºå°çš„å˜åŒ–ï¼Œä½†ä¸ä¼šè¡¨ç°å‡ºæ˜æ˜¾çš„è§†å·®ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200616191421654-712293996.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;æ³•çº¿è´´å›¾çš„å…‰çº¿å˜åŒ–.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;è¦è·å¾—çœŸæ­£çš„æ·±åº¦è§†å·®æ„Ÿï¼Œ&lt;strong&gt;é¦–å…ˆ&lt;/strong&gt;éœ€è¦ç¡®å®šæ·±åº¦åº”è¯¥æ˜¯å¤šå°‘ã€‚æ³•çº¿è´´å›¾ä¸åŒ…å«è¿™äº›ä¿¡æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé«˜åº¦å›¾ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªåŸºäºé«˜åº¦ä¿¡æ¯çš„å‡è§†å·®æ•ˆæœï¼Œå°±åƒæ³•çº¿è´´å›¾åˆ›å»ºä¸€ä¸ªå‡æ–œç‡ä¸€æ ·ã€‚ä¸‹é¢çš„è´´å›¾ä¹Ÿç§°å®ƒæ˜¯ç°åº¦å›¾ï¼Œé»‘è‰²ä»£è¡¨æœ€ä½ç‚¹ï¼Œç™½è‰²ä»£è¡¨æœ€é«˜ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªè´´å›¾æ¥åˆ›å»ºä¸€ä¸ªè§†å·®æ•ˆæœï¼Œä¹Ÿç§°ä¸ºè§†å·®å›¾ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200616191422519-1710373191.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;é«˜åº¦å›¾.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ç¡®ä¿åœ¨å¯¼å…¥æ—¶ç¦ç”¨sRGB(é¢œè‰²çº¹ç†)ï¼Œè¿™æ ·åœ¨ä½¿ç”¨çº¿æ€§ç©ºé—´æ¸²æŸ“æ—¶æ•°æ®å°±ä¸ä¼šè¢«å¼„ä¹±&lt;/p&gt;

&lt;h3 id=&quot;shaderå‚æ•°&quot;&gt;Shaderå‚æ•°&lt;/h3&gt;

&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨è§†å·®è´´å›¾ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºå®ƒæ·»åŠ ä¸€ä¸ªå±æ€§åˆ°ç€è‰²å™¨ã€‚ä¹Ÿä¼šç»™å®ƒä¸€ä¸ªå¼ºåº¦å‚æ•°æ¥ç¼©æ”¾æ•ˆæœã€‚å› ä¸ºè§†å·®æ•ˆæœç›¸å½“å¼ºï¼Œæˆ‘ä»¬å°†å…¶èŒƒå›´è®¾ç½®ä¸º(0 , 0.1)ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NoScaleOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxMap&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Parallax&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;black&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Parallax Strength&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NoScaleOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_OcclusionMap&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Occlusion&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;white&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;_OcclusionStrength&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Occlusion Strength&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è§†å·®è´´å›¾æ˜¯ä¸€ä¸ªç€è‰²å™¨ç‰¹æ€§ï¼Œæˆ‘ä»¬å°†å¯ç”¨__PARALLAX_MAP_å…³é”®å­—ã€‚å°†å¿…éœ€çš„ç¼–è¯‘å™¨æŒ‡ä»¤æ·»åŠ åˆ°base passã€additive passå’Œdeferred passã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#pragma shader_feature _NORMAL_MAP
#pragma shader_feature _PARALLAX_MAP
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ä¸ºä»€ä¹ˆä¸åœ¨ShadowCasterå¢åŠ è§†å·®è´´å›¾ï¼Ÿ
å½“ä½¿ç”¨albedoè´´å›¾çš„alphaé€šé“çš„é€æ˜åº¦æ—¶ï¼Œè§†å·®è´´å›¾åªä¼šå½±å“é˜´å½±ã€‚å³ä½¿æ˜¯è¿™æ ·ï¼Œåœ¨é˜´å½±è´´å›¾ä¸­çš„è§†å·®æ•ˆæœä¹Ÿå¾ˆéš¾è¢«æ³¨æ„åˆ°ã€‚æ‰€ä»¥å®ƒé€šå¸¸ä¸å€¼å¾—é¢å¤–çš„è®¡ç®—æ—¶é—´ã€‚ä½†æ˜¯å¦‚æœæ„¿æ„ï¼Œä¹Ÿå¯ä»¥å°†å®ƒæ·»åŠ åˆ°é˜´å½±æ–½æ³•è€…é€šé“ä¸­ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸ºäº†è®¿é—®æ–°çš„å±æ€§ï¼Œç»™æˆ‘çš„ç…§æ˜æ·»åŠ ç›¸åº”çš„å˜é‡&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sampler2D&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;sampler2D&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_OcclusionMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_OcclusionStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿè‡ªå®šä¹‰é…ç½®æè´¨ï¼Œåœ¨Extend ShaderGUIæ‰©å±•ä¸­å¢åŠ ç›¸åº”Enableä¸Disanble keyçš„æ–¹æ³•ã€‚&lt;/p&gt;

&lt;div class=&quot;language-cs highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoParallax&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;MaterialProperty&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;FindProperty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;_ParallaxMap&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Texture&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;textureValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;EditorGUI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;BeginChangeCheck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;editor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TexturePropertySingleLine&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;MakeLabel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Parallax (G)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;tex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;FindProperty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;_ParallaxStrength&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EditorGUI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EndChangeCheck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;textureValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;SetKeyword&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;_PARALLAX_MAP&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;textureValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200616191423089-347056836.png&quot; width=&quot;250&quot; /&gt;&lt;/center&gt;

&lt;h3 id=&quot;åæ ‡åŒ¹é…&quot;&gt;åæ ‡åŒ¹é…&lt;/h3&gt;

&lt;p&gt;é€šè¿‡åœ¨fragmentç¨‹åºä¸­è°ƒæ•´çº¹ç†åæ ‡ï¼Œè®©å¹³å¦è¡¨é¢çš„æŸäº›éƒ¨åˆ†çœ‹èµ·æ¥é«˜ä½äº¤é”™ã€‚åˆ›å»ºä¸€ä¸ªåº”ç”¨è§†å·®å‡½æ•°ï¼Œç»™å®ƒä¸€ä¸ªinoutæ’å€¼å™¨å‚æ•°ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ApplyParallax&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;inout&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨fragmentç¨‹åºä½¿ç”¨æ’å…¥çš„æ•°æ®ä¹‹å‰è°ƒç”¨è§†å·®å‡½æ•°ã€‚_ä¼šæœ‰ç‚¹å¼‚å¸¸æ˜¯LODè¡°è½ï¼Œ_å› ä¸ºè¿™å–å†³äºå±å¹•ä½ç½®ã€‚å…ˆä¸è°ƒæ•´è¿™äº›åæ ‡ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;FragmentOutput&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyFragmentProgram&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_SETUP_INSTANCE_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if defined(LOD_FADE_CROSSFADE)
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;UnityApplyDitherCrossFade&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vpos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ApplyParallax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetAlpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if defined(_RENDERING_CUTOUT)
&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;clip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_Cutoff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€šè¿‡ç®€å•åœ°å‘Uåæ ‡æ·»åŠ è§†å·®å¼ºåº¦æ¥è°ƒæ•´çº¹ç†åæ ‡ã€‚åšä¸€æ¬¡åç§»è®¡ç®—&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ApplyParallax&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;inout&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if defined(_PARALLAX_MAP)
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ”¹å˜è§†å·®å¼ºåº¦ä¼šå¯¼è‡´çº¹ç†åç§»ã€‚å¢åŠ Uåæ ‡ä¼šä½¿çº¹ç†å‘è´Ÿçš„Uæ–¹å‘ç§»åŠ¨ï¼ŒVåæ ‡åŒç†ã€‚è¿™çœ‹èµ·æ¥ä¸æ˜¯è§†å·®æ•ˆæœï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸è§†è§’æ— å…³çš„å‡åŒ€ä½ç§»ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012938981-982216259.gif&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;uåæ ‡ç§»åŠ¨.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h3 id=&quot;éšè§†è§’æ–¹å‘ç§»åŠ¨&quot;&gt;éšè§†è§’æ–¹å‘ç§»åŠ¨&lt;/h3&gt;

&lt;p&gt;è§†å·®æ˜¯ç”±ç›¸å¯¹äºè§‚å¯Ÿè€…çš„é€è§†æŠ•å½±ï¼Œæ‰€ä»¥å¿…é¡»æ”¹å˜çº¹ç†åæ ‡ã€‚è¿™æ„å‘³ç€å¿…é¡»åŸºäºè§†å›¾çš„æ–¹å‘æ¥ç§»åŠ¨åæ ‡ï¼Œè€Œè§†å›¾çš„æ–¹å‘å¯¹äºè¡¨é¢ä¸Šæ¯ä¸ªç‰‡æ®µéƒ½æ˜¯ä¸åŒçš„ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192759952-594530144.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;varies across a surface.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;çº¹ç†åæ ‡å­˜åœ¨äºåˆ‡çº¿ç©ºé—´ä¸­ã€‚ä¸ºäº†è°ƒæ•´è¿™äº›åæ ‡ï¼Œéœ€è¦çŸ¥é“è§†å›¾åœ¨åˆ‡çº¿ç©ºé—´ä¸­çš„æ–¹å‘ã€‚è¿™éœ€è¦çŸ©é˜µä¹˜æ³•å¯¹ç©ºé—´è¿›è¡Œè½¬æ¢ã€‚åœ¨fragment-ç¨‹åºå·²ç»æœ‰äº†ä¸€ä¸ªåˆ‡çº¿ç©ºé—´çŸ©é˜µï¼Œä½†æ˜¯å®ƒæ˜¯ç”¨äºä»åˆ‡çº¿ç©ºé—´åˆ°ä¸–ç•Œç©ºé—´çš„è½¬æ¢ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œéœ€è¦ä»å¯¹è±¡ç©ºé—´è½¬åˆ°åˆ‡çº¿ç©ºé—´ã€‚&lt;/p&gt;

&lt;p&gt;è§†å›¾æ–¹å‘å‘é‡å®šä¹‰ä¸ºä»è¡¨é¢åˆ°æ‘„åƒæœºï¼Œéœ€è¦å½’ä¸€åŒ–ã€‚æˆ‘ä»¬å¯ä»¥åœ¨vertexç¨‹åºä¸­ç¡®å®šè¿™ä¸ªå‘é‡ï¼Œè½¬æ¢å®ƒå¹¶å°†å®ƒä¼ é€’ç»™fragmentç¨‹åºã€‚ä½†æ˜¯ä¸ºäº†æœ€ç»ˆå¾—åˆ°æ­£ç¡®çš„æ–¹å‘ï¼Œéœ€è¦æ¨è¿Ÿå½’ä¸€åŒ–ï¼Œç›´åˆ°æ’å€¼å®Œæˆåã€‚æ·»åŠ åˆ‡çº¿ç©ºé—´è§†å›¾æ–¹å‘ä½œä¸ºä¸€ä¸ªæ–°çš„æ’å€¼æˆå‘˜å˜é‡ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if defined(_PARALLAX_MAP)
&lt;/span&gt;        &lt;span class=&quot;kt&quot;&gt;float3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TEXCOORD8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if defined(_PARALLAX_MAP)
&lt;/span&gt;        &lt;span class=&quot;kt&quot;&gt;float3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TEXCOORD8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;å¯„å­˜å™¨æ•°é‡é™åˆ¶æ˜¯å¤šå°‘?
model 1ä¸model 2éƒ½åªæ”¯æŒ8ä¸ªTexture Coordinate Register -&amp;gt;Texcoord[0-7]ã€‚å½“ä½¿ç”¨model 3æ—¶ï¼Œå¯ä»¥ä½¿ç”¨TEXCOORD8ã€‚è‹¥ç¡¬ä»¶ä¸æ”¯æŒmodel 3å…¶æœºèƒ½ä¹Ÿå°±ä¸æ˜¯å¾ˆå¼ºå¤§ï¼Œæ‰€ä»¥ä¸è¦ä½¿ç”¨è§†å·®æ˜ å°„ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;é¦–å…ˆ&lt;/strong&gt;, ä½¿ç”¨meshç½‘æ ¼æ•°æ®ä¸­çš„åŸå§‹é¡¶ç‚¹åˆ‡å‘é‡å’Œæ³•å‘é‡ï¼Œåœ¨é¡¶ç‚¹ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ªä»å¯¹è±¡ç©ºé—´åˆ°åˆ‡çº¿ç©ºé—´çš„è½¬æ¢çŸ©é˜µã€‚å› ä¸ºæˆ‘ä»¬åªç”¨å®ƒæ¥å˜æ¢ä¸€ä¸ªå‘é‡è€Œä¸æ˜¯ä¸€ä¸ªä½ç½®æˆ‘ä»¬ç”¨ä¸€ä¸ª3Ã—3çŸ©é˜µå°±è¶³å¤Ÿäº†ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyVertexProgram&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VertexData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ComputeVertexLightColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;cp&quot;&gt;#if defined (_PARALLAX_MAP)
&lt;/span&gt;        &lt;span class=&quot;kt&quot;&gt;float3x3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectToTangent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float3x3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;cross&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normal&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;ç„¶å&lt;/strong&gt;ï¼Œå¯ä»¥ä½¿ç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ObjSpaceViewDir&lt;/code&gt;å‡½æ•°å¾—åˆ°å¯¹è±¡ç©ºé—´ä¸­é¡¶ç‚¹ä½ç½®çš„è§†å›¾æ–¹å‘ï¼Œå†ç”¨çŸ©é˜µå˜æ¢å®ƒæˆ‘ä»¬å°±å¾—åˆ°äº†æˆ‘ä»¬éœ€è¦çš„åˆ‡çº¿ç©ºé—´ä¸‹è§†å›¾æ–¹å‘ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#if defined (_PARALLAX_MAP)
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;float3x3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectToTangent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float3x3&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;cross&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normal&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mul&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;objectToTangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ObjSpaceViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vertex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//ObjSpaceViewDirå†…éƒ¨å®ç°?&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//ObjSpaceViewDirå‡½æ•°æ˜¯åœ¨UnityCGä¸­å®šä¹‰çš„ã€‚å®ƒå…ˆå°†æ‘„åƒæœºä½ç½®è½¬æ¢åˆ°å¯¹è±¡ç©ºé—´ï¼Œç„¶åå‡å»å¯¹è±¡ç©ºé—´ä¸‹é¡¶ç‚¹ä½ç½®å¾—åˆ°ä¸€ä¸ªä»é¡¶ç‚¹æŒ‡å‘æ‘„åƒæœºçš„å‘é‡ï¼Œæ³¨æ„å®ƒè¿˜æ²¡æœ‰æ ‡å‡†åŒ–.&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;inline&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float3&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ObjSpaceViewDir&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objSpaceCameraPos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mul&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unity_WorldToObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_WorldSpaceCameraPos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objSpaceCameraPos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;æœ€å&lt;/strong&gt;ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ApplyParallaxå‡½æ•°ä½¿ç”¨åˆ‡çº¿ç©ºé—´è§†å›¾æ–¹å‘äº†ã€‚é¦–å…ˆï¼Œå¯¹å®ƒè¿›è¡Œè§„æ ¼åŒ–normalizeï¼ŒæŠŠå®ƒå˜æˆä¸€ä¸ªåˆé€‚çš„æ–¹å‘å‘é‡ã€‚ç„¶åï¼Œæ·»åŠ å®ƒçš„XYç»„ä»¶åˆ°çº¹ç†åæ ‡ï¼Œå†ç”±è§†å·®å¼ºåº¦ç¼©æ”¾ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ApplyParallax&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;inout&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if defined(_PARALLAX_MAP)
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™èƒ½æœ‰æ•ˆåœ°å°†è§†å›¾æ–¹å‘æŠ•å½±åˆ°çº¹ç†è¡¨é¢ä¸Šã€‚å½“ä»¥90åº¦è§’ç›´è§†è¡¨é¢æ—¶ï¼Œåœ¨åˆ‡ç©ºé—´ä¸­çš„è§†å›¾æ–¹å‘ç­‰äºè¡¨é¢æ³•çº¿(0,0,1)ï¼Œè¿™ä¸ä¼šå¯¼è‡´ä½ç§»ã€‚è§†è§’è¶Šæµ…ï¼ŒæŠ•å½±è¶Šå¤§ï¼Œä½ç§»æ•ˆæœä¹Ÿè¶Šå¤§ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192800432-1757806048.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;å½±è§†å›¾æ–¹å‘ç”¨ä½œUVåç§».&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;æ‰€æœ‰è¿™ä¸€åˆ‡çš„å½±å“æ˜¯è¡¨é¢ä¼¼ä¹è¢«æ‹‰å‘ä¸Šçš„åˆ‡çº¿ç©ºé—´ï¼Œçœ‹èµ·æ¥æ¯”å®ƒå®é™…ä¸Šæ›´é«˜ï¼ŒåŸºäºè§†å·®å¼ºåº¦ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012940748-384205609.gif&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;éšæŠ•å½±è§†è§’æ–¹å‘ç§»åŠ¨UV.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h3 id=&quot;åŸºäºé«˜åº¦æ»‘åŠ¨&quot;&gt;åŸºäºé«˜åº¦æ»‘åŠ¨&lt;/h3&gt;

&lt;p&gt;åœ¨åŸºäºé«˜åº¦è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è®©è¡¨é¢çœ‹èµ·æ¥æ›´é«˜ï¼Œä½†å®ƒä»ç„¶æ˜¯ä¸€ä¸ªå‡åŒ€ä½ç§»ã€‚ä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨è§†å·®è´´å›¾æ¥ç¼©æ”¾ä½ç§»ã€‚é‡‡æ ·è´´å›¾ï¼Œä½¿ç”¨å®ƒçš„Gé€šé“ä½œä¸ºé«˜åº¦ï¼Œåº”ç”¨è§†å·®å¼ºåº¦ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è°ƒèŠ‚ä½ç§»ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;tex2D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ParallaxMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012942351-290008046.gif&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;ç”±é«˜åº¦è°ƒæ•´çš„ç§»åŠ¨.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ä½çš„åŒºåŸŸç°åœ¨ä¿æŒä¸å˜ï¼Œè€Œé«˜çš„åŒºåŸŸè¢«å‘ä¸Šæ‹‰ã€‚standard shaderæŠµæ¶ˆäº†è¿™ç§æ•ˆæœï¼Œæ‰€ä»¥ä½çš„åŒºåŸŸä¹Ÿå‘ä¸‹ç§»åŠ¨ï¼Œè€Œåœ¨ä¸­é—´çš„åŒºåŸŸä¿æŒä»–ä»¬åŸæ¥çš„ä½ç½®ã€‚è¿™æ˜¯é€šè¿‡ä»åŸå§‹é«˜åº¦æ•°æ®ä¸­å‡å»å·®å€¼æ¥å®ç°çš„ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;tex2D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ParallaxMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012944095-1997194416.gif&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;è§†å·®è´´å›¾æ•ˆæœ ç”±åˆç†åˆ°è¿‡é‡.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;è¿™å°±äº§ç”Ÿäº†æˆ‘ä»¬æƒ³è¦çš„è§†å·®æ•ˆæœï¼Œä½†å®ƒåªåœ¨ä½å¼ºåº¦ä¸‹æœ‰æ•ˆã€‚ä¸è¶³çš„æ˜¯ä½ç§»ä½ç§»å˜æ¢çš„å¾ˆå¿«ï¼Œä¼šæ’•è£‚è¡¨é¢ã€‚&lt;/p&gt;

&lt;h3 id=&quot;åç§»è§†å·®æ˜ å°„ç®—æ³•&quot;&gt;åç§»è§†å·®æ˜ å°„ç®—æ³•&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„è§†å·®æ˜ å°„æŠ€æœ¯è¢«ç§°ä¸ºå¸¦åç§»é™åˆ¶çš„è§†å·®æ˜ å°„ã€‚æˆ‘ä»¬åªæ˜¯ä½¿ç”¨äº†è§†å›¾æ–¹å‘çš„XYéƒ¨åˆ†ï¼Œå®ƒçš„æœ€å¤§é•¿åº¦æ˜¯1ã€‚å› æ­¤ï¼Œçº¹ç†åç§»é‡æ˜¯æœ‰é™çš„ã€‚è¿™ç§æ•ˆæœä¸é”™ï¼Œä½†ä¸èƒ½ä»£è¡¨æ­£ç¡®çš„é€è§†æŠ•å½±ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ªæ›´ç²¾ç¡®çš„è®¡ç®—åç§»é‡çš„ç‰©ç†æ–¹æ³•æ˜¯å°†é«˜åº¦åœºè§†ä¸ºå‡ ä½•å›¾å½¢è¡¨é¢ä¸‹çš„ä½“ç§¯ï¼Œå¹¶é€šè¿‡å®ƒæ‹æ‘„ä¸€ä¸ªè§†å›¾å°„çº¿ã€‚å…‰çº¿ä»ç›¸æœºå‘å°„åˆ°è¡¨é¢ï¼Œä»ä¸Šé¢è¿›å…¥é«˜åº¦åœºä½“ç§¯ï¼Œå¹¶æŒç»­å‘å°„ç›´åˆ°å®ƒåˆ°è¾¾ç”±åœºå®šä¹‰çš„è¡¨é¢ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœé«˜åº¦åœºå‡åŒ€ä¸ºé›¶ï¼Œé‚£ä¹ˆå°„çº¿å°±ä¼šä¸€ç›´æŒç»­åˆ°ä½“ç§¯çš„åº•éƒ¨ã€‚å®ƒä¸ç‰©ä½“çš„è·ç¦»å–å†³äºå…‰çº¿è¿›å…¥ç‰©ä½“æ—¶çš„è§’åº¦ã€‚å®ƒæ²¡æœ‰é™åˆ¶ã€‚è§’åº¦è¶Šæµ…ï¼Œè¶Šè¿œã€‚æœ€æç«¯çš„æƒ…å†µæ˜¯å½“è§†è§’è¶‹äº0æ—¶ï¼Œå…‰çº¿å°„å‘æ— ç©·å¤§ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192800958-1980748310.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;å…‰çº¿æŠ•å°„åˆ°åº•éƒ¨ï¼Œæœ‰é™ä¸”æ­£ç¡®.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ä¸ºäº†æ‰¾åˆ°åˆé€‚çš„åç§»é‡ï¼Œæˆ‘ä»¬å¿…é¡»ç¼©æ”¾è§†å›¾æ–¹å‘å‘é‡ï¼Œé€šè¿‡é™¤ä»¥å®ƒè‡ªå·±çš„Zåˆ†é‡æ¥ä½¿å®ƒçš„Zåˆ†é‡å˜æˆ1ã€‚å› ä¸ºæˆ‘ä»¬ä»¥åä¸éœ€è¦ç”¨Zï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨Xå’ŒYé™¤ä»¥Zã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è™½ç„¶è¿™æ ·å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ›´æ­£ç¡®çš„æŠ•å½±ï¼Œä½†å®ƒç¡®å®ä¼šä½¿æµ…è§†è§’çš„è§†å·®æ•ˆæœæ¶åŒ–ã€‚standardç€è‰²å™¨é€šè¿‡å¢åŠ 0.42åå·®åˆ°Zå‡è½»æµ…è§†è§’çš„è§†å·®æ•ˆæœæ¶åŒ–ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œä¸ä¼šæ¥è¿‘é›¶ã€‚è¿™æ‰­æ›²äº†é€è§†å›¾ï¼Œä½†ä½¿å·¥ä»¶æ›´æ˜“äºç®¡ç†ã€‚æˆ‘ä»¬å†åŠ ä¸Šè¿™ä¸ªåå·®.&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192802151-218582125.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;è§†å·®è´´å›¾åƒæ ‡å‡†ç€è‰²å™¨.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;é€šè¿‡ä¸Šè¿°å¤šä¸ªæ­¥éª¤ä¿®æ­£å, ç°åœ¨æˆ‘ä»¬çš„ç€è‰²å™¨ä¸æ ‡å‡†ç€è‰²å™¨æ”¯æŒåŒæ ·çš„è§†å·®æ•ˆæœã€‚è§†å·®æ˜ å°„å¯ä»¥åº”ç”¨äºä»»ä½•è¡¨é¢ï¼ŒæŠ•å½±å‡è®¾åˆ‡çº¿ç©ºé—´æ˜¯å‡åŒ€çš„ã€‚æ›²é¢å…·æœ‰å¼¯æ›²çš„åˆ‡çº¿ç©ºé—´ï¼Œå› æ­¤ä¼šäº§ç”Ÿç‰©ç†ä¸Šä¸æ­£ç¡®çš„ç»“æœã€‚åªè¦è§†å·®å¼ºåº¦å’Œæ›²ç‡å¾ˆå°ï¼Œä½ å°±å¯ä»¥æ‘†è„±å®ƒã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192802555-2049613835.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;çƒé¢è§†å·®è´´å›¾.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;åŒæ ·ï¼Œé˜´å½±åæ ‡ä¸ä¼šå—åˆ°è¿™ä¸ªæ•ˆæœçš„å½±å“ã€‚å› æ­¤ï¼Œé˜´å½±åœ¨å¼ºçƒˆçš„è§†å·®çš„ç»„åˆä¸‹çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œå¥½åƒæ¼‚æµ®åœ¨è¡¨é¢ä¸Šã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192803371-1931947503.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;é˜´å½±ä¸å—è§†å·®å½±å“.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h3 id=&quot;parallax-configuration&quot;&gt;Parallax Configuration&lt;/h3&gt;

&lt;p&gt;ä½ ä¸åŒæ„Unityä½¿ç”¨0.42çš„åç§»å€¼å—?æˆ–è€…ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„å€¼ï¼Œè¿˜æ˜¯è®©å®ƒä¿æŒåœ¨0?æˆ–è€…ä½ æƒ³ç”¨åç§»é™åˆ¶ä»£æ›¿å—?å®ƒæ˜¯å¯ä»¥é…ç½®!&lt;/p&gt;

&lt;p&gt;å½“ä½ æƒ³ä½¿ç”¨åç§»é™åˆ¶ï¼Œå®šä¹‰&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PARALLAX_OFFSET_LIMITING&lt;/code&gt;åœ¨ç€è‰²å™¨ã€‚æˆ–è€…ï¼Œé€šè¿‡å®šä¹‰PARALLAX_BIASæ¥è®¾ç½®è¦ä½¿ç”¨çš„åå·®ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ApplyParallax&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;inout&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if defined(_PARALLAX_MAP)
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;cp&quot;&gt;#if !defined(PARALLAX_OFFSET_LIMITING)
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARALLAX_BIAS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å½“æ²¡æœ‰å®šä¹‰æ—¶ï¼Œå‡è®¾åå·®æ˜¯0.42ã€‚åœ¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ApplyParallax&lt;/code&gt; ä¸­å®šä¹‰å®ƒã€‚æ³¨æ„ï¼Œå®å®šä¹‰ä¸å…³å¿ƒå‡½æ•°ä½œç”¨åŸŸï¼Œå®ƒä»¬æ€»æ˜¯å…¨å±€çš„ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#if !defined(PARALLAX_OFFSET_LIMITING)
&lt;/span&gt;    &lt;span class=&quot;cp&quot;&gt;#if !defined(PARALLAX_BIAS)
&lt;/span&gt;        &lt;span class=&quot;cp&quot;&gt;#define PARALLAX_BIAS 0.42
&lt;/span&gt;    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARALLAX_BIAS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ç€è‰²å™¨çš„CGINCLUDEå—æ¥å¾®è°ƒæˆ‘ä»¬çš„è§†å·®æ•ˆæœã€‚æ·»åŠ æ— åå·®å’Œé™åˆ¶åç§»çš„é€‰é¡¹ï¼Œä½†å°†å®ƒä»¬è½¬æ¢ä¸ºæ³¨é‡Šï¼Œä»¥åšæŒé»˜è®¤é€‰é¡¹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;CGINCLUDE&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#define BINORMAL_PER_FRAGMENT
&lt;/span&gt;    &lt;span class=&quot;cp&quot;&gt;#define FOG_DISTANCE
&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//	#define PARALLAX_BIAS 0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//	#define PARALLAX_OFFSET_LIMITING&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ENDCG&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;detail-uv&quot;&gt;Detail UV&lt;/h3&gt;

&lt;p&gt;è§†å·®è´´å›¾å¯ä»¥åœ¨ä¸»è´´å›¾ä¸Šå·¥ä½œï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰æ³¨æ„åˆ°å‰¯è´´å›¾ã€‚æˆ‘ä»¬å¿…é¡»åº”ç”¨çº¹ç†åæ ‡åç§»åˆ°ç»†èŠ‚UVä¸Šã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªåŒ…å«ç½‘æ ¼æ¨¡å¼çš„è¯¦ç»†åœ°å›¾ã€‚å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°éªŒè¯æ•ˆæœæ˜¯å¦æ­£ç¡®åœ°åº”ç”¨äºç»†èŠ‚ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192803893-1797850325.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;ç»†èŠ‚ç½‘æ ¼çº¹ç†.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ä½¿ç”¨è¿™ä¸ªçº¹ç†ä½œä¸ºæè´¨çš„ç»†èŠ‚albedoè´´å›¾ã€‚è®¾ç½®äºŒçº§è´´å›¾çš„å¹³é“ºä¸º10Ã—10ã€‚è¿™è¡¨æ˜ï¼Œç»†èŠ‚ç´«å¤–çº¿ç¡®å®ä»ç„¶ä¸å—å½±å“ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192804491-290326603.png&quot; width=&quot;250&quot; /&gt;&lt;body&gt;&lt;/body&gt;
        &lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192805295-1360127209.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;ç»†èŠ‚UVä¸å—å½±å“.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;Standardä¹Ÿç®€å•åœ°æ·»åŠ äº†UVåç§»åˆ°ç»†èŠ‚UVï¼Œè¿™æ˜¯å­˜å‚¨åœ¨UVæ’å€¼å™¨çš„ZWç»„ä»¶ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;tex2D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ParallaxMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç»†èŠ‚å¯èƒ½æœ‰æ‰€å˜åŒ–ï¼Œä½†æ˜¯å®ƒä»¬è‚¯å®šè¿˜ä¸åŒ¹é…è§†å·®æ•ˆæœã€‚ é‚£æ˜¯å› ä¸ºæˆ‘ä»¬å¹³é“ºäº†äºŒçº§çº¹ç†ã€‚ è¿™æ ·ä¼šå°†ç»†èŠ‚UVç¼©æ”¾10å€ï¼Œä½¿è§†å·®åç§»é‡å˜å¼±åå€ã€‚ æˆ‘ä»¬è¿˜å¿…é¡»å°†ç»†èŠ‚æ‹¼è´´åº”ç”¨åˆ°åç§»é‡ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_DetailTex_ST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å®é™…ä¸Šï¼Œç¼©æ”¾åº”è¯¥ç›¸å¯¹äºä¸»UVå¹³é“ºï¼Œä»¥é˜²å®ƒè¢«è®¾ç½®ä¸º1Ã—1ä»¥å¤–çš„ä¸€äº›ä¸œè¥¿ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DetailTex_ST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_MainTex_ST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192806533-2106069113.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;æ­£ç¡®çš„UV.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h2 id=&quot;ray-marching-å…‰çº¿æ­¥è¿›&quot;&gt;Ray Marching-å…‰çº¿æ­¥è¿›&lt;/h2&gt;

&lt;p&gt;ç„¶è€Œï¼Œé™¤äº†ä¸Šè¿°çš„åç§»è§†å·®æ˜ å°„è¿˜æœ‰å¦å¤–çš„è§†å·®ç®—æ³•ï¼šå‘å°„å°„çº¿ä¸é«˜åº¦åœºä½“ç§¯ç›¸äº¤ï¼Œç¡®å®šå…¶äº¤ç‚¹åœ¨è¡¨é¢ä¸Šçš„ä½ç½®ï¼Œç„¶åå¯¹è¯¥ä½ç½®é‡‡æ ·ã€‚ å®ƒé€šè¿‡åœ¨å°„çº¿è¿›å…¥ä½“ç§¯æ—¶çš„äº¤ç‚¹ï¼Œå¯¹é«˜åº¦å›¾è¿›è¡Œä¸€æ¬¡é‡‡æ ·ã€‚ ä½†æ˜¯ï¼Œå½“çœ‹å‘ä»»æ„ä¸€ä¸ªè§’åº¦æ—¶ï¼Œè¿™å¹¶ä¸èƒ½å‡†ç¡®å‘Šè¯‰å°„çº¿å®é™…ä¸Šä¸é«˜åº¦åœºç›¸äº¤çš„é«˜åº¦ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192807160-2024700857.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;å®é™…ä¸é¢„æµ‹çš„é«˜åº¦å¯¹æ¯”.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;å…ˆå‡è®¾å…¥å£ç‚¹çš„é«˜åº¦ä¸äº¤ç‚¹çš„é«˜åº¦ç›¸åŒï¼Œä½†è¿™å®é™…ä¸Šåªæœ‰åœ¨å…¥å£ç‚¹å’Œäº¤ç‚¹å…·æœ‰ç›¸åŒçš„é«˜åº¦æ—¶æ‰æ˜¯æ­£ç¡®çš„ã€‚å½“åç§»é‡ä¸å¤§ä¸”é«˜åº¦åœºå˜åŒ–ä¸å¤§æ—¶ï¼Œå®ƒçš„æ•ˆæœä»ç„¶å¾ˆå¥½ã€‚ä½†æ˜¯ï¼Œå½“åç§»é‡å¤ªå¤§æˆ–é«˜åº¦å˜åŒ–å¤ªå¿«æ—¶ï¼Œè¯¥ç®—æ³•å°±ä¼šå‡ºç°é—®é¢˜ï¼Œè€Œè¿™å¾ˆå¯èƒ½æ˜¯é”™è¯¯çš„ã€‚è¿™å°±ä¼šé€ æˆè¡¨é¢æ’•è£‚ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæˆ‘ä»¬èƒ½ç®—å‡ºå°„çº¿å®é™…åˆ°è¾¾çš„é«˜åº¦åœºçš„ä½ç½®ï¼Œé‚£ä¹ˆæ€»èƒ½æ‰¾åˆ°çœŸæ­£çš„å¯è§è¡¨é¢ç‚¹ã€‚è¿™ä¸èƒ½é€šè¿‡å•ä¸ªçº¹ç†æ ·æœ¬æ¥å®ç°ï¼Œæˆ‘ä»¬å¿…é¡»æ²¿ç€è§†å›¾å°„çº¿é€æ­¥ç§»åŠ¨ï¼Œå¹¶æ¯æ¬¡éƒ½é‡‡æ ·é«˜åº¦åœºï¼Œç›´åˆ°å°„çº¿åˆ°è¾¾è¡¨é¢ã€‚è¯¥æŠ€æœ¯æ˜¯RayMarchingã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200617192807679-1545265192.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;éšè§†å›¾å°„çº¿å‰è¿›.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;æœ‰å„ç§ä¸åŒçš„è§†å·®è´´å›¾ä½¿ç”¨raymarchingã€‚å¸¸è§çš„æ˜¯é™¡è§†å·®æ˜ å°„_Steep Parallax Mapping_ã€åœ°å½¢æ˜ å°„_Relief Mapping_å’Œè§†å·®é®æŒ¡æ˜ å°„_Parallax Occlusion Mapping_ã€‚ä¸ä½¿ç”¨å•ä¸€çº¹ç†æ ·æœ¬ç›¸æ¯”ï¼Œå®ƒä»¬èƒ½é€šè¿‡é«˜åº¦åœºæ¥åˆ›å»ºæ›´å¥½çš„è§†å·®æ•ˆæœã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä»¬è¿˜å¯ä»¥åº”ç”¨é¢å¤–çš„é˜´å½±å’ŒæŠ€æœ¯æ¥æ”¹è¿›è¯¥ç®—æ³•ã€‚å½“æˆ‘ä»¬åšçš„åŒ¹é…è¿™äº›æ–¹æ³•æ—¶ï¼Œæˆ‘ä¼šè°ƒç”¨å®ƒã€‚&lt;/p&gt;

&lt;h3 id=&quot;è‡ªå®šä¹‰è§†å·®å‡½æ•°&quot;&gt;è‡ªå®šä¹‰è§†å·®å‡½æ•°&lt;/h3&gt;

&lt;p&gt;æ ‡å‡†ç€è‰²å™¨ä»…æ”¯æŒç®€å•çš„åç§»è§†å·®æ˜ å°„ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬è¦åœ¨è‡ªå·±çš„ç€è‰²å™¨ä¸­æ·»åŠ å¯¹è§†å·®å…‰çº¿Ray marchingçš„æ”¯æŒã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜è¦ç»§ç»­æ”¯æŒè¿™ç§ç®€å•æ–¹æ³•ã€‚ ä¸¤è€…éƒ½éœ€è¦é‡‡æ ·heightå­—æ®µï¼Œå› æ­¤å°†é‡‡æ ·ä»£ç è¡Œæ”¾åœ¨å•ç‹¬çš„GetParallaxHeightå‡½æ•°ä¸­ã€‚ è€Œä¸”ï¼Œä¸¤ç§æ–¹æ³•çš„æŠ•å½±è§†å›¾æ–¹å‘å’Œåç§»é‡çš„æœ€ç»ˆåº”ç”¨éƒ½ç›¸åŒã€‚ å› æ­¤ï¼Œå°†åç§»é‡è®¡ç®—ä¹Ÿå•ç‹¬ä¸ºä¸€ä¸ªå‡½æ•°ã€‚ å®ƒä»…éœ€è¦åŸå§‹UVåæ ‡å’Œå·²å¤„ç†çš„è§†å›¾æ–¹å‘ä½œä¸ºå‚æ•°ï¼Œç»“æœè¿”å›è¦åº”ç”¨çš„UVåç§»ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetParallaxHeight&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;tex2D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ParallaxMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ParallaxOffset&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ApplyParallax&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;inout&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if defined(_PARALLAX_MAP)
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;cp&quot;&gt;#if !defined(PARALLAX_OFFSET_LIMITING)
&lt;/span&gt;            &lt;span class=&quot;cp&quot;&gt;#if !defined(PARALLAX_BIAS)
&lt;/span&gt;                &lt;span class=&quot;cp&quot;&gt;#define PARALLAX_BIAS 0.42
&lt;/span&gt;            &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARALLAX_BIAS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ParallaxOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DetailTex_ST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_MainTex_ST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬å°†åº”ç”¨è§†å·®å‡½æ•°å®æ›¿æ¢å¯¹è§†å·®åç§»çš„ç¡¬ç¼–ç è°ƒç”¨ï¼Œä»è€Œä½¿è§†å·®æ–¹æ³•æ›´åŠ çµæ´»ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰å®ƒï¼Œæˆ‘ä»¬å°†å®ƒè®¾ç½®ä¸ºä½¿ç”¨åç§»é‡æ–¹æ³•ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ApplyParallax&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;inout&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if defined(_PARALLAX_MAP)
&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;//...&lt;/span&gt;
        &lt;span class=&quot;cp&quot;&gt;#if !defined(PARALLAX_FUNCTION)
&lt;/span&gt;            &lt;span class=&quot;cp&quot;&gt;#define PARALLAX_FUNCTION ParallaxOffset
&lt;/span&gt;        &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;        &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARALLAX_FUNCTION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DetailTex_ST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_MainTex_ST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸ºRayMarchingæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚ä¸ParallaxOffsetå‡½æ•°ç±»ä¼¼çš„å‚æ•°å’Œè¿”å›ç±»å‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ParallaxOffset&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ParallaxRaymarching&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç°åœ¨å¯ä»¥é€šè¿‡å®šä¹‰_PARALLAX_FUNCTION_æ¥æ”¹å˜ç€è‰²å™¨ä¸­çš„è§†å·®æ–¹æ³•ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_BIAS 0
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//#define PARALLAX_OFFSET_LIMITING&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_FUNCTION ParallaxRaymarching
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ç›¸äº¤è®¡ç®—&quot;&gt;ç›¸äº¤è®¡ç®—&lt;/h3&gt;

&lt;p&gt;ä¸ºäº†æ‰¾åˆ°è§†å›¾å°„çº¿åˆ°è¾¾é«˜åº¦åœºçš„ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å°„çº¿ä¸Šçš„å¤šä¸ªç‚¹è¿›è¡Œé‡‡æ ·å¹¶è®¡ç®—å‡ºåœ¨è¡¨é¢ä¸‹æ–¹çš„ä½ç½®ã€‚ç¬¬ä¸€ä¸ªé‡‡æ ·ç‚¹åœ¨é¡¶éƒ¨ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè¾“å…¥é«˜åº¦é‡ï¼Œå°±åƒä½¿ç”¨åç§»æ–¹æ³•ä¸€æ ·ã€‚æœ€åä¸€ä¸ªé‡‡æ ·ç‚¹å°±æ˜¯å°„çº¿åˆ°è¾¾ä½“ç§¯åº•éƒ¨çš„åœ°æ–¹ã€‚æˆ‘ä»¬ä¼šåœ¨è¿™äº›ç«¯ç‚¹ä¹‹é—´å‡åŒ€åœ°æ·»åŠ é¢å¤–çš„é‡‡æ ·ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;å‡è®¾æ¯æ¡å°„çº¿è¿›è¡Œ10æ¬¡é‡‡æ ·ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å°†å¯¹é«˜åº¦å›¾é‡‡æ ·10æ¬¡è€Œä¸æ˜¯ä¸€æ¬¡ï¼Œæ‰€ä»¥è¿™ä¸æ˜¯ä¸€ä¸ªä¾¿å®œè®¡ç®—æ–¹æ³•ã€‚å› ä¸ºæˆ‘ä»¬ç”¨äº†10ä¸ªæ ·æœ¬ï¼Œæ‰€ä»¥æ­¥é•¿æ˜¯0.1ã€‚è¿™æ˜¯æˆ‘ä»¬æ²¿ç€è§†å›¾å°„çº¿ç§»åŠ¨çš„å› å­ï¼Œä¹Ÿå°±æ˜¯UVåç§»å¢é‡ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ParallaxRaymarching&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸ºäº†åº”ç”¨è§†å·®å¼ºåº¦ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´æ¯ä¸€æ­¥é‡‡æ ·çš„é«˜åº¦ã€‚ä½†æ˜¯ç¼©æ”¾UV deltaä¹Ÿæœ‰åŒæ ·çš„æ•ˆæœï¼Œåªéœ€è¦è®¡ç®—ä¸€æ¬¡ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ— è®ºè§†å·®å¼ºåº¦å¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç»§ç»­ä½¿ç”¨0â€“1ä½œä¸ºé«˜åº¦åœºçš„èŒƒå›´ã€‚ å› æ­¤ï¼Œå°„çº¿çš„ç¬¬ä¸€æ­¥é«˜åº¦å§‹ç»ˆä¸º1ã€‚ä½äºæˆ–é«˜äºè¯¥é«˜åº¦çš„è¡¨é¢ç‚¹çš„é«˜åº¦ç”±é«˜åº¦åœºå®šä¹‰ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//æ­¥é•¿&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//æ­¥é«˜&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç°åœ¨æˆ‘ä»¬è¦æ²¿ç€å°„çº¿è¿­ä»£ã€‚&lt;strong&gt;é¦–å…ˆ&lt;/strong&gt;ï¼Œæ¯ä¸€æ­¥æˆ‘ä»¬éƒ½ä¼šå¢åŠ UVåç§»é‡ã€‚è§†å›¾å‘é‡æŒ‡å‘æ‘„åƒæœºï¼Œä½†æˆ‘ä»¬æ˜¯åœ¨å‘è¡¨é¢ç§»åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å‡å»UV deltaã€‚&lt;strong&gt;ç„¶å&lt;/strong&gt;æˆ‘ä»¬ç”¨æ­¥é«˜æ¥å‡å°æ­¥é•¿ã€‚&lt;strong&gt;ç„¶å&lt;/strong&gt;æˆ‘ä»¬å†æ¬¡å¯¹é«˜åº¦å›¾é‡‡æ ·ã€‚ä½¿ç”¨whileå¾ªç¯é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°é‡‡æ ·å®Œæ¯•ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å½“ç¼–è¯‘æ—¶ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘å™¨è­¦å‘Šå’Œé”™è¯¯ã€‚è¿™ä¸ªè­¦å‘Šå‘Šè¯‰æˆ‘ä»¬åœ¨å¾ªç¯ä¸­ä½¿ç”¨äº†æ¢¯åº¦æŒ‡ä»¤ã€‚è¿™æŒ‡çš„æ˜¯å¾ªç¯ä¸­çš„çº¹ç†é‡‡æ ·ã€‚GPUå¿…é¡»å¼„æ¸…æ¥šä½¿ç”¨å“ªä¸ªmipmapçº§åˆ«ï¼Œå®ƒéœ€è¦æ¯”è¾ƒç›¸é‚»ç‰‡æ®µä½¿ç”¨çš„UVåæ ‡ã€‚åªæœ‰å½“æ‰€æœ‰ç‰‡æ®µæ‰§è¡Œç›¸åŒçš„ä»£ç æ—¶ï¼Œå®ƒæ‰èƒ½å¯¹æ¯”ã€‚å¯¹äºå¾ªç¯æ¥è¯´ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥æå‰ç»ˆæ­¢ï¼Œæ¯ä¸ªç‰‡æ®µéƒ½å¯èƒ½ä¸åŒã€‚å› æ­¤ç¼–è¯‘å™¨å°†å±•å¼€å¾ªç¯ï¼Œè¿™æ„å‘³ç€å®ƒå°†ä¸€ç›´æ‰§è¡Œæ‰€æœ‰9ä¸ªæ­¥éª¤ï¼Œè€Œä¸ç®¡é€»è¾‘æ˜¯å¦å¯ä»¥æå‰åœæ­¢ã€‚ç›¸åï¼Œå®ƒéšåä½¿ç”¨ç¡®å®šæ€§é€»è¾‘é€‰æ‹©æœ€ç»ˆç»“æœã€‚&lt;/p&gt;

&lt;p&gt;ç¼–è¯‘å¤±è´¥æ˜¯å› ä¸ºç¼–è¯‘å™¨æ— æ³•ç¡®å®šå¾ªç¯çš„æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚å®ƒä¸çŸ¥é“è¿™ä¸ªæœ€å¤šæ˜¯9ã€‚é€šè¿‡å°†whileå¾ªç¯è½¬æ¢ä¸ºæ‰§è¡Œé™åˆ¶çš„forå¾ªç¯æ¥æ˜ç¡®è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012945572-448280189.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Raymarching æ­¥è¿›10æ¬¡ æ— åå·®, æ— é™åˆ¶.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ä¸ç®€å•çš„è§†å·®åç§»æ–¹æ³•ç›¸æ¯”ï¼Œè§†å·®æ•ˆæœæ›´åŠ æ˜æ˜¾ã€‚è¾ƒé«˜çš„åŒºåŸŸç°åœ¨ä¹Ÿæ­£ç¡®åœ°é˜»æŒ¡äº†æˆ‘ä»¬åé¢è¾ƒä½åŒºåŸŸçš„è§†é‡ã€‚æˆ‘ä»¬è¿˜å¾—åˆ°äº†æ˜æ˜¾çš„å›¾å±‚ï¼Œæ€»å…±10å±‚ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ›´å¤šæ­¥è¿›&quot;&gt;æ›´å¤šæ­¥è¿›&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªåŸºæœ¬çš„å…‰çº¿è¡Œè¿›æ–¹æ³•æœ€é€‚åˆé™¡å³­çš„è§†å·®è´´å›¾ã€‚æ•ˆæœçš„è´¨é‡æ˜¯ç”±æˆ‘ä»¬çš„æ ·æœ¬åˆ†è¾¨ç‡å†³å®šçš„ã€‚ä¸€äº›æ–¹æ³•æ ¹æ®è§†è§’ä½¿ç”¨å¯å˜çš„æ­¥éª¤ã€‚è¾ƒæµ…çš„è§’åº¦éœ€è¦æ›´å¤šçš„æ­¥é•¿ï¼Œå› ä¸ºå…‰çº¿è¾ƒé•¿ã€‚ä½†æˆ‘ä»¬çš„æ ·æœ¬é‡æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä¼šè¿™æ ·åšã€‚&lt;/p&gt;

&lt;p&gt;æé«˜è´¨é‡çš„æ˜æ˜¾æ–¹æ³•æ˜¯å¢åŠ é‡‡æ ·çš„æ¬¡æ•°ï¼Œå› æ­¤è®©å…¶å¯é…ç½®ã€‚ä½¿ç”¨_PARALLAX_RAYMARCHING_STEPS_ï¼Œé»˜è®¤å€¼ä¸º10ï¼Œè€Œä¸æ˜¯å›ºå®šçš„æ­¥é•¿å’Œè¿­ä»£æ¬¡æ•°ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ParallaxRaymarching&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#if !defined(PARALLAX_RAYMARCHING_STEPS)
&lt;/span&gt;        &lt;span class=&quot;cp&quot;&gt;#define PARALLAX_RAYMARCHING_STEPS 10
&lt;/span&gt;    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARALLAX_RAYMARCHING_STEPS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_ParallaxStrength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARALLAX_RAYMARCHING_STEPS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ç€è‰²å™¨ä¸­æ§åˆ¶æ­¥æ•°ã€‚å¯¹äºçœŸæ­£çš„é«˜è´¨é‡ï¼Œå°†PARALLAX_RAYMARCHING_STEPSå®šä¹‰ä¸º100ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_BIAS 0
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//#define PARALLAX_OFFSET_LIMITING&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_RAYMARCHING_STEPS 100
#define PARALLAX_FUNCTION ParallaxRaymarching
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012948054-536464296.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Raymarching 100æ¬¡é‡‡æ ·.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;è¿™è®©æˆ‘ä»¬çŸ¥é“äº†å®ƒçš„æ•ˆæœèƒ½æœ‰å¤šå¥½ï¼Œä½†å®ƒè®¡ç®—é‡å¤ªå¤§äº†ï¼Œä¸€èˆ¬ä¸é€‚åˆæ‰‹æœºã€‚æ‰€ä»¥æŠŠæ ·æœ¬æ•°è®¾ä¸º10åï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥çœ‹åˆ°è§†å·®æ•ˆæœçœ‹èµ·æ¥è¿ç»­å’Œå¹³æ»‘ã€‚ç„¶è€Œï¼Œç”±è§†å·®é®æŒ¡å¼•èµ·çš„è½®å»“æ€»æ˜¯é”¯é½¿çŠ¶çš„ï¼ŒMSAAå¹¶ä¸èƒ½æ¶ˆé™¤è¿™ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒåªé€‚ç”¨äºå‡ ä½•å›¾å½¢çš„è¾¹ç¼˜ï¼Œè€Œä¸æ˜¯çº¹ç†æ•ˆæœã€‚åªè¦ä¸ä¾èµ–æ·±åº¦ç¼“å†²åŒºï¼Œåå¤„ç†æŠ—é”¯é½¿æŠ€æœ¯èƒ½è§£å†³ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ä¸èƒ½æŒ‰ç‰‡æ®µå†™å…¥æ·±åº¦ç¼“å†²åŒºå—?
è¿™åœ¨è¶³å¤Ÿå…ˆè¿›çš„ç¡¬ä»¶ä¸Šç¡®å®æ˜¯å¯èƒ½çš„ï¼Œä½¿å®ƒèƒ½å¤Ÿæ­£ç¡®åœ°ä¸é«˜åº¦åœºç›¸äº¤å¹¶åº”ç”¨é˜´å½±ã€‚ä¸è¿‡ï¼Œå®ƒè®¡ç®—é‡å¤ªå¤§ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘ä»¬å½“å‰çš„æ–¹æ³•æ˜¯æ²¿ç€å°„çº¿æ­¥è¿›ï¼Œç›´åˆ°åˆ°è¾¾è¡¨é¢ä»¥ä¸‹çš„ç‚¹ï¼Œæˆ–è€…åˆ°è¾¾å°„çº¿æœ«ç«¯å¯èƒ½çš„æœ€ä½ç‚¹ã€‚ç„¶åæˆ‘ä»¬ç”¨UVåç§»å¤„ç†é‚£ä¸ªç‚¹ã€‚ä½†éšè—åœ¨è¡¨é¢ä¹‹ä¸‹çš„è¿™ä¸ªç‚¹ï¼Œå¾ˆå¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚è¿™å°±æ˜¯å¯¼è‡´è¡¨é¢æ’•è£‚çš„åŸå› ã€‚&lt;/p&gt;

&lt;p&gt;å¢åŠ æ­¥é•¿æ•°åªä¼šå‡å°‘æœ€å¤§è¯¯å·®ã€‚ä½¿ç”¨è¶³å¤Ÿçš„æ­¥éª¤ï¼Œé”™è¯¯ä¼šå˜å¾—æ›´å°ï¼Œä»¥è‡³äºæˆ‘ä»¬æ— æ³•å†çœ‹åˆ°å®ƒã€‚æ‰€ä»¥å½“ä¸€ä¸ªè¡¨é¢æ€»æ˜¯ä»è¿œå¤„çœ‹ï¼Œä½ å¯ä»¥ç”¨æ›´å°‘çš„æ­¥éª¤ã€‚è·ç¦»è¶Šè¿‘ï¼Œè§†è§’è¶Šå°ï¼Œéœ€è¦çš„æ ·æœ¬å°±è¶Šå¤šã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012948690-1598196626.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;Raymarching 100æ¬¡é‡‡æ ·.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h3 id=&quot;æ­¥é•¿ä¹‹é—´æ’å€¼&quot;&gt;æ­¥é•¿ä¹‹é—´æ’å€¼&lt;/h3&gt;

&lt;p&gt;æé«˜è´¨é‡çš„ä¸€ç§æ–¹æ³•æ˜¯æ ¹æ®ç»éªŒé¢„æµ‹å…‰çº¿çœŸæ­£åˆ°è¾¾è¡¨é¢çš„ä½ç½®ã€‚æ¯”å¦‚ç¬¬ä¸€æ­¥åœ¨è¡¨é¢ä¹‹ä¸Šï¼Œä¸‹ä¸€æ­¥åœ¨è¡¨é¢ä¹‹ä¸‹ã€‚åœ¨è¿™ä¸¤æ­¥ä¹‹é—´çš„æŸä¸ªç‚¹å°„çº¿ä¸€å®šåˆ°è¾¾äº†è¡¨é¢ã€‚&lt;/p&gt;

&lt;p&gt;ä¸¤ä¸ªå°„çº¿ç‚¹ã€å’Œä¸¤ä¸ªå°„çº¿ç‚¹åˆ°è¡¨é¢æœ€è¿‘çš„ç‚¹ï¼Œèƒ½å®šä¹‰ä¸¤æ¡çº¿æ®µã€‚å› ä¸ºå…‰çº¿å’Œè¡¨é¢ç¢°æ’ï¼Œè¿™ä¸¤æ¡çº¿æ®µä¼šç›¸äº¤ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬è·Ÿè¸ªå‰é¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¾ªç¯ä¹‹åæ‰§è¡Œç›´çº¿äº¤å‰ã€‚æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªä¿¡æ¯æ¥è¿‘ä¼¼å‡ºçœŸæ­£çš„äº¤ç‚¹ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012949277-977122761.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;æ‰§è¡Œç›´çº¿äº¤å‰.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;åœ¨forå¾ªç¯å†…ï¼Œæˆ‘ä»¬å¿…é¡»è·Ÿè¸ªä¹‹å‰çš„UVåç§»é‡ã€æ­¥é•¿é«˜åº¦å’Œè¡¨é¢é«˜åº¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›ç­‰äºå¾ªç¯ä¹‹å‰çš„ç¬¬ä¸€ä¸ªæ ·æœ¬ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;float2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevUVOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevStepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevSurfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨å¾ªç¯ä¹‹åï¼Œæˆ‘ä»¬è®¡ç®—è¿™äº›çº¿çš„äº¤ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ’å€¼ä¹‹é—´çš„å‰ç‚¹å’Œåç‚¹çš„UVåç§»ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevStepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevSurfaceHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;difference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;difference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lerp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prevUVOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;æ•°å­¦åŸç†ï¼š
è¿™ä¸¤ä¸ªçº¿æ®µå®šä¹‰åœ¨ä¸¤ä¸ªæ ·æœ¬æ­¥éª¤ä¹‹é—´çš„ç©ºé—´å†…ã€‚æˆ‘ä»¬å°†è¿™ä¸ªç©ºé—´çš„å®½åº¦è®¾ç½®ä¸º1ã€‚ä»å‰ä¸€æ­¥åˆ°æœ€åä¸€æ­¥çš„ç›´çº¿ç”±ç‚¹(0ï¼Œa)å’Œç‚¹(1ï¼Œb)å®šä¹‰ï¼Œå…¶ä¸­aæ˜¯å‰ä¸€æ­¥çš„é«˜åº¦ï¼Œbæ˜¯åä¸€æ­¥çš„é«˜åº¦ã€‚å› æ­¤ï¼Œå¯ä»¥ç”¨çº¿æ€§å‡½æ•°&apos;v(t) = a + (b - a)t&apos;æ¥å®šä¹‰è§†å›¾çº¿ã€‚åŒæ ·åœ°ï¼Œé¢çº¿ç”±ç‚¹(0ï¼Œc)å’Œ(1ï¼Œd)å®šä¹‰ï¼Œå‡½æ•°&apos;s(t) = hlsl + (d - hlsl)t&apos;ã€‚

äº¤ç‚¹å­˜åœ¨äºs(t) = v(t)&apos;å¤„ã€‚é‚£ä¹ˆtçš„å€¼æ˜¯å¤šå°‘?
c + (d - c)t = a + (b - a)t
(d - c)t - (b - a)t = a - c
(a - c + d - b)t = a - c
t = (a - c) / (a - c + d - b)
æ³¨æ„:a - cæ˜¯åœ¨t = 0å¤„ç›´çº¿é«˜åº¦çš„ç»å¯¹å·®ã€‚d - bæ˜¯t = 1å¤„çš„ç»å¯¹é«˜åº¦å·®ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012950193-51635460.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;çº¿æ®µäº¤ç‚¹.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;å®é™…ä¸Šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ’å€¼å™¨æ¥ç¼©æ”¾æˆ‘ä»¬è¦æ·»åŠ åˆ°ä¸Šä¸€ç‚¹ä¸Šçš„UVåç§»é‡ã€‚å®ƒå¯ä»¥å½’ç»“ä¸ºç›¸åŒçš„ä¸œè¥¿ï¼Œåªæ˜¯ç”¨äº†æ›´å°‘çš„æ•°å­¦ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;difference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevUVOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012951620-360864955.png&quot; width=&quot;250&quot; /&gt;&lt;/center&gt;

&lt;p&gt;æ•ˆæœçœ‹èµ·æ¥å¥½å¤šäº†ã€‚æˆ‘ä»¬ç°åœ¨å‡è®¾è¡¨é¢åœ¨æ ·æœ¬ç‚¹ä¹‹é—´æ˜¯çº¿æ€§çš„ï¼Œè¿™å¯ä»¥é˜²æ­¢æœ€æ˜æ˜¾çš„åˆ†å±‚å‡è±¡ã€‚ç„¶è€Œï¼Œå®ƒä¸èƒ½å¸®åŠ©æˆ‘ä»¬æ£€æµ‹æˆ‘ä»¬æ˜¯å¦é”™è¿‡äº†æ­¥éª¤ä¹‹é—´çš„äº¤é›†ã€‚æˆ‘ä»¬ä»ç„¶éœ€è¦å¾ˆå¤šçš„æ ·æœ¬æ¥å¤„ç†å°çš„ç‰¹å¾ï¼Œè½®å»“å’Œæµ…è§’åº¦ã€‚&lt;/p&gt;

&lt;p&gt;æœ‰äº†è¿™ä¸ªæŠ€å·§ï¼Œæˆ‘ä»¬çš„æ–¹æ³•ç±»ä¼¼äºè§†å·®é®æŒ¡æ˜ å°„ã€‚è™½ç„¶è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹ä¾¿å®œçš„æ”¹è¿›ï¼Œä½†é€šè¿‡å®šä¹‰_PARALLAX_RAYMARCHING_INTERPOLATE_ï¼Œæˆ‘ä»¬è®©å®ƒæˆä¸ºå¯é€‰çš„ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#if defined(PARALLAX_RAYMARCHING_INTERPOLATE)
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevStepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevSurfaceHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;difference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;difference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevUVOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨shaderå†…å®šä¹‰PARALLAX_RAYMARCHING_INTERPOLATEã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_BIAS 0
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//#define PARALLAX_OFFSET_LIMITING&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_RAYMARCHING_STEPS 10
#define PARALLAX_RAYMARCHING_INTERPOLATE
#define PARALLAX_FUNCTION ParallaxRaymarching
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æ­¥é•¿æœç´¢&quot;&gt;æ­¥é•¿æœç´¢&lt;/h3&gt;

&lt;p&gt;é€šè¿‡åœ¨ä¸¤ä¸ªæ­¥é•¿ä¹‹é—´è¿›è¡Œçº¿æ€§æ’å€¼ï¼Œæˆ‘ä»¬å‡å®šè¡¨é¢åœ¨ä¸¤ä¸ªæ­¥é•¿ä¹‹é—´æ˜¯ç¬”ç›´çš„ã€‚ ä½†æ˜¯ï¼Œé€šå¸¸æƒ…å†µå¹¶éå¦‚æ­¤ã€‚ ä¸ºäº†æ›´å¥½åœ°å¤„ç†ä¸è§„åˆ™çš„é«˜åº¦åœºï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ä¸¤ä¸ªæ­¥é•¿ä¹‹é—´æœç´¢å®é™…çš„äº¤ç‚¹ã€‚ æˆ–è‡³å°‘æ¥è¿‘å®ƒã€‚&lt;/p&gt;

&lt;p&gt;å®Œæˆå¾ªç¯åï¼Œä¸è¦ä½¿ç”¨æœ€åçš„åç§»é‡ï¼Œè€Œæ˜¯å°†åç§»é‡è°ƒæ•´åˆ°æœ€åä¸¤ä¸ªæ­¥é•¿çš„ä¸­é—´ä½ç½®ã€‚å¯¹è¯¥ç‚¹çš„é«˜åº¦è¿›è¡Œé‡‡æ ·ã€‚å¦‚æœæˆ‘ä»¬ç»“æŸåœ¨è¡¨é¢ä»¥ä¸‹ï¼Œå‘è¡¨é¢ä¹‹ä¸Šæ–¹å‘ç§»åŠ¨å››åˆ†ä¹‹ä¸€ï¼Œå¹¶å†æ¬¡é‡‡æ ·ã€‚å¦‚æœæˆ‘ä»¬åœ¨è¡¨é¢ä¸Šç»“æŸï¼Œå‘è¡¨é¢ä¹‹ä¸‹æ–¹å‘ç§»åŠ¨å››åˆ†ä¹‹ï¼Œå¹¶å†æ¬¡é‡‡æ ·ã€‚ä¸æ–­é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012952340-10743193.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;è¶Šæ¥è¶Šæ¥è¿‘äº¤ç‚¹.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ä¸Šè¿°æ–¹æ³•æ˜¯äºŒåˆ†æŸ¥æ‰¾çš„ä¸€ä¸ªåº”ç”¨ã€‚å®ƒä¸åœ°å½¢æµ‹ç»˜æ–¹æ³•æœ€åŒ¹é…ã€‚æ¯èµ°ä¸€æ­¥ï¼Œè·¯ç¨‹å‡åŠï¼Œç›´åˆ°åˆ°è¾¾ç›®çš„åœ°ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ç®€å•åœ°åšå›ºå®šæ¬¡æ•°ï¼Œä»¥è¾¾åˆ°é¢„æœŸçš„è§£å†³æ–¹æ¡ˆã€‚ä¸€æ­¥ï¼Œå¾—åˆ°0.5ã€‚ä¸¤æ­¥ï¼Œå¾—åˆ°0.25ã€0.75ã€‚ä¸‰æ­¥ï¼Œæ˜¯0.125ã€0.375ã€0.625ã€0.875ã€‚æ³¨æ„ï¼Œä»ç¬¬äºŒæ­¥å¼€å§‹ï¼Œæ¯æ¬¡é‡‡æ ·æå‡åˆ†çš„è¾¨ç‡å°†ç¿»å€ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†æ§åˆ¶æ˜¯å¦ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œæˆ‘ä»¬å®šä¹‰_PARALLAX_RAYMARCHING_SEARCH_STEPS_ã€‚é»˜è®¤æƒ…å†µä¸‹å°†å…¶è®¾ç½®ä¸ºé›¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æ ¹æœ¬ä¸è¿›è¡Œæœç´¢ã€‚å¦‚æœå®ƒè¢«å®šä¹‰ä¸ºå¤§äº0ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿ç”¨å¦ä¸€ä¸ªå¾ªç¯ã€‚æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•ä¸_PARALLAX_RAYMARCHING_INTERPOLATE_æ˜¯&lt;strong&gt;ä¸å…¼å®¹&lt;/strong&gt;çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½å†ä¿è¯è¡¨é¢æ˜¯äº¤å‰çš„æœ€åä¸¤ä¸ªæ­¥éª¤ã€‚å½“æˆ‘ä»¬æœç´¢çš„æ—¶å€™ï¼Œç¦ç”¨æ’å€¼ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#if !defined(PARALLAX_RAYMARCHING_SEARCH_STEPS)
&lt;/span&gt;    &lt;span class=&quot;cp&quot;&gt;#define PARALLAX_RAYMARCHING_SEARCH_STEPS 0
#endif
#if PARALLAX_RAYMARCHING_SEARCH_STEPS &amp;gt; 0
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARALLAX_RAYMARCHING_SEARCH_STEPS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#elif defined(PARALLAX_RAYMARCHING_INTERPOLATE)
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevStepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevSurfaceHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;difference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prevDifference&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;difference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prevUVOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ­¤å¾ªç¯ä¹Ÿæ‰§è¡Œä¸åŸå§‹å¾ªç¯ç›¸åŒçš„åŸºæœ¬å·¥ä½œã€‚è°ƒæ•´åç§»é‡å’Œæ­¥é«˜ï¼Œç„¶åé‡‡æ ·é«˜åº¦å­—æ®µã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARALLAX_RAYMARCHING_SEARCH_STEPS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä½†æ¯æ¬¡è¿­ä»£ï¼ŒUVå¢é‡å’Œæ­¥é•¿å‡åŠã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARALLAX_RAYMARCHING_SEARCH_STEPS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åŒæ ·ï¼Œå¦‚æœç‚¹åœ¨è¡¨é¢ä¹‹ä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»æœç›¸åçš„æ–¹å‘ç§»åŠ¨ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvDelta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stepHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stepSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;surfaceHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetParallaxHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uvOffset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è°ƒæ•´ç€è‰²å™¨ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨ä¸‰ä¸ªæœç´¢æ­¥éª¤&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_BIAS 0
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//#define PARALLAX_OFFSET_LIMITING&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_RAYMARCHING_STEPS 10
#define PARALLAX_RAYMARCHING_INTERPOLATE
#define PARALLAX_RAYMARCHING_SEARCH_STEPS 3
#define PARALLAX_FUNCTION ParallaxRaymarching
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012953271-1061541462.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;10æ­¥é•¿åŠ ä¸Š3ä¸ªäºŒåˆ†æŸ¥æ‰¾çš„æœ€ç»ˆæ•ˆæœ.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ç»“æœçœ‹èµ·æ¥ç›¸å½“ä¸é”™ï¼Œä½†ä»ä¸å®Œç¾ã€‚äºŒåˆ†æ³•æœç´¢å¯ä»¥æ¯”ç®€å•çš„æ’å€¼å¤„ç†è¾ƒæµ…çš„è§’åº¦ï¼Œä½†ä»ç„¶éœ€è¦ç›¸å½“å¤šçš„æœç´¢æ­¥éª¤ï¼Œä»¥æ‘†è„±åˆ†å±‚ã€‚æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªè¯•éªŒçš„é—®é¢˜ï¼Œæ‰¾å‡ºå“ªç§æ–¹æ³•åœ¨ç‰¹å®šæƒ…å†µä¸‹æœ€æœ‰æ•ˆï¼Œéœ€è¦å¤šå°‘æ­¥éª¤ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç¼©æ”¾å¯¹è±¡å’ŒåŠ¨æ€æ‰¹å¤„ç†&quot;&gt;ç¼©æ”¾å¯¹è±¡å’ŒåŠ¨æ€æ‰¹å¤„ç†&lt;/h3&gt;

&lt;p&gt;å°½ç®¡æˆ‘ä»¬çš„è§†å·®æ˜ å°„æ–¹æ³•ä¼¼ä¹å¯è¡Œï¼Œä½†å­˜åœ¨ä¸€ä¸ªéšè—çš„é”™è¯¯ã€‚ è€Œä¸”è¿˜æŠŠé”™è¯¯æ˜¾ç¤ºå‡ºæ¥äº†ã€‚å®ƒæ˜¾ç¤ºäº†ä½•æ—¶ä½¿ç”¨åŠ¨æ€æ‰¹å¤„ç†æ¥ç»„åˆå·²ç¼©æ”¾çš„å¯¹è±¡ã€‚ ä¾‹å¦‚ï¼Œç»™æˆ‘ä»¬çš„å››è¾¹å½¢ä¸€ä¸ªåƒ\((10,10,10)\)çš„æ¯”ä¾‹ï¼Œç„¶åå¤åˆ¶å®ƒï¼Œå°†å‰¯æœ¬ç§»åˆ°å®ƒä¸‹é¢ä¸€ç‚¹ã€‚ å‡è®¾åœ¨æ’­æ”¾å™¨è®¾ç½®ä¸­å¯ç”¨äº†æ­¤é€‰é¡¹ï¼Œè¿™å°†è§¦å‘UnityåŠ¨æ€æ‰¹å¤„ç†å››è¾¹å½¢ã€‚&lt;/p&gt;

&lt;p&gt;æ‰¹å¤„ç†å¼€å§‹æ—¶ï¼Œè§†å·®æ•ˆæœå°†æ‰­æ›²ã€‚ æ—‹è½¬ç›¸æœºæ—¶ï¼Œè¿™ä¸€ç‚¹éå¸¸æ˜æ˜¾ã€‚ ä½†æ˜¯ï¼Œè¿™ä»…å‘ç”Ÿåœ¨æ¸¸æˆè§†å›¾å’Œæ„å»ºä¸­ï¼Œè€Œä¸å‘ç”Ÿåœ¨åœºæ™¯è§†å›¾ä¸­ã€‚ è¯·æ³¨æ„ï¼Œstandardç€è‰²å™¨ä¹Ÿå­˜åœ¨æ­¤é—®é¢˜ï¼Œä½†æ˜¯å½“ä½¿ç”¨å¼±åç§»è§†å·®æ•ˆæœæ—¶ï¼Œæ‚¨å¯èƒ½ä¸ä¼šç«‹å³æ³¨æ„åˆ°å®ƒã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/1692664-20200618012954391-1540920343.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;åŠ¨æ€æ‰¹å¤„ç†ä¼šäº§ç”Ÿå¥‡æ€ªçš„ç»“æœ.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;åœ¨æ‰¹å¤„ç†å°†å®ƒä»¬åˆå¹¶åˆ°ä¸€ä¸ªå•ä¸€çš„ç½‘æ ¼ä¸­ä¹‹åï¼ŒUnityä¸èƒ½æ ‡å‡†åŒ–å¤„ç†åçš„å‡ ä½•æ³•å‘é‡å’Œåˆ‡å‘é‡ã€‚å› æ­¤é¡¶ç‚¹æ•°æ®æ­£ç¡®çš„å‡è®¾ä¸å†æˆç«‹ã€‚&lt;/p&gt;

&lt;p&gt;é¡¶ç‚¹æ³•å‘é‡å’Œåˆ‡å‘é‡æ²¡æœ‰è§„èŒƒåŒ–ä¸æ˜¯ä»€ä¹ˆå¤§çš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨é¡¶ç‚¹ç¨‹åºä¸­å°†è§†å›¾å‘é‡è½¬æ¢åˆ°åˆ‡çº¿ç©ºé—´ã€‚å¯¹äºå…¶ä»–æ‰€æœ‰å†…å®¹ï¼Œæ•°æ®åœ¨ä½¿ç”¨ä¹‹å‰éƒ½è¦æ ‡å‡†åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;è§£å†³æ–¹æ³•æ˜¯åœ¨æ„é€ å¯¹è±¡è½¬æ¢åˆ°åˆ‡çº¿çŸ©é˜µä¹‹å‰å¯¹å‘é‡è¿›è¡Œå½’ä¸€åŒ–ã€‚ å› ä¸ºåªæœ‰åŠ¨æ€æ‰¹å¤„ç†çš„ç¼©æ”¾å‡ ä½•æ‰éœ€è¦æ­¤é€‰é¡¹ï¼Œæ‰€ä»¥æ ¹æ®æ˜¯å¦å®šä¹‰äº†PARALLAX_SUPPORT_SCALED_DYNAMIC_BATCHINGï¼Œå°†å…¶è®¾ä¸ºå¯é€‰ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#if defined (_PARALLAX_MAP)
&lt;/span&gt;    &lt;span class=&quot;cp&quot;&gt;#if defined(PARALLAX_SUPPORT_SCALED_DYNAMIC_BATCHING)
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;normalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;float3x3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectToTangent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float3x3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;cross&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xyz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;normal&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tangentViewDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mul&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;objectToTangent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ObjSpaceViewDir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vertex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_BIAS 0
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//#define PARALLAX_OFFSET_LIMITING&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define PARALLAX_RAYMARCHING_STEPS 10
#define PARALLAX_RAYMARCHING_INTERPOLATE
#define PARALLAX_RAYMARCHING_SEARCH_STEPS 3
#define PARALLAX_FUNCTION ParallaxRaymarching
#define PARALLAX_SUPPORT_SCALED_DYNAMIC_BATCHING
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender20/batched-correct.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;åŠ¨æ€æ‰¹é‡ä¸æ­£ç¡®çš„ç»“æœ.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
</description>
        <pubDate>Thu, 25 Jan 2018 20:00:00 +0000</pubDate>
        <link>https://www.damonc.top/Unity_Parallax_Normals_Heightmap.html</link>
        <guid isPermaLink="true">https://www.damonc.top/Unity_Parallax_Normals_Heightmap.html</guid>
        
        <category>Shader</category>
        
        
      </item>
    
      <item>
        <title>Unity GPU Instance(ç¿»è¯‘åä¹)</title>
        <description>&lt;p&gt;æœ¬ç¯‡æ‘˜è¦ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æ¸²æŸ“å¤§é‡çƒä½“-ä¼˜åŒ–DrawCall&lt;/li&gt;
  &lt;li&gt;æ”¯æŒGPU-Instance&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨æè´¨å±æ€§å—&lt;/li&gt;
  &lt;li&gt;LOD-Groupsæ”¯æŒGPU-Instance&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;batching-instance-æ‰¹å¤„ç†&quot;&gt;Batching Instance-æ‰¹å¤„ç†&lt;/h2&gt;

&lt;p&gt;æŒ‡ç¤ºGPUç»˜åˆ¶éœ€è¦èŠ±æ—¶é—´ï¼›å‘å…¶ä¼ é€’meshå’Œmaterialå±æ€§ä¹Ÿè¦èŠ±æ—¶é—´ã€‚ç°åœ¨å·²çŸ¥ä¸¤ç§èŠ‚çœDraw Callçš„æ–¹å¼ï¼šstaticå’Œ&lt;a href=&quot;https://docs.unity3d.com/Manual/DrawCallBatching.html&quot;&gt;&lt;strong&gt;dynamic batching&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Unityå¯ä»¥å°†å¤šä¸ªé™æ€ç‰©ä½“çš„ç½‘æ ¼åˆå¹¶ä¸ºä¸€ä¸ªæ›´å¤§çš„é™æ€ç½‘æ ¼ï¼Œä»è€Œå‡å°‘draw callã€‚ &lt;strong&gt;æ³¨æ„ï¼š&lt;/strong&gt; åªæœ‰ä½¿ç”¨ç›¸åŒæè´¨çš„å¯¹è±¡æ‰èƒ½ä»¥è¿™ç§æ–¹å¼ç»„åˆã€‚ è¿™æ˜¯ä»¥å¿…é¡»å­˜å‚¨æ›´å¤šç½‘æ ¼æ•°æ®ä¸ºä»£ä»·çš„ã€‚ å¯ç”¨åŠ¨æ€æ‰¹å¤„ç†åï¼ŒUnityåœ¨è¿è¡Œæ—¶ä¼šå¯¹è§†å›¾ä¸­çš„åŠ¨æ€å¯¹è±¡æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ è¿™ä»…é€‚ç”¨äºå°å‹ç½‘æ ¼ç‰©ä½“ï¼Œå¦åˆ™å¼€é”€å°†å˜å¾—å¤ªå¤§ã€‚&lt;/p&gt;

&lt;p&gt;è¿˜æœ‰å¦ä¸€ç§ç»„åˆdraw callçš„æ–¹æ³•ï¼šGPU instanceæˆ–Geometry instanceã€‚ä¸åŠ¨æ€æ‰¹å¤„ç†ä¸€æ ·ï¼Œæ­¤æ“ä½œåœ¨è¿è¡Œæ—¶é’ˆå¯¹å¯è§å¯¹è±¡ã€‚ å®ƒçš„ç›®æ ‡æ˜¯è®©GPUä¸€æ¬¡æ€§æ¸²æŸ“åŒä¸€ç½‘æ ¼çš„å¤šä¸ªå‰¯æœ¬ã€‚ å› æ­¤ï¼Œå®ƒä¸èƒ½ç»„åˆä¸åŒçš„ç½‘æ ¼æˆ–æè´¨ã€‚&lt;/p&gt;

&lt;h3 id=&quot;åˆ›å»ºå¤§é‡çƒä½“&quot;&gt;åˆ›å»ºå¤§é‡çƒä½“&lt;/h3&gt;

&lt;div class=&quot;language-plaintext tip-info highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;im title?
test test test.
test test test.
test test test!!dfS:FDFH&amp;amp;*YER#.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UnityEngine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GPUInstancingTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MonoBehaviour&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Transform&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prefab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instances&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;radius&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//å•ä½åœ†å†…éšæœºä¸€ç‚¹å¹¶æ”¾å¤§åæ ‡50å€ï¼Œç”Ÿæˆ5000ä¸ªçƒä½“&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//ç„¶åæŸ¥çœ‹statisticsç»Ÿè®¡çš„draw Callä¿¡æ¯&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Start&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instances&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Transform&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Instantiate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;localPosition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insideUnitSphere&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;radius&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SetParent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä½¿ç”¨forward render pathç»Ÿè®¡åˆ°çš„draw callï¼Œå»æ‰èƒŒæ™¯å’Œcamera Effectä¸¤ä¸ªdraw callï¼š&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010902826-821880737.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;5000 draw call.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ä½†æ˜¯å½“ä½¿ç”¨cubeä»£æ›¿çƒä½“&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010904552-338192039.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;6 draw call.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h3 id=&quot;æ”¯æŒinstance&quot;&gt;æ”¯æŒInstance&lt;/h3&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒGPU Instanceä¸ä¼šå¼€å¯ï¼Œå¿…é¡»è®¾è®¡shaderä»¥æ”¯æŒå®ƒã€‚ å³ä½¿è¿™æ ·ï¼Œä¹Ÿå¿…é¡»ä¸ºæ¯ç§ææ–™æ˜¾å¼å¯ç”¨å®ä¾‹åŒ–ã€‚ Unityçš„standardç€è‰²å™¨æœ‰ä¸€ä¸ªå¼€å…³ã€‚åƒæ ‡å‡†ç€è‰²å™¨çš„GUIä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä¸ºshaderæ‰©å±•é¢æ¿åˆ›å»ºâ€œé«˜çº§é€‰é¡¹â€éƒ¨åˆ†ã€‚ å¯ä»¥é€šè¿‡è°ƒç”¨MaterialEditor.EnableInstancingFieldæ–¹æ³•æ¥æ·»åŠ åˆ‡æ¢ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoAdvanced&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;GUILayout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Advanced Options&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EditorStyles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;boldLabel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;editor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnableInstancingField&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä»…å½“shaderå®é™…æ”¯æŒinstanceæ—¶ï¼Œæ‰ä¼šæ˜¾ç¤ºè¯¥åˆ‡æ¢ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†#pragma multi_compile_instancingæŒ‡ä»¤æ·»åŠ åˆ°ç€è‰²å™¨base-passå¯ç”¨æ­¤æ”¯æŒã€‚ è¿™å°†ä¸ºä¸€äº›å…³é”®å­—å¯ç”¨ç€è‰²å™¨å˜ä½“ï¼Œè‡ªå®šä¹‰å…³é”®å­—_INSTANCING_ON_ï¼Œå…¶ä»–å…³é”®å­—ä¹Ÿå¯ä»¥ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#pragma multi_compile_fwdbase
#pragma multi_compile_fog
#pragma multi_compile_instancing
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010905493-1524350499.png&quot; width=&quot;250&quot; /&gt;&lt;body&gt;&lt;/body&gt;
        &lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010906722-1492830859.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;åˆå¹¶äº†ï¼Œä½†æ˜¯æ˜¾ç¤ºæœ‰é”™è¯¯.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;æ‰¹å¤„ç†æ•°é‡å·²å‡å°‘åˆ°42ï¼Œè¿™æ„å‘³ç€ç°åœ¨ä»…ç”¨40ä¸ªæ‰¹å¤„ç†å³å¯æ¸²æŸ“æ‰€æœ‰5000ä¸ªçƒä½“ã€‚å¸§é€Ÿç‡ä¹Ÿé«˜è¾¾80 fpsï¼Œä½†æ˜¯åªæœ‰å‡ ä¸ªçƒä½“å¯è§ã€‚&lt;strong&gt;é”™è¯¯åŸå› &lt;/strong&gt;ï¼šè™½ç„¶5000ä¸ªçƒä½“ä»åœ¨æ¸²æŸ“ï¼Œä½†æ˜¯åœ¨åˆæ‰¹ä¸­åŒä¸€æ‰¹æ¬¡çš„æ‰€æœ‰çƒä½“çš„é¡¶ç‚¹è½¬æ¢æ—¶éƒ½ä½¿ç”¨äº†åŒä¸€ä¸ªä½ç½®ï¼šå®ƒä»¬éƒ½ä½¿ç”¨åŒä¸€æ‰¹æ¬¡ä¸­ç¬¬ä¸€ä¸ªçƒçš„è½¬æ¢çŸ©é˜µã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºç°åœ¨åŒä¸€æ‰¹ä¸­æ‰€æœ‰çƒä½“çš„çŸ©é˜µéƒ½ä½œä¸ºæ•°ç»„å‘é€åˆ°GPUã€‚ åœ¨ä¸å‘ŠçŸ¥ç€è‰²å™¨è¦ä½¿ç”¨å“ªä¸ªæ•°ç»„ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œå®ƒå§‹ç»ˆä½¿ç”¨ç¬¬ä¸€ä¸ªç´¢å¼•ã€‚&lt;/p&gt;

&lt;h3 id=&quot;instance-ids&quot;&gt;Instance IDs&lt;/h3&gt;

&lt;p&gt;ä¸Šè¿°é”™è¯¯è§£å†³åŠæ³•ï¼šæ¯ä¸ªInstanceç›¸å¯¹åº”çš„æ•°ç»„ç´¢å¼•ç§°ä¸ºå…¶Instance IDï¼ŒGPUé€šè¿‡é¡¶ç‚¹æ•°æ®å°†å…¶ä¼ é€’åˆ°ç€è‰²å™¨çš„vertexç¨‹åºã€‚åœ¨å¤§å¤šæ•°å¹³å°ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œåä¸ºinstanceIDï¼Œå…·æœ‰SV_InstanceIDè¯­ä¹‰ã€‚ æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨_UNITY_VERTEX_INPUT_INSTANCE_ID_å®å°†å…¶åŒ…å«åœ¨æˆ‘ä»¬çš„VertexDataç»“æ„ä¸­ã€‚ å®ƒåœ¨UnityCGä¸­åŒ…å«çš„_UnityInstancing.cginc_æ–‡ä»¶ä¸­å®šä¹‰ã€‚ å®ƒä¸ºæˆ‘ä»¬æä¾›äº†å®ä¾‹IDçš„æ­£ç¡®å®šä¹‰ï¼Œæˆ–è€…åœ¨æœªå¯ç”¨å®ä¾‹åŒ–æ—¶ä¸æä¾›ä»»ä½•å†…å®¹ã€‚å°†å…¶æ·»åŠ åˆ°VertexDataç»“æ„ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;VertexData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_VERTEX_INPUT_INSTANCE_ID&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vertex&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;POSITION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ç”¨instanceåï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨é¡¶ç‚¹ç¨‹åºä¸­è®¿é—®instanceIDã€‚ æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å˜æ¢é¡¶ç‚¹ä½ç½®æ—¶ä½¿ç”¨æ­£ç¡®çš„çŸ©é˜µã€‚ ä½†æ˜¯ï¼ŒUnityObjectToClipPoså‡½æ•°æ²¡æœ‰çŸ©é˜µå‚æ•°ï¼Œå®ƒå‡½æ•°å†…éƒ¨å§‹ç»ˆä½¿ç”¨unity_ObjectToWorldçŸ©é˜µã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼ŒUnityInstancingåŒ…å«æ–‡ä»¶ä¼šä½¿ç”¨çŸ©é˜µæ•°ç»„çš„å®è¦†ç›–unity_ObjectToWorldã€‚ &lt;em&gt;è¿™å¯ä»¥è¢«è®¤ä¸ºæ˜¯è‚®è„çš„å®æŠ€å·§ï¼Œä½†æ— éœ€æ›´æ”¹ç°æœ‰ç€è‰²å™¨ä»£ç å³å¯å·¥ä½œï¼Œä»è€Œç¡®ä¿äº†å‘åå…¼å®¹æ€§&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è¦ä½¿å®ƒå·¥ä½œï¼Œinstanceçš„æ•°ç»„ç´¢å¼•å¿…é¡»å¯¹æ‰€æœ‰ç€è‰²å™¨ä»£ç å…¨å±€å¯ç”¨ã€‚å¿…é¡»é€šè¿‡_UNITY_SETUP_INSTANCE_ID_å®è¿›è¡Œæ‰‹åŠ¨è®¾ç½®ï¼Œè¯¥å®å¿…é¡»åœ¨vertexç¨‹åºæœ€å…ˆè®¡ç®—ï¼Œç„¶åå†æ‰§è¡Œå…¶ä»–çš„ä»£ç ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyVertexProgram&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VertexData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_INITIALIZE_OUTPUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_SETUP_INSTANCE_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UnityObjectToClipPos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vertex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010908398-221325174.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;çŸ©é˜µæ›¿æ¢å†…éƒ¨å®ç°ï¼Ÿ.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//UnityInstancingä¸­çš„å®é™…ä»£ç è¦å¤æ‚å¾—å¤šã€‚ å®ƒè¦å¤„ç†å¹³å°å·®å¼‚ï¼Œå…¶ä»–ä½¿ç”¨å®ä¾‹åŒ–çš„æ–¹æ³•ä»¥åŠç”¨äºç«‹&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//ä½“å£°æ¸²æŸ“çš„ç‰¹æ®Šä»£ç ï¼Œä»è€Œå¯¼è‡´é—´æ¥å®šä¹‰çš„å¤šä¸ªæ­¥éª¤ã€‚ å®ƒè¿˜å¿…é¡»é‡æ–°å®šä¹‰UnityObjectToClipPosï¼Œå› &lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//ä¸ºUnityCGé¦–å…ˆåŒ…å«UnityShaderUtilitiesã€‚&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//ç¼“å†²åŒºå®å°†åœ¨åé¢è¯´æ˜ã€‚&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uint&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unity_InstanceID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;CBUFFER_START&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UnityDrawCallInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Where the current batch starts within the instanced arrays.&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unity_BaseInstanceID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CBUFFER_END&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#define UNITY_VERTEX_INPUT_INSTANCE_ID uint instanceID : SV_InstanceID;
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define UNITY_SETUP_INSTANCE_ID(input) \
    unity_InstanceID = input.instanceID + unity_BaseInstanceID;
&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Redefine some of the built-in variables&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// macros to make them work with instancing.&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCING_CBUFFER_START&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PerDraw0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float4x4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unity_ObjectToWorldArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCED_ARRAY_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float4x4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unity_WorldToObjectArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCED_ARRAY_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCING_CBUFFER_END&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define unity_ObjectToWorld     unity_ObjectToWorldArray[unity_InstanceID]
#define unity_WorldToObject     unity_WorldToObjectArray[unity_InstanceID]
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æ‰¹å¤„ç†å¤§å°&quot;&gt;æ‰¹å¤„ç†å¤§å°&lt;/h3&gt;

&lt;p&gt;æ¯å°è®¾å¤‡ä¸ä¸€æ ·ï¼Œæœ€ç»ˆå¾—åˆ°çš„æ‰¹æ¬¡æ•°é‡å¯èƒ½ä¸å½“å‰å®éªŒå¾—åˆ°çš„æ•°é‡ä¸åŒã€‚ç°åœ¨è¿™æƒ…å†µä¸‹ï¼Œä»¥40æ‰¹æ¸²æŸ“5000ä¸ªçƒä½“å®ä¾‹ï¼Œè¿™æ„å‘³ç€æ¯æ‰¹125ä¸ªçƒä½“ã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªæ‰¹æ¬¡éƒ½éœ€è¦è‡ªå·±çš„çŸ©é˜µæ•°ç»„ã€‚ æ­¤æ•°æ®å‘é€åˆ°GPUå¹¶å­˜å‚¨åœ¨å†…å­˜ç¼“å†²åŒºä¸­ï¼Œåœ¨Direct3Dä¸­ç§°ä¸ºå¸¸é‡ç¼“å†²åŒºï¼Œåœ¨OpenGLä¸­ç§°ä¸ºç»Ÿä¸€ç¼“å†²åŒºã€‚ è¿™äº›&lt;strong&gt;ç¼“å†²åŒºå…·æœ‰æœ€å¤§å¤§å°&lt;/strong&gt;ï¼Œè¿™é™åˆ¶äº†ä¸€æ‰¹ä¸­å¯ä»¥å®¹çº³å¤šå°‘ä¸ªå®ä¾‹ã€‚ å‡è®¾å°å¼æœºGPUæ¯ä¸ªç¼“å†²åŒºçš„é™åˆ¶ä¸º64KBã€‚&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ªçŸ©é˜µç”±16ä¸ªæµ®ç‚¹æ•°ç»„æˆï¼Œæ¯ä¸ªæµ®ç‚¹æ•°å‡ä¸º4ä¸ªå­—èŠ‚ã€‚ å› æ­¤ï¼Œæ¯ä¸ªçŸ©é˜µ64ä¸ªå­—èŠ‚ã€‚ æ¯ä¸ªå®ä¾‹éƒ½éœ€è¦ä¸€ä¸ªå¯¹è±¡åˆ°ä¸–ç•Œçš„è½¬æ¢çŸ©é˜µã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªä¸–ç•Œåˆ°å¯¹è±¡çš„çŸ©é˜µæ¥è½¬æ¢æ³•çº¿å‘é‡ã€‚ å› æ­¤ï¼Œæœ€ç»ˆæ¯ä¸ªå®ä¾‹æœ‰128ä¸ªå­—èŠ‚ã€‚ è¿™å¯¼è‡´æœ€å¤§æ‰¹å¤„ç†å¤§å°ä¸ºâ€œ 64000/128 = 500â€ï¼Œè¿™åªèƒ½åœ¨10ä¸ªæ‰¹å¤„ç†ä¸­æ¸²æŸ“5000ä¸ªçƒä½“ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;å†…å­˜å•ä½æ˜¯2è¿›åˆ¶ï¼Œæ‰€ä»¥1KBè¡¨ç¤º1024å­—èŠ‚ï¼Œè€Œä¸æ˜¯1000ã€‚å› æ­¤ï¼Œ&apos;(64 * 1024)/ 128 = 512 &apos;ã€‚UNITY_INSTANCED_ARRAY_SIZEé»˜è®¤å®šä¹‰ä¸º500ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ç¼–è¯‘å™¨æŒ‡ä»¤è¦†ç›–å®ƒã€‚ä¾‹å¦‚ï¼Œ#pragma instancing_options maxcount:512å°†æœ€å¤§å€¼è®¾ç½®ä¸º512ã€‚ä½†æ˜¯ï¼Œè¿™å°†å¯¼è‡´æ–­è¨€å¤±è´¥é”™è¯¯ï¼Œå› æ­¤å®é™…é™åˆ¶ä¸º511ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ500å’Œ512ä¹‹é—´æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å³ä½¿å‡è®¾å°å¼æœºçš„æœ€å¤§å®¹é‡ä¸º64KBæˆç«‹ï¼Œä½†æ˜¯å¤§å¤šæ•°ç§»åŠ¨è®¾å¤‡çš„æœ€å¤§å®¹é‡è¿œè¿œè¾¾ä¸åˆ°64ï¼Œå¯èƒ½ä»…ä¸º16KBã€‚ Unityé€šè¿‡åœ¨é’ˆå¯¹OpenGL ES 3ï¼ŒOpenGL Coreæˆ–Metalæ—¶å°†æœ€å¤§å€¼é™¤ä»¥å››æ¥è§£å†³æ­¤é—®é¢˜ã€‚ å› ä¸ºæˆ‘åœ¨ç¼–è¾‘å™¨ä¸­ä½¿ç”¨çš„æ˜¯OpenGL Coreï¼Œæ‰€ä»¥æœ€ç»ˆçš„æœ€å¤§æ‰¹å¤„ç†å¤§å°ä¸ºâ€œ 500/4 = 125â€ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥é€šè¿‡æ·»åŠ ç¼–è¯‘å™¨æŒ‡ä»¤#pragma instancing_options force_same_maxcount_for_glæ¥ç¦ç”¨æ­¤è‡ªåŠ¨å‡å°‘åŠŸèƒ½ã€‚ å¤šä¸ªinstanceé€‰é¡¹ç»„åˆåœ¨åŒä¸€æŒ‡ä»¤ä¸­ã€‚ ä½†æ˜¯ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´åœ¨éƒ¨ç½²åˆ°ç§»åŠ¨è®¾å¤‡ä¸Šæ—¶å‘ç”Ÿæ•…éšœï¼Œå› æ­¤è¯·å°å¿ƒä½¿ç”¨ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;é‚£å‡è®¾å‡ç­‰ç¼©æ”¾é€‰é¡¹å‘¢ï¼Ÿ

å¯ä»¥ä½¿ç”¨#pragma instancing_optionsæŒ‡ç¤ºæ‰€æœ‰instanceå¯¹è±¡å…·æœ‰ç»Ÿä¸€çš„ç¼©æ”¾æ¯”ä¾‹ã€‚ è¿™æ¶ˆé™¤äº†å°†ä¸–ç•Œåˆ°å¯¹è±¡çŸ©é˜µç”¨äºæ³•çº¿è½¬æ¢çš„éœ€è¦(å°‘å­˜å‚¨ä¸€ä¸ªçŸ©é˜µ)ã€‚ è®¾ç½®æ­¤é€‰é¡¹åï¼Œè™½ç„¶UnityObjectToWorldNormalå‡½æ•°ç¡®å®ä¼šæ›´æ”¹å…¶è¡Œä¸ºï¼Œä½†å®ƒä¸ä¼šæ¶ˆé™¤ç¬¬äºŒä¸ªçŸ©é˜µæ•°ç»„ã€‚ å› æ­¤ï¼Œè‡³å°‘åœ¨Unity 2017.1.0ä¸­ï¼Œæ­¤é€‰é¡¹å®é™…ä¸Šæ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;instance-shadows&quot;&gt;Instance Shadows&lt;/h3&gt;

&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€ç›´æ²¡æœ‰é˜´å½±ã€‚ é‡æ–°æ‰“å¼€ä¸»é˜´å½±çš„Soft shadowï¼Œå¹¶ç¡®ä¿é˜´å½±è·ç¦»è¶³ä»¥åŒ…å«æ‰€æœ‰çƒä½“&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010909964-776430193.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;æ‰¹å¤„ç†çˆ†ç‚¸.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ä¸ºå¤§é‡ç‰©ä½“æ¸²æŸ“é˜´å½±ä¼šå¢åŠ GPUè€—èƒ½ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ¸²æŸ“çƒä½“é˜´å½±æ—¶ä½¿ç”¨GPU instanceã€‚åœ¨shadow caster-passä¸­æ·»åŠ instanceæŒ‡ä»¤ï¼›åŒæ—¶ä¹Ÿå¢åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UNITY_VERTEX_INPUT_INSTANCE_ID&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UNITY_SETUP_INSTANCE_ID&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#pragma multi_compile_shadowcaster
#pragma multi_compile_instancing
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;VertexData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;UNITY_VERTEX_INPUT_INSTANCE_ID&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyShadowVertexProgram&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VertexData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;UNITY_SETUP_INSTANCE_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010911627-1161944067.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;instanced é˜´å½±.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h3 id=&quot;å¤šå…‰æº&quot;&gt;å¤šå…‰æº&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬ä»…åœ¨base-passå’Œshadow caster-passä¸­æ·»åŠ äº†instanceæ”¯æŒã€‚ å› æ­¤ï¼Œæ‰¹å¤„ç†ä¸é€‚ç”¨äºå…¶ä»–å…‰æºã€‚ è¦éªŒè¯è¿™ä¸€ç‚¹ï¼Œåœç”¨ä¸»å…‰æºå¹¶æ·»åŠ ä¸€äº›ä¼šå½±å“å¤šä¸ªçƒä½“çš„èšå…‰ç¯æˆ–ç‚¹å…‰æºã€‚ ä¸è¦ä¸ºå®ƒä»¬æ‰“å¼€é˜´å½±ï¼Œå› ä¸ºé‚£æ ·ä¼šé™ä½å¸§é€Ÿç‡ã€‚&lt;/p&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010913312-1389275661.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;æ‰¹å¤„ç†çˆ†ç‚¸.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;ä¸Šå›¾ï¼Œå®Œå…¨ä¸æ”¯æŒå¤šå…‰æºæ‰¹å¤„ç†ã€‚ è¦å°†instanceä¸å¤šä¸ªå…‰æºç»“åˆä½¿ç”¨ï¼Œåªèƒ½åˆ‡æ¢åˆ°å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ã€‚ ä¸ºæ­¤ï¼Œè¯·å°†æ‰€éœ€çš„ç¼–è¯‘å™¨æŒ‡ä»¤æ·»åŠ åˆ°ç€è‰²å™¨çš„å»¶è¿Ÿä¼ é€’ä¸­ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#pragma multi_compile_prepassfinal
#pragma multi_compile_instancing
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010914967-1310775534.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;å¤šå…‰æºinstance.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;h2 id=&quot;mixing-material-properties&quot;&gt;Mixing Material Properties&lt;/h2&gt;

&lt;p&gt;æ‰€æœ‰æ‰¹å¤„ç†éƒ½æœ‰ä¸€ä¸ªé™åˆ¶ï¼šå®ƒä»¬ä»…é™äºå…·æœ‰ç›¸åŒææ–™çš„å¯¹è±¡ã€‚ å½“æˆ‘ä»¬å¸Œæœ›æ¸²æŸ“çš„å¯¹è±¡å…·æœ‰å¤šæ ·æ€§æ—¶ï¼Œæ­¤é™åˆ¶å°±ä¼šæˆä¸ºé—®é¢˜ã€‚&lt;/p&gt;

&lt;h3 id=&quot;éšæœºç€è‰²&quot;&gt;éšæœºç€è‰²&lt;/h3&gt;

&lt;p&gt;éšæœºæ”¹å˜çƒä½“çš„é¢œè‰²&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instances&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Transform&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Instantiate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;localPosition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insideUnitSphere&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;radius&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SetParent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GetComponent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MeshRenderer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;material&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;    &lt;span class=&quot;kr&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010916576-490651101.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;çƒä½“ä¸éšæœºçš„é¢œè‰²ï¼Œæ²¡æœ‰æ‰¹é‡å’Œé˜´å½±.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;

&lt;p&gt;å³ä½¿æˆ‘ä»¬ä¸ºç‰©æ–™å¯ç”¨äº†æ‰¹å¤„ç†ï¼Œå®ƒä¹Ÿä¸å†èµ·ä½œç”¨ã€‚ç”±äºæ¯ä¸ªçƒä½“ç°åœ¨éƒ½æœ‰è‡ªå·±çš„æè´¨ï¼Œå› æ­¤æ¯ä¸ªçƒä½“çš„ç€è‰²å™¨çŠ¶æ€ä¹Ÿå¿…è¢«æ›´æ”¹ã€‚ è¿™æ˜¾ç¤ºåœ¨ç»Ÿè®¡é¢æ¿ä¸­ä¸ºSetPass callçš„æ•°é‡ã€‚åœ¨è¿™ä¿®æ”¹ä¹‹å‰åªæœ‰å°‘é‡å‡ ä¸ªæ‰¹æ¬¡æ¸²æŸ“ï¼Œä½†æ˜¯ç°åœ¨æ˜¯5000åŠ æ‰¹æ¬¡ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æè´¨å±æ€§å—-material-property-blocks&quot;&gt;æè´¨å±æ€§å—-Material Property Blocks&lt;/h3&gt;

&lt;p&gt;é™¤äº†ä¸ºæ¯ä¸ªçƒä½“åˆ›å»ºæ–°çš„æè´¨å®ä¾‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æè´¨å±æ€§å—ã€‚ è¿™äº›æ˜¯å°çš„ä¿®æ”¹ï¼Œè®¾ç½®å±æ€§å—çš„é¢œè‰²å¹¶å°†å…¶ä¼ é€’ç»™çƒä½“çš„æ¸²æŸ“å™¨ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ†é…æè´¨çš„é¢œè‰²ã€‚&lt;a href=&quot;http://docs.unity3d.com/Documentation/ScriptReference/MaterialPropertyBlock.html&quot;&gt;MaterialPropertyBlock&lt;/a&gt;å®˜ç½‘ä»‹ç»;&lt;/p&gt;

&lt;h3 id=&quot;property-buffers-å±æ€§ç¼“å†²åŒº&quot;&gt;Property Buffers-å±æ€§ç¼“å†²åŒº&lt;/h3&gt;

&lt;p&gt;æ¸²æŸ“instanceå¯¹è±¡æ—¶ï¼ŒUnityé€šè¿‡æ•°ç»„å½¢å¼å°†é¢œè‰²æ•°æ®ä¼ é€’åˆ°GPUå†…å­˜å¹¶è½¬æ¢çŸ©é˜µï¼ŒUnityå¯¹å­˜å‚¨åœ¨ææ–™å±æ€§å—ä¸­çš„å±æ€§æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œä½†è¦ä½¿å…¶èµ·ä½œç”¨çš„è¯ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨shaderä¸­å®šä¹‰ä¸€ä¸ªinstanceçš„ç¼“å†²åŒºã€‚&lt;/p&gt;

&lt;p&gt;å£°æ˜instanceç¼“å†²åŒºçš„å·¥ä½œç±»ä¼¼äºåˆ›å»ºè¯¸å¦‚æ’å€¼å™¨ä¹‹ç±»çš„ç»“æ„ï¼Œä½†æ˜¯ç¡®åˆ‡çš„è¯­æ³•å› å¹³å°è€Œå¼‚ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨UNITY_INSTANCING_CBUFFER_STARTå’ŒUNITY_INSTANCING_CBUFFER_ENDå®æ¥è§£å†³å·®å¼‚ã€‚ å¯ç”¨å®ä¾‹åŒ–åï¼Œå®ƒä»¬å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;å°†_Colorå˜é‡çš„å®šä¹‰æ”¾åœ¨instanceç¼“å†²åŒºä¸­ã€‚ UNITY_INSTANCING_CBUFFER_STARTå®éœ€è¦ä¸€ä¸ªåç§°å‚æ•°ï¼Œå®é™…åç§°æ— å…³ç´§è¦ä½†è¦æ³¨æ„é¿å…é‡åå†²çªã€‚ å®ä»¥UNITY_INSTANCING_ä¸ºå…¶å‰ç¼€ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCING_CBUFFER_START&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InstanceProperties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_Color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCING_CBUFFER_END&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åƒå˜æ¢çŸ©é˜µä¸€æ ·ï¼Œå¯ç”¨instanceåï¼Œé¢œè‰²æ•°æ®ä½œä¸ºæ•°ç»„ä¸Šä¼ åˆ°GPUã€‚UNITY_DEFINE_INSTANCED_PROPå®ä¼šä¸ºæˆ‘ä»¬å¤„ç†æ­£ç¡®çš„å£°æ˜è¯­æ³•ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCING_CBUFFER_START&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InstanceProperties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//float4 _Color;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_DEFINE_INSTANCED_PROP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_Color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCING_CBUFFER_END&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœ€åè¦è®¿é—®fragmentç¨‹åºä¸­çš„æ•°ç»„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨å…¶ä¸­çŸ¥é“instanceIDã€‚ å› æ­¤ï¼Œå°†å…¶æ·»åŠ åˆ°æ’å€¼å™¨ç»“æ„ä¸­ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_VERTEX_INPUT_INSTANCE_ID&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_VERTEX_INPUT_INSTANCE_ID&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨vertexé¡¶ç‚¹ç¨‹åºä¸­ï¼Œå°†IDä»é¡¶ç‚¹æ•°æ®å¤åˆ¶åˆ°æ’å€¼å™¨ã€‚ å¯ç”¨å®ä¾‹åŒ–æ—¶ï¼ŒUNITY_TRANSFER_INSTANCE_IDå®å®šä¹‰æ­¤ç®€å•æ“ä½œï¼Œå¦åˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyVertexProgram&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VertexData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_INITIALIZE_OUTPUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_SETUP_INSTANCE_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_TRANSFER_INSTANCE_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ç‰‡æ®µç¨‹åºçš„å¼€å¤´ï¼Œä½¿IDå…¨å±€å¯ç”¨ï¼Œå°±åƒåœ¨é¡¶ç‚¹ç¨‹åºä¸­ä¸€æ ·ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;FragmentOutput&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyFragmentProgram&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_SETUP_INSTANCE_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ä¸ä½¿ç”¨instanceæ—¶ä»¥_Colorçš„å½¢å¼è®¿é—®é¢œè‰²ï¼Œè€Œåœ¨å¯ç”¨å®ä¾‹åŒ–æ—¶ä»¥_Color [unity_InstanceID]çš„å½¢å¼è®¿é—®é¢œè‰²ã€‚ ä½¿ç”¨UNITY_ACCESS_INSTANCED_PROPå®å¯åŒæ—¶æ”¯æŒä¸Šè¿°ä¸¤ç§è®¿é—®ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;float3&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetAlbedo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;float3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;albedo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;tex2D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_MainTex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgb&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UNITY_ACCESS_INSTANCED_PROP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_Color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetAlpha&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UNITY_ACCESS_INSTANCED_PROP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_Color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;æ–°ç‰ˆæœ¬å¦‚æœç¼–è¯‘æœ‰é”™è¯¯ï¼š
ä»2017.3åŠä»¥ä¸Šç‰ˆæœ¬, UNITY_ACCESS_INSTANCED_PROP macroæ”¹äº†å®ƒéœ€è¦çš„ä¸¤ä¸ªå‚æ•°ï¼šbufferåï¼Œé¢œè‰²åä½¿ç”¨UNITY_ACCESS_INSTANCED_PROP(InstanceProperties, _Color).
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010918398-38688989.png&quot; width=&quot;250&quot; /&gt;&lt;/center&gt;

&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬çš„é¢œè‰²éšæœºçš„çƒå†æ¬¡è¢«æ‰¹å¤„ç†ã€‚ æˆ‘ä»¬&lt;strong&gt;å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼ä½¿å…¶ä»–å±æ€§å¯å˜ã€‚ å¯¹äºé¢œè‰²ï¼Œæµ®ç‚¹æ•°ï¼ŒçŸ©é˜µå’Œå››åˆ†é‡æµ®ç‚¹å‘é‡ï¼Œè¿™æ˜¯å¯èƒ½çš„&lt;/strong&gt;ã€‚ &lt;strong&gt;å¦‚æœè¦æ”¹å˜çº¹ç†ï¼Œå¯ä»¥ä½¿ç”¨å•ç‹¬çš„çº¹ç†æ•°ç»„&lt;/strong&gt;ï¼Œå¹¶å°†ç´¢å¼•æ·»åŠ åˆ°å®ä¾‹åŒ–ç¼“å†²åŒºã€‚å…¶ä»–å±æ€§ä¿®æ”¹ç±»ä¼¼ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥åœ¨åŒä¸€ä¸ªç¼“å†²åŒºä¸­ç»„åˆå¤šä¸ªå±æ€§ï¼Œä½†è¦ç‰¢è®°å¤§å°é™åˆ¶ã€‚ è¿˜åº”æ³¨æ„ï¼Œç¼“å†²åŒºè¢«åˆ’åˆ†ä¸º32ä½å—ï¼Œå› æ­¤å•ä¸ªæµ®ç‚¹æ•°éœ€è¦ä¸å‘é‡ç›¸åŒçš„ç©ºé—´ã€‚ æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªç¼“å†²åŒºï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ä¸ªé™åˆ¶ï¼Œå®ƒä»¬ä¸æ˜¯å…è´¹æä¾›çš„ã€‚ å¯ç”¨instanceåï¼Œæ¯ä¸ªè¦ç¼“å†²çš„å±æ€§éƒ½å°†æˆä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå› æ­¤ä»…å¯¹éœ€è¦æ ¹æ®instanceå˜åŒ–çš„å±æ€§æ‰§è¡Œæ­¤æ“ä½œã€‚&lt;/p&gt;

&lt;h3 id=&quot;é˜´å½±&quot;&gt;é˜´å½±&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬çš„é˜´å½±ä¹Ÿå–å†³äºé¢œè‰²ã€‚ è°ƒæ•´shaderé˜´å½±ä»¥ä¾¿æ¯ä¸ªå®ä¾‹ä¹Ÿå¯ä»¥æ”¯æŒå”¯ä¸€çš„é¢œè‰²ã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//float4 _Color;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCING_CBUFFER_START&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InstanceProperties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_DEFINE_INSTANCED_PROP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_Color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UNITY_INSTANCING_CBUFFER_END&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_VERTEX_INPUT_INSTANCE_ID&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_VERTEX_INPUT_INSTANCE_ID&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetAlpha&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UNITY_ACCESS_INSTANCED_PROP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_Color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyShadowVertexProgram&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VertexData&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;InterpolatorsVertex&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_SETUP_INSTANCE_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_TRANSFER_INSTANCE_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;float4&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyShadowFragmentProgram&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Interpolators&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SV_TARGET&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UNITY_SETUP_INSTANCE_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;lod-instance&quot;&gt;LOD Instance&lt;/h3&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;MaterialPropertyBlock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MaterialPropertyBlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instances&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Transform&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Instantiate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;localPosition&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insideUnitSphere&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;radius&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetParent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//MaterialPropertyBlock properties = new MaterialPropertyBlock();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetColor&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;s&quot;&gt;&quot;_Color&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//t.GetComponent&amp;lt;MeshRenderer&amp;gt;().SetPropertyBlock(properties);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;MeshRenderer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GetComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MeshRenderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetPropertyBlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; 
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;//å¯¹LODå­å¯¹è±¡è®¾ç½®é¢œè‰²&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ci&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ci&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;childCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GetComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MeshRenderer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetPropertyBlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010919954-2006515171.png&quot; width=&quot;250&quot; /&gt;&lt;/center&gt;

&lt;p&gt;ä¸å¹¸çš„æ˜¯æ²¡æœ‰æœ‰æ•ˆçš„æ‰¹å¤„ç†ã€‚Unityèƒ½å¤Ÿå¯¹ä»¥ç›¸åŒçš„LODé¢œè‰²çƒä½“è¿›è¡Œæ‰¹å¤„ç†ï¼Œä½†æ˜¯å¦‚æœå¯ä»¥åƒå¾€å¸¸ä¸€æ ·è¿›è¡Œæ‰¹å¤„ç†ä¼šæ›´å¥½ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”¨ç¼“å†²æ•°ç»„æ›¿æ¢unity_LODFadeæ¥å®ç°ã€‚å¯ä»¥é€šè¿‡ä¸ºæ”¯æŒå®ä¾‹åŒ–çš„æ¯ä¸ªè¿‡ç¨‹æ·»åŠ lodfadeå®ä¾‹åŒ–é€‰é¡¹æ¥æŒ‡ç¤ºUnityçš„ç€è‰²å™¨ä»£ç æ‰§è¡Œæ­¤æ“ä½œã€‚&lt;/p&gt;

&lt;div class=&quot;language-hlsl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#pragma multi_compile_instancing
#pragma instancing_options lodfade
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;!--url1 url2 url3 url4 url5
    ä»£è¡¨ä¸€æ¬¡åŠ è½½å¤šå°‘å¼ å›¾
--&gt;
&lt;center class=&quot;half&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://img.damonc.top/posts/2018/month1/catRender19/1692664-20200612010921540-656727216.png&quot; width=&quot;250&quot; /&gt;&lt;font size=&quot;2.5&quot;&gt;
            &lt;i&gt;instance LOD fading.&lt;/i&gt;
        &lt;/font&gt;&lt;/center&gt;
</description>
        <pubDate>Wed, 24 Jan 2018 20:00:00 +0000</pubDate>
        <link>https://www.damonc.top/Unity_GPU_Instance.html</link>
        <guid isPermaLink="true">https://www.damonc.top/Unity_GPU_Instance.html</guid>
        
        <category>Shader</category>
        
        
      </item>
    
  </channel>
</rss>
